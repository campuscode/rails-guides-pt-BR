<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Active Support Core Extensions — Ruby on Rails Guides</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
  <link rel="stylesheet" type="text/css" href="stylesheets/highlight.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/search.css" data-turbolinks-track="reload">
  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
  <script src="javascripts/turbolinks.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/clipboard.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/guides.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/search.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/lunr-documents.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/lunr.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/toggle-theme.js" data-turbolinks-track="reload"></script>
  <meta property="og:title" content="Active Support Core Extensions — Ruby on Rails Guides" />
  <meta name="description" content="Active Support Core ExtensionsO Active Support é o componente em Ruby on Rails responsável por fornecer à linguagem Ruby extensões, utilidades e outras funcionalidades paralelas.Ele oferece um riquíssimo ponto de partida no nível da linguagem, onde pode-se aproveitar tanto para o desenvolvimento de aplicações Rails, quanto no próprio desenvolvimento da tecnologia Ruby on Rails.Depois de ler esse guia, você saberá: O que são Core Extensions. Como carregar todas as extensões. Como escolher apenas as extensões que você precisa. Quais extensões o Active Support fornece." />
  <meta property="og:description" content="Active Support Core ExtensionsO Active Support é o componente em Ruby on Rails responsável por fornecer à linguagem Ruby extensões, utilidades e outras funcionalidades paralelas.Ele oferece um riquíssimo ponto de partida no nível da linguagem, onde pode-se aproveitar tanto para o desenvolvimento de aplicações Rails, quanto no próprio desenvolvimento da tecnologia Ruby on Rails.Depois de ler esse guia, você saberá: O que são Core Extensions. Como carregar todas as extensões. Como escolher apenas as extensões que você precisa. Quais extensões o Active Support fornece." />
  <meta property="og:locale" content="pt_BR" />
  <meta property="og:site_name" content="Guia Ruby on Rails" />
  <meta property="og:image" content="https://avatars.githubusercontent.com/u/4223" />
  <meta property="og:type" content="website" />
</head>
<body class="guide">
  <div>
    <div id="version-badge">v6.1.4</div>
  </div>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">Veja mais em <a href="https://rubyonrails.org/">rubyonrails.org:</a> </strong>
      <span class="red-button more-info-button">
        Mais Ruby on Rails
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://weblog.rubyonrails.org/">Blog</a></li>
        <li class="more-info"><a href="https://guides.rubyonrails.org/">Guia oficial</a></li>
        <li class="more-info"><a href="https://api.rubyonrails.org/">API</a></li>
        <li class="more-info"><a href="https://discuss.rubyonrails.org/">Forum</a></li>
        <li class="more-info"><a href="https://github.com/rails/rails">Contribua no GitHub</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="Voltar para a página principal">Guiarails.com.br</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">Home</a></li>
        <li class="guides-search guides-search-large">
          <input class="search-box search-box-large nav-item" type="text" placeholder="Digite o termo...">
          <div class="search-results"></div>
          <div class="search-spinner">Aguarde...</div>
        </li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">Guias</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
            <dl class="guides-section-container">
                <div class="guides-section">
                  <dt>Comece aqui</dt>
                  <dd><a href="getting_started.html">Começando com Rails</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Models</dt>
                  <dd><a href="active_record_basics.html">Active Record Basics</a></dd>
                  <dd><a href="active_record_migrations.html">Active Record Migrations</a></dd>
                  <dd><a href="active_record_validations.html">Active Record Validations</a></dd>
                  <dd><a href="active_record_callbacks.html">Active Record Callbacks</a></dd>
                  <dd><a href="association_basics.html">Active Record Associations</a></dd>
                  <dd><a href="active_record_querying.html">Active Record Query Interface</a></dd>
                  <dd><a href="active_model_basics.html">Active Model Basics</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Views</dt>
                  <dd><a href="action_view_overview.html">Action View Overview</a></dd>
                  <dd><a href="layouts_and_rendering.html">Layouts and Rendering in Rails</a></dd>
                  <dd><a href="action_view_helpers.html">Action View Helpers</a></dd>
                  <dd><a href="form_helpers.html">Action View Form Helpers</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Controllers</dt>
                  <dd><a href="action_controller_overview.html">Action Controller Overview</a></dd>
                  <dd><a href="routing.html">Rails Routing from the Outside In</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Outros componentes</dt>
                  <dd><a href="active_support_core_extensions.html">Active Support Core Extensions</a></dd>
                  <dd><a href="action_mailer_basics.html">Action Mailer Basics</a></dd>
                  <dd><a href="action_mailbox_basics.html">Action Mailbox Basics</a></dd>
                  <dd><a href="action_text_overview.html">Action Text Overview</a></dd>
                  <dd><a href="active_job_basics.html">Active Job Basics</a></dd>
                  <dd><a href="active_storage_overview.html">Active Storage Overview</a></dd>
                  <dd><a href="action_cable_overview.html">Action Cable Overview</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Indo mais fundo</dt>
                  <dd><a href="i18n.html">Rails Internationalization (I18n) API</a></dd>
                  <dd><a href="testing.html">Testing Rails Applications</a></dd>
                  <dd><a href="security.html">Securing Rails Applications</a></dd>
                  <dd><a href="debugging_rails_applications.html">Debugging Rails Applications</a></dd>
                  <dd><a href="configuring.html">Configuring Rails Applications</a></dd>
                  <dd><a href="command_line.html">The Rails Command Line</a></dd>
                  <dd><a href="asset_pipeline.html">The Asset Pipeline</a></dd>
                  <dd><a href="working_with_javascript_in_rails.html">Working with JavaScript in Rails</a></dd>
                  <dd><a href="initialization.html">The Rails Initialization Process</a></dd>
                  <dd><a href="autoloading_and_reloading_constants.html">Autoloading and Reloading Constants (Zeitwerk Mode)</a></dd>
                  <dd><a href="autoloading_and_reloading_constants_classic_mode.html">Autoloading and Reloading Constants (Classic Mode)</a></dd>
                  <dd><a href="caching_with_rails.html">Caching with Rails: An Overview</a></dd>
                  <dd><a href="active_support_instrumentation.html">Active Support Instrumentation</a></dd>
                  <dd><a href="api_app.html">Using Rails for API-only Applications</a></dd>
                  <dd><a href="active_record_postgresql.html">Active Record and PostgreSQL</a></dd>
                  <dd><a href="active_record_multiple_databases.html">Multiple Databases with Active Record</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Estendendo o Rails</dt>
                  <dd><a href="plugins.html">The Basics of Creating Rails Plugins</a></dd>
                  <dd><a href="rails_on_rack.html">Rails on Rack</a></dd>
                  <dd><a href="generators.html">Creating and Customizing Rails Generators &amp; Templates</a></dd>
                  <dd><a href="engines.html">Getting Started with Engines</a></dd>
                  <dd><a href="threading_and_code_execution.html">Threading and Code Execution in Rails</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Contribuições</dt>
                  <dd><a href="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails</a></dd>
                  <dd><a href="api_documentation_guidelines.html">API Documentation Guidelines</a></dd>
                  <dd><a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Políticas</dt>
                  <dd><a href="maintenance_policy.html">Maintenance Policy for Ruby on Rails</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Release Notes</dt>
                  <dd><a href="upgrading_ruby_on_rails.html">Upgrading Ruby on Rails</a></dd>
                  <dd><a href="6_1_release_notes.html">Version 6.1 - Dezembro 2020</a></dd>
                  <dd><a href="6_0_release_notes.html">Version 6.0 - Agosto 2019</a></dd>
                  <dd><a href="5_2_release_notes.html">Version 5.2 - April 2018</a></dd>
                  <dd><a href="5_1_release_notes.html">Version 5.1 - April 2017</a></dd>
                  <dd><a href="5_0_release_notes.html">Version 5.0 - June 2016</a></dd>
                  <dd><a href="4_2_release_notes.html">Version 4.2 - December 2014</a></dd>
                  <dd><a href="4_1_release_notes.html">Version 4.1 - April 2014</a></dd>
                  <dd><a href="4_0_release_notes.html">Version 4.0 - June 2013</a></dd>
                  <dd><a href="3_2_release_notes.html">Version 3.2 - January 2012</a></dd>
                  <dd><a href="3_1_release_notes.html">Version 3.1 - August 2011</a></dd>
                  <dd><a href="3_0_release_notes.html">Version 3.0 - August 2010</a></dd>
                  <dd><a href="2_3_release_notes.html">Version 2.3 - March 2009</a></dd>
                  <dd><a href="2_2_release_notes.html">Version 2.2 - November 2008</a></dd>
                </div>
            </div>
          </dl>
        </li>
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">Contribua</a></li>
        <li class="guides-search guides-search-small">
          <input class="search-box search-box-small nav-item" type="text" placeholder="Digite o termo...">
          <div class="search-results"></div>
          <div class="search-spinner">Aguarde...</div>
        </li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">Guias</option>
              <optgroup label="Comece aqui">
                  <option value="getting_started.html">Começando com Rails</option>
              </optgroup>
              <optgroup label="Models">
                  <option value="active_record_basics.html">Active Record Basics</option>
                  <option value="active_record_migrations.html">Active Record Migrations</option>
                  <option value="active_record_validations.html">Active Record Validations</option>
                  <option value="active_record_callbacks.html">Active Record Callbacks</option>
                  <option value="association_basics.html">Active Record Associations</option>
                  <option value="active_record_querying.html">Active Record Query Interface</option>
                  <option value="active_model_basics.html">Active Model Basics</option>
              </optgroup>
              <optgroup label="Views">
                  <option value="action_view_overview.html">Action View Overview</option>
                  <option value="layouts_and_rendering.html">Layouts and Rendering in Rails</option>
                  <option value="action_view_helpers.html">Action View Helpers</option>
                  <option value="form_helpers.html">Action View Form Helpers</option>
              </optgroup>
              <optgroup label="Controllers">
                  <option value="action_controller_overview.html">Action Controller Overview</option>
                  <option value="routing.html">Rails Routing from the Outside In</option>
              </optgroup>
              <optgroup label="Outros componentes">
                  <option value="active_support_core_extensions.html">Active Support Core Extensions</option>
                  <option value="action_mailer_basics.html">Action Mailer Basics</option>
                  <option value="action_mailbox_basics.html">Action Mailbox Basics</option>
                  <option value="action_text_overview.html">Action Text Overview</option>
                  <option value="active_job_basics.html">Active Job Basics</option>
                  <option value="active_storage_overview.html">Active Storage Overview</option>
                  <option value="action_cable_overview.html">Action Cable Overview</option>
              </optgroup>
              <optgroup label="Indo mais fundo">
                  <option value="i18n.html">Rails Internationalization (I18n) API</option>
                  <option value="testing.html">Testing Rails Applications</option>
                  <option value="security.html">Securing Rails Applications</option>
                  <option value="debugging_rails_applications.html">Debugging Rails Applications</option>
                  <option value="configuring.html">Configuring Rails Applications</option>
                  <option value="command_line.html">The Rails Command Line</option>
                  <option value="asset_pipeline.html">The Asset Pipeline</option>
                  <option value="working_with_javascript_in_rails.html">Working with JavaScript in Rails</option>
                  <option value="initialization.html">The Rails Initialization Process</option>
                  <option value="autoloading_and_reloading_constants.html">Autoloading and Reloading Constants (Zeitwerk Mode)</option>
                  <option value="autoloading_and_reloading_constants_classic_mode.html">Autoloading and Reloading Constants (Classic Mode)</option>
                  <option value="caching_with_rails.html">Caching with Rails: An Overview</option>
                  <option value="active_support_instrumentation.html">Active Support Instrumentation</option>
                  <option value="api_app.html">Using Rails for API-only Applications</option>
                  <option value="active_record_postgresql.html">Active Record and PostgreSQL</option>
                  <option value="active_record_multiple_databases.html">Multiple Databases with Active Record</option>
              </optgroup>
              <optgroup label="Estendendo o Rails">
                  <option value="plugins.html">The Basics of Creating Rails Plugins</option>
                  <option value="rails_on_rack.html">Rails on Rack</option>
                  <option value="generators.html">Creating and Customizing Rails Generators &amp; Templates</option>
                  <option value="engines.html">Getting Started with Engines</option>
                  <option value="threading_and_code_execution.html">Threading and Code Execution in Rails</option>
              </optgroup>
              <optgroup label="Contribuições">
                  <option value="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails</option>
                  <option value="api_documentation_guidelines.html">API Documentation Guidelines</option>
                  <option value="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</option>
              </optgroup>
              <optgroup label="Políticas">
                  <option value="maintenance_policy.html">Maintenance Policy for Ruby on Rails</option>
              </optgroup>
              <optgroup label="Release Notes">
                  <option value="upgrading_ruby_on_rails.html">Upgrading Ruby on Rails</option>
                  <option value="6_1_release_notes.html">Version 6.1 - Dezembro 2020</option>
                  <option value="6_0_release_notes.html">Version 6.0 - Agosto 2019</option>
                  <option value="5_2_release_notes.html">Version 5.2 - April 2018</option>
                  <option value="5_1_release_notes.html">Version 5.1 - April 2017</option>
                  <option value="5_0_release_notes.html">Version 5.0 - June 2016</option>
                  <option value="4_2_release_notes.html">Version 4.2 - December 2014</option>
                  <option value="4_1_release_notes.html">Version 4.1 - April 2014</option>
                  <option value="4_0_release_notes.html">Version 4.0 - June 2013</option>
                  <option value="3_2_release_notes.html">Version 3.2 - January 2012</option>
                  <option value="3_1_release_notes.html">Version 3.1 - August 2011</option>
                  <option value="3_0_release_notes.html">Version 3.0 - August 2010</option>
                  <option value="2_3_release_notes.html">Version 2.3 - March 2009</option>
                  <option value="2_2_release_notes.html">Version 2.2 - November 2008</option>
              </optgroup>
          </select>
        </li>
      </ul>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Active Support Core Extensions</h2><p>O <em>Active Support</em> é o componente em Ruby on Rails responsável por fornecer à linguagem Ruby extensões, utilidades e outras funcionalidades paralelas.</p><p>Ele oferece um riquíssimo ponto de partida no nível da linguagem, onde pode-se aproveitar tanto para o desenvolvimento de aplicações Rails, quanto no próprio desenvolvimento da tecnologia Ruby on Rails.</p><p>Depois de ler esse guia, você saberá:</p>
<ul>
<li>O que são <em>Core Extensions</em>.</li>
<li>Como carregar todas as extensões.</li>
<li>Como escolher apenas as extensões que você precisa.</li>
<li>Quais extensões o <em>Active Support</em> fornece.</li>
</ul>


                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li>
<a href="#como-carregar-core-extensions">Como Carregar <em>Core Extensions</em></a>

<ul>
<li><a href="#active-support-stand-alone"><em>Active Support Stand-Alone</em></a></li>
<li><a href="#active-support-em-uma-aplicacao-ruby-on-rails"><em>Active Support</em> Em Uma Aplicação Ruby on Rails</a></li>
</ul>
</li>
<li>
<a href="#extensoes-para-todos-os-objetos">Extensões para todos os objetos</a>

<ul>
<li><a href="#blank-questionmark-e-present-questionmark"><code>blank?</code> e <code>present?</code></a></li>
<li><a href="#presence"><code>presence</code></a></li>
<li><a href="#duplicable-questionmark"><code>duplicable?</code></a></li>
<li><a href="#deep-dup"><code>deep_dup</code></a></li>
<li><a href="#try"><code>try</code></a></li>
<li><a href="#class-eval-args-block"><code>class_eval(*args, &amp;block)</code></a></li>
<li><a href="#acts-like-questionmark-duck"><code>acts_like?(duck)</code></a></li>
<li><a href="#to-param"><code>to_param</code></a></li>
<li><a href="#to-query"><code>to_query</code></a></li>
<li><a href="#with-options"><code>with_options</code></a></li>
<li><a href="#suporte-ao-json">Suporte ao JSON</a></li>
<li><a href="#variaveis-de-instancia">Variáveis de Instância</a></li>
<li><a href="#silenciando-warnings-e-excecoes">Silenciando <em>Warnings</em> e Exceções</a></li>
<li><a href="#in-questionmark"><code>in?</code></a></li>
</ul>
</li>
<li>
<a href="#extensoes-de-module">Extensões de <code>Module</code></a>

<ul>
<li><a href="#atributos">Atributos</a></li>
<li><a href="#parents"><em>Parents</em></a></li>
<li><a href="#anonimo">Anônimo</a></li>
<li><a href="#delegacao-de-metodo">Delegação de Método</a></li>
<li><a href="#redefinindo-metodos">Redefinindo Métodos</a></li>
</ul>
</li>
<li>
<a href="#extensoes-para-class">Extensões para <code>Class</code></a>

<ul>
<li><a href="#atributos-de-classe">Atributos de classe</a></li>
<li><a href="#subclasses-e-descendentes">Subclasses e Descendentes</a></li>
</ul>
</li>
<li>
<a href="#extensoes-para-string">Extensões para <code>String</code></a>

<ul>
<li><a href="#seguranca-de-saida">Segurança de saída</a></li>
<li><a href="#remove"><code>remove</code></a></li>
<li><a href="#squish"><code>squish</code></a></li>
<li><a href="#truncate"><code>truncate</code></a></li>
<li><a href="#truncate-bytes"><code>truncate_bytes</code></a></li>
<li><a href="#truncate-words"><code>truncate_words</code></a></li>
<li><a href="#inquiry"><code>inquiry</code></a></li>
<li><a href="#extensoes-para-string-starts-with-questionmark-e-ends-with-questionmark"><code>starts_with?</code> e <code>ends_with?</code></a></li>
<li><a href="#strip-heredoc"><code>strip_heredoc</code></a></li>
<li><a href="#indent"><code>indent</code></a></li>
<li><a href="#acesso">Acesso</a></li>
<li><a href="#inflexoes">Inflexões</a></li>
<li><a href="#conversoes">Conversões</a></li>
</ul>
</li>
<li>
<a href="#extensoes-para-symbol">Extensões para <code>Symbol</code></a>

<ul>
<li><a href="#extensoes-para-symbol-starts-with-questionmark-e-ends-with-questionmark"><code>starts_with?</code> e <code>ends_with?</code></a></li>
</ul>
</li>
<li>
<a href="#extensoes-para-numeric">Extensões para <code>Numeric</code></a>

<ul>
<li><a href="#bytes">Bytes</a></li>
<li><a href="#extensoes-para-numeric-time">Time</a></li>
<li><a href="#formatacao">Formatação</a></li>
</ul>
</li>
<li>
<a href="#extensoes-para-integer">Extensões para <code>Integer</code></a>

<ul>
<li><a href="#multiple-of-questionmark"><code>multiple_of?</code></a></li>
<li><a href="#ordinal"><code>ordinal</code></a></li>
<li><a href="#ordinalize"><code>ordinalize</code></a></li>
<li><a href="#extensoes-para-integer-time">Time</a></li>
</ul>
</li>
<li>
<a href="#extensoes-para-bigdecimal">Extensões para <code>BigDecimal</code></a>

<ul>
<li><a href="#extensoes-para-bigdecimal-to-s"><code>to_s</code></a></li>
</ul>
</li>
<li>
<a href="#extensions-to-enumerable">Extensions to <code>Enumerable</code></a>

<ul>
<li><a href="#sum"><code>sum</code></a></li>
<li><a href="#index-by"><code>index_by</code></a></li>
<li><a href="#index-with"><code>index_with</code></a></li>
<li><a href="#many-questionmark"><code>many?</code></a></li>
<li><a href="#exclude-questionmark"><code>exclude?</code></a></li>
<li><a href="#including"><code>including</code></a></li>
<li><a href="#excluding"><code>excluding</code></a></li>
<li><a href="#pluck"><code>pluck</code></a></li>
<li><a href="#pick"><code>pick</code></a></li>
</ul>
</li>
<li>
<a href="#extensions-to-array">Extensions to <code>Array</code></a>

<ul>
<li><a href="#accessing">Accessing</a></li>
<li><a href="#extensions-to-array-extracting">Extracting</a></li>
<li><a href="#options-extraction">Options Extraction</a></li>
<li><a href="#extensions-to-array-conversions">Conversions</a></li>
<li><a href="#wrapping">Wrapping</a></li>
<li><a href="#duplicating">Duplicating</a></li>
<li><a href="#grouping">Grouping</a></li>
</ul>
</li>
<li>
<a href="#extensions-to-hash">Extensions to <code>Hash</code></a>

<ul>
<li><a href="#extensions-to-hash-conversions">Conversions</a></li>
<li><a href="#merging">Merging</a></li>
<li><a href="#deep-duplicating">Deep duplicating</a></li>
<li><a href="#working-with-keys">Working with Keys</a></li>
<li><a href="#working-with-values">Working with Values</a></li>
<li><a href="#slicing">Slicing</a></li>
<li><a href="#extensions-to-hash-extracting">Extracting</a></li>
<li><a href="#indifferent-access">Indifferent Access</a></li>
</ul>
</li>
<li>
<a href="#extensions-to-regexp">Extensions to <code>Regexp</code></a>

<ul>
<li><a href="#multiline-questionmark"><code>multiline?</code></a></li>
</ul>
</li>
<li>
<a href="#extensions-to-range">Extensions to <code>Range</code></a>

<ul>
<li><a href="#extensions-to-range-to-s"><code>to_s</code></a></li>
<li><a href="#include-questionmark-and-cover-questionmark"><code>===</code>, <code>include?</code>, and <code>cover?</code></a></li>
<li><a href="#overlaps-questionmark"><code>overlaps?</code></a></li>
</ul>
</li>
<li>
<a href="#extensions-to-date">Extensions to <code>Date</code></a>

<ul>
<li><a href="#extensions-to-date-calculations">Calculations</a></li>
<li><a href="#conversions">Conversions</a></li>
</ul>
</li>
<li>
<a href="#extensions-to-datetime">Extensions to <code>DateTime</code></a>

<ul>
<li><a href="#extensions-to-datetime-calculations">Calculations</a></li>
</ul>
</li>
<li>
<a href="#extensions-to-time">Extensions to <code>Time</code></a>

<ul>
<li><a href="#calculations">Calculations</a></li>
<li><a href="#time-constructors">Time Constructors</a></li>
</ul>
</li>
<li>
<a href="#extensions-to-file">Extensions to <code>File</code></a>

<ul>
<li><a href="#atomic-write"><code>atomic_write</code></a></li>
</ul>
</li>
<li>
<a href="#extensions-to-marshal">Extensions to <code>Marshal</code></a>

<ul>
<li><a href="#load"><code>load</code></a></li>
</ul>
</li>
<li><a href="#extensions-to-nameerror">Extensions to <code>NameError</code></a></li>
<li><a href="#extensions-to-loaderror">Extensions to <code>LoadError</code></a></li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h3 id="como-carregar-core-extensions"><a class="anchorlink" href="#como-carregar-core-extensions">1 Como Carregar <em>Core Extensions</em></a></h3><h4 id="active-support-stand-alone"><a class="anchorlink" href="#active-support-stand-alone">1.1 <em>Active Support Stand-Alone</em></a></h4><p>A fim de ter uma configuração padrão mais básica, o <em>Active Support</em> não carrega nada por padrão. Com isso, ele é granularizado em pequenas unidades para que seja possível carregar apenas o que se é necessário no contexto, além de oferecer pontos de entrada que são interessantes para o carregamento de extensões convenientes de uma só vez, ou até mesmo não carregar nenhuma.</p><p>Portanto, é possível inicializar após o uso de um simples <em>require</em> como:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">require</span> <span class="s2">"active_support"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-cf739d3e43739282cbc42d5cacbb4ced">require "active_support"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-cf739d3e43739282cbc42d5cacbb4ced">Copiar</button>
</div>
<p>objetos não respondem nem mesmo a um <a href="https://api.rubyonrails.org/v6.1.4/classes/Object.html#method-i-blank-3F"><code>blank?</code></a>. Vejamos como carregar essa definição.</p><h5 id="escolhendo-a-definicao"><a class="anchorlink" href="#escolhendo-a-definicao">1.1.1 Escolhendo a Definição</a></h5><p>A forma mais limitada de conseguir respostas a um <code>blank?</code> é selecionando o arquivo que faz essa definição.</p><p>Para cada método definido como <em>core extension</em> esse guia possui uma nota que diz onde tal método é definido. No caso de <code>blank?</code> a nota diz:</p><div class="note"><p>Definido em <code>active_support/core_ext/object/blank.rb</code>.</p></div><p>Isso significa que você pode fazer <em>requires</em> assim:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">require</span> <span class="s2">"active_support"</span>
<span class="nb">require</span> <span class="s2">"active_support/core_ext/object/blank"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-a5f861d767313c47c313cdc46e55c5f6">require "active_support"
require "active_support/core_ext/object/blank"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-a5f861d767313c47c313cdc46e55c5f6">Copiar</button>
</div>
<p>O <em>Active Support</em> foi cuidadosamente projetado para que as seleções de arquivos carreguem somente as dependências extremamente necessárias, caso existam.</p><h5 id="carregando-core-extensions-agrupadas"><a class="anchorlink" href="#carregando-core-extensions-agrupadas">1.1.2 Carregando <em>Core Extensions</em> Agrupadas</a></h5><p>O próximo passo é simplesmente carregar todas as extensões de <code>Object</code>. Como regra geral, extensões para <code>SomeClass</code> estão disponíveis em um rápido carregamento de <code>active_support/core_ext/some_class</code>.</p><p>Portanto, para carregar todas as extensões de <code>Object</code> (incluindo <code>blank?</code>):</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">require</span> <span class="s2">"active_support"</span>
<span class="nb">require</span> <span class="s2">"active_support/core_ext/object"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-260b76a3accae21025396fe6551e237b">require "active_support"
require "active_support/core_ext/object"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-260b76a3accae21025396fe6551e237b">Copiar</button>
</div>
<h5 id="carregando-todas-core-extensions"><a class="anchorlink" href="#carregando-todas-core-extensions">1.1.3 Carregando Todas <em>Core Extensions</em></a></h5><p>Você pode escolher por carregar todas as extensões principais, há um arquivo para isso:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">require</span> <span class="s2">"active_support"</span>
<span class="nb">require</span> <span class="s2">"active_support/core_ext"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-744aff36f294de5c94ea72f2b953f95c">require "active_support"
require "active_support/core_ext"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-744aff36f294de5c94ea72f2b953f95c">Copiar</button>
</div>
<h5 id="carregando-active-support-completamente"><a class="anchorlink" href="#carregando-active-support-completamente">1.1.4 Carregando <em>Active Support</em> Completamente</a></h5><p>E finalmente, se você quer ter tudo que o <em>Active Support</em> fornece, basta apenas:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">require</span> <span class="s2">"active_support/all"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-f282b97557d22b5ecfff8e94caa7cace">require "active_support/all"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-f282b97557d22b5ecfff8e94caa7cace">Copiar</button>
</div>
<p>Isso não vai inserir todo o <em>Active Support</em> na memória antes do necessário, algumas funcionalidades são configuradas via <em>ʻautoload`</em>, então só são carregadas se usadas.</p><h4 id="active-support-em-uma-aplicacao-ruby-on-rails"><a class="anchorlink" href="#active-support-em-uma-aplicacao-ruby-on-rails">1.2 <em>Active Support</em> Em Uma Aplicação Ruby on Rails</a></h4><p>Uma aplicação Ruby on Rails carrega todo o <em>Active Support</em> a não ser que <code>config.active_support.bare</code> esteja definida como <code>true</code>. Neste caso, a aplicação vai carregar apenas o que o próprio <em>framework</em> escolhe como suas próprias necessidades, e ainda pode selecionar a si mesmo em qualquer nível de granularidade, conforme explicado na seção anterior.</p><h3 id="extensoes-para-todos-os-objetos"><a class="anchorlink" href="#extensoes-para-todos-os-objetos">2 Extensões para todos os objetos</a></h3><h4 id="blank-questionmark-e-present-questionmark"><a class="anchorlink" href="#blank-questionmark-e-present-questionmark">2.1 <code>blank?</code> e <code>present?</code></a></h4><p>Os seguintes valores são considerados <em>blank</em> em uma aplicação Rails:</p>
<ul>
<li><p><code>nil</code> e <code>false</code>,</p></li>
<li><p><em>strings</em> compostas apenas por espaços em branco (veja a nota abaixo),</p></li>
<li><p><em>arrays</em> e <em>hashes</em> vazios, e</p></li>
<li><p>qualquer outro objeto que responde a <code>empty?</code> como <code>true</code>.</p></li>
</ul>
<div class="info"><p>A condicional é que as <em>strings</em> usem a classe de caractere <code>[:space:]</code> do <em>Unicode-aware</em>, como por exemplo U+2029 (separador de parágrafo) é considerado um espaço em branco.</p></div><div class="warning"><p>Note que números não são mencionados. Em particular, 0 e 0.0 <strong>não</strong> são <em>blank</em>.</p></div><p>Por exemplo, este método de <code>ActionController::HttpAuthentication::Token::ControllerMethods</code> usa <a href="https://api.rubyonrails.org/v6.1.4/classes/Object.html#method-i-blank-3F"><code>blank?</code></a> pra checar se o <em>token</em> está presente:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">login_procedure</span><span class="p">)</span>
  <span class="n">token</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="n">token_and_options</span><span class="p">(</span><span class="n">controller</span><span class="p">.</span><span class="nf">request</span><span class="p">)</span>
  <span class="k">unless</span> <span class="n">token</span><span class="p">.</span><span class="nf">blank?</span>
    <span class="n">login_procedure</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-9126cb8497848b370cdc7b66657c4f13">def authenticate(controller, &amp;login_procedure)
  token, options = token_and_options(controller.request)
  unless token.blank?
    login_procedure.call(token, options)
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-9126cb8497848b370cdc7b66657c4f13">Copiar</button>
</div>
<p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/Object.html#method-i-present-3F"><code>present?</code></a> é equivalente ao <code>!blank?</code>. Este exemplo disponível em <code>ActionDispatch::Http::Cache::Response</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">set_conditional_cache_control!</span>
  <span class="k">return</span> <span class="k">if</span> <span class="nb">self</span><span class="p">[</span><span class="s2">"Cache-Control"</span><span class="p">].</span><span class="nf">present?</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-f284ee26332f165d22d806d2dc78dbef">def set_conditional_cache_control!
  return if self["Cache-Control"].present?
  # ...
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-f284ee26332f165d22d806d2dc78dbef">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/object/blank.rb</code>.</p></div><h4 id="presence"><a class="anchorlink" href="#presence">2.2 <code>presence</code></a></h4><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/Object.html#method-i-presence"><code>presence</code></a> retorna seu valor se <code>present?</code> for <code>true</code>, e <code>nil</code> caso não seja. Isso é muito útil para expressões como esta:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">host</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="ss">:host</span><span class="p">].</span><span class="nf">presence</span> <span class="o">||</span> <span class="s1">'localhost'</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-f61676411f860eea4e32a365db791a5f">host = config[:host].presence || 'localhost'
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-f61676411f860eea4e32a365db791a5f">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/object/blank.rb</code>.</p></div><h4 id="duplicable-questionmark"><a class="anchorlink" href="#duplicable-questionmark">2.3 <code>duplicable?</code></a></h4><p>A partir do Ruby 2.5, a maioria dos objetos podem ser duplicados com <code>dup</code> ou <code>clone</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"foo"</span><span class="p">.</span><span class="nf">dup</span>           <span class="c1"># =&gt; "foo"</span>
<span class="s2">""</span><span class="p">.</span><span class="nf">dup</span>              <span class="c1"># =&gt; ""</span>
<span class="no">Rational</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">dup</span>     <span class="c1"># =&gt; (1/1)</span>
<span class="no">Complex</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nf">dup</span>      <span class="c1"># =&gt; (0+0i)</span>
<span class="mi">1</span><span class="p">.</span><span class="nf">method</span><span class="p">(:</span><span class="o">+</span><span class="p">).</span><span class="nf">dup</span>    <span class="c1"># =&gt; TypeError (allocator undefined for Method)</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-4ea6085ca44ab6ab4f5012c14a29e145">"foo".dup           # =&gt; "foo"
"".dup              # =&gt; ""
Rational(1).dup     # =&gt; (1/1)
Complex(0).dup      # =&gt; (0+0i)
1.method(:+).dup    # =&gt; TypeError (allocator undefined for Method)
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-4ea6085ca44ab6ab4f5012c14a29e145">Copiar</button>
</div>
<p>O <em>Active Support</em> fornece o <a href="https://api.rubyonrails.org/v6.1.4/classes/Object.html#method-i-duplicable-3F"><code>duplicable?</code></a> para consultar se o objeto pode ser duplicado:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"foo"</span><span class="p">.</span><span class="nf">duplicable?</span>           <span class="c1"># =&gt; true</span>
<span class="s2">""</span><span class="p">.</span><span class="nf">duplicable?</span>              <span class="c1"># =&gt; true</span>
<span class="no">Rational</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">duplicable?</span>     <span class="c1"># =&gt; true</span>
<span class="no">Complex</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">duplicable?</span>      <span class="c1"># =&gt; true</span>
<span class="mi">1</span><span class="p">.</span><span class="nf">method</span><span class="p">(:</span><span class="o">+</span><span class="p">).</span><span class="nf">duplicable?</span>    <span class="c1"># =&gt; false</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-347535fbb48554093febde4d5743c14c">"foo".duplicable?           # =&gt; true
"".duplicable?              # =&gt; true
Rational(1).duplicable?     # =&gt; true
Complex(1).duplicable?      # =&gt; true
1.method(:+).duplicable?    # =&gt; false
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-347535fbb48554093febde4d5743c14c">Copiar</button>
</div>
<div class="warning"><p>Qualquer classe pode ter a duplicação desabilitada a partir da remoção de <code>dup</code> e <code>clone</code> ou definindo exceções. Neste caso apenas <code>rescue</code> pode informar se determinado objeto arbitrável é duplicável. <code>duplicable?</code> depende da existência de uma lista de elementos a serem analisados, como no exemplo porém é muito mais veloz que <code>rescue</code>. Use apenas se você souber que a lista é suficiente em seu caso.</p></div><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/object/duplicable.rb">active_support/core_ext/object/duplicable.rb</a></code>.</p></div><h4 id="deep-dup"><a class="anchorlink" href="#deep-dup">2.4 <code>deep_dup</code></a></h4><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/Object.html#method-i-deep_dup"><code>deep_dup</code></a> retorna uma cópia profunda de um objeto. Normalmente, quando você <code>dup</code> um objeto que contêm outros objetos, Ruby não executa o <code>dup</code>, então é criada uma cópia superficial do objeto. Caso você possua um <em>array</em> com uma <em>string</em>, por exemplo, terá algo parecido com:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">array</span>     <span class="o">=</span> <span class="p">[</span><span class="s1">'string'</span><span class="p">]</span>
<span class="n">duplicate</span> <span class="o">=</span> <span class="n">array</span><span class="p">.</span><span class="nf">dup</span>

<span class="n">duplicate</span><span class="p">.</span><span class="nf">push</span> <span class="s1">'another-string'</span>

<span class="c1"># the object was duplicated, so the element was added only to the duplicate</span>
<span class="n">array</span>     <span class="c1"># =&gt; ['string']</span>
<span class="n">duplicate</span> <span class="c1"># =&gt; ['string', 'another-string']</span>

<span class="n">duplicate</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">gsub!</span><span class="p">(</span><span class="s1">'string'</span><span class="p">,</span> <span class="s1">'foo'</span><span class="p">)</span>

<span class="c1"># first element was not duplicated, it will be changed in both arrays</span>
<span class="n">array</span>     <span class="c1"># =&gt; ['foo']</span>
<span class="n">duplicate</span> <span class="c1"># =&gt; ['foo', 'another-string']</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-67dbfffa20fbe84cec7b6d780793d7bd">array     = ['string']
duplicate = array.dup

duplicate.push 'another-string'

# the object was duplicated, so the element was added only to the duplicate
array     # =&gt; ['string']
duplicate # =&gt; ['string', 'another-string']

duplicate.first.gsub!('string', 'foo')

# first element was not duplicated, it will be changed in both arrays
array     # =&gt; ['foo']
duplicate # =&gt; ['foo', 'another-string']
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-67dbfffa20fbe84cec7b6d780793d7bd">Copiar</button>
</div>
<p>Como podemos ver, depois de duplicar a instância de <code>Array</code>, possuímos agora outro objeto, portanto podemos modificá-lo sem alterar informações do objeto original. Isso não funciona para elementos de um <em>array</em>, entretanto. Desde que <code>dup</code> não faça a cópia profunda, a <em>string</em> dentro do <em>array</em> se manterá como o mesmo objeto.</p><p>Se você precisa de uma cópia profunda de um objeto, pode então usar o <code>deep_dup</code>. Confira um exemplo:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">array</span>     <span class="o">=</span> <span class="p">[</span><span class="s1">'string'</span><span class="p">]</span>
<span class="n">duplicate</span> <span class="o">=</span> <span class="n">array</span><span class="p">.</span><span class="nf">deep_dup</span>

<span class="n">duplicate</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">gsub!</span><span class="p">(</span><span class="s1">'string'</span><span class="p">,</span> <span class="s1">'foo'</span><span class="p">)</span>

<span class="n">array</span>     <span class="c1"># =&gt; ['string']</span>
<span class="n">duplicate</span> <span class="c1"># =&gt; ['foo']</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-e4a2d4d42eea565b8307c30d48b16bd6">array     = ['string']
duplicate = array.deep_dup

duplicate.first.gsub!('string', 'foo')

array     # =&gt; ['string']
duplicate # =&gt; ['foo']
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-e4a2d4d42eea565b8307c30d48b16bd6">Copiar</button>
</div>
<p>Se o objeto não é duplicável, <code>deep_dup</code> apenas o retornará:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">number</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">duplicate</span> <span class="o">=</span> <span class="n">number</span><span class="p">.</span><span class="nf">deep_dup</span>
<span class="n">number</span><span class="p">.</span><span class="nf">object_id</span> <span class="o">==</span> <span class="n">duplicate</span><span class="p">.</span><span class="nf">object_id</span>   <span class="c1"># =&gt; true</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-6aebfd2ea41fb52c6bac53e5e3f736f3">number = 1
duplicate = number.deep_dup
number.object_id == duplicate.object_id   # =&gt; true
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-6aebfd2ea41fb52c6bac53e5e3f736f3">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/object/deep_dup.rb</code>.</p></div><h4 id="try"><a class="anchorlink" href="#try">2.5 <code>try</code></a></h4><p>Quando você quer chamar um método em um objeto somente se ele não for <code>nil</code>, a forma mais simples de conseguir isso é através de uma estrutura condicional, adicionando uma desnecessária desordem. A alternativa é usar <a href="https://api.rubyonrails.org/v6.1.4/classes/Object.html#method-i-try"><code>try</code></a>. <code>try</code> é como <code>Object#send</code> exceto que o retorno seja <code>nil</code> se enviado para <code>nil</code>.</p><p>Eis um exemplo:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># sem try</span>
<span class="k">unless</span> <span class="vi">@number</span><span class="p">.</span><span class="nf">nil?</span>
  <span class="vi">@number</span><span class="p">.</span><span class="nf">next</span>
<span class="k">end</span>

<span class="c1"># com try</span>
<span class="vi">@number</span><span class="p">.</span><span class="nf">try</span><span class="p">(</span><span class="ss">:next</span><span class="p">)</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-eabd7505dfe5651f3e267f8082777e17"># sem try
unless @number.nil?
  @number.next
end

# com try
@number.try(:next)
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-eabd7505dfe5651f3e267f8082777e17">Copiar</button>
</div>
<p>Outro exemplo é o código em <code>ActiveRecord::ConnectionAdapters::AbstractAdapter</code> onde <code>@logger</code> não pode ser <code>nil</code>. Você pode ver que o código usa <code>try</code> e evita uma verificação desnecessária.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">log_info</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="n">ms</span><span class="p">)</span>
  <span class="k">if</span> <span class="vi">@logger</span><span class="p">.</span><span class="nf">try</span><span class="p">(</span><span class="ss">:debug?</span><span class="p">)</span>
    <span class="nb">name</span> <span class="o">=</span> <span class="s1">'%s (%.1fms)'</span> <span class="o">%</span> <span class="p">[</span><span class="nb">name</span> <span class="o">||</span> <span class="s1">'SQL'</span><span class="p">,</span> <span class="n">ms</span><span class="p">]</span>
    <span class="vi">@logger</span><span class="p">.</span><span class="nf">debug</span><span class="p">(</span><span class="n">format_log_entry</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">sql</span><span class="p">.</span><span class="nf">squeeze</span><span class="p">(</span><span class="s1">' '</span><span class="p">)))</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-966cea0084f101807e005ba57660f0dd">def log_info(sql, name, ms)
  if @logger.try(:debug?)
    name = '%s (%.1fms)' % [name || 'SQL', ms]
    @logger.debug(format_log_entry(name, sql.squeeze(' ')))
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-966cea0084f101807e005ba57660f0dd">Copiar</button>
</div>
<p><code>try</code> pode também ser chamada sem argumentos, porém em um bloco, no qual só será executado se o objeto não for <code>nil</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="vi">@person</span><span class="p">.</span><span class="nf">try</span> <span class="p">{</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span> <span class="s2">"</span><span class="si">#{</span><span class="nb">p</span><span class="p">.</span><span class="nf">first_name</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="nb">p</span><span class="p">.</span><span class="nf">last_name</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-41da0eca1e4903258d869901b9fed80d">@person.try { |p| "#{p.first_name} #{p.last_name}" }
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-41da0eca1e4903258d869901b9fed80d">Copiar</button>
</div>
<p>Perceba que <code>try</code> não exibirá as mensagens de erro caso elas ocorram, retornando <code>nil</code> em vez disso. Se você quiser se proteger de possíveis erros de digitação, use <a href="https://api.rubyonrails.org/v6.1.4/classes/Object.html#method-i-try-21"><code>try!</code></a>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="vi">@number</span><span class="p">.</span><span class="nf">try</span><span class="p">(</span><span class="ss">:nest</span><span class="p">)</span>  <span class="c1"># =&gt; nil</span>
<span class="vi">@number</span><span class="p">.</span><span class="nf">try!</span><span class="p">(</span><span class="ss">:nest</span><span class="p">)</span> <span class="c1"># NoMethodError: undefined method `nest' for 1:Integer</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-188c74b77c318c617ab1eff27721de1e">@number.try(:nest)  # =&gt; nil
@number.try!(:nest) # NoMethodError: undefined method `nest' for 1:Integer
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-188c74b77c318c617ab1eff27721de1e">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/object/try.rb</code>.</p></div><h4 id="class-eval-args-block"><a class="anchorlink" href="#class-eval-args-block">2.6 <code>class_eval(*args, &amp;block)</code></a></h4><p>Você pode evoluir o código no contexto de um <em>singleton</em> de qualquer objeto usando <a href="https://api.rubyonrails.org/v6.1.4/classes/Kernel.html#method-i-class_eval"><code>class_eval</code></a>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Proc</span>
  <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
    <span class="n">block</span><span class="p">,</span> <span class="n">time</span> <span class="o">=</span> <span class="nb">self</span><span class="p">,</span> <span class="no">Time</span><span class="p">.</span><span class="nf">current</span>
    <span class="n">object</span><span class="p">.</span><span class="nf">class_eval</span> <span class="k">do</span>
      <span class="n">method_name</span> <span class="o">=</span> <span class="s2">"__bind_</span><span class="si">#{</span><span class="n">time</span><span class="p">.</span><span class="nf">to_i</span><span class="si">}</span><span class="s2">_</span><span class="si">#{</span><span class="n">time</span><span class="p">.</span><span class="nf">usec</span><span class="si">}</span><span class="s2">"</span>
      <span class="n">define_method</span><span class="p">(</span><span class="n">method_name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
      <span class="nb">method</span> <span class="o">=</span> <span class="nb">instance_method</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
      <span class="n">remove_method</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
      <span class="nb">method</span>
    <span class="k">end</span><span class="p">.</span><span class="nf">bind</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-67e6079fb6642ea38e466451727fb7c9">class Proc
  def bind(object)
    block, time = self, Time.current
    object.class_eval do
      method_name = "__bind_#{time.to_i}_#{time.usec}"
      define_method(method_name, &amp;block)
      method = instance_method(method_name)
      remove_method(method_name)
      method
    end.bind(object)
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-67e6079fb6642ea38e466451727fb7c9">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/kernel/singleton_class.rb</code>.</p></div><h4 id="acts-like-questionmark-duck"><a class="anchorlink" href="#acts-like-questionmark-duck">2.7 <code>acts_like?(duck)</code></a></h4><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/Object.html#method-i-acts_like-3F"><code>acts_like?</code></a> fornece um meio para conferir se alguma classe age como alguma outra classe baseada em uma simples convenção: a classe que fornece a mesma <em>interface</em> é definida como <code>String</code></p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">acts_like_string?</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-0fdf58d5094a9edebc029a2ca5b5310d">def acts_like_string?
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-0fdf58d5094a9edebc029a2ca5b5310d">Copiar</button>
</div>
<p>que é apenas um marcador, seu corpo ou valor de retorno são irrelevantes. Então, o código do cliente pode consultar a tipagem desta forma:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">some_klass</span><span class="p">.</span><span class="nf">acts_like?</span><span class="p">(</span><span class="ss">:string</span><span class="p">)</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-1510ae7614d9f6317421f6ee623a5bc3">some_klass.acts_like?(:string)
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-1510ae7614d9f6317421f6ee623a5bc3">Copiar</button>
</div>
<p>Rails possui classes que agem como <code>Date</code> ou <code>Time</code> e seguem essa linha.</p><div class="note"><p>Definido em <code>active_support/core_ext/object/acts_like.rb</code>.</p></div><h4 id="to-param"><a class="anchorlink" href="#to-param">2.8 <code>to_param</code></a></h4><p>Todos objetos em Rails respondem ao método <a href="https://api.rubyonrails.org/v6.1.4/classes/Object.html#method-i-to_param"><code>to_param</code></a>, o qual é usado para retornar representações de valores em <em>strings</em>, no qual podem ser usadas em consultas, ou fragmentos de URL.</p><p>Por padrão, <code>to_param</code> apenas chama o método <code>to_s</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mi">7</span><span class="p">.</span><span class="nf">to_param</span> <span class="c1"># =&gt; "7"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-c278d685ccb088a1c7809b688ba76f82">7.to_param # =&gt; "7"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-c278d685ccb088a1c7809b688ba76f82">Copiar</button>
</div>
<p>O retorno de valores em <code>to_param</code> <strong>não</strong> deve ser ignorado:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Tom &amp; Jerry"</span><span class="p">.</span><span class="nf">to_param</span> <span class="c1"># =&gt; "Tom &amp; Jerry"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-ddc42657e8dda7d2075cc9b442b4d8a0">"Tom &amp; Jerry".to_param # =&gt; "Tom &amp; Jerry"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-ddc42657e8dda7d2075cc9b442b4d8a0">Copiar</button>
</div>
<p>Várias classes em Rails sobrescrevem este método.</p><p>Por exemplo <code>nil</code>, <code>true</code>, e <code>false</code> retornam a si mesmo. <a href="https://api.rubyonrails.org/v6.1.4/classes/Array.html#method-i-to_param"><code>Array#to_param</code></a> chama <code>to_param</code> para cada elemento, exibindo o resultado separando os elementos com "/":</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="kp">true</span><span class="p">,</span> <span class="no">String</span><span class="p">].</span><span class="nf">to_param</span> <span class="c1"># =&gt; "0/true/String"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-8c4cabbd70ca96e6714ab79e6f191fe5">[0, true, String].to_param # =&gt; "0/true/String"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8c4cabbd70ca96e6714ab79e6f191fe5">Copiar</button>
</div>
<p>Notavelmente, as rotas de sistemas Rails chamam <code>to_param</code> em <em>models</em> para obter o valor do campo <code>:id</code>. <code>ActiveRecord::Base#to_param</code> retorna o <code>id</code> do <em>model</em>, mas você pode redefinir esse método em seus <em>models</em>. Por exemplo, dado</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">User</span>
  <span class="k">def</span> <span class="nf">to_param</span>
    <span class="s2">"</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="s2">-</span><span class="si">#{</span><span class="nb">name</span><span class="p">.</span><span class="nf">parameterize</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-b2138c590b1912c9b5149acc8896323d">class User
  def to_param
    "#{id}-#{name.parameterize}"
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-b2138c590b1912c9b5149acc8896323d">Copiar</button>
</div>
<p>nós temos:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">user_path</span><span class="p">(</span><span class="vi">@user</span><span class="p">)</span> <span class="c1"># =&gt; "/users/357-john-smith"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-91e95f813f30bf8eec622f8b12162791">user_path(@user) # =&gt; "/users/357-john-smith"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-91e95f813f30bf8eec622f8b12162791">Copiar</button>
</div>
<div class="warning"><p><em>Controllers</em> precisam estar alinhados a qualquer redefinição de <code>to_param</code> porque quando uma requisição como essa chega em "357-john-smith" este é o valor de <code>params[:id]</code>.</p></div><div class="note"><p>Definido em <code>active_support/core_ext/object/to_param.rb</code>.</p></div><h4 id="to-query"><a class="anchorlink" href="#to-query">2.9 <code>to_query</code></a></h4><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/Object.html#method-i-to_query"><code>to_query</code></a> controi uma <em>query</em> em <em>string</em> que associam a <code>key</code> com o retorno de <code>to_param</code>. Por exemplo, dado a seguinte definição de <code>to_param</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">User</span>
  <span class="k">def</span> <span class="nf">to_param</span>
    <span class="s2">"</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="s2">-</span><span class="si">#{</span><span class="nb">name</span><span class="p">.</span><span class="nf">parameterize</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-9dd1e7f83cab78d38dad9aa055eae9f9">class User
  def to_param
    "#{id}-#{name.parameterize}"
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-9dd1e7f83cab78d38dad9aa055eae9f9">Copiar</button>
</div>
<p>Temos:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">current_user</span><span class="p">.</span><span class="nf">to_query</span><span class="p">(</span><span class="s1">'user'</span><span class="p">)</span> <span class="c1"># =&gt; "user=357-john-smith"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-3169bf0be8a902332a28addc1da760c9">current_user.to_query('user') # =&gt; "user=357-john-smith"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-3169bf0be8a902332a28addc1da760c9">Copiar</button>
</div>
<p>Este método traz o que é necessário, tanto para chave, como para o valor:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">account</span><span class="p">.</span><span class="nf">to_query</span><span class="p">(</span><span class="s1">'company[name]'</span><span class="p">)</span>
<span class="c1"># =&gt; "company%5Bname%5D=Johnson+%26+Johnson"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-5b80115b1d65a9ba9eec8b040222ff27">account.to_query('company[name]')
# =&gt; "company%5Bname%5D=Johnson+%26+Johnson"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-5b80115b1d65a9ba9eec8b040222ff27">Copiar</button>
</div>
<p>então esse resultado esta pronto para ser usado em uma <em>string</em> de busca.</p><p><em>Arrays</em> retornam o resultado da aplicação <code>to_query</code> para cada elemento com <code>key[]</code> como chave, e junta o resultado com "&amp;":</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span><span class="mf">3.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">45.6</span><span class="p">].</span><span class="nf">to_query</span><span class="p">(</span><span class="s1">'sample'</span><span class="p">)</span>
<span class="c1"># =&gt; "sample%5B%5D=3.4&amp;sample%5B%5D=-45.6"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-1326d3f5719216bae743c541ab686c16">[3.4, -45.6].to_query('sample')
# =&gt; "sample%5B%5D=3.4&amp;sample%5B%5D=-45.6"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-1326d3f5719216bae743c541ab686c16">Copiar</button>
</div>
<p><em>Hashes</em> tambem respondem a <code>to_query</code> mas com uma diferença. Se não passar um argumento a chamada gera uma série ordenada de chaves/valores atribuídas chamando <code>to_query(key)</code> em seus valores. Em seguida, o resultado é mesclado com "&amp;":</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="ss">c: </span><span class="mi">3</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">a: </span><span class="mi">1</span><span class="p">}.</span><span class="nf">to_query</span> <span class="c1"># =&gt; "a=1&amp;b=2&amp;c=3"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-90a7af8d545790498f54692a5218ce0c">{c: 3, b: 2, a: 1}.to_query # =&gt; "a=1&amp;b=2&amp;c=3"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-90a7af8d545790498f54692a5218ce0c">Copiar</button>
</div>
<p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-to_query"><code>Hash#to_query</code></a> aceita um espaço para nomear as chaves:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="ss">id: </span><span class="mi">89</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"John Smith"</span><span class="p">}.</span><span class="nf">to_query</span><span class="p">(</span><span class="s1">'user'</span><span class="p">)</span>
<span class="c1"># =&gt; "user%5Bid%5D=89&amp;user%5Bname%5D=John+Smith"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-9ece720836d5e6c3bc86e624069775e7">{id: 89, name: "John Smith"}.to_query('user')
# =&gt; "user%5Bid%5D=89&amp;user%5Bname%5D=John+Smith"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-9ece720836d5e6c3bc86e624069775e7">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/object/to_query.rb</code>.</p></div><h4 id="with-options"><a class="anchorlink" href="#with-options">2.10 <code>with_options</code></a></h4><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/Object.html#method-i-with_options"><code>with_options</code></a> fornece um meio de agrupar opções comuns em uma série de chamada de métodos.</p><p>Dado as opções <em>default</em> de uma <em>hash</em>, <code>with_options</code> faz um objeto de "ponte" em um bloco. Dentro do bloco, métodos são chamados no objeto e são encaminhados ao receptor com suas opções mescladas. Por exemplo, você se livra da duplicação em:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Account</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:customers</span><span class="p">,</span> <span class="ss">dependent: :destroy</span>
  <span class="n">has_many</span> <span class="ss">:products</span><span class="p">,</span>  <span class="ss">dependent: :destroy</span>
  <span class="n">has_many</span> <span class="ss">:invoices</span><span class="p">,</span>  <span class="ss">dependent: :destroy</span>
  <span class="n">has_many</span> <span class="ss">:expenses</span><span class="p">,</span>  <span class="ss">dependent: :destroy</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-38499ac14b6e66e2d227356f896cd1c4">class Account &lt; ApplicationRecord
  has_many :customers, dependent: :destroy
  has_many :products,  dependent: :destroy
  has_many :invoices,  dependent: :destroy
  has_many :expenses,  dependent: :destroy
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-38499ac14b6e66e2d227356f896cd1c4">Copiar</button>
</div>
<p>desta forma:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Account</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">with_options</span> <span class="ss">dependent: :destroy</span> <span class="k">do</span> <span class="o">|</span><span class="n">assoc</span><span class="o">|</span>
    <span class="n">assoc</span><span class="p">.</span><span class="nf">has_many</span> <span class="ss">:customers</span>
    <span class="n">assoc</span><span class="p">.</span><span class="nf">has_many</span> <span class="ss">:products</span>
    <span class="n">assoc</span><span class="p">.</span><span class="nf">has_many</span> <span class="ss">:invoices</span>
    <span class="n">assoc</span><span class="p">.</span><span class="nf">has_many</span> <span class="ss">:expenses</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-3226594ec34a26336b7f8fe156dc89c6">class Account &lt; ApplicationRecord
  with_options dependent: :destroy do |assoc|
    assoc.has_many :customers
    assoc.has_many :products
    assoc.has_many :invoices
    assoc.has_many :expenses
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-3226594ec34a26336b7f8fe156dc89c6">Copiar</button>
</div>
<p>Essa expressão pode transmitir um agrupamento para o leitor também. Por exemplo, digamos que você queira enviar um boletim informativo cujo idioma depende do usuário. Em algum lugar na <em>mailer</em> você poderá agrupar os receptores por localidade como no exemplo:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">I18n</span><span class="p">.</span><span class="nf">with_options</span> <span class="ss">locale: </span><span class="n">user</span><span class="p">.</span><span class="nf">locale</span><span class="p">,</span> <span class="ss">scope: </span><span class="s2">"newsletter"</span> <span class="k">do</span> <span class="o">|</span><span class="n">i18n</span><span class="o">|</span>
  <span class="n">subject</span> <span class="n">i18n</span><span class="p">.</span><span class="nf">t</span> <span class="ss">:subject</span>
  <span class="n">body</span>    <span class="n">i18n</span><span class="p">.</span><span class="nf">t</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">user_name: </span><span class="n">user</span><span class="p">.</span><span class="nf">name</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-2d16aba5cea7c3cb14b143ea86009882">I18n.with_options locale: user.locale, scope: "newsletter" do |i18n|
  subject i18n.t :subject
  body    i18n.t :body, user_name: user.name
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2d16aba5cea7c3cb14b143ea86009882">Copiar</button>
</div>
<div class="info"><p>Desde que <code>with_options</code> envie chamadas para seus receptores eles podem ser aninhados. Cada nível de aninhamento mesclará os padrões herdados com os seus próprios.</p></div><div class="note"><p>Definido em <code>active_support/core_ext/object/with_options.rb</code>.</p></div><h4 id="suporte-ao-json"><a class="anchorlink" href="#suporte-ao-json">2.11 Suporte ao JSON</a></h4><p><em>Active Support</em> fornece uma melhor implementação para <code>to_json</code> do que a <em>gem</em> <code>json</code> normalmente fornece para objetos em Ruby. Isso é porque algumas classes, como <code>Hash</code>, <code>OrderedHash</code> e <code>Process::Status</code> precisam de manipulações especiais a fim de fornecer uma representação de JSON adequada.</p><div class="note"><p>Definido em <code>active_support/core_ext/object/json.rb</code>.</p></div><h4 id="variaveis-de-instancia"><a class="anchorlink" href="#variaveis-de-instancia">2.12 Variáveis de Instância</a></h4><p><em>Active Support</em> fornece vários métodos para facilitar o acesso a variáveis de instância.</p><h5 id="instance-values"><a class="anchorlink" href="#instance-values">2.12.1 <code>instance_values</code></a></h5><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/Object.html#method-i-instance_values"><code>instance_values</code></a> retorna uma <em>hash</em> que mapeia variáveis de instância de nomes sem "@" para seus
valores correspondentes. As chaves são <em>strings</em>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">C</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="vi">@x</span><span class="p">,</span> <span class="vi">@y</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">C</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nf">instance_values</span> <span class="c1"># =&gt; {"x" =&gt; 0, "y" =&gt; 1}</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-f0fa0b7a0ff1f7c094dfa87c62ee68e4">class C
  def initialize(x, y)
    @x, @y = x, y
  end
end

C.new(0, 1).instance_values # =&gt; {"x" =&gt; 0, "y" =&gt; 1}
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-f0fa0b7a0ff1f7c094dfa87c62ee68e4">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/object/instance_variables.rb</code>.</p></div><h5 id="instance-variable-names"><a class="anchorlink" href="#instance-variable-names">2.12.2 <code>instance_variable_names</code></a></h5><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/Object.html#method-i-instance_variable_names"><code>instance_variable_names</code></a> retorna um <em>array</em>. Cada nome inclui o sinal "@".</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">C</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="vi">@x</span><span class="p">,</span> <span class="vi">@y</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">C</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nf">instance_variable_names</span> <span class="c1"># =&gt; ["@x", "@y"]</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-e3610fae0e122e865bfdc92de55eff8f">class C
  def initialize(x, y)
    @x, @y = x, y
  end
end

C.new(0, 1).instance_variable_names # =&gt; ["@x", "@y"]
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-e3610fae0e122e865bfdc92de55eff8f">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/object/instance_variables.rb</code>.</p></div><h4 id="silenciando-warnings-e-excecoes"><a class="anchorlink" href="#silenciando-warnings-e-excecoes">2.13 Silenciando <em>Warnings</em> e Exceções</a></h4><p>Os métodos <a href="https://api.rubyonrails.org/v6.1.4/classes/Kernel.html#method-i-silence_warnings"><code>silence_warnings</code></a> e <a href="https://api.rubyonrails.org/v6.1.4/classes/Kernel.html#method-i-enable_warnings"><code>enable_warnings</code></a> trocam o valor de <code>$VERBOSE</code> de acordo com a duração do seu bloco, e o reiniciam depois:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">silence_warnings</span> <span class="p">{</span> <span class="no">Object</span><span class="p">.</span><span class="nf">const_set</span> <span class="s2">"RAILS_DEFAULT_LOGGER"</span><span class="p">,</span> <span class="n">logger</span> <span class="p">}</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-e0fc10c6116c02797533bdc998dc4dc1">silence_warnings { Object.const_set "RAILS_DEFAULT_LOGGER", logger }
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-e0fc10c6116c02797533bdc998dc4dc1">Copiar</button>
</div>
<p>Silenciar exceções também é possível com <a href="https://api.rubyonrails.org/v6.1.4/classes/Kernel.html#method-i-suppress"><code>suppress</code></a>. Este método recebe um número arbitrário de classes de exceção. Se uma exceção é acionada durante a execução de um bloco e é <code>kind_of?</code> qualquer um dos argumentos, <code>suppress</code> captura e retorna silenciosamente. Caso contrário, a exceção não é capturada:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># If the user is locked, the increment is lost, no big deal.</span>
<span class="n">suppress</span><span class="p">(</span><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">StaleObjectError</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">current_user</span><span class="p">.</span><span class="nf">increment!</span> <span class="ss">:visits</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-ffbe8c20e66f8686ab5516bc570660eb"># If the user is locked, the increment is lost, no big deal.
suppress(ActiveRecord::StaleObjectError) do
  current_user.increment! :visits
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-ffbe8c20e66f8686ab5516bc570660eb">Copiar</button>
</div>
<div class="note"><p>Definido in <code>active_support/core_ext/kernel/reporting.rb</code>.</p></div><h4 id="in-questionmark"><a class="anchorlink" href="#in-questionmark">2.14 <code>in?</code></a></h4><p>A expressão <a href="https://api.rubyonrails.org/v6.1.4/classes/Object.html#method-i-in-3F"><code>in?</code></a> testa se um objeto é incluído em outro objeto. Uma exceção <code>ArgumentError</code> será acionada se o argumento passado não responder a <code>include?</code>.</p><p>Exemplos de <code>in?</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mi">1</span><span class="p">.</span><span class="nf">in?</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>        <span class="c1"># =&gt; true</span>
<span class="s2">"lo"</span><span class="p">.</span><span class="nf">in?</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">)</span>   <span class="c1"># =&gt; true</span>
<span class="mi">25</span><span class="p">.</span><span class="nf">in?</span><span class="p">(</span><span class="mi">30</span><span class="o">..</span><span class="mi">50</span><span class="p">)</span>      <span class="c1"># =&gt; false</span>
<span class="mi">1</span><span class="p">.</span><span class="nf">in?</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>            <span class="c1"># =&gt; ArgumentError</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-121fa3762ce9a918c508d97deb7b7ac7">1.in?([1,2])        # =&gt; true
"lo".in?("hello")   # =&gt; true
25.in?(30..50)      # =&gt; false
1.in?(1)            # =&gt; ArgumentError
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-121fa3762ce9a918c508d97deb7b7ac7">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/object/inclusion.rb</code>.</p></div><h3 id="extensoes-de-module"><a class="anchorlink" href="#extensoes-de-module">3 Extensões de <code>Module</code></a></h3><h4 id="atributos"><a class="anchorlink" href="#atributos">3.1 Atributos</a></h4><h5 id="alias-attribute"><a class="anchorlink" href="#alias-attribute">3.1.1 <code>alias_attribute</code></a></h5><p>Atributos de <em>models</em> podem ser lidos, escritos e condicionados. Você pode criar um <em>alias</em> para um atributo de <em>model</em> correspondendo todos os três métodos definidos por você usando <a href="https://api.rubyonrails.org/v6.1.4/classes/Module.html#method-i-alias_attribute"><code>alias_attribute</code></a>. Em outro métodos de <em>alias</em>, o novo nome é o primeiro argumento, e o antigo nome é o segundo (uma forma de memorizar é pensar que eles se apresentam na mesma ordem como se você fizesse uma atribuição):</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="c1"># Você pode referenciar a coluna email como "login".</span>
  <span class="c1"># Isso pode ser importante para o código de autenticação.</span>
  <span class="n">alias_attribute</span> <span class="ss">:login</span><span class="p">,</span> <span class="ss">:email</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-be36fd38c68188a9b05e7cb2a748a7d0">class User &lt; ApplicationRecord
  # Você pode referenciar a coluna email como "login".
  # Isso pode ser importante para o código de autenticação.
  alias_attribute :login, :email
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-be36fd38c68188a9b05e7cb2a748a7d0">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/module/aliasing.rb</code>.</p></div><h5 id="atributos-internos"><a class="anchorlink" href="#atributos-internos">3.1.2 Atributos Internos</a></h5><p>Quando você esta definindo um atributo em uma classe que pode ser uma subclasse, os conflitos de nomes são um risco. Isso é extremamente importante para as bibliotecas.</p><p><em>Active Support</em> define as macros <a href="https://api.rubyonrails.org/v6.1.4/classes/Module.html#method-i-attr_internal_reader"><code>attr_internal_reader</code></a>, <a href="https://api.rubyonrails.org/v6.1.4/classes/Module.html#method-i-attr_internal_writer"><code>attr_internal_writer</code></a>, e <a href="https://api.rubyonrails.org/v6.1.4/classes/Module.html#method-i-attr_internal_accessor"><code>attr_internal_accessor</code></a>. Elas comportam-se como seu próprio Ruby <code>attr_*</code> embutido, exceto pelos nomes de variáveis de instância que faz com que os conflitos sejam menos comuns.</p><p>A macro <a href="https://api.rubyonrails.org/v6.1.4/classes/Module.html#method-i-attr_internal"><code>attr_internal</code></a> é um sinônimo para <code>attr_internal_accessor</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># biblioteca</span>
<span class="k">class</span> <span class="nc">ThirdPartyLibrary::Crawler</span>
  <span class="n">attr_internal</span> <span class="ss">:log_level</span>
<span class="k">end</span>

<span class="c1"># código do cliente</span>
<span class="k">class</span> <span class="nc">MyCrawler</span> <span class="o">&lt;</span> <span class="no">ThirdPartyLibrary</span><span class="o">::</span><span class="no">Crawler</span>
  <span class="nb">attr_accessor</span> <span class="ss">:log_level</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-dc48fb8d17cc3b04b1165e7bad91af99"># biblioteca
class ThirdPartyLibrary::Crawler
  attr_internal :log_level
end

# código do cliente
class MyCrawler &lt; ThirdPartyLibrary::Crawler
  attr_accessor :log_level
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-dc48fb8d17cc3b04b1165e7bad91af99">Copiar</button>
</div>
<p>No exemplo anterior, poderia ser que no caso <code>:log_level</code> não pertença a interface pública da biblioteca e só seria usada em desenvolvimento. O código do cliente, não sabe do potencial conflito, subclasses e definições de seus próprios <code>:log_level</code>. Graças ao <code>attr_internal</code> não há conflito.</p><p>Por padrão, a variável de instancia interna é nomeada com uma <em>underscore</em> na frente, <code>@_log_level</code> no exemplo acima. Isso é configurável via <code>Module.attr_internal_naming_format</code> apesar disso, você pode passar qualquer tipo de <code>sprintf</code> no formato <em>string</em> com a inicial <code>@</code> e um <code>%s</code> em algum lugar, no qual é onde o nome será colocado. O padrão é <code>"@_%s"</code>.</p><p>Rails usa atributos internos em alguns pontos, para <em>views</em> como por exemplo:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">ActionView</span>
  <span class="k">class</span> <span class="nc">Base</span>
    <span class="n">attr_internal</span> <span class="ss">:captures</span>
    <span class="n">attr_internal</span> <span class="ss">:request</span><span class="p">,</span> <span class="ss">:layout</span>
    <span class="n">attr_internal</span> <span class="ss">:controller</span><span class="p">,</span> <span class="ss">:template</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-e22113f681001141d4efeabbb7040de6">module ActionView
  class Base
    attr_internal :captures
    attr_internal :request, :layout
    attr_internal :controller, :template
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-e22113f681001141d4efeabbb7040de6">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/module/attr_internal.rb</code>.</p></div><h5 id="atributos-de-modulo"><a class="anchorlink" href="#atributos-de-modulo">3.1.3 Atributos de Módulo</a></h5><p>As macros <a href="https://api.rubyonrails.org/v6.1.4/classes/Module.html#method-i-mattr_reader"><code>mattr_reader</code></a>, <a href="https://api.rubyonrails.org/v6.1.4/classes/Module.html#method-i-mattr_writer"><code>mattr_writer</code></a>, e <a href="https://api.rubyonrails.org/v6.1.4/classes/Module.html#method-i-mattr_accessor"><code>mattr_accessor</code></a> São iguais a <code>cattr_*</code> macros definidas na classe. De fato, <code>cattr_*</code> macros são apenas <em>aliases</em> para as <code>mattr_*</code> macros. Confira a seção <a href="#atributos-de-classe">Atributos de Classe</a>.</p><p>Por exemplo, os mecanismos de dependências usam:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">ActiveSupport</span>
  <span class="k">module</span> <span class="nn">Dependencies</span>
    <span class="n">mattr_accessor</span> <span class="ss">:warnings_on_first_load</span>
    <span class="n">mattr_accessor</span> <span class="ss">:history</span>
    <span class="n">mattr_accessor</span> <span class="ss">:loaded</span>
    <span class="n">mattr_accessor</span> <span class="ss">:mechanism</span>
    <span class="n">mattr_accessor</span> <span class="ss">:load_paths</span>
    <span class="n">mattr_accessor</span> <span class="ss">:load_once_paths</span>
    <span class="n">mattr_accessor</span> <span class="ss">:autoloaded_constants</span>
    <span class="n">mattr_accessor</span> <span class="ss">:explicitly_unloadable_constants</span>
    <span class="n">mattr_accessor</span> <span class="ss">:constant_watch_stack</span>
    <span class="n">mattr_accessor</span> <span class="ss">:constant_watch_stack_mutex</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-284dfdaf73509ba10b8526ff5c518942">module ActiveSupport
  module Dependencies
    mattr_accessor :warnings_on_first_load
    mattr_accessor :history
    mattr_accessor :loaded
    mattr_accessor :mechanism
    mattr_accessor :load_paths
    mattr_accessor :load_once_paths
    mattr_accessor :autoloaded_constants
    mattr_accessor :explicitly_unloadable_constants
    mattr_accessor :constant_watch_stack
    mattr_accessor :constant_watch_stack_mutex
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-284dfdaf73509ba10b8526ff5c518942">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/module/attribute_accessors.rb</code>.</p></div><h4 id="parents"><a class="anchorlink" href="#parents">3.2 <em>Parents</em></a></h4><h5 id="module-parent"><a class="anchorlink" href="#module-parent">3.2.1 <code>module_parent</code></a></h5><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/Module.html#method-i-module_parent"><code>module_parent</code></a> em um módulo nomeado aninhado que retorna o módulo que contém uma constante correspondente:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">X</span>
  <span class="k">module</span> <span class="nn">Y</span>
    <span class="k">module</span> <span class="nn">Z</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="no">M</span> <span class="o">=</span> <span class="no">X</span><span class="o">::</span><span class="no">Y</span><span class="o">::</span><span class="no">Z</span>

<span class="no">X</span><span class="o">::</span><span class="no">Y</span><span class="o">::</span><span class="no">Z</span><span class="p">.</span><span class="nf">module_parent</span> <span class="c1"># =&gt; X::Y</span>
<span class="no">M</span><span class="p">.</span><span class="nf">module_parent</span>       <span class="c1"># =&gt; X::Y</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-b2aa63e9e8d98b8107aa050ccb01ce21">module X
  module Y
    module Z
    end
  end
end
M = X::Y::Z

X::Y::Z.module_parent # =&gt; X::Y
M.module_parent       # =&gt; X::Y
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-b2aa63e9e8d98b8107aa050ccb01ce21">Copiar</button>
</div>
<p>Se o módulo é anônimo ou pertence a um nível superior, <code>module_parent</code> retorna <code>Object</code>.</p><div class="warning"><p>Note que neste caso <code>module_parent_name</code> retorna <code>nil</code>.</p></div><div class="note"><p>Definido em <code>active_support/core_ext/module/introspection.rb</code>.</p></div><h5 id="module-parent-name"><a class="anchorlink" href="#module-parent-name">3.2.2 <code>module_parent_name</code></a></h5><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/Module.html#method-i-module_parent_name"><code>module_parent_name</code></a> em um modulo nomeado aninhado  retorna o nome completamente qualificado do módulo que contém sua constante correspondente:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">X</span>
  <span class="k">module</span> <span class="nn">Y</span>
    <span class="k">module</span> <span class="nn">Z</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="no">M</span> <span class="o">=</span> <span class="no">X</span><span class="o">::</span><span class="no">Y</span><span class="o">::</span><span class="no">Z</span>

<span class="no">X</span><span class="o">::</span><span class="no">Y</span><span class="o">::</span><span class="no">Z</span><span class="p">.</span><span class="nf">module_parent_name</span> <span class="c1"># =&gt; "X::Y"</span>
<span class="no">M</span><span class="p">.</span><span class="nf">module_parent_name</span>       <span class="c1"># =&gt; "X::Y"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-3a065580f21a7352f69a3ccfd8e6fddb">module X
  module Y
    module Z
    end
  end
end
M = X::Y::Z

X::Y::Z.module_parent_name # =&gt; "X::Y"
M.module_parent_name       # =&gt; "X::Y"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-3a065580f21a7352f69a3ccfd8e6fddb">Copiar</button>
</div>
<p>Para módulos de nível superior ou anônimos <code>module_parent_name</code> retorna <code>nil</code>.</p><div class="warning"><p>Note que nesse caso <code>module_parent</code> retorna <code>Object</code>.</p></div><div class="note"><p>Definido em <code>active_support/core_ext/module/introspection.rb</code>.</p></div><h5 id="module-parents"><a class="anchorlink" href="#module-parents">3.2.3 <code>module_parents</code></a></h5><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/Module.html#method-i-module_parents"><code>module_parents</code></a> chama <code>module_parent</code> no receptor e sobe até <code>Object</code> ser alcançado. A cadeia é retornada em uma matriz, de baixo para cima:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">X</span>
  <span class="k">module</span> <span class="nn">Y</span>
    <span class="k">module</span> <span class="nn">Z</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="no">M</span> <span class="o">=</span> <span class="no">X</span><span class="o">::</span><span class="no">Y</span><span class="o">::</span><span class="no">Z</span>

<span class="no">X</span><span class="o">::</span><span class="no">Y</span><span class="o">::</span><span class="no">Z</span><span class="p">.</span><span class="nf">module_parents</span> <span class="c1"># =&gt; [X::Y, X, Object]</span>
<span class="no">M</span><span class="p">.</span><span class="nf">module_parents</span>       <span class="c1"># =&gt; [X::Y, X, Object]</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-1ec81a51e9451f02d87bb912c48c6e90">module X
  module Y
    module Z
    end
  end
end
M = X::Y::Z

X::Y::Z.module_parents # =&gt; [X::Y, X, Object]
M.module_parents       # =&gt; [X::Y, X, Object]
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-1ec81a51e9451f02d87bb912c48c6e90">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/module/introspection.rb</code>.</p></div><h4 id="anonimo"><a class="anchorlink" href="#anonimo">3.3 Anônimo</a></h4><p>Um módulo pode ou não ter um nome:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">M</span>
<span class="k">end</span>
<span class="no">M</span><span class="p">.</span><span class="nf">name</span> <span class="c1"># =&gt; "M"</span>

<span class="no">N</span> <span class="o">=</span> <span class="no">Module</span><span class="p">.</span><span class="nf">new</span>
<span class="no">N</span><span class="p">.</span><span class="nf">name</span> <span class="c1"># =&gt; "N"</span>

<span class="no">Module</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">name</span> <span class="c1"># =&gt; nil</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-0c287ffcb042342d689be206fa20cf69">module M
end
M.name # =&gt; "M"

N = Module.new
N.name # =&gt; "N"

Module.new.name # =&gt; nil
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-0c287ffcb042342d689be206fa20cf69">Copiar</button>
</div>
<p>Você pode verificar se um módulo possui um nome com a condicional <a href="https://api.rubyonrails.org/v6.1.4/classes/Module.html#method-i-anonymous-3F"><code>anonymous?</code></a>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">M</span>
<span class="k">end</span>
<span class="no">M</span><span class="p">.</span><span class="nf">anonymous?</span> <span class="c1"># =&gt; false</span>

<span class="no">Module</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">anonymous?</span> <span class="c1"># =&gt; true</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-aac51bcb30981addb861c23a40310cd9">module M
end
M.anonymous? # =&gt; false

Module.new.anonymous? # =&gt; true
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-aac51bcb30981addb861c23a40310cd9">Copiar</button>
</div>
<p>Observe que estar inacessível não significa ser anônimo:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">M</span>
<span class="k">end</span>

<span class="n">m</span> <span class="o">=</span> <span class="no">Object</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="ss">:remove_const</span><span class="p">,</span> <span class="ss">:M</span><span class="p">)</span>

<span class="n">m</span><span class="p">.</span><span class="nf">anonymous?</span> <span class="c1"># =&gt; false</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-88b523077eb06bb57ccfebaac28a9103">module M
end

m = Object.send(:remove_const, :M)

m.anonymous? # =&gt; false
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-88b523077eb06bb57ccfebaac28a9103">Copiar</button>
</div>
<p>Embora um módulo anônimo seja inacessível por definição.</p><div class="note"><p>Definido em <code>active_support/core_ext/module/anonymous.rb</code>.</p></div><h4 id="delegacao-de-metodo"><a class="anchorlink" href="#delegacao-de-metodo">3.4 Delegação de Método</a></h4><h5 id="delegate"><a class="anchorlink" href="#delegate">3.4.1 <code>delegate</code></a></h5><p>A macro <a href="https://api.rubyonrails.org/v6.1.4/classes/Module.html#method-i-delegate"><code>delegate</code></a> oferece uma maneira fácil de encaminhar métodos.</p><p>Vamos imaginar que os usuários de alguma aplicação possuem informações de <em>login</em> no <em>model</em> <code>User</code> além de nome e outro dado em um <em>model</em> <code>Profile</code> separado:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_one</span> <span class="ss">:profile</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-671262932139a71c7cb299bcda70b955">class User &lt; ApplicationRecord
  has_one :profile
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-671262932139a71c7cb299bcda70b955">Copiar</button>
</div>
<p>Com essa configuração você consegue o nome dos usuários partir da classe perfil, <code>user.profile.name</code>, mas isso poderia ser conveniente para habilitar o acesso ao atributo diretamente:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_one</span> <span class="ss">:profile</span>

  <span class="k">def</span> <span class="nf">name</span>
    <span class="n">profile</span><span class="p">.</span><span class="nf">name</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-063e3953fd3f8799b7bfe22c441d2705">class User &lt; ApplicationRecord
  has_one :profile

  def name
    profile.name
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-063e3953fd3f8799b7bfe22c441d2705">Copiar</button>
</div>
<p>Isso é o que o <code>delegate</code> faz por você:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_one</span> <span class="ss">:profile</span>

  <span class="n">delegate</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">to: :profile</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-9df883bbbf487622602cf5cead3b8453">class User &lt; ApplicationRecord
  has_one :profile

  delegate :name, to: :profile
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-9df883bbbf487622602cf5cead3b8453">Copiar</button>
</div>
<p>É mais curto e a intenção mais óbvia.</p><p>O método deve ser público.</p><p>A macro <code>delegate</code> aceita vários métodos:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">delegate</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:age</span><span class="p">,</span> <span class="ss">:address</span><span class="p">,</span> <span class="ss">:twitter</span><span class="p">,</span> <span class="ss">to: :profile</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-2dad39f00ec1d3361c497868522011e6">delegate :name, :age, :address, :twitter, to: :profile
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2dad39f00ec1d3361c497868522011e6">Copiar</button>
</div>
<p>Quando interpolado em uma <em>string</em>, a opção <code>:to</code> deve se tornar uma expressão que avalia o objeto ao qual o método é delegado. Normalmente uma <em>string</em> ou um <em>symbol</em>. Tal expressão é avaliada no contexto do receptor:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># delega para as constantes Rails</span>
<span class="n">delegate</span> <span class="ss">:logger</span><span class="p">,</span> <span class="ss">to: :Rails</span>

<span class="c1"># delega para as classes receptoras</span>
<span class="n">delegate</span> <span class="ss">:table_name</span><span class="p">,</span> <span class="ss">to: :class</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-966505b030cb546fb52f0c2eed79948e"># delega para as constantes Rails
delegate :logger, to: :Rails

# delega para as classes receptoras
delegate :table_name, to: :class
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-966505b030cb546fb52f0c2eed79948e">Copiar</button>
</div>
<div class="warning"><p>Se a opção <code>:prefix</code> for <code>true</code> é menos genérica, veja abaixo.</p></div><p>Por padrão, se a delegação resulta em <code>NoMethodError</code> e o objeto é <code>nil</code> a exceção se propaga. Você pode perguntar se <code>nil</code> é retornado ao invés com a opção <code>:allow_nil</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">delegate</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">to: :profile</span><span class="p">,</span> <span class="ss">allow_nil: </span><span class="kp">true</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-b655e9d576cc39ed4667119543c683a0">delegate :name, to: :profile, allow_nil: true
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-b655e9d576cc39ed4667119543c683a0">Copiar</button>
</div>
<p>Com <code>:allow_nil</code> a chamada <code>user.name</code> retorna <code>nil</code> se o usuário não tiver um perfil.</p><p>A opção <code>:prefix</code> adiciona um prefixo ao nome do método gerado. Isso pode ser útil, por exemplo, para obter um nome melhor:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">delegate</span> <span class="ss">:street</span><span class="p">,</span> <span class="ss">to: :address</span><span class="p">,</span> <span class="ss">prefix: </span><span class="kp">true</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-9366f54fe097297fa837d482a9415414">delegate :street, to: :address, prefix: true
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-9366f54fe097297fa837d482a9415414">Copiar</button>
</div>
<p>Os exemplos prévios geram <code>address_street</code> ao invés de <code>street</code>.</p><div class="warning"><p>Já que neste caso o nome do método gerado é composto pelos nomes do objeto alvo e do método alvo, a opção <code>:to</code> deve ser um nome de método.</p></div><p>Um prefixo customizado pode também ser configurado:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">delegate</span> <span class="ss">:size</span><span class="p">,</span> <span class="ss">to: :attachment</span><span class="p">,</span> <span class="ss">prefix: :avatar</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-ff034aa8bc4e1664e78844bae421201e">delegate :size, to: :attachment, prefix: :avatar
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-ff034aa8bc4e1664e78844bae421201e">Copiar</button>
</div>
<p>Os macro exemplos prévios geram <code>avatar_size</code> ao invés de <code>size</code>.</p><p>A opção <code>:private</code> mudam o escopo do método:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">delegate</span> <span class="ss">:date_of_birth</span><span class="p">,</span> <span class="ss">to: :profile</span><span class="p">,</span> <span class="ss">private: </span><span class="kp">true</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-d8dedcbe60f7f949167dea5c8eb233a2">delegate :date_of_birth, to: :profile, private: true
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d8dedcbe60f7f949167dea5c8eb233a2">Copiar</button>
</div>
<p>Os métodos delegados são públicos por padrão. Passe <code>private: true</code> para mudar isso.</p><div class="note"><p>Definido em <code>active_support/core_ext/module/delegation.rb</code></p></div><h5 id="delegate-missing-to"><a class="anchorlink" href="#delegate-missing-to">3.4.2 <code>delegate_missing_to</code></a></h5><p>Imagine que você gostaria de delegar tudo o que está faltando no objeto <code>User</code>,
para um <code>Profile</code>. A macro <a href="https://api.rubyonrails.org/v6.1.4/classes/Module.html#method-i-delegate_missing_to"><code>delegate_missing_to</code></a> permite que você implemente isso
de forma facilitada:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_one</span> <span class="ss">:profile</span>

  <span class="n">delegate_missing_to</span> <span class="ss">:profile</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-770b025fde41728d17266ffb225682c4">class User &lt; ApplicationRecord
  has_one :profile

  delegate_missing_to :profile
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-770b025fde41728d17266ffb225682c4">Copiar</button>
</div>
<p>O destino pode ser qualquer coisa que possa ser chamada dentro do objeto, por exemplo: instância de variáveis,
métodos, constantes etc. Somente métodos públicos do alvo são delegados.</p><div class="note"><p>Definido em <code>active_support/core_ext/module/delegation.rb</code>.</p></div><h4 id="redefinindo-metodos"><a class="anchorlink" href="#redefinindo-metodos">3.5 Redefinindo Métodos</a></h4><p>Existem casos onde você precisa definir um método com <code>define_method</code>, mas não sei se já existe um método com esse nome. Caso sim, um <em>warning</em> é exibido se estiverem habilitados. Não é muito perigoso, mas não é uma boa prática.</p><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/Module.html#method-i-redefine_method"><code>redefine_method</code></a> previne um potencial <em>warning</em>, removendo um método existente, se necessário.</p><p>Você pode também usar <a href="https://api.rubyonrails.org/v6.1.4/classes/Module.html#method-i-silence_redefinition_of_method"><code>silence_redefinition_of_method</code></a> se você precisa definir
o método de substituição (porque você está usando <code>delegate</code>, por
exemplo).</p><div class="note"><p>Definido em <code>active_support/core_ext/module/redefine_method.rb</code>.</p></div><h3 id="extensoes-para-class"><a class="anchorlink" href="#extensoes-para-class">4 Extensões para <code>Class</code></a></h3><h4 id="atributos-de-classe"><a class="anchorlink" href="#atributos-de-classe">4.1 Atributos de classe</a></h4><h5 id="class-attribute"><a class="anchorlink" href="#class-attribute">4.1.1 <code>class_attribute</code></a></h5><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/Class.html#method-i-class_attribute"><code>class_attribute</code></a> declara um ou mais atributos de classe herdáveis que podem ser substituídos em qualquer nível abaixo da hierarquia.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">A</span>
  <span class="n">class_attribute</span> <span class="ss">:x</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">B</span> <span class="o">&lt;</span> <span class="no">A</span><span class="p">;</span> <span class="k">end</span>

<span class="k">class</span> <span class="nc">C</span> <span class="o">&lt;</span> <span class="no">B</span><span class="p">;</span> <span class="k">end</span>

<span class="no">A</span><span class="p">.</span><span class="nf">x</span> <span class="o">=</span> <span class="ss">:a</span>
<span class="no">B</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; :a</span>
<span class="no">C</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; :a</span>

<span class="no">B</span><span class="p">.</span><span class="nf">x</span> <span class="o">=</span> <span class="ss">:b</span>
<span class="no">A</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; :a</span>
<span class="no">C</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; :b</span>

<span class="no">C</span><span class="p">.</span><span class="nf">x</span> <span class="o">=</span> <span class="ss">:c</span>
<span class="no">A</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; :a</span>
<span class="no">B</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; :b</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-25886c9fd40abf076c152d627a6c4595">class A
  class_attribute :x
end

class B &lt; A; end

class C &lt; B; end

A.x = :a
B.x # =&gt; :a
C.x # =&gt; :a

B.x = :b
A.x # =&gt; :a
C.x # =&gt; :b

C.x = :c
A.x # =&gt; :a
B.x # =&gt; :b
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-25886c9fd40abf076c152d627a6c4595">Copiar</button>
</div>
<p>Por exemplo <code>ActionMailer::Base</code> define:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">class_attribute</span> <span class="ss">:default_params</span>
<span class="nb">self</span><span class="p">.</span><span class="nf">default_params</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">mime_version: </span><span class="s2">"1.0"</span><span class="p">,</span>
  <span class="ss">charset: </span><span class="s2">"UTF-8"</span><span class="p">,</span>
  <span class="ss">content_type: </span><span class="s2">"text/plain"</span><span class="p">,</span>
  <span class="ss">parts_order: </span><span class="p">[</span> <span class="s2">"text/plain"</span><span class="p">,</span> <span class="s2">"text/enriched"</span><span class="p">,</span> <span class="s2">"text/html"</span> <span class="p">]</span>
<span class="p">}.</span><span class="nf">freeze</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-d02d4c4b04df5d8fecb6d7fc60611c8d">class_attribute :default_params
self.default_params = {
  mime_version: "1.0",
  charset: "UTF-8",
  content_type: "text/plain",
  parts_order: [ "text/plain", "text/enriched", "text/html" ]
}.freeze
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d02d4c4b04df5d8fecb6d7fc60611c8d">Copiar</button>
</div>
<p>Eles também podem ser acessados e substituídos no nível de instância.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">A</span><span class="p">.</span><span class="nf">x</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">a1</span> <span class="o">=</span> <span class="no">A</span><span class="p">.</span><span class="nf">new</span>
<span class="n">a2</span> <span class="o">=</span> <span class="no">A</span><span class="p">.</span><span class="nf">new</span>
<span class="n">a2</span><span class="p">.</span><span class="nf">x</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">a1</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; 1, vem de A</span>
<span class="n">a2</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; 2, substituído em a2</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-898b8e82c1e28f792da8d9c83987e425">A.x = 1

a1 = A.new
a2 = A.new
a2.x = 2

a1.x # =&gt; 1, vem de A
a2.x # =&gt; 2, substituído em a2
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-898b8e82c1e28f792da8d9c83987e425">Copiar</button>
</div>
<p>A criação de um método de instância de escrita pode ser prevenido configurando a opção <code>:instance_writer</code> para <code>false</code>.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">ActiveRecord</span>
  <span class="k">class</span> <span class="nc">Base</span>
    <span class="n">class_attribute</span> <span class="ss">:table_name_prefix</span><span class="p">,</span> <span class="ss">instance_writer: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">default: </span><span class="s2">"my"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-ea4f2e09df84ed3b47f03163fc0dd6c6">module ActiveRecord
  class Base
    class_attribute :table_name_prefix, instance_writer: false, default: "my"
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-ea4f2e09df84ed3b47f03163fc0dd6c6">Copiar</button>
</div>
<p>Essa opção pode ser útil para prevenir atribuições em massa ao definir o atributo.</p><p>A criação de um método de instância de leitura pode ser prevenido configurando a opção <code>:instance_reader</code> para <code>false</code>.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">A</span>
  <span class="n">class_attribute</span> <span class="ss">:x</span><span class="p">,</span> <span class="ss">instance_reader: </span><span class="kp">false</span>
<span class="k">end</span>

<span class="no">A</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="no">A</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># NoMethodError</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-2b25241ce556877165cae1c1ca5c105b">class A
  class_attribute :x, instance_reader: false
end

A.new.x = 1
A.new.x # NoMethodError
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2b25241ce556877165cae1c1ca5c105b">Copiar</button>
</div>
<p>Por conveniência <code>class_attribute</code> também define um predicado de instância que é uma negação dupla do que o leitor de instância retorna. No exemplo acima podemos usar <code>x?</code>.</p><p>Quando <code>:instance_reader</code> é <code>false</code>, o predicado de instância retorna <code>NoMethodError</code> assim como o método de leitura.</p><p>Se você não quiser o predicado de instância, passe <code>instance_predicate: false</code> e ele não será definido.</p><div class="note"><p>Definido em <code>active_support/core_ext/class/attribute.rb</code>.</p></div><h5 id="cattr-reader-cattr-writer-e-cattr-accessor"><a class="anchorlink" href="#cattr-reader-cattr-writer-e-cattr-accessor">4.1.2 <code>cattr_reader</code>, <code>cattr_writer</code>, e <code>cattr_accessor</code></a></h5><p>As macros <a href="https://api.rubyonrails.org/v6.1.4/classes/Module.html#method-i-cattr_reader"><code>cattr_reader</code></a>, <a href="https://api.rubyonrails.org/v6.1.4/classes/Module.html#method-i-cattr_writer"><code>cattr_writer</code></a>, e <a href="https://api.rubyonrails.org/v6.1.4/classes/Module.html#method-i-cattr_accessor"><code>cattr_accessor</code></a> são análogas às suas <code>attr_*</code> homólogas porém para classes. Eles inicializam a variável de classe com <code>nil</code> a menos que ela já exista, e gera os métodos de classe correspondentes para acessá-la:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">MysqlAdapter</span> <span class="o">&lt;</span> <span class="no">AbstractAdapter</span>
  <span class="c1"># Gera métodos de classe para acessar @@emulate_booleans.</span>
  <span class="n">cattr_accessor</span> <span class="ss">:emulate_booleans</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-17b1c5df6036157cab810a06fc52db9b">class MysqlAdapter &lt; AbstractAdapter
  # Gera métodos de classe para acessar @@emulate_booleans.
  cattr_accessor :emulate_booleans
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-17b1c5df6036157cab810a06fc52db9b">Copiar</button>
</div>
<p>Além disso, você pode passar um bloco para <code>cattr_*</code> para configurar o atributo com um valor padrão.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">MysqlAdapter</span> <span class="o">&lt;</span> <span class="no">AbstractAdapter</span>
  <span class="c1"># Gera métodos de classe para acessar @@emulate_booleans com true como valor padrão.</span>
  <span class="n">cattr_accessor</span> <span class="ss">:emulate_booleans</span><span class="p">,</span> <span class="ss">default: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-4f44eb5af54d266d0a66bb7ac5e31165">class MysqlAdapter &lt; AbstractAdapter
  # Gera métodos de classe para acessar @@emulate_booleans com true como valor padrão.
  cattr_accessor :emulate_booleans, default: true
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-4f44eb5af54d266d0a66bb7ac5e31165">Copiar</button>
</div>
<p>Métodos de instância são criados também por conveniência, eles são apenas uma forma de acesso ao atributo de classe. Logo, instâncias podem alterar o atributo de classe, porém não podem substituí-lo do mesmo modo que ocorre com <code>class_attribute</code> (veja acima). Por exemplo, dado</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">ActionView</span>
  <span class="k">class</span> <span class="nc">Base</span>
    <span class="n">cattr_accessor</span> <span class="ss">:field_error_proc</span><span class="p">,</span> <span class="ss">default: </span><span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-81f4e60adeefa05c9debc8d7cc141ec7">module ActionView
  class Base
    cattr_accessor :field_error_proc, default: Proc.new { ... }
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-81f4e60adeefa05c9debc8d7cc141ec7">Copiar</button>
</div>
<p>podemos acessar <code>field_error_proc</code> nas <em>views</em>.</p><p>A geração do método de leitura de instância pode ser prevenido configurando <code>:instance_reader</code> para <code>false</code> e a geração dos métodos de escrita de instância podem ser prevenidos configurando <code>:instance_writer</code> para <code>false</code>. A geração de ambos os métodos podem ser prevenidos configurando <code>:instance_accessor</code> para <code>false</code>. Em todos os casos, o valor deve ser exatamente <code>false</code> e não qualquer outro valor falso.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">A</span>
  <span class="k">class</span> <span class="nc">B</span>
    <span class="c1"># Nenhuma leitura de instância first_name é gerada.</span>
    <span class="n">cattr_accessor</span> <span class="ss">:first_name</span><span class="p">,</span> <span class="ss">instance_reader: </span><span class="kp">false</span>
    <span class="c1"># Nenhuma escrita de instância last_name= é gerada.</span>
    <span class="n">cattr_accessor</span> <span class="ss">:last_name</span><span class="p">,</span> <span class="ss">instance_writer: </span><span class="kp">false</span>
    <span class="c1"># Nenhuma leitura surname ou escritor surname= de instância é gerada.</span>
    <span class="n">cattr_accessor</span> <span class="ss">:surname</span><span class="p">,</span> <span class="ss">instance_accessor: </span><span class="kp">false</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-544b9088c9b144369df1130dadc37163">module A
  class B
    # Nenhuma leitura de instância first_name é gerada.
    cattr_accessor :first_name, instance_reader: false
    # Nenhuma escrita de instância last_name= é gerada.
    cattr_accessor :last_name, instance_writer: false
    # Nenhuma leitura surname ou escritor surname= de instância é gerada.
    cattr_accessor :surname, instance_accessor: false
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-544b9088c9b144369df1130dadc37163">Copiar</button>
</div>
<p>Pode ser útil configurar <code>:instance_accessor</code> para <code>false</code> no <em>model</em> como uma maneira de prevenir atribuições em massa ao definir o atributo.</p><div class="note"><p>Definido em <code>active_support/core_ext/module/attribute_accessors.rb</code>.</p></div><h4 id="subclasses-e-descendentes"><a class="anchorlink" href="#subclasses-e-descendentes">4.2 Subclasses e Descendentes</a></h4><h5 id="subclasses"><a class="anchorlink" href="#subclasses">4.2.1 <code>subclasses</code></a></h5><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/Class.html#method-i-subclasses"><code>subclasses</code></a> retorna as subclasses do recebedor:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">C</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">subclasses</span> <span class="c1"># =&gt; []</span>

<span class="k">class</span> <span class="nc">B</span> <span class="o">&lt;</span> <span class="no">C</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">subclasses</span> <span class="c1"># =&gt; [B]</span>

<span class="k">class</span> <span class="nc">A</span> <span class="o">&lt;</span> <span class="no">B</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">subclasses</span> <span class="c1"># =&gt; [B]</span>

<span class="k">class</span> <span class="nc">D</span> <span class="o">&lt;</span> <span class="no">C</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">subclasses</span> <span class="c1"># =&gt; [B, D]</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-4b915e71a2fb4ae5e91e1b726db395a3">class C; end
C.subclasses # =&gt; []

class B &lt; C; end
C.subclasses # =&gt; [B]

class A &lt; B; end
C.subclasses # =&gt; [B]

class D &lt; C; end
C.subclasses # =&gt; [B, D]
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-4b915e71a2fb4ae5e91e1b726db395a3">Copiar</button>
</div>
<p>A ordem em que essas classes são retornadas não é especificada.</p><div class="note"><p>Definido em <code>active_support/core_ext/class/subclasses.rb</code>.</p></div><h5 id="descendants"><a class="anchorlink" href="#descendants">4.2.2 <code>descendants</code></a></h5><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/Class.html#method-i-descendants"><code>descendants</code></a> retorna todas as classes que são <code>&lt;</code> pelo recebedor:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">C</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">descendants</span> <span class="c1"># =&gt; []</span>

<span class="k">class</span> <span class="nc">B</span> <span class="o">&lt;</span> <span class="no">C</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">descendants</span> <span class="c1"># =&gt; [B]</span>

<span class="k">class</span> <span class="nc">A</span> <span class="o">&lt;</span> <span class="no">B</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">descendants</span> <span class="c1"># =&gt; [B, A]</span>

<span class="k">class</span> <span class="nc">D</span> <span class="o">&lt;</span> <span class="no">C</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">descendants</span> <span class="c1"># =&gt; [B, A, D]</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-e5a734b9092515815c255cbaa9fa99b7">class C; end
C.descendants # =&gt; []

class B &lt; C; end
C.descendants # =&gt; [B]

class A &lt; B; end
C.descendants # =&gt; [B, A]

class D &lt; C; end
C.descendants # =&gt; [B, A, D]
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-e5a734b9092515815c255cbaa9fa99b7">Copiar</button>
</div>
<p>A ordem em que essas classes são retornadas não é especificada.</p><div class="note"><p>Definido em <code>active_support/core_ext/class/subclasses.rb</code>.</p></div><h3 id="extensoes-para-string"><a class="anchorlink" href="#extensoes-para-string">5 Extensões para <code>String</code></a></h3><h4 id="seguranca-de-saida"><a class="anchorlink" href="#seguranca-de-saida">5.1 Segurança de saída</a></h4><h5 id="motivacao"><a class="anchorlink" href="#motivacao">5.1.1 Motivação</a></h5><p>Inserir dados em <em>templates</em> HTML, necessita de cuidados extras. Por exemplo, você não pode apenas literalmente juntar <code>@review.title</code> em uma página HTML. Por outro lado, se o título do comentário é "Flanagan &amp; Matz rules!" o retorno não será bem formada porque um 'e comercial' precisa ser usado como "&amp;amp;". Além do mais, dependendo da aplicação, isso pode ser uma grande falha de segurança porque os usuários podem injetar uma configuração HTML maliciosa em um título de revisão feito à mão. Confira a seção sobre <em>cross-site scripting</em> em <a href="security.html#cross-site-scripting-xss">Guia de Segurança</a> para maiores informações sobre os riscos.</p><h5 id="strings-seguras"><a class="anchorlink" href="#strings-seguras">5.1.2 <em>Strings</em> Seguras</a></h5><p><em>Active Support</em> possui o conceito de <em>(html)</em> <em>strings</em> seguras. Uma <em>string</em> segura é aquela que é marcada como sendo inserível no HTML como é definida. Ela é confiável, não importando sua origem.</p><p><em>Strings</em> são consideradas como inseguras por padrão:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">""</span><span class="p">.</span><span class="nf">html_safe?</span> <span class="c1"># =&gt; false</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-d5d1bcf8a902806ce36763cc6a43a203">"".html_safe? # =&gt; false
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d5d1bcf8a902806ce36763cc6a43a203">Copiar</button>
</div>
<p>Pode-se obter uma <em>string</em> segura de um dado com o método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-html_safe"><code>html_safe</code></a>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">s</span> <span class="o">=</span> <span class="s2">""</span><span class="p">.</span><span class="nf">html_safe</span>
<span class="n">s</span><span class="p">.</span><span class="nf">html_safe?</span> <span class="c1"># =&gt; true</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-34bb693ca9f6fcdc462ea1d1feecea7b">s = "".html_safe
s.html_safe? # =&gt; true
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-34bb693ca9f6fcdc462ea1d1feecea7b">Copiar</button>
</div>
<p>É importante entender que <code>html_safe</code> não executa nenhuma operação, é apenas uma afirmação:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">s</span> <span class="o">=</span> <span class="s2">"&lt;script&gt;...&lt;/script&gt;"</span><span class="p">.</span><span class="nf">html_safe</span>
<span class="n">s</span><span class="p">.</span><span class="nf">html_safe?</span> <span class="c1"># =&gt; true</span>
<span class="n">s</span>            <span class="c1"># =&gt; "&lt;script&gt;...&lt;/script&gt;"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-894ddf0595240266badc8699233bc7bd">s = "&lt;script&gt;...&lt;/script&gt;".html_safe
s.html_safe? # =&gt; true
s            # =&gt; "&lt;script&gt;...&lt;/script&gt;"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-894ddf0595240266badc8699233bc7bd">Copiar</button>
</div>
<p>É sua responsabilidade garantir a chamada <code>html_safe</code> em cada <em>string</em> particular.</p><p>Se você anexar em uma <em>string</em> segura, com <code>concat</code>/<code>&lt;&lt;</code>, ou com <code>+</code>, o resultado é uma <em>string</em> segura. Argumentos inseguros são ignorados:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">""</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span> <span class="s2">"&lt;"</span> <span class="c1"># =&gt; "&amp;lt;"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-89c806dc38c6b0d7dddfb40cde6f8d68">"".html_safe + "&lt;" # =&gt; "&amp;lt;"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-89c806dc38c6b0d7dddfb40cde6f8d68">Copiar</button>
</div>
<p>Argumentos seguros são anexados diretamente:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">""</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span> <span class="s2">"&lt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="c1"># =&gt; "&lt;"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-54c6a39920740edadd2f0755407b654c">"".html_safe + "&lt;".html_safe # =&gt; "&lt;"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-54c6a39920740edadd2f0755407b654c">Copiar</button>
</div>
<p>Esses métodos não devem ser usados em <em>views</em> comuns. Valores inseguros são ignorados automaticamente:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="vi">@review</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span> <span class="c">&lt;%# correto, ignora se necessário %&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-fcc055dba58d5b2a9076b97e7884c9b3">&lt;%= @review.title %&gt; &lt;%# correto, ignora se necessário %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-fcc055dba58d5b2a9076b97e7884c9b3">Copiar</button>
</div>
<p>Para inserir algo literal, use o <em>helper</em> <a href="https://api.rubyonrails.org/v6.1.4/classes/ActionView/Helpers/OutputSafetyHelper.html#method-i-raw"><code>raw</code></a> ao invés de chamar <code>html_safe</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">raw</span> <span class="vi">@cms</span><span class="p">.</span><span class="nf">current_template</span> <span class="cp">%&gt;</span> <span class="c">&lt;%# insere @cms.current_template como é %&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-38655f65a64c9e7e3f02ecbc2acf8fa1">&lt;%= raw @cms.current_template %&gt; &lt;%# insere @cms.current_template como é %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-38655f65a64c9e7e3f02ecbc2acf8fa1">Copiar</button>
</div>
<p>ou, equivalentemente, use <code>&lt;%==</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span><span class="o">=</span> <span class="vi">@cms</span><span class="p">.</span><span class="nf">current_template</span> <span class="cp">%&gt;</span> <span class="c">&lt;%# insere @cms.current_template como é %&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-5c8e4a692e5feab46effa4ff74dfe06a">&lt;%== @cms.current_template %&gt; &lt;%# insere @cms.current_template como é %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-5c8e4a692e5feab46effa4ff74dfe06a">Copiar</button>
</div>
<p>O <em>helper</em> <code>raw</code> chama <code>html_safe</code> pra você:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">raw</span><span class="p">(</span><span class="n">stringish</span><span class="p">)</span>
  <span class="n">stringish</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">html_safe</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-09b842d563f407c7888001d331ddeb59">def raw(stringish)
  stringish.to_s.html_safe
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-09b842d563f407c7888001d331ddeb59">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/string/output_safety.rb</code>.</p></div><h5 id="transformacao"><a class="anchorlink" href="#transformacao">5.1.3 Transformação</a></h5><p>De modo geral, exceto talvez para concatenação conforme explicado acima, qualquer método que possa alterar uma <em>string</em> fornece uma <em>string</em> insegura. Estes são <code>downcase</code>, <code>gsub</code>, <code>strip</code>, <code>chomp</code>, <code>underscore</code>, etc.</p><p>No caso de transformações locais, como com <code>gsub!</code> o próprio receptor se torna inseguro.</p><div class="info"><p>O bit de segurança é perdido sempre, não importa se a transformação realmente mudou algo.</p></div><h5 id="conversao-e-coercao"><a class="anchorlink" href="#conversao-e-coercao">5.1.4 Conversão e Coerção</a></h5><p>Chamando <code>to_s</code> em uma <em>string</em> segura retorna uma <em>string</em> segura, mas a coerção com <code>to_str</code> retorna uma <em>string</em> insegura.</p><h5 id="copiando"><a class="anchorlink" href="#copiando">5.1.5 Copiando</a></h5><p>Chamando <code>dup</code> ou <code>clone</code> em <em>strings</em> seguras produz outras <em>strings</em> seguras.</p><h4 id="remove"><a class="anchorlink" href="#remove">5.2 <code>remove</code></a></h4><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-remove"><code>remove</code></a> vai remover todas ocorrências com o padrão:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Hello World"</span><span class="p">.</span><span class="nf">remove</span><span class="p">(</span><span class="sr">/Hello /</span><span class="p">)</span> <span class="c1"># =&gt; "World"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-753902a9a3725e791bb1de0633aebfc7">"Hello World".remove(/Hello /) # =&gt; "World"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-753902a9a3725e791bb1de0633aebfc7">Copiar</button>
</div>
<p>Há também a versão destrutiva <code>String#remove!</code>.</p><div class="note"><p>Definido em <code>active_support/core_ext/string/filters.rb</code>.</p></div><h4 id="squish"><a class="anchorlink" href="#squish">5.3 <code>squish</code></a></h4><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-squish"><code>squish</code></a> remove os espaços em branco à esquerda e à direita e substitui os espaços em branco por um único espaço cada:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">" </span><span class="se">\n</span><span class="s2">  foo</span><span class="se">\n\r</span><span class="s2"> </span><span class="se">\t</span><span class="s2"> bar </span><span class="se">\n</span><span class="s2">"</span><span class="p">.</span><span class="nf">squish</span> <span class="c1"># =&gt; "foo bar"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-392e026e6afbb723b84f39c8c0334b21">" \n  foo\n\r \t bar \n".squish # =&gt; "foo bar"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-392e026e6afbb723b84f39c8c0334b21">Copiar</button>
</div>
<p>Há também a versão destrutiva <code>String#squish!</code>.</p><p>Observe que se lida com espaços em branco ASCII e Unicode.</p><div class="note"><p>Definido em <code>active_support/core_ext/string/filters.rb</code>.</p></div><h4 id="truncate"><a class="anchorlink" href="#truncate">5.4 <code>truncate</code></a></h4><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-truncate"><code>truncate</code></a> retorna uma cópia de seu receptor truncado após um determinado <code>length</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh dear!..."</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-d445c16be6fb5fcb08e29ef4655679e4">"Oh dear! Oh dear! I shall be late!".truncate(20)
# =&gt; "Oh dear! Oh dear!..."
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d445c16be6fb5fcb08e29ef4655679e4">Copiar</button>
</div>
<p>As reticências podem ser personalizadas com a opção <code>:omission</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="ss">omission: </span><span class="s1">'&amp;hellip;'</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh &amp;hellip;"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-b61786ff8291874717c936023b989593">"Oh dear! Oh dear! I shall be late!".truncate(20, omission: '&amp;hellip;')
# =&gt; "Oh dear! Oh &amp;hellip;"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-b61786ff8291874717c936023b989593">Copiar</button>
</div>
<p>Observe em particular que o truncamento leva em consideração o comprimento da <em>string</em> de omissão.</p><p>Passe o método <code>:separator</code> para truncar a <em>string</em> em uma pausa natural:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh dea..."</span>
<span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="ss">separator: </span><span class="s1">' '</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh..."</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-0192150464c06638567ca619ed4337df">"Oh dear! Oh dear! I shall be late!".truncate(18)
# =&gt; "Oh dear! Oh dea..."
"Oh dear! Oh dear! I shall be late!".truncate(18, separator: ' ')
# =&gt; "Oh dear! Oh..."
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-0192150464c06638567ca619ed4337df">Copiar</button>
</div>
<p>A opção <code>:separator</code> pode ser uma regexp:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="ss">separator: </span><span class="sr">/\s/</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh..."</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-89b698fd279594d26447930e9ec88304">"Oh dear! Oh dear! I shall be late!".truncate(18, separator: /\s/)
# =&gt; "Oh dear! Oh..."
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-89b698fd279594d26447930e9ec88304">Copiar</button>
</div>
<p>Nos exemplos acima "dear" é cortado primeiro, mas depois <code>:separator</code> impede isso.</p><div class="note"><p>Definido em <code>active_support/core_ext/string/filters.rb</code>.</p></div><h4 id="truncate-bytes"><a class="anchorlink" href="#truncate-bytes">5.5 <code>truncate_bytes</code></a></h4><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-truncate_bytes"><code>truncate_bytes</code></a> retorna uma cópia de seu receptor truncado para no máximo <code>bytesize</code> <em>bytes</em>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"👍👍👍👍"</span><span class="p">.</span><span class="nf">truncate_bytes</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="c1"># =&gt; "👍👍👍…"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-50b92b5aa28900e49f4926ed16a744e8">"👍👍👍👍".truncate_bytes(15)
# =&gt; "👍👍👍…"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-50b92b5aa28900e49f4926ed16a744e8">Copiar</button>
</div>
<p>As reticências podem ser personalizadas com a opção <code>:omission</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"👍👍👍👍"</span><span class="p">.</span><span class="nf">truncate_bytes</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="ss">omission: </span><span class="s2">"🖖"</span><span class="p">)</span>
<span class="c1"># =&gt; "👍👍🖖"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-5850d9599214dece63cc37ae09d63eb1">"👍👍👍👍".truncate_bytes(15, omission: "🖖")
# =&gt; "👍👍🖖"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-5850d9599214dece63cc37ae09d63eb1">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/string/filters.rb</code>.</p></div><h4 id="truncate-words"><a class="anchorlink" href="#truncate-words">5.6 <code>truncate_words</code></a></h4><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-truncate_words"><code>truncate_words</code></a> retorna uma cópia da frase original truncada depois de receber um determinado número de palavras:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate_words</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh dear!..."</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-997e100398e2d6068eea6d2c32be52a6">"Oh dear! Oh dear! I shall be late!".truncate_words(4)
# =&gt; "Oh dear! Oh dear!..."
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-997e100398e2d6068eea6d2c32be52a6">Copiar</button>
</div>
<p>Reticências podem ser customizadas com a opção <code>:omission</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate_words</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="ss">omission: </span><span class="s1">'&amp;hellip;'</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh dear!&amp;hellip;"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-e9674069cd89174c91524771f7e80838">"Oh dear! Oh dear! I shall be late!".truncate_words(4, omission: '&amp;hellip;')
# =&gt; "Oh dear! Oh dear!&amp;hellip;"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-e9674069cd89174c91524771f7e80838">Copiar</button>
</div>
<p>Chame <code>:separator</code> para truncar a <em>string</em> na pausa natural:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate_words</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="ss">separator: </span><span class="s1">'!'</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh dear! I shall be late..."</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-6b489798754b01ca2e4a5f005db9b934">"Oh dear! Oh dear! I shall be late!".truncate_words(3, separator: '!')
# =&gt; "Oh dear! Oh dear! I shall be late..."
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-6b489798754b01ca2e4a5f005db9b934">Copiar</button>
</div>
<p>A opção <code>:separator</code> pode ser uma regexp:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate_words</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="ss">separator: </span><span class="sr">/\s/</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh dear!..."</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-9b87b0b669c0260bfa24bd636ed28e6e">"Oh dear! Oh dear! I shall be late!".truncate_words(4, separator: /\s/)
# =&gt; "Oh dear! Oh dear!..."
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-9b87b0b669c0260bfa24bd636ed28e6e">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/string/filters.rb</code>.</p></div><h4 id="inquiry"><a class="anchorlink" href="#inquiry">5.7 <code>inquiry</code></a></h4><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-inquiry"><code>inquiry</code></a> converte uma <em>string</em> em um objeto <code>StringInquirer</code> fazendo verificações de igualdade mais elegantes.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"production"</span><span class="p">.</span><span class="nf">inquiry</span><span class="p">.</span><span class="nf">production?</span> <span class="c1"># =&gt; true</span>
<span class="s2">"active"</span><span class="p">.</span><span class="nf">inquiry</span><span class="p">.</span><span class="nf">inactive?</span>       <span class="c1"># =&gt; false</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-3d843e2fd5e2ab0d8575ac2f4ab0d0a4">"production".inquiry.production? # =&gt; true
"active".inquiry.inactive?       # =&gt; false
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-3d843e2fd5e2ab0d8575ac2f4ab0d0a4">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/string/inquiry.rb</code>.</p></div><h4 id="extensoes-para-string-starts-with-questionmark-e-ends-with-questionmark"><a class="anchorlink" href="#extensoes-para-string-starts-with-questionmark-e-ends-with-questionmark">5.8 <code>starts_with?</code> e <code>ends_with?</code></a></h4><p><em>Active Support</em> define conjugação verbal para 3ª pessoa em <code>String#start_with?</code> e <code>String#end_with?</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"foo"</span><span class="p">.</span><span class="nf">starts_with?</span><span class="p">(</span><span class="s2">"f"</span><span class="p">)</span> <span class="c1"># =&gt; true</span>
<span class="s2">"foo"</span><span class="p">.</span><span class="nf">ends_with?</span><span class="p">(</span><span class="s2">"o"</span><span class="p">)</span>   <span class="c1"># =&gt; true</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-3d3c96e4a050fd492ac9879e18643d98">"foo".starts_with?("f") # =&gt; true
"foo".ends_with?("o")   # =&gt; true
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-3d3c96e4a050fd492ac9879e18643d98">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/string/starts_ends_with.rb</code>.</p></div><h4 id="strip-heredoc"><a class="anchorlink" href="#strip-heredoc">5.9 <code>strip_heredoc</code></a></h4><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-strip_heredoc"><code>strip_heredoc</code></a> tira o recuo em <em>heredocs</em>.</p><p>Por exemplo em</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="ss">:usage</span><span class="p">]</span>
  <span class="nb">puts</span> <span class="o">&lt;&lt;-</span><span class="no">USAGE</span><span class="p">.</span><span class="nf">strip_heredoc</span><span class="sh">
    This command does such and such.

    Supported options are:
      -h         This message
      ...
</span><span class="no">  USAGE</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-16be842c57ba7f71d2c186ecf80ab96c">if options[:usage]
  puts &lt;&lt;-USAGE.strip_heredoc
    This command does such and such.

    Supported options are:
      -h         This message
      ...
  USAGE
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-16be842c57ba7f71d2c186ecf80ab96c">Copiar</button>
</div>
<p>o usuário veria a mensagem de uso alinhada à margem esquerda.</p><p>Tecnicamente, se procura a linha menos indentada em toda a <em>string</em> e remove
essa quantidade de espaço em branco à esquerda.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/string/strip.rb">active_support/core_ext/string/strip.rb</a></code>.</p></div><h4 id="indent"><a class="anchorlink" href="#indent">5.10 <code>indent</code></a></h4><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-indent"><code>indent</code></a> indenta as linhas no receptor:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="o">&lt;&lt;</span><span class="no">EOS</span><span class="p">.</span><span class="nf">indent</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="sh">
def some_method
  some_code
end
</span><span class="no">EOS</span>
<span class="c1"># =&gt;</span>
  <span class="k">def</span> <span class="nf">some_method</span>
    <span class="n">some_code</span>
  <span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-4c410c0526263ec22fc866434c3b2f97">&lt;&lt;EOS.indent(2)
def some_method
  some_code
end
EOS
# =&gt;
  def some_method
    some_code
  end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-4c410c0526263ec22fc866434c3b2f97">Copiar</button>
</div>
<p>O segundo argumento, <code>indent_string</code>, especifica qual <em>string</em> de indentação usar. O padrão é <code>nil</code>, que diz ao método para fazer uma suposição conferindo a primeira linha indentada, e recuando para um espaço se não houver nenhuma.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"  foo"</span><span class="p">.</span><span class="nf">indent</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>        <span class="c1"># =&gt; "    foo"</span>
<span class="s2">"foo</span><span class="se">\n\t\t</span><span class="s2">bar"</span><span class="p">.</span><span class="nf">indent</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; "\t\tfoo\n\t\t\t\tbar"</span>
<span class="s2">"foo"</span><span class="p">.</span><span class="nf">indent</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">)</span>    <span class="c1"># =&gt; "\t\tfoo"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-068ddb128f144f266dd9b52f336b3023">"  foo".indent(2)        # =&gt; "    foo"
"foo\n\t\tbar".indent(2) # =&gt; "\t\tfoo\n\t\t\t\tbar"
"foo".indent(2, "\t")    # =&gt; "\t\tfoo"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-068ddb128f144f266dd9b52f336b3023">Copiar</button>
</div>
<p>Enquanto <code>indent_string</code> é normalmente um espaço ou tabulação, essa pode ser qualquer <em>string</em>.</p><p>O terceiro argumento, <code>indent_empty_lines</code>, é uma sinalização que diz se as linhas vazias devem ser indentadas. O padrão é <em>false</em>.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"foo</span><span class="se">\n\n</span><span class="s2">bar"</span><span class="p">.</span><span class="nf">indent</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>            <span class="c1"># =&gt; "  foo\n\n  bar"</span>
<span class="s2">"foo</span><span class="se">\n\n</span><span class="s2">bar"</span><span class="p">.</span><span class="nf">indent</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">true</span><span class="p">)</span> <span class="c1"># =&gt; "  foo\n  \n  bar"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-b1e66a0230e69074244a88799b7791b3">"foo\n\nbar".indent(2)            # =&gt; "  foo\n\n  bar"
"foo\n\nbar".indent(2, nil, true) # =&gt; "  foo\n  \n  bar"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-b1e66a0230e69074244a88799b7791b3">Copiar</button>
</div>
<p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-indent-21"><code>indent!</code></a> realiza recuo no local.</p><div class="note"><p>Definido em <code>active_support/core_ext/string/indent.rb</code>.</p></div><h4 id="acesso"><a class="anchorlink" href="#acesso">5.11 Acesso</a></h4><h5 id="at-position"><a class="anchorlink" href="#at-position">5.11.1 <code>at(position)</code></a></h5><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-at"><code>at</code></a> retorna o caractere da <em>string</em> na posição <code>position</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"hello"</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># =&gt; "h"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># =&gt; "o"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># =&gt; "o"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># =&gt; nil</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-8ea53365e47ed2ee900277f7a322bb81">"hello".at(0)  # =&gt; "h"
"hello".at(4)  # =&gt; "o"
"hello".at(-1) # =&gt; "o"
"hello".at(10) # =&gt; nil
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8ea53365e47ed2ee900277f7a322bb81">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/string/access.rb</code>.</p></div><h5 id="from-position"><a class="anchorlink" href="#from-position">5.11.2 <code>from(position)</code></a></h5><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-from"><code>from</code></a> retorna a <em>substring</em> da <em>string</em> iniciada na posição <code>position</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"hello"</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># =&gt; "hello"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># =&gt; "llo"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; "lo"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># =&gt; nil</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-0593f8c7c1a0992c0fd6c0abd4796700">"hello".from(0)  # =&gt; "hello"
"hello".from(2)  # =&gt; "llo"
"hello".from(-2) # =&gt; "lo"
"hello".from(10) # =&gt; nil
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-0593f8c7c1a0992c0fd6c0abd4796700">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/string/access.rb</code>.</p></div><h5 id="to-position"><a class="anchorlink" href="#to-position">5.11.3 <code>to(position)</code></a></h5><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-to"><code>to</code></a> retorna a <em>substring</em> da <em>string</em> até a posição <code>position</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"hello"</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># =&gt; "h"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># =&gt; "hel"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; "hell"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># =&gt; "hello"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-13e391fecbf383248723d75dedbb1b86">"hello".to(0)  # =&gt; "h"
"hello".to(2)  # =&gt; "hel"
"hello".to(-2) # =&gt; "hell"
"hello".to(10) # =&gt; "hello"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-13e391fecbf383248723d75dedbb1b86">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/string/access.rb</code>.</p></div><h5 id="first-limit-1"><a class="anchorlink" href="#first-limit-1">5.11.4 <code>first(limit = 1)</code></a></h5><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-first"><code>first</code></a> retorna a <em>substring</em> contendo os primeiros <code>limit</code> caracteres da <em>string</em>.</p><p>A chamada <code>str.first(n)</code> é equivalente a <code>str.to(n-1)</code> se <code>n</code> &gt; 0, e retorna uma <em>string</em> vazia para <code>n</code> == 0.</p><div class="note"><p>Definido em <code>active_support/core_ext/string/access.rb</code>.</p></div><h5 id="last-limit-1"><a class="anchorlink" href="#last-limit-1">5.11.5 <code>last(limit = 1)</code></a></h5><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-last"><code>last</code></a> retorna a <em>substring</em> contendo os últimos <code>limit</code> caracteres da <em>string</em>.</p><p>A chamada <code>str.last(n)</code> é equivalente a <code>str.from(-n)</code> se <code>n</code> &gt; 0, e retorna uma <em>string</em> vazia para <code>n</code> == 0.</p><div class="note"><p>Definido em <code>active_support/core_ext/string/access.rb</code>.</p></div><h4 id="inflexoes"><a class="anchorlink" href="#inflexoes">5.12 Inflexões</a></h4><h5 id="pluralize"><a class="anchorlink" href="#pluralize">5.12.1 <code>pluralize</code></a></h5><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-pluralize"><code>pluralize</code></a> retorna o plural do receptor:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"table"</span><span class="p">.</span><span class="nf">pluralize</span>     <span class="c1"># =&gt; "tables"</span>
<span class="s2">"ruby"</span><span class="p">.</span><span class="nf">pluralize</span>      <span class="c1"># =&gt; "rubies"</span>
<span class="s2">"equipment"</span><span class="p">.</span><span class="nf">pluralize</span> <span class="c1"># =&gt; "equipment"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-796f9c5928d5e5fdecb09fa750577068">"table".pluralize     # =&gt; "tables"
"ruby".pluralize      # =&gt; "rubies"
"equipment".pluralize # =&gt; "equipment"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-796f9c5928d5e5fdecb09fa750577068">Copiar</button>
</div>
<p>Como mostra o exemplo anterior, <em>Active Support</em> conhece alguns plurais irregulares e substantivos incontáveis. As regras integradas podem ser estendidas em <code>config/initializers/inflections.rb</code>. Este arquivo é gerado por padrão, pelo comando <code>rails new</code> e tem instruções nos comentários.</p><p><code>pluralize</code> também pode fazer um parâmetro <code>count</code> opcional. Se <code>count == 1</code> a forma singular será retornada. Para qualquer outro valor de <code>count</code> a forma plural será retornada:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"dude"</span><span class="p">.</span><span class="nf">pluralize</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># =&gt; "dudes"</span>
<span class="s2">"dude"</span><span class="p">.</span><span class="nf">pluralize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># =&gt; "dude"</span>
<span class="s2">"dude"</span><span class="p">.</span><span class="nf">pluralize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; "dudes"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-e928b8a077dbe703242a1b188a5c76ce">"dude".pluralize(0) # =&gt; "dudes"
"dude".pluralize(1) # =&gt; "dude"
"dude".pluralize(2) # =&gt; "dudes"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-e928b8a077dbe703242a1b188a5c76ce">Copiar</button>
</div>
<p><em>Active Record</em> usa esse método pra computar a o nome da tabela padrão correspondente ao <em>model</em>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># active_record/model_schema.rb</span>
<span class="k">def</span> <span class="nf">undecorated_table_name</span><span class="p">(</span><span class="n">class_name</span> <span class="o">=</span> <span class="n">base_class</span><span class="p">.</span><span class="nf">name</span><span class="p">)</span>
  <span class="n">table_name</span> <span class="o">=</span> <span class="n">class_name</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">demodulize</span><span class="p">.</span><span class="nf">underscore</span>
  <span class="n">pluralize_table_names</span> <span class="p">?</span> <span class="n">table_name</span><span class="p">.</span><span class="nf">pluralize</span> <span class="p">:</span> <span class="n">table_name</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-5c2d62a551fdc78353516927ee2e2254"># active_record/model_schema.rb
def undecorated_table_name(class_name = base_class.name)
  table_name = class_name.to_s.demodulize.underscore
  pluralize_table_names ? table_name.pluralize : table_name
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-5c2d62a551fdc78353516927ee2e2254">Copiar</button>
</div>
<div class="note"><p>Definido <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id="singularize"><a class="anchorlink" href="#singularize">5.12.2 <code>singularize</code></a></h5><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-singularize"><code>singularize</code></a> é o inverso do <code>pluralize</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"tables"</span><span class="p">.</span><span class="nf">singularize</span>    <span class="c1"># =&gt; "table"</span>
<span class="s2">"rubies"</span><span class="p">.</span><span class="nf">singularize</span>    <span class="c1"># =&gt; "ruby"</span>
<span class="s2">"equipment"</span><span class="p">.</span><span class="nf">singularize</span> <span class="c1"># =&gt; "equipment"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-c87a8ade8d3a394b09275b0e86ff7997">"tables".singularize    # =&gt; "table"
"rubies".singularize    # =&gt; "ruby"
"equipment".singularize # =&gt; "equipment"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-c87a8ade8d3a394b09275b0e86ff7997">Copiar</button>
</div>
<p>As associações calculam o nome padrão da classe associada correspondente usando este método:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># active_record/reflection.rb</span>
<span class="k">def</span> <span class="nf">derive_class_name</span>
  <span class="n">class_name</span> <span class="o">=</span> <span class="nb">name</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">camelize</span>
  <span class="n">class_name</span> <span class="o">=</span> <span class="n">class_name</span><span class="p">.</span><span class="nf">singularize</span> <span class="k">if</span> <span class="n">collection?</span>
  <span class="n">class_name</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-7338c5d69bc781b1ec032fbebec9eb14"># active_record/reflection.rb
def derive_class_name
  class_name = name.to_s.camelize
  class_name = class_name.singularize if collection?
  class_name
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-7338c5d69bc781b1ec032fbebec9eb14">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id="camelize"><a class="anchorlink" href="#camelize">5.12.3 <code>camelize</code></a></h5><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-camelize"><code>camelize</code></a> retorna o receptor em <em>camel case</em>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"product"</span><span class="p">.</span><span class="nf">camelize</span>    <span class="c1"># =&gt; "Product"</span>
<span class="s2">"admin_user"</span><span class="p">.</span><span class="nf">camelize</span> <span class="c1"># =&gt; "AdminUser"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-1f586f8a9030db87dc8b15bcda3d0ceb">"product".camelize    # =&gt; "Product"
"admin_user".camelize # =&gt; "AdminUser"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-1f586f8a9030db87dc8b15bcda3d0ceb">Copiar</button>
</div>
<p>Como regra geral, você pode pensar neste método como aquele que transforma pastas em nomes de classes ou módulos <em>Ruby</em>, em que barras separam os subarquivos:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"backoffice/session"</span><span class="p">.</span><span class="nf">camelize</span> <span class="c1"># =&gt; "Backoffice::Session"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-79d6a322a16f32ae893fd13646c8a1ef">"backoffice/session".camelize # =&gt; "Backoffice::Session"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-79d6a322a16f32ae893fd13646c8a1ef">Copiar</button>
</div>
<p>Por exemplo, o <em>Action Pack</em> usa este método para carregar a classe que fornece um determinado armazenamento de sessão:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># action_controller/metal/session_management.rb</span>
<span class="k">def</span> <span class="nf">session_store</span><span class="o">=</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
  <span class="vc">@@session_store</span> <span class="o">=</span> <span class="n">store</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Symbol</span><span class="p">)</span> <span class="p">?</span>
    <span class="no">ActionDispatch</span><span class="o">::</span><span class="no">Session</span><span class="p">.</span><span class="nf">const_get</span><span class="p">(</span><span class="n">store</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">camelize</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">store</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-8df3bac3b88a04bb65a796d2f412113e"># action_controller/metal/session_management.rb
def session_store=(store)
  @@session_store = store.is_a?(Symbol) ?
    ActionDispatch::Session.const_get(store.to_s.camelize) :
    store
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8df3bac3b88a04bb65a796d2f412113e">Copiar</button>
</div>
<p><code>camelize</code> aceita um argumento opcional, que pode ser <code>:upper</code> (padrão), ou <code>:lower</code>. Com o último, a primeira letra torna-se minúscula:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"visual_effect"</span><span class="p">.</span><span class="nf">camelize</span><span class="p">(</span><span class="ss">:lower</span><span class="p">)</span> <span class="c1"># =&gt; "visualEffect"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-678971b44bd7e523215c63d619176795">"visual_effect".camelize(:lower) # =&gt; "visualEffect"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-678971b44bd7e523215c63d619176795">Copiar</button>
</div>
<p>Isso pode ser útil para calcular nomes de métodos em uma linguagem que segue essa convenção, por exemplo, <em>JavaScript</em>.</p><div class="info"><p>Como regra geral, você pode pensar em <code>camelize</code> como o inverso do <code>underscore</code>, embora haja casos em que isso não se aplica: <code>"SSLError".underscore.camelize</code> devolve <code>"SslError"</code>. Para apoiar casos como este, o <em>Active Support</em> permite que você especifique acrônimos em <code>config/initializers/inflections.rb</code>:</p></div><div class="code_container">
<pre><code class="highlight ruby"><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Inflector</span><span class="p">.</span><span class="nf">inflections</span> <span class="k">do</span> <span class="o">|</span><span class="n">inflect</span><span class="o">|</span>
  <span class="n">inflect</span><span class="p">.</span><span class="nf">acronym</span> <span class="s1">'SSL'</span>
<span class="k">end</span>

<span class="s2">"SSLError"</span><span class="p">.</span><span class="nf">underscore</span><span class="p">.</span><span class="nf">camelize</span> <span class="c1"># =&gt; "SSLError"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-0192f063c161a996afe24570c1624af8">ActiveSupport::Inflector.inflections do |inflect|
  inflect.acronym 'SSL'
end

"SSLError".underscore.camelize # =&gt; "SSLError"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-0192f063c161a996afe24570c1624af8">Copiar</button>
</div>
<p><code>camelize</code> é o mesmo que usar <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-camelcase"><code>camelcase</code></a>.</p><div class="note"><p>Definido em <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id="underscore"><a class="anchorlink" href="#underscore">5.12.4 <code>underscore</code></a></h5><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-underscore"><code>underscore</code></a> vai ao contrário, de <em>camel case</em> para pastas:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Product"</span><span class="p">.</span><span class="nf">underscore</span>   <span class="c1"># =&gt; "product"</span>
<span class="s2">"AdminUser"</span><span class="p">.</span><span class="nf">underscore</span> <span class="c1"># =&gt; "admin_user"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-adbe09a6af0d97362477e5ee6f029d53">"Product".underscore   # =&gt; "product"
"AdminUser".underscore # =&gt; "admin_user"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-adbe09a6af0d97362477e5ee6f029d53">Copiar</button>
</div>
<p>Também converte "::" back para "/":</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Backoffice::Session"</span><span class="p">.</span><span class="nf">underscore</span> <span class="c1"># =&gt; "backoffice/session"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-0ba7ed89535a08026dddd98f2f78e284">"Backoffice::Session".underscore # =&gt; "backoffice/session"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-0ba7ed89535a08026dddd98f2f78e284">Copiar</button>
</div>
<p>e entende <em>strings</em> que começam com start letra minúscula:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"visualEffect"</span><span class="p">.</span><span class="nf">underscore</span> <span class="c1"># =&gt; "visual_effect"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-38a6f2ab92134cdaaafea73f29c7de49">"visualEffect".underscore # =&gt; "visual_effect"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-38a6f2ab92134cdaaafea73f29c7de49">Copiar</button>
</div>
<p><code>underscore</code> não aceita nenhum argumento.</p><p>Classes e módulos <em>Rails</em> carregam automaticamente o uso de <code>underscore</code> para inferir o endereço relativo sem extensão de um arquivo que definiria uma constante ausente:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># active_support/dependencies.rb</span>
<span class="k">def</span> <span class="nf">load_missing_constant</span><span class="p">(</span><span class="n">from_mod</span><span class="p">,</span> <span class="n">const_name</span><span class="p">)</span>
  <span class="c1"># ...</span>
  <span class="n">qualified_name</span> <span class="o">=</span> <span class="n">qualified_name_for</span> <span class="n">from_mod</span><span class="p">,</span> <span class="n">const_name</span>
  <span class="n">path_suffix</span> <span class="o">=</span> <span class="n">qualified_name</span><span class="p">.</span><span class="nf">underscore</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-986e3d442afef249bf198833d3afddd9"># active_support/dependencies.rb
def load_missing_constant(from_mod, const_name)
  # ...
  qualified_name = qualified_name_for from_mod, const_name
  path_suffix = qualified_name.underscore
  # ...
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-986e3d442afef249bf198833d3afddd9">Copiar</button>
</div>
<div class="info"><p>Como regra geral, pode-se pensar em <code>underscore</code> como o inverso de <code>camelize</code>, embora haja casos em que isso não se aplica. Por exemplo, <code>"SSLError".underscore.camelize</code> devolve <code>"SslError"</code>.</p></div><div class="note"><p>Definido em <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id="titleize"><a class="anchorlink" href="#titleize">5.12.5 <code>titleize</code></a></h5><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-titleize"><code>titleize</code></a> coloca cada palavra com letra maiúscula:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"alice in wonderland"</span><span class="p">.</span><span class="nf">titleize</span> <span class="c1"># =&gt; "Alice In Wonderland"</span>
<span class="s2">"fermat's enigma"</span><span class="p">.</span><span class="nf">titleize</span>     <span class="c1"># =&gt; "Fermat's Enigma"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-2fb0191ab8a31c7d7fa4a7336498e1d4">"alice in wonderland".titleize # =&gt; "Alice In Wonderland"
"fermat's enigma".titleize     # =&gt; "Fermat's Enigma"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2fb0191ab8a31c7d7fa4a7336498e1d4">Copiar</button>
</div>
<p><code>titleize</code> é o mesmo que usar <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-titlecase"><code>titlecase</code></a>.</p><div class="note"><p>Definido em <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id="dasherize"><a class="anchorlink" href="#dasherize">5.12.6 <code>dasherize</code></a></h5><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-dasherize"><code>dasherize</code></a> troca <em>underscores</em> no receptor por traços:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"name"</span><span class="p">.</span><span class="nf">dasherize</span>         <span class="c1"># =&gt; "name"</span>
<span class="s2">"contact_data"</span><span class="p">.</span><span class="nf">dasherize</span> <span class="c1"># =&gt; "contact-data"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-0025f21e1b5bba4c462b80230b5ca088">"name".dasherize         # =&gt; "name"
"contact_data".dasherize # =&gt; "contact-data"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-0025f21e1b5bba4c462b80230b5ca088">Copiar</button>
</div>
<p>O <em>serializer</em> XML de <em>models</em> usa este método para colocar traços nos nomes de seus nós:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># active_model/serializers/xml.rb</span>
<span class="k">def</span> <span class="nf">reformat_name</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
  <span class="nb">name</span> <span class="o">=</span> <span class="nb">name</span><span class="p">.</span><span class="nf">camelize</span> <span class="k">if</span> <span class="n">camelize?</span>
  <span class="n">dasherize?</span> <span class="p">?</span> <span class="nb">name</span><span class="p">.</span><span class="nf">dasherize</span> <span class="p">:</span> <span class="nb">name</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-9aa9e4aa7774192802143dac752b0874"># active_model/serializers/xml.rb
def reformat_name(name)
  name = name.camelize if camelize?
  dasherize? ? name.dasherize : name
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-9aa9e4aa7774192802143dac752b0874">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id="demodulize"><a class="anchorlink" href="#demodulize">5.12.7 <code>demodulize</code></a></h5><p>Dado uma <em>string</em> com um nome de constante em módulo, <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-demodulize"><code>demodulize</code></a> retorna o real nome da constante, ou seja, a parte mais à direita dela:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Product"</span><span class="p">.</span><span class="nf">demodulize</span>                        <span class="c1"># =&gt; "Product"</span>
<span class="s2">"Backoffice::UsersController"</span><span class="p">.</span><span class="nf">demodulize</span>    <span class="c1"># =&gt; "UsersController"</span>
<span class="s2">"Admin::Hotel::ReservationUtils"</span><span class="p">.</span><span class="nf">demodulize</span> <span class="c1"># =&gt; "ReservationUtils"</span>
<span class="s2">"::Inflections"</span><span class="p">.</span><span class="nf">demodulize</span>                  <span class="c1"># =&gt; "Inflections"</span>
<span class="s2">""</span><span class="p">.</span><span class="nf">demodulize</span>                               <span class="c1"># =&gt; ""</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-f69d9d4095a19858fed2bebf13b3735f">"Product".demodulize                        # =&gt; "Product"
"Backoffice::UsersController".demodulize    # =&gt; "UsersController"
"Admin::Hotel::ReservationUtils".demodulize # =&gt; "ReservationUtils"
"::Inflections".demodulize                  # =&gt; "Inflections"
"".demodulize                               # =&gt; ""
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-f69d9d4095a19858fed2bebf13b3735f">Copiar</button>
</div>
<p><em>Active Record</em> por exemplo, usa este método para calcular o nome de uma coluna de cache do contador:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># active_record/reflection.rb</span>
<span class="k">def</span> <span class="nf">counter_cache_column</span>
  <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="ss">:counter_cache</span><span class="p">]</span> <span class="o">==</span> <span class="kp">true</span>
    <span class="s2">"</span><span class="si">#{</span><span class="n">active_record</span><span class="p">.</span><span class="nf">name</span><span class="p">.</span><span class="nf">demodulize</span><span class="p">.</span><span class="nf">underscore</span><span class="p">.</span><span class="nf">pluralize</span><span class="si">}</span><span class="s2">_count"</span>
  <span class="k">elsif</span> <span class="n">options</span><span class="p">[</span><span class="ss">:counter_cache</span><span class="p">]</span>
    <span class="n">options</span><span class="p">[</span><span class="ss">:counter_cache</span><span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-6045784c74f99e66a59df97538a8a981"># active_record/reflection.rb
def counter_cache_column
  if options[:counter_cache] == true
    "#{active_record.name.demodulize.underscore.pluralize}_count"
  elsif options[:counter_cache]
    options[:counter_cache]
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-6045784c74f99e66a59df97538a8a981">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id="deconstantize"><a class="anchorlink" href="#deconstantize">5.12.8 <code>deconstantize</code></a></h5><p>Dada uma <em>string</em> com uma expressão de referência a uma constante, <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-deconstantize"><code>deconstantize</code></a> remove o segmento mais à direita, geralmente deixando o nome do contêiner da constante:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Product"</span><span class="p">.</span><span class="nf">deconstantize</span>                        <span class="c1"># =&gt; ""</span>
<span class="s2">"Backoffice::UsersController"</span><span class="p">.</span><span class="nf">deconstantize</span>    <span class="c1"># =&gt; "Backoffice"</span>
<span class="s2">"Admin::Hotel::ReservationUtils"</span><span class="p">.</span><span class="nf">deconstantize</span> <span class="c1"># =&gt; "Admin::Hotel"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-fad9b88ddf5b58391ede2ee12a7feae0">"Product".deconstantize                        # =&gt; ""
"Backoffice::UsersController".deconstantize    # =&gt; "Backoffice"
"Admin::Hotel::ReservationUtils".deconstantize # =&gt; "Admin::Hotel"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-fad9b88ddf5b58391ede2ee12a7feae0">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id="parameterize"><a class="anchorlink" href="#parameterize">5.12.9 <code>parameterize</code></a></h5><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-parameterize"><code>parameterize</code></a> normaliza seu receptor de uma forma que pode ser usada em URLs de forma mais elegante.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"John Smith"</span><span class="p">.</span><span class="nf">parameterize</span> <span class="c1"># =&gt; "john-smith"</span>
<span class="s2">"Kurt Gödel"</span><span class="p">.</span><span class="nf">parameterize</span> <span class="c1"># =&gt; "kurt-godel"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-38c37dbe43504ad0c9b81df439b5242a">"John Smith".parameterize # =&gt; "john-smith"
"Kurt Gödel".parameterize # =&gt; "kurt-godel"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-38c37dbe43504ad0c9b81df439b5242a">Copiar</button>
</div>
<p>Para preservar a caixa da <em>string</em>, defina o argumento <code>preserve_case</code> para <em>true</em>. Por padrão, <code>preserve_case</code> será configurado como <code>false</code>.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"John Smith"</span><span class="p">.</span><span class="nf">parameterize</span><span class="p">(</span><span class="ss">preserve_case: </span><span class="kp">true</span><span class="p">)</span> <span class="c1"># =&gt; "John-Smith"</span>
<span class="s2">"Kurt Gödel"</span><span class="p">.</span><span class="nf">parameterize</span><span class="p">(</span><span class="ss">preserve_case: </span><span class="kp">true</span><span class="p">)</span> <span class="c1"># =&gt; "Kurt-Godel"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-5e1cf5b93d51ee9f31df28872eb58cd7">"John Smith".parameterize(preserve_case: true) # =&gt; "John-Smith"
"Kurt Gödel".parameterize(preserve_case: true) # =&gt; "Kurt-Godel"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-5e1cf5b93d51ee9f31df28872eb58cd7">Copiar</button>
</div>
<p>Para usar um separador customizado, sobrescreva o argumento <code>separator</code>.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"John Smith"</span><span class="p">.</span><span class="nf">parameterize</span><span class="p">(</span><span class="ss">separator: </span><span class="s2">"_"</span><span class="p">)</span> <span class="c1"># =&gt; "john\_smith"</span>
<span class="s2">"Kurt Gödel"</span><span class="p">.</span><span class="nf">parameterize</span><span class="p">(</span><span class="ss">separator: </span><span class="s2">"_"</span><span class="p">)</span> <span class="c1"># =&gt; "kurt\_godel"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-3d8fdf0f37d7ca9b9b4d825c053db268">"John Smith".parameterize(separator: "_") # =&gt; "john\_smith"
"Kurt Gödel".parameterize(separator: "_") # =&gt; "kurt\_godel"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-3d8fdf0f37d7ca9b9b4d825c053db268">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id="tableize"><a class="anchorlink" href="#tableize">5.12.10 <code>tableize</code></a></h5><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-tableize"><code>tableize</code></a> é <code>underscore</code> seguido por <code>pluralize</code>.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Person"</span><span class="p">.</span><span class="nf">tableize</span>      <span class="c1"># =&gt; "people"</span>
<span class="s2">"Invoice"</span><span class="p">.</span><span class="nf">tableize</span>     <span class="c1"># =&gt; "invoices"</span>
<span class="s2">"InvoiceLine"</span><span class="p">.</span><span class="nf">tableize</span> <span class="c1"># =&gt; "invoice_lines"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-6d935ce8c6e45624600c6124466c4d5a">"Person".tableize      # =&gt; "people"
"Invoice".tableize     # =&gt; "invoices"
"InvoiceLine".tableize # =&gt; "invoice_lines"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-6d935ce8c6e45624600c6124466c4d5a">Copiar</button>
</div>
<p>Como um princípio básico, <code>tableize</code> retorna o nome da tabela que corresponde a um determinado modelo para casos simples. A implementação real de <code>tableize</code> no <em>Active Record</em> na verdade não é direta, porque também desmodulariza o nome da classe e verifica algumas opções que podem afetar a <em>string</em> retornada.</p><div class="note"><p>Definido em <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id="classify"><a class="anchorlink" href="#classify">5.12.11 <code>classify</code></a></h5><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-classify"><code>classify</code></a> é o inverso de <code>tableize</code>. Ele da o nome da classe correspondente ao nome da tabela:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"people"</span><span class="p">.</span><span class="nf">classify</span>        <span class="c1"># =&gt; "Person"</span>
<span class="s2">"invoices"</span><span class="p">.</span><span class="nf">classify</span>      <span class="c1"># =&gt; "Invoice"</span>
<span class="s2">"invoice_lines"</span><span class="p">.</span><span class="nf">classify</span> <span class="c1"># =&gt; "InvoiceLine"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-6bd0edc32a056c18a34c94fc82829528">"people".classify        # =&gt; "Person"
"invoices".classify      # =&gt; "Invoice"
"invoice_lines".classify # =&gt; "InvoiceLine"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-6bd0edc32a056c18a34c94fc82829528">Copiar</button>
</div>
<p>O método compreende nomes de tabela associadas:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"highrise_production.companies"</span><span class="p">.</span><span class="nf">classify</span> <span class="c1"># =&gt; "Company"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-ecc90695d463205c91a68a0c7a02b231">"highrise_production.companies".classify # =&gt; "Company"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-ecc90695d463205c91a68a0c7a02b231">Copiar</button>
</div>
<p>Note que <code>classify</code> retorna um nome de classe como uma <em>string</em>. Você pode obter o objeto de classe real invocando <code>constantize</code> sobre isso, será explicado a seguir.</p><div class="note"><p>Definido em <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id="constantize"><a class="anchorlink" href="#constantize">5.12.12 <code>constantize</code></a></h5><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-constantize"><code>constantize</code></a> resolve a expressão de referência constante em seu receptor:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Integer"</span><span class="p">.</span><span class="nf">constantize</span> <span class="c1"># =&gt; Integer</span>

<span class="k">module</span> <span class="nn">M</span>
  <span class="no">X</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">end</span>
<span class="s2">"M::X"</span><span class="p">.</span><span class="nf">constantize</span> <span class="c1"># =&gt; 1</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-181484ab2c99a55cef8a949f1ad66ba8">"Integer".constantize # =&gt; Integer

module M
  X = 1
end
"M::X".constantize # =&gt; 1
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-181484ab2c99a55cef8a949f1ad66ba8">Copiar</button>
</div>
<p>Se a <em>string</em> não for avaliada como uma constante conhecida ou seu conteúdo nem mesmo for um nome de constante válido, <code>constantize</code> executa <code>NameError</code>.</p><p>Resolução de nome constante por <code>constantize</code> inicia sempre no nível superior de <code>Object</code> mesmo se não começar com "::".</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">X</span> <span class="o">=</span> <span class="ss">:in_Object</span>
<span class="k">module</span> <span class="nn">M</span>
  <span class="no">X</span> <span class="o">=</span> <span class="ss">:in_M</span>

  <span class="no">X</span>                 <span class="c1"># =&gt; :in_M</span>
  <span class="s2">"::X"</span><span class="p">.</span><span class="nf">constantize</span> <span class="c1"># =&gt; :in_Object</span>
  <span class="s2">"X"</span><span class="p">.</span><span class="nf">constantize</span>   <span class="c1"># =&gt; :in_Object (!)</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-8be3757e91f3ae059cff7c2810602586">X = :in_Object
module M
  X = :in_M

  X                 # =&gt; :in_M
  "::X".constantize # =&gt; :in_Object
  "X".constantize   # =&gt; :in_Object (!)
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8be3757e91f3ae059cff7c2810602586">Copiar</button>
</div>
<p>So, it is in general not equivalent to what Ruby would do in the same spot, had a real constant be evaluated.</p><p>Mailer test cases obtain the mailer being tested from the name of the test class using <code>constantize</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># action_mailer/test_case.rb</span>
<span class="k">def</span> <span class="nf">determine_default_mailer</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
  <span class="nb">name</span><span class="p">.</span><span class="nf">delete_suffix</span><span class="p">(</span><span class="s2">"Test"</span><span class="p">).</span><span class="nf">constantize</span>
<span class="k">rescue</span> <span class="no">NameError</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="k">raise</span> <span class="no">NonInferrableMailerError</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-c7e75eab32cc832a1be680641e41c593"># action_mailer/test_case.rb
def determine_default_mailer(name)
  name.delete_suffix("Test").constantize
rescue NameError =&gt; e
  raise NonInferrableMailerError.new(name)
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-c7e75eab32cc832a1be680641e41c593">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id="humanize"><a class="anchorlink" href="#humanize">5.12.13 <code>humanize</code></a></h5><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-humanize"><code>humanize</code></a> ajusta um nome de atributo para exibir aos usuários.</p><p>Especificamente, ele realiza estas transformações:</p>
<ul>
<li>Aplica regras de inflexão humana ao argumento.</li>
<li>Exclui os <em>underlines</em> iniciais, se houver.</li>
<li>Remove um sufixo "_id", se houver.</li>
<li>Substitui <em>underlines</em> por espaços, se houver.</li>
<li>Reduz todas as palavras, exceto siglas.</li>
<li>Coloca em maiúscula a primeira palavra.</li>
</ul>
<p>A capitalização da primeira palavra pode ser desativada configurando o
<code>:capitalize</code> opção para <code>false</code> (o padrão é <code>true</code>).</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"name"</span><span class="p">.</span><span class="nf">humanize</span>                         <span class="c1"># =&gt; "Name"</span>
<span class="s2">"author_id"</span><span class="p">.</span><span class="nf">humanize</span>                    <span class="c1"># =&gt; "Author"</span>
<span class="s2">"author_id"</span><span class="p">.</span><span class="nf">humanize</span><span class="p">(</span><span class="ss">capitalize: </span><span class="kp">false</span><span class="p">)</span> <span class="c1"># =&gt; "author"</span>
<span class="s2">"comments_count"</span><span class="p">.</span><span class="nf">humanize</span>               <span class="c1"># =&gt; "Comments count"</span>
<span class="s2">"_id"</span><span class="p">.</span><span class="nf">humanize</span>                          <span class="c1"># =&gt; "Id"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-991651933549a8da428d48a07797172e">"name".humanize                         # =&gt; "Name"
"author_id".humanize                    # =&gt; "Author"
"author_id".humanize(capitalize: false) # =&gt; "author"
"comments_count".humanize               # =&gt; "Comments count"
"_id".humanize                          # =&gt; "Id"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-991651933549a8da428d48a07797172e">Copiar</button>
</div>
<p>Se "SSL" for definido como uma sigla:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s1">'ssl_error'</span><span class="p">.</span><span class="nf">humanize</span> <span class="c1"># =&gt; "SSL error"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-11ada7e38b1d3d07db9525bea59ac9cc">'ssl_error'.humanize # =&gt; "SSL error"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-11ada7e38b1d3d07db9525bea59ac9cc">Copiar</button>
</div>
<p>O método <em>helper</em> <code>full_messages</code> usa <code>humanize</code> como alternativa para incluir
nomes de atributos:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">full_messages</span>
  <span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">attribute</span><span class="p">,</span> <span class="n">message</span><span class="o">|</span> <span class="n">full_message</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">full_message</span>
  <span class="c1"># ...</span>
  <span class="n">attr_name</span> <span class="o">=</span> <span class="n">attribute</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">tr</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span> <span class="s1">'_'</span><span class="p">).</span><span class="nf">humanize</span>
  <span class="n">attr_name</span> <span class="o">=</span> <span class="vi">@base</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">human_attribute_name</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="ss">default: </span><span class="n">attr_name</span><span class="p">)</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-d6fdaec4d38d883f8699e20f1e2ff43d">def full_messages
  map { |attribute, message| full_message(attribute, message) }
end

def full_message
  # ...
  attr_name = attribute.to_s.tr('.', '_').humanize
  attr_name = @base.class.human_attribute_name(attribute, default: attr_name)
  # ...
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d6fdaec4d38d883f8699e20f1e2ff43d">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id="foreign-key"><a class="anchorlink" href="#foreign-key">5.12.14 <code>foreign_key</code></a></h5><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-foreign_key"><code>foreign_key</code></a> fornece um nome de coluna de chave estrangeira a partir de um nome de classe. Para fazer isso, ele desmoduliza, separa com <em>underline</em> e adiciona "_id":</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"User"</span><span class="p">.</span><span class="nf">foreign_key</span>           <span class="c1"># =&gt; "user_id"</span>
<span class="s2">"InvoiceLine"</span><span class="p">.</span><span class="nf">foreign_key</span>    <span class="c1"># =&gt; "invoice_line_id"</span>
<span class="s2">"Admin::Session"</span><span class="p">.</span><span class="nf">foreign_key</span> <span class="c1"># =&gt; "session_id"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-791bdd1ce1686c25a6696a2bc396e442">"User".foreign_key           # =&gt; "user_id"
"InvoiceLine".foreign_key    # =&gt; "invoice_line_id"
"Admin::Session".foreign_key # =&gt; "session_id"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-791bdd1ce1686c25a6696a2bc396e442">Copiar</button>
</div>
<p>Passe <code>false</code> como argumento se você não quiser o <em>underline</em> em "_id":</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"User"</span><span class="p">.</span><span class="nf">foreign_key</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span> <span class="c1"># =&gt; "userid"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-b846803178cc664d09188e45cd40778f">"User".foreign_key(false) # =&gt; "userid"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-b846803178cc664d09188e45cd40778f">Copiar</button>
</div>
<p>As associações usam este método para inferir chaves estrangeiras, por exemplo <code>has_one</code> e <code>has_many</code> fazem isto:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># active_record/associations.rb</span>
<span class="n">foreign_key</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:foreign_key</span><span class="p">]</span> <span class="o">||</span> <span class="n">reflection</span><span class="p">.</span><span class="nf">active_record</span><span class="p">.</span><span class="nf">name</span><span class="p">.</span><span class="nf">foreign_key</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-295202ec8f3d98a623ebf6af15fead12"># active_record/associations.rb
foreign_key = options[:foreign_key] || reflection.active_record.name.foreign_key
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-295202ec8f3d98a623ebf6af15fead12">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h4 id="conversoes"><a class="anchorlink" href="#conversoes">5.13 Conversões</a></h4><h5 id="to-date-to-time-to-datetime"><a class="anchorlink" href="#to-date-to-time-to-datetime">5.13.1 <code>to_date</code>, <code>to_time</code>, <code>to_datetime</code></a></h5><p>Os métodos <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-to_date"><code>to_date</code></a>, <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-to_time"><code>to_time</code></a>, e <a href="https://api.rubyonrails.org/v6.1.4/classes/String.html#method-i-to_datetime"><code>to_datetime</code></a> são basicamente  variações convenientes de <code>Date._parse</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"2010-07-27"</span><span class="p">.</span><span class="nf">to_date</span>              <span class="c1"># =&gt; Tue, 27 Jul 2010</span>
<span class="s2">"2010-07-27 23:37:00"</span><span class="p">.</span><span class="nf">to_time</span>     <span class="c1"># =&gt; 2010-07-27 23:37:00 +0200</span>
<span class="s2">"2010-07-27 23:37:00"</span><span class="p">.</span><span class="nf">to_datetime</span> <span class="c1"># =&gt; Tue, 27 Jul 2010 23:37:00 +0000</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-f4b6df41afe07334a737fce900bf0f7b">"2010-07-27".to_date              # =&gt; Tue, 27 Jul 2010
"2010-07-27 23:37:00".to_time     # =&gt; 2010-07-27 23:37:00 +0200
"2010-07-27 23:37:00".to_datetime # =&gt; Tue, 27 Jul 2010 23:37:00 +0000
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-f4b6df41afe07334a737fce900bf0f7b">Copiar</button>
</div>
<p><code>to_time</code> recebe an um argumento opcional <code>:utc</code> ou <code>:local</code>, para indicar qual fuso horário you quer se basear:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"2010-07-27 23:42:00"</span><span class="p">.</span><span class="nf">to_time</span><span class="p">(</span><span class="ss">:utc</span><span class="p">)</span>   <span class="c1"># =&gt; 2010-07-27 23:42:00 UTC</span>
<span class="s2">"2010-07-27 23:42:00"</span><span class="p">.</span><span class="nf">to_time</span><span class="p">(</span><span class="ss">:local</span><span class="p">)</span> <span class="c1"># =&gt; 2010-07-27 23:42:00 +0200</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-820b09ea0552ec79d2b77d1d34c6157a">"2010-07-27 23:42:00".to_time(:utc)   # =&gt; 2010-07-27 23:42:00 UTC
"2010-07-27 23:42:00".to_time(:local) # =&gt; 2010-07-27 23:42:00 +0200
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-820b09ea0552ec79d2b77d1d34c6157a">Copiar</button>
</div>
<p>O padrão é <code>:local</code>.</p><p>Por favor, consulte a documentação de <code>Date._parse</code> para mais detalhes.</p><div class="info"><p>Os três exemplos retornam <code>nil</code> caso não recebam argumentos.</p></div><div class="note"><p>Definido em <code>active_support/core_ext/string/conversions.rb</code>.</p></div><h3 id="extensoes-para-symbol"><a class="anchorlink" href="#extensoes-para-symbol">6 Extensões para <code>Symbol</code></a></h3><h4 id="extensoes-para-symbol-starts-with-questionmark-e-ends-with-questionmark"><a class="anchorlink" href="#extensoes-para-symbol-starts-with-questionmark-e-ends-with-questionmark">6.1 <code>starts_with?</code> e <code>ends_with?</code></a></h4><p>O Active Support define <em>aliases</em> (nomes simbólicos) de terceira pessoa de <code>Symbol#start_with?</code> e <code>Symbol#end_with?</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="ss">:foo</span><span class="p">.</span><span class="nf">starts_with?</span><span class="p">(</span><span class="s2">"f"</span><span class="p">)</span> <span class="c1"># =&gt; true</span>
<span class="ss">:foo</span><span class="p">.</span><span class="nf">ends_with?</span><span class="p">(</span><span class="s2">"o"</span><span class="p">)</span>   <span class="c1"># =&gt; true</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-7da80fdf425265785c8a438a74e2461b">:foo.starts_with?("f") # =&gt; true
:foo.ends_with?("o")   # =&gt; true
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-7da80fdf425265785c8a438a74e2461b">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/symbol/starts_ends_with.rb</code>.</p></div><h3 id="extensoes-para-numeric"><a class="anchorlink" href="#extensoes-para-numeric">7 Extensões para <code>Numeric</code></a></h3><h4 id="bytes"><a class="anchorlink" href="#bytes">7.1 Bytes</a></h4><p>Todos os números respondem a estes métodos:</p>
<ul>
<li><a href="https://api.rubyonrails.org/v6.1.4/classes/Numeric.html#method-i-bytes"><code>bytes</code></a></li>
<li><a href="https://api.rubyonrails.org/v6.1.4/classes/Numeric.html#method-i-kilobytes"><code>kilobytes</code></a></li>
<li><a href="https://api.rubyonrails.org/v6.1.4/classes/Numeric.html#method-i-megabytes"><code>megabytes</code></a></li>
<li><a href="https://api.rubyonrails.org/v6.1.4/classes/Numeric.html#method-i-gigabytes"><code>gigabytes</code></a></li>
<li><a href="https://api.rubyonrails.org/v6.1.4/classes/Numeric.html#method-i-terabytes"><code>terabytes</code></a></li>
<li><a href="https://api.rubyonrails.org/v6.1.4/classes/Numeric.html#method-i-petabytes"><code>petabytes</code></a></li>
<li><a href="https://api.rubyonrails.org/v6.1.4/classes/Numeric.html#method-i-exabytes"><code>exabytes</code></a></li>
</ul>
<p>Eles retornam a quantidade correspondente de bytes, usando um fator de conversão de 1024:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mi">2</span><span class="p">.</span><span class="nf">kilobytes</span>   <span class="c1"># =&gt; 2048</span>
<span class="mi">3</span><span class="p">.</span><span class="nf">megabytes</span>   <span class="c1"># =&gt; 3145728</span>
<span class="mf">3.5</span><span class="p">.</span><span class="nf">gigabytes</span> <span class="c1"># =&gt; 3758096384</span>
<span class="o">-</span><span class="mi">4</span><span class="p">.</span><span class="nf">exabytes</span>   <span class="c1"># =&gt; -4611686018427387904</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-1431bbb431d0a0fcbf6b9fd8d0630c2d">2.kilobytes   # =&gt; 2048
3.megabytes   # =&gt; 3145728
3.5.gigabytes # =&gt; 3758096384
-4.exabytes   # =&gt; -4611686018427387904
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-1431bbb431d0a0fcbf6b9fd8d0630c2d">Copiar</button>
</div>
<p>As formas singulares têm um <em>alias</em> para que você possa dizer:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mi">1</span><span class="p">.</span><span class="nf">megabyte</span> <span class="c1"># =&gt; 1048576</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-a2992b93b9f9cd840bc5ee1f93816cc4">1.megabyte # =&gt; 1048576
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-a2992b93b9f9cd840bc5ee1f93816cc4">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/numeric/bytes.rb</code>.</p></div><h4 id="extensoes-para-numeric-time"><a class="anchorlink" href="#extensoes-para-numeric-time">7.2 Time</a></h4><p>Os seguintes métodos:</p>
<ul>
<li><a href="https://api.rubyonrails.org/v6.1.4/classes/Numeric.html#method-i-seconds"><code>seconds</code></a></li>
<li><a href="https://api.rubyonrails.org/v6.1.4/classes/Numeric.html#method-i-minutes"><code>minutes</code></a></li>
<li><a href="https://api.rubyonrails.org/v6.1.4/classes/Numeric.html#method-i-hours"><code>hours</code></a></li>
<li><a href="https://api.rubyonrails.org/v6.1.4/classes/Numeric.html#method-i-days"><code>days</code></a></li>
<li><a href="https://api.rubyonrails.org/v6.1.4/classes/Numeric.html#method-i-weeks"><code>weeks</code></a></li>
<li><a href="https://api.rubyonrails.org/v6.1.4/classes/Numeric.html#method-i-fortnights"><code>fortnights</code></a></li>
</ul>
<p>habilitar declarações e cálculos de tempo, como <code>45.minutes + 2.hours + 4.weeks</code>. Seus valores de retorno também podem ser adicionados ou subtraídos dos objetos Time.</p><p>Esses métodos podem ser combinados com <a href="https://api.rubyonrails.org/v6.1.4/classes/ActiveSupport/Duration.html#method-i-from_now"><code>from_now</code></a>, <a href="https://api.rubyonrails.org/v6.1.4/classes/ActiveSupport/Duration.html#method-i-ago"><code>ago</code></a>, etc, para cálculos de datas precisos. Por exemplo:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># equivalent to Time.current.advance(days: 1)</span>
<span class="mi">1</span><span class="p">.</span><span class="nf">day</span><span class="p">.</span><span class="nf">from_now</span>

<span class="c1"># equivalent to Time.current.advance(weeks: 2)</span>
<span class="mi">2</span><span class="p">.</span><span class="nf">weeks</span><span class="p">.</span><span class="nf">from_now</span>

<span class="c1"># equivalent to Time.current.advance(days: 4, weeks: 5)</span>
<span class="p">(</span><span class="mi">4</span><span class="p">.</span><span class="nf">days</span> <span class="o">+</span> <span class="mi">5</span><span class="p">.</span><span class="nf">weeks</span><span class="p">).</span><span class="nf">from_now</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-2711cb08b9d73a1f480057eca3714530"># equivalent to Time.current.advance(days: 1)
1.day.from_now

# equivalent to Time.current.advance(weeks: 2)
2.weeks.from_now

# equivalent to Time.current.advance(days: 4, weeks: 5)
(4.days + 5.weeks).from_now
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2711cb08b9d73a1f480057eca3714530">Copiar</button>
</div>
<div class="warning"><p>Para outras durações, consulte as extensões de tempo para <code>Integer</code>.</p></div><div class="note"><p>Definido em <code>active_support/core_ext/numeric/time.rb</code>.</p></div><h4 id="formatacao"><a class="anchorlink" href="#formatacao">7.3 Formatação</a></h4><p>Permite a formatação de números de várias maneiras.</p><p>Produz uma representação de <em>string</em> de um número como um número de telefone:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mi">5551234</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:phone</span><span class="p">)</span>
<span class="c1"># =&gt; 555-1234</span>
<span class="mi">1235551234</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:phone</span><span class="p">)</span>
<span class="c1"># =&gt; 123-555-1234</span>
<span class="mi">1235551234</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:phone</span><span class="p">,</span> <span class="ss">area_code: </span><span class="kp">true</span><span class="p">)</span>
<span class="c1"># =&gt; (123) 555-1234</span>
<span class="mi">1235551234</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:phone</span><span class="p">,</span> <span class="ss">delimiter: </span><span class="s2">" "</span><span class="p">)</span>
<span class="c1"># =&gt; 123 555 1234</span>
<span class="mi">1235551234</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:phone</span><span class="p">,</span> <span class="ss">area_code: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">extension: </span><span class="mi">555</span><span class="p">)</span>
<span class="c1"># =&gt; (123) 555-1234 x 555</span>
<span class="mi">1235551234</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:phone</span><span class="p">,</span> <span class="ss">country_code: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; +1-123-555-1234</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-6fc74d01fb7c0331c40f36de1673f41f">5551234.to_s(:phone)
# =&gt; 555-1234
1235551234.to_s(:phone)
# =&gt; 123-555-1234
1235551234.to_s(:phone, area_code: true)
# =&gt; (123) 555-1234
1235551234.to_s(:phone, delimiter: " ")
# =&gt; 123 555 1234
1235551234.to_s(:phone, area_code: true, extension: 555)
# =&gt; (123) 555-1234 x 555
1235551234.to_s(:phone, country_code: 1)
# =&gt; +1-123-555-1234
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-6fc74d01fb7c0331c40f36de1673f41f">Copiar</button>
</div>
<p>Produz uma representação de <em>string</em> de um número como moeda:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mf">1234567890.50</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:currency</span><span class="p">)</span>                 <span class="c1"># =&gt; $1,234,567,890.50</span>
<span class="mf">1234567890.506</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:currency</span><span class="p">)</span>                <span class="c1"># =&gt; $1,234,567,890.51</span>
<span class="mf">1234567890.506</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:currency</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># =&gt; $1,234,567,890.506</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-380852c7c58bb20212c7a427c551b902">1234567890.50.to_s(:currency)                 # =&gt; $1,234,567,890.50
1234567890.506.to_s(:currency)                # =&gt; $1,234,567,890.51
1234567890.506.to_s(:currency, precision: 3)  # =&gt; $1,234,567,890.506
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-380852c7c58bb20212c7a427c551b902">Copiar</button>
</div>
<p>Produz uma representação de <em>string</em> de um número como uma porcentagem:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mi">100</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:percentage</span><span class="p">)</span>
<span class="c1"># =&gt; 100.000%</span>
<span class="mi">100</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:percentage</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># =&gt; 100%</span>
<span class="mi">1000</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:percentage</span><span class="p">,</span> <span class="ss">delimiter: </span><span class="s1">'.'</span><span class="p">,</span> <span class="ss">separator: </span><span class="s1">','</span><span class="p">)</span>
<span class="c1"># =&gt; 1.000,000%</span>
<span class="mf">302.24398923423</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:percentage</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">5</span><span class="p">)</span>
<span class="c1"># =&gt; 302.24399%</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-ef56861d5d9be13fd43f6bc1aa0b8116">100.to_s(:percentage)
# =&gt; 100.000%
100.to_s(:percentage, precision: 0)
# =&gt; 100%
1000.to_s(:percentage, delimiter: '.', separator: ',')
# =&gt; 1.000,000%
302.24398923423.to_s(:percentage, precision: 5)
# =&gt; 302.24399%
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-ef56861d5d9be13fd43f6bc1aa0b8116">Copiar</button>
</div>
<p>Produz uma representação de <em>string</em> de um número na forma delimitada:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mi">12345678</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:delimited</span><span class="p">)</span>                     <span class="c1"># =&gt; 12,345,678</span>
<span class="mf">12345678.05</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:delimited</span><span class="p">)</span>                  <span class="c1"># =&gt; 12,345,678.05</span>
<span class="mi">12345678</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:delimited</span><span class="p">,</span> <span class="ss">delimiter: </span><span class="s2">"."</span><span class="p">)</span>     <span class="c1"># =&gt; 12.345.678</span>
<span class="mi">12345678</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:delimited</span><span class="p">,</span> <span class="ss">delimiter: </span><span class="s2">","</span><span class="p">)</span>     <span class="c1"># =&gt; 12,345,678</span>
<span class="mf">12345678.05</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:delimited</span><span class="p">,</span> <span class="ss">separator: </span><span class="s2">" "</span><span class="p">)</span>  <span class="c1"># =&gt; 12,345,678 05</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-fb32f9de7b5450015ec110b2e6fdcb68">12345678.to_s(:delimited)                     # =&gt; 12,345,678
12345678.05.to_s(:delimited)                  # =&gt; 12,345,678.05
12345678.to_s(:delimited, delimiter: ".")     # =&gt; 12.345.678
12345678.to_s(:delimited, delimiter: ",")     # =&gt; 12,345,678
12345678.05.to_s(:delimited, separator: " ")  # =&gt; 12,345,678 05
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-fb32f9de7b5450015ec110b2e6fdcb68">Copiar</button>
</div>
<p>Produz uma representação de <em>string</em> de um número arredondado para uma precisão:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mf">111.2345</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:rounded</span><span class="p">)</span>                     <span class="c1"># =&gt; 111.235</span>
<span class="mf">111.2345</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:rounded</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">2</span><span class="p">)</span>       <span class="c1"># =&gt; 111.23</span>
<span class="mi">13</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:rounded</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">5</span><span class="p">)</span>             <span class="c1"># =&gt; 13.00000</span>
<span class="mf">389.32314</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:rounded</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">0</span><span class="p">)</span>      <span class="c1"># =&gt; 389</span>
<span class="mf">111.2345</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:rounded</span><span class="p">,</span> <span class="ss">significant: </span><span class="kp">true</span><span class="p">)</span>  <span class="c1"># =&gt; 111</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-39484184a89d961a701e01d386af2333">111.2345.to_s(:rounded)                     # =&gt; 111.235
111.2345.to_s(:rounded, precision: 2)       # =&gt; 111.23
13.to_s(:rounded, precision: 5)             # =&gt; 13.00000
389.32314.to_s(:rounded, precision: 0)      # =&gt; 389
111.2345.to_s(:rounded, significant: true)  # =&gt; 111
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-39484184a89d961a701e01d386af2333">Copiar</button>
</div>
<p>Produz uma representação de <em>string</em> de um número como um número de bytes legível para humanos:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mi">123</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>                  <span class="c1"># =&gt; 123 Bytes</span>
<span class="mi">1234</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>                 <span class="c1"># =&gt; 1.21 KB</span>
<span class="mi">12345</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>                <span class="c1"># =&gt; 12.1 KB</span>
<span class="mi">1234567</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>              <span class="c1"># =&gt; 1.18 MB</span>
<span class="mi">1234567890</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>           <span class="c1"># =&gt; 1.15 GB</span>
<span class="mi">1234567890123</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>        <span class="c1"># =&gt; 1.12 TB</span>
<span class="mi">1234567890123456</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>     <span class="c1"># =&gt; 1.1 PB</span>
<span class="mi">1234567890123456789</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>  <span class="c1"># =&gt; 1.07 EB</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-8f3ad53887dc3679b0145faeae7cda31">123.to_s(:human_size)                  # =&gt; 123 Bytes
1234.to_s(:human_size)                 # =&gt; 1.21 KB
12345.to_s(:human_size)                # =&gt; 12.1 KB
1234567.to_s(:human_size)              # =&gt; 1.18 MB
1234567890.to_s(:human_size)           # =&gt; 1.15 GB
1234567890123.to_s(:human_size)        # =&gt; 1.12 TB
1234567890123456.to_s(:human_size)     # =&gt; 1.1 PB
1234567890123456789.to_s(:human_size)  # =&gt; 1.07 EB
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8f3ad53887dc3679b0145faeae7cda31">Copiar</button>
</div>
<p>Produz uma representação de <em>string</em> de um número em palavras legíveis para humanos:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mi">123</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>               <span class="c1"># =&gt; "123"</span>
<span class="mi">1234</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>              <span class="c1"># =&gt; "1.23 Thousand"</span>
<span class="mi">12345</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>             <span class="c1"># =&gt; "12.3 Thousand"</span>
<span class="mi">1234567</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>           <span class="c1"># =&gt; "1.23 Million"</span>
<span class="mi">1234567890</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>        <span class="c1"># =&gt; "1.23 Billion"</span>
<span class="mi">1234567890123</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>     <span class="c1"># =&gt; "1.23 Trillion"</span>
<span class="mi">1234567890123456</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>  <span class="c1"># =&gt; "1.23 Quadrillion"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-e9916cb9f11413b0d438265e0a003e6b">123.to_s(:human)               # =&gt; "123"
1234.to_s(:human)              # =&gt; "1.23 Thousand"
12345.to_s(:human)             # =&gt; "12.3 Thousand"
1234567.to_s(:human)           # =&gt; "1.23 Million"
1234567890.to_s(:human)        # =&gt; "1.23 Billion"
1234567890123.to_s(:human)     # =&gt; "1.23 Trillion"
1234567890123456.to_s(:human)  # =&gt; "1.23 Quadrillion"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-e9916cb9f11413b0d438265e0a003e6b">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/numeric/conversions.rb</code>.</p></div><h3 id="extensoes-para-integer"><a class="anchorlink" href="#extensoes-para-integer">8 Extensões para <code>Integer</code></a></h3><h4 id="multiple-of-questionmark"><a class="anchorlink" href="#multiple-of-questionmark">8.1 <code>multiple_of?</code></a></h4><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/Integer.html#method-i-multiple_of-3F"><code>multiple_of?</code></a> testa se um inteiro é múltiplo do argumento:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mi">2</span><span class="p">.</span><span class="nf">multiple_of?</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># =&gt; true</span>
<span class="mi">1</span><span class="p">.</span><span class="nf">multiple_of?</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-9f3d43f32d4d7704210ac226232a1af6">2.multiple_of?(1) # =&gt; true
1.multiple_of?(2) # =&gt; false
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-9f3d43f32d4d7704210ac226232a1af6">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/integer/multiple.rb</code>.</p></div><h4 id="ordinal"><a class="anchorlink" href="#ordinal">8.2 <code>ordinal</code></a></h4><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/Integer.html#method-i-ordinal"><code>ordinal</code></a> retorna a <em>string</em> de sufixo ordinal correspondente ao inteiro receptor:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mi">1</span><span class="p">.</span><span class="nf">ordinal</span>    <span class="c1"># =&gt; "st"</span>
<span class="mi">2</span><span class="p">.</span><span class="nf">ordinal</span>    <span class="c1"># =&gt; "nd"</span>
<span class="mi">53</span><span class="p">.</span><span class="nf">ordinal</span>   <span class="c1"># =&gt; "rd"</span>
<span class="mi">2009</span><span class="p">.</span><span class="nf">ordinal</span> <span class="c1"># =&gt; "th"</span>
<span class="o">-</span><span class="mi">21</span><span class="p">.</span><span class="nf">ordinal</span>  <span class="c1"># =&gt; "st"</span>
<span class="o">-</span><span class="mi">134</span><span class="p">.</span><span class="nf">ordinal</span> <span class="c1"># =&gt; "th"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-61722a0cc696565e3194ea8308533afb">1.ordinal    # =&gt; "st"
2.ordinal    # =&gt; "nd"
53.ordinal   # =&gt; "rd"
2009.ordinal # =&gt; "th"
-21.ordinal  # =&gt; "st"
-134.ordinal # =&gt; "th"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-61722a0cc696565e3194ea8308533afb">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/integer/inflections.rb</code>.</p></div><h4 id="ordinalize"><a class="anchorlink" href="#ordinalize">8.3 <code>ordinalize</code></a></h4><p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/Integer.html#method-i-ordinalize"><code>ordinalize</code></a> retorna a <em>string</em> ordinal correspondente ao inteiro receptor. Em comparação, observe que o método <code>ordinal</code> retorna <strong>apenas</strong> a string de sufixo.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mi">1</span><span class="p">.</span><span class="nf">ordinalize</span>    <span class="c1"># =&gt; "1st"</span>
<span class="mi">2</span><span class="p">.</span><span class="nf">ordinalize</span>    <span class="c1"># =&gt; "2nd"</span>
<span class="mi">53</span><span class="p">.</span><span class="nf">ordinalize</span>   <span class="c1"># =&gt; "53rd"</span>
<span class="mi">2009</span><span class="p">.</span><span class="nf">ordinalize</span> <span class="c1"># =&gt; "2009th"</span>
<span class="o">-</span><span class="mi">21</span><span class="p">.</span><span class="nf">ordinalize</span>  <span class="c1"># =&gt; "-21st"</span>
<span class="o">-</span><span class="mi">134</span><span class="p">.</span><span class="nf">ordinalize</span> <span class="c1"># =&gt; "-134th"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-aa5db5ec347ea355c834486e8e179a7a">1.ordinalize    # =&gt; "1st"
2.ordinalize    # =&gt; "2nd"
53.ordinalize   # =&gt; "53rd"
2009.ordinalize # =&gt; "2009th"
-21.ordinalize  # =&gt; "-21st"
-134.ordinalize # =&gt; "-134th"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-aa5db5ec347ea355c834486e8e179a7a">Copiar</button>
</div>
<div class="note"><p>Definido em <code>active_support/core_ext/integer/inflections.rb</code>.</p></div><h4 id="extensoes-para-integer-time"><a class="anchorlink" href="#extensoes-para-integer-time">8.4 Time</a></h4><p>Os seguintes métodos:</p>
<ul>
<li><a href="https://api.rubyonrails.org/v6.1.4/classes/Integer.html#method-i-months"><code>months</code></a></li>
<li><a href="https://api.rubyonrails.org/v6.1.4/classes/Integer.html#method-i-years"><code>years</code></a></li>
</ul>
<p>habilitar declarações de tempo e cálculos, como <code>4.months + 5.years</code>. Seus valores de retorno também podem ser adicionados ou subtraídos dos objetos Time.</p><p>Esses métodos podem ser combinados com <a href="https://api.rubyonrails.org/v6.1.4/classes/ActiveSupport/Duration.html#method-i-from_now"><code>from_now</code></a>, <a href="https://api.rubyonrails.org/v6.1.4/classes/ActiveSupport/Duration.html#method-i-ago"><code>ago</code></a>, etc, para cálculos de data precisos. Por exemplo:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># equivalente ao Time.current.advance(months: 1)</span>
<span class="mi">1</span><span class="p">.</span><span class="nf">month</span><span class="p">.</span><span class="nf">from_now</span>

<span class="c1"># eequivalente ao Time.current.advance(years: 2)</span>
<span class="mi">2</span><span class="p">.</span><span class="nf">years</span><span class="p">.</span><span class="nf">from_now</span>

<span class="c1"># equivalente ao Time.current.advance(months: 4, years: 5)</span>
<span class="p">(</span><span class="mi">4</span><span class="p">.</span><span class="nf">months</span> <span class="o">+</span> <span class="mi">5</span><span class="p">.</span><span class="nf">years</span><span class="p">).</span><span class="nf">from_now</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-6dde7552ff7d797c0456c80b3598d771"># equivalente ao Time.current.advance(months: 1)
1.month.from_now

# eequivalente ao Time.current.advance(years: 2)
2.years.from_now

# equivalente ao Time.current.advance(months: 4, years: 5)
(4.months + 5.years).from_now
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-6dde7552ff7d797c0456c80b3598d771">Copiar</button>
</div>
<div class="warning"><p>Para outras durações, consulte as extensões de tempo para <code>Numeric</code>.</p></div><div class="note"><p>Definido em <code>active_support/core_ext/integer/time.rb</code>.</p></div><h3 id="extensoes-para-bigdecimal"><a class="anchorlink" href="#extensoes-para-bigdecimal">9 Extensões para <code>BigDecimal</code></a></h3><h4 id="extensoes-para-bigdecimal-to-s"><a class="anchorlink" href="#extensoes-para-bigdecimal-to-s">9.1 <code>to_s</code></a></h4><p>O método <code>to_s</code> fornece um especificador padrão de "F". Isso significa que uma simples chamada para <code>to_s</code> resultará em representação de ponto flutuante em vez de notação de engenharia:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">BigDecimal</span><span class="p">(</span><span class="mf">5.00</span><span class="p">,</span> <span class="mi">6</span><span class="p">).</span><span class="nf">to_s</span>       <span class="c1"># =&gt; "5.0"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-fd565352619f9a46837624469be19f04">BigDecimal(5.00, 6).to_s       # =&gt; "5.0"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-fd565352619f9a46837624469be19f04">Copiar</button>
</div>
<p>e que especificadores  usando <em>symbols</em> também são suportados:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">BigDecimal</span><span class="p">(</span><span class="mf">5.00</span><span class="p">,</span> <span class="mi">6</span><span class="p">).</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:db</span><span class="p">)</span>  <span class="c1"># =&gt; "5.0"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-2972bc859eb930610a6823b8ca867c3e">BigDecimal(5.00, 6).to_s(:db)  # =&gt; "5.0"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2972bc859eb930610a6823b8ca867c3e">Copiar</button>
</div>
<p>A notação de engenharia ainda é suportada:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">BigDecimal</span><span class="p">(</span><span class="mf">5.00</span><span class="p">,</span> <span class="mi">6</span><span class="p">).</span><span class="nf">to_s</span><span class="p">(</span><span class="s2">"e"</span><span class="p">)</span>  <span class="c1"># =&gt; "0.5E1"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-988f0c07a29e45809e2869688ba0b2c3">BigDecimal(5.00, 6).to_s("e")  # =&gt; "0.5E1"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-988f0c07a29e45809e2869688ba0b2c3">Copiar</button>
</div>
<h3 id="extensions-to-enumerable"><a class="anchorlink" href="#extensions-to-enumerable">10 Extensions to <code>Enumerable</code></a></h3><h4 id="sum"><a class="anchorlink" href="#sum">10.1 <code>sum</code></a></h4><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Enumerable.html#method-i-sum"><code>sum</code></a> adds the elements of an enumerable:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nf">sum</span> <span class="c1"># =&gt; 6</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">100</span><span class="p">).</span><span class="nf">sum</span>  <span class="c1"># =&gt; 5050</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-ff3fe3b16bcece20af055234aacb16ca">[1, 2, 3].sum # =&gt; 6
(1..100).sum  # =&gt; 5050
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-ff3fe3b16bcece20af055234aacb16ca">Copiar</button>
</div>
<p>Addition only assumes the elements respond to <code>+</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]].</span><span class="nf">sum</span>    <span class="c1"># =&gt; [1, 2, 2, 3, 3, 4]</span>
<span class="sx">%w(foo bar baz)</span><span class="p">.</span><span class="nf">sum</span>             <span class="c1"># =&gt; "foobarbaz"</span>
<span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">c: </span><span class="mi">3</span><span class="p">}.</span><span class="nf">sum</span>          <span class="c1"># =&gt; [:a, 1, :b, 2, :c, 3]</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-01a0eb442710e77e8fa7894603a4c0e6">[[1, 2], [2, 3], [3, 4]].sum    # =&gt; [1, 2, 2, 3, 3, 4]
%w(foo bar baz).sum             # =&gt; "foobarbaz"
{a: 1, b: 2, c: 3}.sum          # =&gt; [:a, 1, :b, 2, :c, 3]
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-01a0eb442710e77e8fa7894603a4c0e6">Copiar</button>
</div>
<p>The sum of an empty collection is zero by default, but this is customizable:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[].</span><span class="nf">sum</span>    <span class="c1"># =&gt; 0</span>
<span class="p">[].</span><span class="nf">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># =&gt; 1</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-7a49ac0f5428ee69922be59ed4b0ffb8">[].sum    # =&gt; 0
[].sum(1) # =&gt; 1
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-7a49ac0f5428ee69922be59ed4b0ffb8">Copiar</button>
</div>
<p>If a block is given, <code>sum</code> becomes an iterator that yields the elements of the collection and sums the returned values:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">).</span><span class="nf">sum</span> <span class="p">{</span><span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="n">n</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">}</span> <span class="c1"># =&gt; 30</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">].</span><span class="nf">sum</span>    <span class="c1"># =&gt; 30</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-f2d53b41b2e28d3cff9b6e5d2df60f7b">(1..5).sum {|n| n * 2 } # =&gt; 30
[2, 4, 6, 8, 10].sum    # =&gt; 30
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-f2d53b41b2e28d3cff9b6e5d2df60f7b">Copiar</button>
</div>
<p>The sum of an empty receiver can be customized in this form as well:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[].</span><span class="nf">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="n">n</span><span class="o">**</span><span class="mi">3</span><span class="p">}</span> <span class="c1"># =&gt; 1</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-50806dea70cd9bda637d2552acc9170c">[].sum(1) {|n| n**3} # =&gt; 1
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-50806dea70cd9bda637d2552acc9170c">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/enumerable.rb">active_support/core_ext/enumerable.rb</a></code>.</p></div><h4 id="index-by"><a class="anchorlink" href="#index-by">10.2 <code>index_by</code></a></h4><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Enumerable.html#method-i-index_by"><code>index_by</code></a> generates a hash with the elements of an enumerable indexed by some key.</p><p>It iterates through the collection and passes each element to a block. The element will be keyed by the value returned by the block:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">invoices</span><span class="p">.</span><span class="nf">index_by</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:number</span><span class="p">)</span>
<span class="c1"># =&gt; {'2009-032' =&gt; &lt;Invoice ...&gt;, '2009-008' =&gt; &lt;Invoice ...&gt;, ...}</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-0be4cbb469a12604771886268d0c545c">invoices.index_by(&amp;:number)
# =&gt; {'2009-032' =&gt; &lt;Invoice ...&gt;, '2009-008' =&gt; &lt;Invoice ...&gt;, ...}
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-0be4cbb469a12604771886268d0c545c">Copiar</button>
</div>
<div class="warning"><p>Keys should normally be unique. If the block returns the same value for different elements no collection is built for that key. The last item will win.</p></div><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/enumerable.rb">active_support/core_ext/enumerable.rb</a></code>.</p></div><h4 id="index-with"><a class="anchorlink" href="#index-with">10.3 <code>index_with</code></a></h4><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Enumerable.html#method-i-index_with"><code>index_with</code></a> generates a hash with the elements of an enumerable as keys. The value
is either a passed default or returned in a block.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">post</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">title: </span><span class="s2">"hey there"</span><span class="p">,</span> <span class="ss">body: </span><span class="s2">"what's up?"</span><span class="p">)</span>

<span class="sx">%i( title body )</span><span class="p">.</span><span class="nf">index_with</span> <span class="p">{</span> <span class="o">|</span><span class="n">attr_name</span><span class="o">|</span> <span class="n">post</span><span class="p">.</span><span class="nf">public_send</span><span class="p">(</span><span class="n">attr_name</span><span class="p">)</span> <span class="p">}</span>
<span class="c1"># =&gt; { title: "hey there", body: "what's up?" }</span>

<span class="no">WEEKDAYS</span><span class="p">.</span><span class="nf">index_with</span><span class="p">(</span><span class="no">Interval</span><span class="p">.</span><span class="nf">all_day</span><span class="p">)</span>
<span class="c1"># =&gt; { monday: [ 0, 1440 ], … }</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-ae7726542d6661642bd0023d7b1be7d5">post = Post.new(title: "hey there", body: "what's up?")

%i( title body ).index_with { |attr_name| post.public_send(attr_name) }
# =&gt; { title: "hey there", body: "what's up?" }

WEEKDAYS.index_with(Interval.all_day)
# =&gt; { monday: [ 0, 1440 ], … }
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-ae7726542d6661642bd0023d7b1be7d5">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/enumerable.rb">active_support/core_ext/enumerable.rb</a></code>.</p></div><h4 id="many-questionmark"><a class="anchorlink" href="#many-questionmark">10.4 <code>many?</code></a></h4><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Enumerable.html#method-i-many-3F"><code>many?</code></a> is shorthand for <code>collection.size &gt; 1</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">pages</span><span class="p">.</span><span class="nf">many?</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">pagination_links</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-313bb1bf24e27155899f222186ad08d3">&lt;% if pages.many? %&gt;
  &lt;%= pagination_links %&gt;
&lt;% end %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-313bb1bf24e27155899f222186ad08d3">Copiar</button>
</div>
<p>If an optional block is given, <code>many?</code> only takes into account those elements that return true:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="vi">@see_more</span> <span class="o">=</span> <span class="n">videos</span><span class="p">.</span><span class="nf">many?</span> <span class="p">{</span><span class="o">|</span><span class="n">video</span><span class="o">|</span> <span class="n">video</span><span class="p">.</span><span class="nf">category</span> <span class="o">==</span> <span class="n">params</span><span class="p">[</span><span class="ss">:category</span><span class="p">]}</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-84b1224b2098c1d4a8b6c10c2b0d0675">@see_more = videos.many? {|video| video.category == params[:category]}
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-84b1224b2098c1d4a8b6c10c2b0d0675">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/enumerable.rb">active_support/core_ext/enumerable.rb</a></code>.</p></div><h4 id="exclude-questionmark"><a class="anchorlink" href="#exclude-questionmark">10.5 <code>exclude?</code></a></h4><p>The predicate <a href="https://api.rubyonrails.org/v6.1.4/classes/Enumerable.html#method-i-exclude-3F"><code>exclude?</code></a> tests whether a given object does <strong>not</strong> belong to the collection. It is the negation of the built-in <code>include?</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">to_visit</span> <span class="o">&lt;&lt;</span> <span class="n">node</span> <span class="k">if</span> <span class="n">visited</span><span class="p">.</span><span class="nf">exclude?</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-a774275bf13dd75bab1a9c7a615a6188">to_visit &lt;&lt; node if visited.exclude?(node)
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-a774275bf13dd75bab1a9c7a615a6188">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/enumerable.rb">active_support/core_ext/enumerable.rb</a></code>.</p></div><h4 id="including"><a class="anchorlink" href="#including">10.6 <code>including</code></a></h4><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Enumerable.html#method-i-including"><code>including</code></a> returns a new enumerable that includes the passed elements:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">].</span><span class="nf">including</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>                    <span class="c1"># =&gt; [ 1, 2, 3, 4, 5 ]</span>
<span class="p">[</span><span class="s2">"David"</span><span class="p">,</span> <span class="s2">"Rafael"</span><span class="p">].</span><span class="nf">including</span> <span class="sx">%w[ Aaron Todd ]</span> <span class="c1"># =&gt; ["David", "Rafael", "Aaron", "Todd"]</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-98719e47d82ee81339372bea378e4f83">[ 1, 2, 3 ].including(4, 5)                    # =&gt; [ 1, 2, 3, 4, 5 ]
["David", "Rafael"].including %w[ Aaron Todd ] # =&gt; ["David", "Rafael", "Aaron", "Todd"]
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-98719e47d82ee81339372bea378e4f83">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/enumerable.rb">active_support/core_ext/enumerable.rb</a></code>.</p></div><h4 id="excluding"><a class="anchorlink" href="#excluding">10.7 <code>excluding</code></a></h4><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Enumerable.html#method-i-excluding"><code>excluding</code></a> returns a copy of an enumerable with the specified elements
removed:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span><span class="s2">"David"</span><span class="p">,</span> <span class="s2">"Rafael"</span><span class="p">,</span> <span class="s2">"Aaron"</span><span class="p">,</span> <span class="s2">"Todd"</span><span class="p">].</span><span class="nf">excluding</span><span class="p">(</span><span class="s2">"Aaron"</span><span class="p">,</span> <span class="s2">"Todd"</span><span class="p">)</span> <span class="c1"># =&gt; ["David", "Rafael"]</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-44ba11bc67c9b68305bf51aa60891263">["David", "Rafael", "Aaron", "Todd"].excluding("Aaron", "Todd") # =&gt; ["David", "Rafael"]
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-44ba11bc67c9b68305bf51aa60891263">Copiar</button>
</div>
<p><code>excluding</code> is aliased to <a href="https://api.rubyonrails.org/v6.1.4/classes/Enumerable.html#method-i-without"><code>without</code></a>.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/enumerable.rb">active_support/core_ext/enumerable.rb</a></code>.</p></div><h4 id="pluck"><a class="anchorlink" href="#pluck">10.8 <code>pluck</code></a></h4><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Enumerable.html#method-i-pluck"><code>pluck</code></a> extracts the given key from each element:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[{</span> <span class="ss">name: </span><span class="s2">"David"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">name: </span><span class="s2">"Rafael"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">name: </span><span class="s2">"Aaron"</span> <span class="p">}].</span><span class="nf">pluck</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span> <span class="c1"># =&gt; ["David", "Rafael", "Aaron"]</span>
<span class="p">[{</span> <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"David"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">id: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"Rafael"</span> <span class="p">}].</span><span class="nf">pluck</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">)</span> <span class="c1"># =&gt; [[1, "David"], [2, "Rafael"]]</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-f9d812474f8caeaa2c638ee6a0b3c41a">[{ name: "David" }, { name: "Rafael" }, { name: "Aaron" }].pluck(:name) # =&gt; ["David", "Rafael", "Aaron"]
[{ id: 1, name: "David" }, { id: 2, name: "Rafael" }].pluck(:id, :name) # =&gt; [[1, "David"], [2, "Rafael"]]
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-f9d812474f8caeaa2c638ee6a0b3c41a">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/enumerable.rb">active_support/core_ext/enumerable.rb</a></code>.</p></div><h4 id="pick"><a class="anchorlink" href="#pick">10.9 <code>pick</code></a></h4><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Enumerable.html#method-i-pick"><code>pick</code></a> extracts the given key from the first element:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[{</span> <span class="ss">name: </span><span class="s2">"David"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">name: </span><span class="s2">"Rafael"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">name: </span><span class="s2">"Aaron"</span> <span class="p">}].</span><span class="nf">pick</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span> <span class="c1"># =&gt; "David"</span>
<span class="p">[{</span> <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"David"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">id: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"Rafael"</span> <span class="p">}].</span><span class="nf">pick</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">)</span> <span class="c1"># =&gt; [1, "David"]</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-5358edaf24f0129779acde495e391106">[{ name: "David" }, { name: "Rafael" }, { name: "Aaron" }].pick(:name) # =&gt; "David"
[{ id: 1, name: "David" }, { id: 2, name: "Rafael" }].pick(:id, :name) # =&gt; [1, "David"]
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-5358edaf24f0129779acde495e391106">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/enumerable.rb">active_support/core_ext/enumerable.rb</a></code>.</p></div><h3 id="extensions-to-array"><a class="anchorlink" href="#extensions-to-array">11 Extensions to <code>Array</code></a></h3><h4 id="accessing"><a class="anchorlink" href="#accessing">11.1 Accessing</a></h4><p>Active Support augments the API of arrays to ease certain ways of accessing them. For example, <a href="https://api.rubyonrails.org/v6.1.4/classes/Array.html#method-i-to"><code>to</code></a> returns the subarray of elements up to the one at the passed index:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="sx">%w(a b c d)</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; ["a", "b", "c"]</span>
<span class="p">[].</span><span class="nf">to</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>          <span class="c1"># =&gt; []</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-8f88500a573aed1161e655499927b758">%w(a b c d).to(2) # =&gt; ["a", "b", "c"]
[].to(7)          # =&gt; []
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8f88500a573aed1161e655499927b758">Copiar</button>
</div>
<p>Similarly, <a href="https://api.rubyonrails.org/v6.1.4/classes/Array.html#method-i-from"><code>from</code></a> returns the tail from the element at the passed index to the end. If the index is greater than the length of the array, it returns an empty array.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="sx">%w(a b c d)</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># =&gt; ["c", "d"]</span>
<span class="sx">%w(a b c d)</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># =&gt; []</span>
<span class="p">[].</span><span class="nf">from</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>           <span class="c1"># =&gt; []</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-d70c16f3770e46c732ec5f013a092fa2">%w(a b c d).from(2)  # =&gt; ["c", "d"]
%w(a b c d).from(10) # =&gt; []
[].from(0)           # =&gt; []
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d70c16f3770e46c732ec5f013a092fa2">Copiar</button>
</div>
<p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Array.html#method-i-including"><code>including</code></a> returns a new array that includes the passed elements:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">].</span><span class="nf">including</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>          <span class="c1"># =&gt; [ 1, 2, 3, 4, 5 ]</span>
<span class="p">[</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">].</span><span class="nf">including</span><span class="p">([</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">])</span> <span class="c1"># =&gt; [ [ 0, 1 ], [ 1, 0 ] ]</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-e45d9e7231fc1949d9a7954ab256a591">[ 1, 2, 3 ].including(4, 5)          # =&gt; [ 1, 2, 3, 4, 5 ]
[ [ 0, 1 ] ].including([ [ 1, 0 ] ]) # =&gt; [ [ 0, 1 ], [ 1, 0 ] ]
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-e45d9e7231fc1949d9a7954ab256a591">Copiar</button>
</div>
<p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Array.html#method-i-excluding"><code>excluding</code></a> returns a copy of the Array excluding the specified elements.
This is an optimization of <code>Enumerable#excluding</code> that uses <code>Array#-</code>
instead of <code>Array#reject</code> for performance reasons.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span><span class="s2">"David"</span><span class="p">,</span> <span class="s2">"Rafael"</span><span class="p">,</span> <span class="s2">"Aaron"</span><span class="p">,</span> <span class="s2">"Todd"</span><span class="p">].</span><span class="nf">excluding</span><span class="p">(</span><span class="s2">"Aaron"</span><span class="p">,</span> <span class="s2">"Todd"</span><span class="p">)</span> <span class="c1"># =&gt; ["David", "Rafael"]</span>
<span class="p">[</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="p">],</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">].</span><span class="nf">excluding</span><span class="p">([</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">])</span>                  <span class="c1"># =&gt; [ [ 0, 1 ] ]</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-6321f50aa835b9f2bf837ddee32b64e8">["David", "Rafael", "Aaron", "Todd"].excluding("Aaron", "Todd") # =&gt; ["David", "Rafael"]
[ [ 0, 1 ], [ 1, 0 ] ].excluding([ [ 1, 0 ] ])                  # =&gt; [ [ 0, 1 ] ]
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-6321f50aa835b9f2bf837ddee32b64e8">Copiar</button>
</div>
<p>The methods <a href="https://api.rubyonrails.org/v6.1.4/classes/Array.html#method-i-second"><code>second</code></a>, <a href="https://api.rubyonrails.org/v6.1.4/classes/Array.html#method-i-third"><code>third</code></a>, <a href="https://api.rubyonrails.org/v6.1.4/classes/Array.html#method-i-fourth"><code>fourth</code></a>, and <a href="https://api.rubyonrails.org/v6.1.4/classes/Array.html#method-i-fifth"><code>fifth</code></a> return the corresponding element, as do <a href="https://api.rubyonrails.org/v6.1.4/classes/Array.html#method-i-second_to_last"><code>second_to_last</code></a> and <a href="https://api.rubyonrails.org/v6.1.4/classes/Array.html#method-i-third_to_last"><code>third_to_last</code></a> (<code>first</code> and <code>last</code> are built-in). Thanks to social wisdom and positive constructiveness all around, <a href="https://api.rubyonrails.org/v6.1.4/classes/Array.html#method-i-forty_two"><code>forty_two</code></a> is also available.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="sx">%w(a b c d)</span><span class="p">.</span><span class="nf">third</span> <span class="c1"># =&gt; "c"</span>
<span class="sx">%w(a b c d)</span><span class="p">.</span><span class="nf">fifth</span> <span class="c1"># =&gt; nil</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-2cacc5edf0b90efd287ca7da5f3caa32">%w(a b c d).third # =&gt; "c"
%w(a b c d).fifth # =&gt; nil
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2cacc5edf0b90efd287ca7da5f3caa32">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/array/access.rb">active_support/core_ext/array/access.rb</a></code>.</p></div><h4 id="extensions-to-array-extracting"><a class="anchorlink" href="#extensions-to-array-extracting">11.2 Extracting</a></h4><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Array.html#method-i-extract-21"><code>extract!</code></a> removes and returns the elements for which the block returns a true value.
If no block is given, an Enumerator is returned instead.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="n">odd_numbers</span> <span class="o">=</span> <span class="n">numbers</span><span class="p">.</span><span class="nf">extract!</span> <span class="p">{</span> <span class="o">|</span><span class="n">number</span><span class="o">|</span> <span class="n">number</span><span class="p">.</span><span class="nf">odd?</span> <span class="p">}</span> <span class="c1"># =&gt; [1, 3, 5, 7, 9]</span>
<span class="n">numbers</span> <span class="c1"># =&gt; [0, 2, 4, 6, 8]</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-dcbf1101b2c4b4b41b679c6030446641">numbers = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
odd_numbers = numbers.extract! { |number| number.odd? } # =&gt; [1, 3, 5, 7, 9]
numbers # =&gt; [0, 2, 4, 6, 8]
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-dcbf1101b2c4b4b41b679c6030446641">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/array/extract.rb">active_support/core_ext/array/extract.rb</a></code>.</p></div><h4 id="options-extraction"><a class="anchorlink" href="#options-extraction">11.3 Options Extraction</a></h4><p>When the last argument in a method call is a hash, except perhaps for a <code>&amp;block</code> argument, Ruby allows you to omit the brackets:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">User</span><span class="p">.</span><span class="nf">exists?</span><span class="p">(</span><span class="ss">email: </span><span class="n">params</span><span class="p">[</span><span class="ss">:email</span><span class="p">])</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-fc9a7516e7a2bfadd6909d5cb57b8c99">User.exists?(email: params[:email])
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-fc9a7516e7a2bfadd6909d5cb57b8c99">Copiar</button>
</div>
<p>That syntactic sugar is used a lot in Rails to avoid positional arguments where there would be too many, offering instead interfaces that emulate named parameters. In particular it is very idiomatic to use a trailing hash for options.</p><p>If a method expects a variable number of arguments and uses <code>*</code> in its declaration, however, such an options hash ends up being an item of the array of arguments, where it loses its role.</p><p>In those cases, you may give an options hash a distinguished treatment with <a href="https://api.rubyonrails.org/v6.1.4/classes/Array.html#method-i-extract_options-21"><code>extract_options!</code></a>. This method checks the type of the last item of an array. If it is a hash it pops it and returns it, otherwise it returns an empty hash.</p><p>Let's see for example the definition of the <code>caches_action</code> controller macro:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">caches_action</span><span class="p">(</span><span class="o">*</span><span class="n">actions</span><span class="p">)</span>
  <span class="k">return</span> <span class="k">unless</span> <span class="n">cache_configured?</span>
  <span class="n">options</span> <span class="o">=</span> <span class="n">actions</span><span class="p">.</span><span class="nf">extract_options!</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-c1a9f5bca51a3f4d47b51b52242c4b78">def caches_action(*actions)
  return unless cache_configured?
  options = actions.extract_options!
  # ...
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-c1a9f5bca51a3f4d47b51b52242c4b78">Copiar</button>
</div>
<p>This method receives an arbitrary number of action names, and an optional hash of options as last argument. With the call to <code>extract_options!</code> you obtain the options hash and remove it from <code>actions</code> in a simple and explicit way.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/array/extract_options.rb">active_support/core_ext/array/extract_options.rb</a></code>.</p></div><h4 id="extensions-to-array-conversions"><a class="anchorlink" href="#extensions-to-array-conversions">11.4 Conversions</a></h4><h5 id="to-sentence"><a class="anchorlink" href="#to-sentence">11.4.1 <code>to_sentence</code></a></h5><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Array.html#method-i-to_sentence"><code>to_sentence</code></a> turns an array into a string containing a sentence that enumerates its items:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="sx">%w()</span><span class="p">.</span><span class="nf">to_sentence</span>                <span class="c1"># =&gt; ""</span>
<span class="sx">%w(Earth)</span><span class="p">.</span><span class="nf">to_sentence</span>           <span class="c1"># =&gt; "Earth"</span>
<span class="sx">%w(Earth Wind)</span><span class="p">.</span><span class="nf">to_sentence</span>      <span class="c1"># =&gt; "Earth and Wind"</span>
<span class="sx">%w(Earth Wind Fire)</span><span class="p">.</span><span class="nf">to_sentence</span> <span class="c1"># =&gt; "Earth, Wind, and Fire"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-c5639eb9ba3e1735c017412be311b450">%w().to_sentence                # =&gt; ""
%w(Earth).to_sentence           # =&gt; "Earth"
%w(Earth Wind).to_sentence      # =&gt; "Earth and Wind"
%w(Earth Wind Fire).to_sentence # =&gt; "Earth, Wind, and Fire"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-c5639eb9ba3e1735c017412be311b450">Copiar</button>
</div>
<p>This method accepts three options:</p>
<ul>
<li>
<code>:two_words_connector</code>: What is used for arrays of length 2. Default is " and ".</li>
<li>
<code>:words_connector</code>: What is used to join the elements of arrays with 3 or more elements, except for the last two. Default is ", ".</li>
<li>
<code>:last_word_connector</code>: What is used to join the last items of an array with 3 or more elements. Default is ", and ".</li>
</ul>
<p>The defaults for these options can be localized, their keys are:</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>I18n key</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:two_words_connector</code></td>
<td><code>support.array.two_words_connector</code></td>
</tr>
<tr>
<td><code>:words_connector</code></td>
<td><code>support.array.words_connector</code></td>
</tr>
<tr>
<td><code>:last_word_connector</code></td>
<td><code>support.array.last_word_connector</code></td>
</tr>
</tbody>
</table>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/array/conversions.rb">active_support/core_ext/array/conversions.rb</a></code>.</p></div><h5 id="to-formatted-s"><a class="anchorlink" href="#to-formatted-s">11.4.2 <code>to_formatted_s</code></a></h5><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Array.html#method-i-to_formatted_s"><code>to_formatted_s</code></a> acts like <code>to_s</code> by default.</p><p>If the array contains items that respond to <code>id</code>, however, the symbol
<code>:db</code> may be passed as argument. That's typically used with
collections of Active Record objects. Returned strings are:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[].</span><span class="nf">to_formatted_s</span><span class="p">(</span><span class="ss">:db</span><span class="p">)</span>            <span class="c1"># =&gt; "null"</span>
<span class="p">[</span><span class="n">user</span><span class="p">].</span><span class="nf">to_formatted_s</span><span class="p">(</span><span class="ss">:db</span><span class="p">)</span>        <span class="c1"># =&gt; "8456"</span>
<span class="n">invoice</span><span class="p">.</span><span class="nf">lines</span><span class="p">.</span><span class="nf">to_formatted_s</span><span class="p">(</span><span class="ss">:db</span><span class="p">)</span> <span class="c1"># =&gt; "23,567,556,12"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-cf5f1824a27f004411616a19c75a6e11">[].to_formatted_s(:db)            # =&gt; "null"
[user].to_formatted_s(:db)        # =&gt; "8456"
invoice.lines.to_formatted_s(:db) # =&gt; "23,567,556,12"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-cf5f1824a27f004411616a19c75a6e11">Copiar</button>
</div>
<p>Integers in the example above are supposed to come from the respective calls to <code>id</code>.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/array/conversions.rb">active_support/core_ext/array/conversions.rb</a></code>.</p></div><h5 id="extensions-to-array-conversions-to-xml"><a class="anchorlink" href="#extensions-to-array-conversions-to-xml">11.4.3 <code>to_xml</code></a></h5><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Array.html#method-i-to_xml"><code>to_xml</code></a> returns a string containing an XML representation of its receiver:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Contributor</span><span class="p">.</span><span class="nf">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nf">order</span><span class="p">(</span><span class="ss">:rank</span><span class="p">).</span><span class="nf">to_xml</span>
<span class="c1"># =&gt;</span>
<span class="c1"># &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="c1"># &lt;contributors type="array"&gt;</span>
<span class="c1">#   &lt;contributor&gt;</span>
<span class="c1">#     &lt;id type="integer"&gt;4356&lt;/id&gt;</span>
<span class="c1">#     &lt;name&gt;Jeremy Kemper&lt;/name&gt;</span>
<span class="c1">#     &lt;rank type="integer"&gt;1&lt;/rank&gt;</span>
<span class="c1">#     &lt;url-id&gt;jeremy-kemper&lt;/url-id&gt;</span>
<span class="c1">#   &lt;/contributor&gt;</span>
<span class="c1">#   &lt;contributor&gt;</span>
<span class="c1">#     &lt;id type="integer"&gt;4404&lt;/id&gt;</span>
<span class="c1">#     &lt;name&gt;David Heinemeier Hansson&lt;/name&gt;</span>
<span class="c1">#     &lt;rank type="integer"&gt;2&lt;/rank&gt;</span>
<span class="c1">#     &lt;url-id&gt;david-heinemeier-hansson&lt;/url-id&gt;</span>
<span class="c1">#   &lt;/contributor&gt;</span>
<span class="c1"># &lt;/contributors&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-800761ac6748ce704f94055f23e9325d">Contributor.limit(2).order(:rank).to_xml
# =&gt;
# &lt;?xml version="1.0" encoding="UTF-8"?&gt;
# &lt;contributors type="array"&gt;
#   &lt;contributor&gt;
#     &lt;id type="integer"&gt;4356&lt;/id&gt;
#     &lt;name&gt;Jeremy Kemper&lt;/name&gt;
#     &lt;rank type="integer"&gt;1&lt;/rank&gt;
#     &lt;url-id&gt;jeremy-kemper&lt;/url-id&gt;
#   &lt;/contributor&gt;
#   &lt;contributor&gt;
#     &lt;id type="integer"&gt;4404&lt;/id&gt;
#     &lt;name&gt;David Heinemeier Hansson&lt;/name&gt;
#     &lt;rank type="integer"&gt;2&lt;/rank&gt;
#     &lt;url-id&gt;david-heinemeier-hansson&lt;/url-id&gt;
#   &lt;/contributor&gt;
# &lt;/contributors&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-800761ac6748ce704f94055f23e9325d">Copiar</button>
</div>
<p>To do so it sends <code>to_xml</code> to every item in turn, and collects the results under a root node. All items must respond to <code>to_xml</code>, an exception is raised otherwise.</p><p>By default, the name of the root element is the underscored and dasherized plural of the name of the class of the first item, provided the rest of elements belong to that type (checked with <code>is_a?</code>) and they are not hashes. In the example above that's "contributors".</p><p>If there's any element that does not belong to the type of the first one the root node becomes "objects":</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span><span class="no">Contributor</span><span class="p">.</span><span class="nf">first</span><span class="p">,</span> <span class="no">Commit</span><span class="p">.</span><span class="nf">first</span><span class="p">].</span><span class="nf">to_xml</span>
<span class="c1"># =&gt;</span>
<span class="c1"># &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="c1"># &lt;objects type="array"&gt;</span>
<span class="c1">#   &lt;object&gt;</span>
<span class="c1">#     &lt;id type="integer"&gt;4583&lt;/id&gt;</span>
<span class="c1">#     &lt;name&gt;Aaron Batalion&lt;/name&gt;</span>
<span class="c1">#     &lt;rank type="integer"&gt;53&lt;/rank&gt;</span>
<span class="c1">#     &lt;url-id&gt;aaron-batalion&lt;/url-id&gt;</span>
<span class="c1">#   &lt;/object&gt;</span>
<span class="c1">#   &lt;object&gt;</span>
<span class="c1">#     &lt;author&gt;Joshua Peek&lt;/author&gt;</span>
<span class="c1">#     &lt;authored-timestamp type="datetime"&gt;2009-09-02T16:44:36Z&lt;/authored-timestamp&gt;</span>
<span class="c1">#     &lt;branch&gt;origin/master&lt;/branch&gt;</span>
<span class="c1">#     &lt;committed-timestamp type="datetime"&gt;2009-09-02T16:44:36Z&lt;/committed-timestamp&gt;</span>
<span class="c1">#     &lt;committer&gt;Joshua Peek&lt;/committer&gt;</span>
<span class="c1">#     &lt;git-show nil="true"&gt;&lt;/git-show&gt;</span>
<span class="c1">#     &lt;id type="integer"&gt;190316&lt;/id&gt;</span>
<span class="c1">#     &lt;imported-from-svn type="boolean"&gt;false&lt;/imported-from-svn&gt;</span>
<span class="c1">#     &lt;message&gt;Kill AMo observing wrap_with_notifications since ARes was only using it&lt;/message&gt;</span>
<span class="c1">#     &lt;sha1&gt;723a47bfb3708f968821bc969a9a3fc873a3ed58&lt;/sha1&gt;</span>
<span class="c1">#   &lt;/object&gt;</span>
<span class="c1"># &lt;/objects&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-1a77fa8cda99142f5515792f8814e351">[Contributor.first, Commit.first].to_xml
# =&gt;
# &lt;?xml version="1.0" encoding="UTF-8"?&gt;
# &lt;objects type="array"&gt;
#   &lt;object&gt;
#     &lt;id type="integer"&gt;4583&lt;/id&gt;
#     &lt;name&gt;Aaron Batalion&lt;/name&gt;
#     &lt;rank type="integer"&gt;53&lt;/rank&gt;
#     &lt;url-id&gt;aaron-batalion&lt;/url-id&gt;
#   &lt;/object&gt;
#   &lt;object&gt;
#     &lt;author&gt;Joshua Peek&lt;/author&gt;
#     &lt;authored-timestamp type="datetime"&gt;2009-09-02T16:44:36Z&lt;/authored-timestamp&gt;
#     &lt;branch&gt;origin/master&lt;/branch&gt;
#     &lt;committed-timestamp type="datetime"&gt;2009-09-02T16:44:36Z&lt;/committed-timestamp&gt;
#     &lt;committer&gt;Joshua Peek&lt;/committer&gt;
#     &lt;git-show nil="true"&gt;&lt;/git-show&gt;
#     &lt;id type="integer"&gt;190316&lt;/id&gt;
#     &lt;imported-from-svn type="boolean"&gt;false&lt;/imported-from-svn&gt;
#     &lt;message&gt;Kill AMo observing wrap_with_notifications since ARes was only using it&lt;/message&gt;
#     &lt;sha1&gt;723a47bfb3708f968821bc969a9a3fc873a3ed58&lt;/sha1&gt;
#   &lt;/object&gt;
# &lt;/objects&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-1a77fa8cda99142f5515792f8814e351">Copiar</button>
</div>
<p>If the receiver is an array of hashes the root element is by default also "objects":</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="ss">c: </span><span class="mi">3</span><span class="p">}].</span><span class="nf">to_xml</span>
<span class="c1"># =&gt;</span>
<span class="c1"># &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="c1"># &lt;objects type="array"&gt;</span>
<span class="c1">#   &lt;object&gt;</span>
<span class="c1">#     &lt;b type="integer"&gt;2&lt;/b&gt;</span>
<span class="c1">#     &lt;a type="integer"&gt;1&lt;/a&gt;</span>
<span class="c1">#   &lt;/object&gt;</span>
<span class="c1">#   &lt;object&gt;</span>
<span class="c1">#     &lt;c type="integer"&gt;3&lt;/c&gt;</span>
<span class="c1">#   &lt;/object&gt;</span>
<span class="c1"># &lt;/objects&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-583608b0b75e5bacb13f645b9dffcc45">[{a: 1, b: 2}, {c: 3}].to_xml
# =&gt;
# &lt;?xml version="1.0" encoding="UTF-8"?&gt;
# &lt;objects type="array"&gt;
#   &lt;object&gt;
#     &lt;b type="integer"&gt;2&lt;/b&gt;
#     &lt;a type="integer"&gt;1&lt;/a&gt;
#   &lt;/object&gt;
#   &lt;object&gt;
#     &lt;c type="integer"&gt;3&lt;/c&gt;
#   &lt;/object&gt;
# &lt;/objects&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-583608b0b75e5bacb13f645b9dffcc45">Copiar</button>
</div>
<div class="warning"><p>If the collection is empty the root element is by default "nil-classes". That's a gotcha, for example the root element of the list of contributors above would not be "contributors" if the collection was empty, but "nil-classes". You may use the <code>:root</code> option to ensure a consistent root element.</p></div><p>The name of children nodes is by default the name of the root node singularized. In the examples above we've seen "contributor" and "object". The option <code>:children</code> allows you to set these node names.</p><p>The default XML builder is a fresh instance of <code>Builder::XmlMarkup</code>. You can configure your own builder via the <code>:builder</code> option. The method also accepts options like <code>:dasherize</code> and friends, they are forwarded to the builder:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Contributor</span><span class="p">.</span><span class="nf">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nf">order</span><span class="p">(</span><span class="ss">:rank</span><span class="p">).</span><span class="nf">to_xml</span><span class="p">(</span><span class="ss">skip_types: </span><span class="kp">true</span><span class="p">)</span>
<span class="c1"># =&gt;</span>
<span class="c1"># &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="c1"># &lt;contributors&gt;</span>
<span class="c1">#   &lt;contributor&gt;</span>
<span class="c1">#     &lt;id&gt;4356&lt;/id&gt;</span>
<span class="c1">#     &lt;name&gt;Jeremy Kemper&lt;/name&gt;</span>
<span class="c1">#     &lt;rank&gt;1&lt;/rank&gt;</span>
<span class="c1">#     &lt;url-id&gt;jeremy-kemper&lt;/url-id&gt;</span>
<span class="c1">#   &lt;/contributor&gt;</span>
<span class="c1">#   &lt;contributor&gt;</span>
<span class="c1">#     &lt;id&gt;4404&lt;/id&gt;</span>
<span class="c1">#     &lt;name&gt;David Heinemeier Hansson&lt;/name&gt;</span>
<span class="c1">#     &lt;rank&gt;2&lt;/rank&gt;</span>
<span class="c1">#     &lt;url-id&gt;david-heinemeier-hansson&lt;/url-id&gt;</span>
<span class="c1">#   &lt;/contributor&gt;</span>
<span class="c1"># &lt;/contributors&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-6ed089f1b439c09456930f3f3b0cd7a9">Contributor.limit(2).order(:rank).to_xml(skip_types: true)
# =&gt;
# &lt;?xml version="1.0" encoding="UTF-8"?&gt;
# &lt;contributors&gt;
#   &lt;contributor&gt;
#     &lt;id&gt;4356&lt;/id&gt;
#     &lt;name&gt;Jeremy Kemper&lt;/name&gt;
#     &lt;rank&gt;1&lt;/rank&gt;
#     &lt;url-id&gt;jeremy-kemper&lt;/url-id&gt;
#   &lt;/contributor&gt;
#   &lt;contributor&gt;
#     &lt;id&gt;4404&lt;/id&gt;
#     &lt;name&gt;David Heinemeier Hansson&lt;/name&gt;
#     &lt;rank&gt;2&lt;/rank&gt;
#     &lt;url-id&gt;david-heinemeier-hansson&lt;/url-id&gt;
#   &lt;/contributor&gt;
# &lt;/contributors&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-6ed089f1b439c09456930f3f3b0cd7a9">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/array/conversions.rb">active_support/core_ext/array/conversions.rb</a></code>.</p></div><h4 id="wrapping"><a class="anchorlink" href="#wrapping">11.5 Wrapping</a></h4><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Array.html#method-c-wrap"><code>Array.wrap</code></a> wraps its argument in an array unless it is already an array (or array-like).</p><p>Specifically:</p>
<ul>
<li>If the argument is <code>nil</code> an empty array is returned.</li>
<li>Otherwise, if the argument responds to <code>to_ary</code> it is invoked, and if the value of <code>to_ary</code> is not <code>nil</code>, it is returned.</li>
<li>Otherwise, an array with the argument as its single element is returned.</li>
</ul>
<div class="code_container">
<pre><code class="highlight ruby"><span class="no">Array</span><span class="p">.</span><span class="nf">wrap</span><span class="p">(</span><span class="kp">nil</span><span class="p">)</span>       <span class="c1"># =&gt; []</span>
<span class="no">Array</span><span class="p">.</span><span class="nf">wrap</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="c1"># =&gt; [1, 2, 3]</span>
<span class="no">Array</span><span class="p">.</span><span class="nf">wrap</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>         <span class="c1"># =&gt; [0]</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-539f0d4451d706c74e9c7cc5a95cea7a">Array.wrap(nil)       # =&gt; []
Array.wrap([1, 2, 3]) # =&gt; [1, 2, 3]
Array.wrap(0)         # =&gt; [0]
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-539f0d4451d706c74e9c7cc5a95cea7a">Copiar</button>
</div>
<p>This method is similar in purpose to <code>Kernel#Array</code>, but there are some differences:</p>
<ul>
<li>If the argument responds to <code>to_ary</code> the method is invoked. <code>Kernel#Array</code> moves on to try <code>to_a</code> if the returned value is <code>nil</code>, but <code>Array.wrap</code> returns an array with the argument as its single element right away.</li>
<li>If the returned value from <code>to_ary</code> is neither <code>nil</code> nor an <code>Array</code> object, <code>Kernel#Array</code> raises an exception, while <code>Array.wrap</code> does not, it just returns the value.</li>
<li>It does not call <code>to_a</code> on the argument, if the argument does not respond to <code>to_ary</code> it returns an array with the argument as its single element.</li>
</ul>
<p>The last point is particularly worth comparing for some enumerables:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Array</span><span class="p">.</span><span class="nf">wrap</span><span class="p">(</span><span class="ss">foo: :bar</span><span class="p">)</span> <span class="c1"># =&gt; [{:foo=&gt;:bar}]</span>
<span class="no">Array</span><span class="p">(</span><span class="ss">foo: :bar</span><span class="p">)</span>      <span class="c1"># =&gt; [[:foo, :bar]]</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-a93f33892896c1a8cbaa243f316e2089">Array.wrap(foo: :bar) # =&gt; [{:foo=&gt;:bar}]
Array(foo: :bar)      # =&gt; [[:foo, :bar]]
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-a93f33892896c1a8cbaa243f316e2089">Copiar</button>
</div>
<p>There's also a related idiom that uses the splat operator:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span><span class="o">*</span><span class="n">object</span><span class="p">]</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-91543ae9f184207ab309308a8acb00ff">[*object]
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-91543ae9f184207ab309308a8acb00ff">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/array/wrap.rb">active_support/core_ext/array/wrap.rb</a></code>.</p></div><h4 id="duplicating"><a class="anchorlink" href="#duplicating">11.6 Duplicating</a></h4><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Array.html#method-i-deep_dup"><code>Array#deep_dup</code></a> duplicates itself and all objects inside
recursively with the Active Support method <code>Object#deep_dup</code>. It works like <code>Array#map</code>, sending <code>deep_dup</code> method to each object inside.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
<span class="nb">dup</span> <span class="o">=</span> <span class="n">array</span><span class="p">.</span><span class="nf">deep_dup</span>
<span class="nb">dup</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="kp">nil</span>   <span class="c1"># =&gt; true</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-0b9e80fea12cba34a67608c241bce201">array = [1, [2, 3]]
dup = array.deep_dup
dup[1][2] = 4
array[1][2] == nil   # =&gt; true
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-0b9e80fea12cba34a67608c241bce201">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/object/deep_dup.rb">active_support/core_ext/object/deep_dup.rb</a></code>.</p></div><h4 id="grouping"><a class="anchorlink" href="#grouping">11.7 Grouping</a></h4><h5 id="in-groups-of-number-fill-with-nil"><a class="anchorlink" href="#in-groups-of-number-fill-with-nil">11.7.1 <code>in_groups_of(number, fill_with = nil)</code></a></h5><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Array.html#method-i-in_groups_of"><code>in_groups_of</code></a> splits an array into consecutive groups of a certain size. It returns an array with the groups:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nf">in_groups_of</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; [[1, 2], [3, nil]]</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-a33886871cb4bdea5870e88afd7c8509">[1, 2, 3].in_groups_of(2) # =&gt; [[1, 2], [3, nil]]
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-a33886871cb4bdea5870e88afd7c8509">Copiar</button>
</div>
<p>or yields them in turn if a block is passed:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%</span> <span class="n">sample</span><span class="p">.</span><span class="nf">in_groups_of</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">a</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">b</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">c</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-5f54f47cfecf8b09a7d6f67d59f3d4fa">&lt;% sample.in_groups_of(3) do |a, b, c| %&gt;
  &lt;tr&gt;
    &lt;td&gt;&lt;%= a %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= b %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= c %&gt;&lt;/td&gt;
  &lt;/tr&gt;
&lt;% end %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-5f54f47cfecf8b09a7d6f67d59f3d4fa">Copiar</button>
</div>
<p>The first example shows how <code>in_groups_of</code> fills the last group with as many <code>nil</code> elements as needed to have the requested size. You can change this padding value using the second optional argument:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nf">in_groups_of</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># =&gt; [[1, 2], [3, 0]]</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-739cf7812d277a962f059ea0901053af">[1, 2, 3].in_groups_of(2, 0) # =&gt; [[1, 2], [3, 0]]
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-739cf7812d277a962f059ea0901053af">Copiar</button>
</div>
<p>And you can tell the method not to fill the last group by passing <code>false</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nf">in_groups_of</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kp">false</span><span class="p">)</span> <span class="c1"># =&gt; [[1, 2], [3]]</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-844f472358b1fe364228fa0e1d50ca1f">[1, 2, 3].in_groups_of(2, false) # =&gt; [[1, 2], [3]]
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-844f472358b1fe364228fa0e1d50ca1f">Copiar</button>
</div>
<p>As a consequence <code>false</code> can't be used as a padding value.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/array/grouping.rb">active_support/core_ext/array/grouping.rb</a></code>.</p></div><h5 id="in-groups-number-fill-with-nil"><a class="anchorlink" href="#in-groups-number-fill-with-nil">11.7.2 <code>in_groups(number, fill_with = nil)</code></a></h5><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Array.html#method-i-in_groups"><code>in_groups</code></a> splits an array into a certain number of groups. The method returns an array with the groups:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="sx">%w(1 2 3 4 5 6 7)</span><span class="p">.</span><span class="nf">in_groups</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># =&gt; [["1", "2", "3"], ["4", "5", nil], ["6", "7", nil]]</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-d3efa2906e0d127e006a69361b7f76a5">%w(1 2 3 4 5 6 7).in_groups(3)
# =&gt; [["1", "2", "3"], ["4", "5", nil], ["6", "7", nil]]
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d3efa2906e0d127e006a69361b7f76a5">Copiar</button>
</div>
<p>or yields them in turn if a block is passed:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="sx">%w(1 2 3 4 5 6 7)</span><span class="p">.</span><span class="nf">in_groups</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">group</span><span class="o">|</span> <span class="nb">p</span> <span class="n">group</span><span class="p">}</span>
<span class="p">[</span><span class="s2">"1"</span><span class="p">,</span> <span class="s2">"2"</span><span class="p">,</span> <span class="s2">"3"</span><span class="p">]</span>
<span class="p">[</span><span class="s2">"4"</span><span class="p">,</span> <span class="s2">"5"</span><span class="p">,</span> <span class="kp">nil</span><span class="p">]</span>
<span class="p">[</span><span class="s2">"6"</span><span class="p">,</span> <span class="s2">"7"</span><span class="p">,</span> <span class="kp">nil</span><span class="p">]</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-c806aa8dda20557f218f631d173fc286">%w(1 2 3 4 5 6 7).in_groups(3) {|group| p group}
["1", "2", "3"]
["4", "5", nil]
["6", "7", nil]
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-c806aa8dda20557f218f631d173fc286">Copiar</button>
</div>
<p>The examples above show that <code>in_groups</code> fills some groups with a trailing <code>nil</code> element as needed. A group can get at most one of these extra elements, the rightmost one if any. And the groups that have them are always the last ones.</p><p>You can change this padding value using the second optional argument:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="sx">%w(1 2 3 4 5 6 7)</span><span class="p">.</span><span class="nf">in_groups</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"0"</span><span class="p">)</span>
<span class="c1"># =&gt; [["1", "2", "3"], ["4", "5", "0"], ["6", "7", "0"]]</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-7dd92a106980724392fe6e14ebfa016e">%w(1 2 3 4 5 6 7).in_groups(3, "0")
# =&gt; [["1", "2", "3"], ["4", "5", "0"], ["6", "7", "0"]]
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-7dd92a106980724392fe6e14ebfa016e">Copiar</button>
</div>
<p>And you can tell the method not to fill the smaller groups by passing <code>false</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="sx">%w(1 2 3 4 5 6 7)</span><span class="p">.</span><span class="nf">in_groups</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="kp">false</span><span class="p">)</span>
<span class="c1"># =&gt; [["1", "2", "3"], ["4", "5"], ["6", "7"]]</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-52b2a388db3ff29698fe54da0486848b">%w(1 2 3 4 5 6 7).in_groups(3, false)
# =&gt; [["1", "2", "3"], ["4", "5"], ["6", "7"]]
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-52b2a388db3ff29698fe54da0486848b">Copiar</button>
</div>
<p>As a consequence <code>false</code> can't be used as a padding value.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/array/grouping.rb">active_support/core_ext/array/grouping.rb</a></code>.</p></div><h5 id="split-value-nil"><a class="anchorlink" href="#split-value-nil">11.7.3 <code>split(value = nil)</code></a></h5><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Array.html#method-i-split"><code>split</code></a> divides an array by a separator and returns the resulting chunks.</p><p>If a block is passed the separators are those elements of the array for which the block returns true:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="o">..</span><span class="mi">5</span><span class="p">).</span><span class="nf">to_a</span><span class="p">.</span><span class="nf">split</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">i</span><span class="p">.</span><span class="nf">multiple_of?</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">}</span>
<span class="c1"># =&gt; [[-5], [-3, -2, -1], [1, 2, 3], [5]]</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-7bb44e764cf16205d40f0f428a6c80c9">(-5..5).to_a.split { |i| i.multiple_of?(4) }
# =&gt; [[-5], [-3, -2, -1], [1, 2, 3], [5]]
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-7bb44e764cf16205d40f0f428a6c80c9">Copiar</button>
</div>
<p>Otherwise, the value received as argument, which defaults to <code>nil</code>, is the separator:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; [[0], [-5], [], ["foo", "bar"]]</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-089304341069510146c3b2ee759209d2">[0, 1, -5, 1, 1, "foo", "bar"].split(1)
# =&gt; [[0], [-5], [], ["foo", "bar"]]
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-089304341069510146c3b2ee759209d2">Copiar</button>
</div>
<div class="info"><p>Observe in the previous example that consecutive separators result in empty arrays.</p></div><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/array/grouping.rb">active_support/core_ext/array/grouping.rb</a></code>.</p></div><h3 id="extensions-to-hash"><a class="anchorlink" href="#extensions-to-hash">12 Extensions to <code>Hash</code></a></h3><h4 id="extensions-to-hash-conversions"><a class="anchorlink" href="#extensions-to-hash-conversions">12.1 Conversions</a></h4><h5 id="extensions-to-hash-conversions-to-xml"><a class="anchorlink" href="#extensions-to-hash-conversions-to-xml">12.1.1 <code>to_xml</code></a></h5><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-to_xml"><code>to_xml</code></a> returns a string containing an XML representation of its receiver:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="s2">"foo"</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"bar"</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">}.</span><span class="nf">to_xml</span>
<span class="c1"># =&gt;</span>
<span class="c1"># &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="c1"># &lt;hash&gt;</span>
<span class="c1">#   &lt;foo type="integer"&gt;1&lt;/foo&gt;</span>
<span class="c1">#   &lt;bar type="integer"&gt;2&lt;/bar&gt;</span>
<span class="c1"># &lt;/hash&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-3223cce58d5e76c01b51b5483e3a7a91">{"foo" =&gt; 1, "bar" =&gt; 2}.to_xml
# =&gt;
# &lt;?xml version="1.0" encoding="UTF-8"?&gt;
# &lt;hash&gt;
#   &lt;foo type="integer"&gt;1&lt;/foo&gt;
#   &lt;bar type="integer"&gt;2&lt;/bar&gt;
# &lt;/hash&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-3223cce58d5e76c01b51b5483e3a7a91">Copiar</button>
</div>
<p>To do so, the method loops over the pairs and builds nodes that depend on the <em>values</em>. Given a pair <code>key</code>, <code>value</code>:</p>
<ul>
<li><p>If <code>value</code> is a hash there's a recursive call with <code>key</code> as <code>:root</code>.</p></li>
<li><p>If <code>value</code> is an array there's a recursive call with <code>key</code> as <code>:root</code>, and <code>key</code> singularized as <code>:children</code>.</p></li>
<li><p>If <code>value</code> is a callable object it must expect one or two arguments. Depending on the arity, the callable is invoked with the <code>options</code> hash as first argument with <code>key</code> as <code>:root</code>, and <code>key</code> singularized as second argument. Its return value becomes a new node.</p></li>
<li><p>If <code>value</code> responds to <code>to_xml</code> the method is invoked with <code>key</code> as <code>:root</code>.</p></li>
<li><p>Otherwise, a node with <code>key</code> as tag is created with a string representation of <code>value</code> as text node. If <code>value</code> is <code>nil</code> an attribute "nil" set to "true" is added. Unless the option <code>:skip_types</code> exists and is true, an attribute "type" is added as well according to the following mapping:</p></li>
</ul>
<div class="code_container">
<pre><code class="highlight ruby"><span class="no">XML_TYPE_NAMES</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"Symbol"</span>     <span class="o">=&gt;</span> <span class="s2">"symbol"</span><span class="p">,</span>
  <span class="s2">"Integer"</span>    <span class="o">=&gt;</span> <span class="s2">"integer"</span><span class="p">,</span>
  <span class="s2">"BigDecimal"</span> <span class="o">=&gt;</span> <span class="s2">"decimal"</span><span class="p">,</span>
  <span class="s2">"Float"</span>      <span class="o">=&gt;</span> <span class="s2">"float"</span><span class="p">,</span>
  <span class="s2">"TrueClass"</span>  <span class="o">=&gt;</span> <span class="s2">"boolean"</span><span class="p">,</span>
  <span class="s2">"FalseClass"</span> <span class="o">=&gt;</span> <span class="s2">"boolean"</span><span class="p">,</span>
  <span class="s2">"Date"</span>       <span class="o">=&gt;</span> <span class="s2">"date"</span><span class="p">,</span>
  <span class="s2">"DateTime"</span>   <span class="o">=&gt;</span> <span class="s2">"datetime"</span><span class="p">,</span>
  <span class="s2">"Time"</span>       <span class="o">=&gt;</span> <span class="s2">"datetime"</span>
<span class="p">}</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-f1c3eb076f2c627216364f12c037d918">XML_TYPE_NAMES = {
  "Symbol"     =&gt; "symbol",
  "Integer"    =&gt; "integer",
  "BigDecimal" =&gt; "decimal",
  "Float"      =&gt; "float",
  "TrueClass"  =&gt; "boolean",
  "FalseClass" =&gt; "boolean",
  "Date"       =&gt; "date",
  "DateTime"   =&gt; "datetime",
  "Time"       =&gt; "datetime"
}
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-f1c3eb076f2c627216364f12c037d918">Copiar</button>
</div>
<p>By default the root node is "hash", but that's configurable via the <code>:root</code> option.</p><p>The default XML builder is a fresh instance of <code>Builder::XmlMarkup</code>. You can configure your own builder with the <code>:builder</code> option. The method also accepts options like <code>:dasherize</code> and friends, they are forwarded to the builder.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/hash/conversions.rb">active_support/core_ext/hash/conversions.rb</a></code>.</p></div><h4 id="merging"><a class="anchorlink" href="#merging">12.2 Merging</a></h4><p>Ruby has a built-in method <code>Hash#merge</code> that merges two hashes:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">1</span><span class="p">}.</span><span class="nf">merge</span><span class="p">(</span><span class="ss">a: </span><span class="mi">0</span><span class="p">,</span> <span class="ss">c: </span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># =&gt; {:a=&gt;0, :b=&gt;1, :c=&gt;2}</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-f80b0ac32a601ae92eb740a291168d10">{a: 1, b: 1}.merge(a: 0, c: 2)
# =&gt; {:a=&gt;0, :b=&gt;1, :c=&gt;2}
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-f80b0ac32a601ae92eb740a291168d10">Copiar</button>
</div>
<p>Active Support defines a few more ways of merging hashes that may be convenient.</p><h5 id="reverse-merge-and-reverse-merge-bang"><a class="anchorlink" href="#reverse-merge-and-reverse-merge-bang">12.2.1 <code>reverse_merge</code> and <code>reverse_merge!</code></a></h5><p>In case of collision the key in the hash of the argument wins in <code>merge</code>. You can support option hashes with default values in a compact way with this idiom:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="ss">length: </span><span class="mi">30</span><span class="p">,</span> <span class="ss">omission: </span><span class="s2">"..."</span><span class="p">}.</span><span class="nf">merge</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-342997c569438438b8c9f2d41af94752">options = {length: 30, omission: "..."}.merge(options)
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-342997c569438438b8c9f2d41af94752">Copiar</button>
</div>
<p>Active Support defines <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-reverse_merge"><code>reverse_merge</code></a> in case you prefer this alternative notation:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="nf">reverse_merge</span><span class="p">(</span><span class="ss">length: </span><span class="mi">30</span><span class="p">,</span> <span class="ss">omission: </span><span class="s2">"..."</span><span class="p">)</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-8e5e26cd661a07794b69b9c9c99e159f">options = options.reverse_merge(length: 30, omission: "...")
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8e5e26cd661a07794b69b9c9c99e159f">Copiar</button>
</div>
<p>And a bang version <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-reverse_merge-21"><code>reverse_merge!</code></a> that performs the merge in place:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">options</span><span class="p">.</span><span class="nf">reverse_merge!</span><span class="p">(</span><span class="ss">length: </span><span class="mi">30</span><span class="p">,</span> <span class="ss">omission: </span><span class="s2">"..."</span><span class="p">)</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-0724e3ec455ef0642111775ae925cf91">options.reverse_merge!(length: 30, omission: "...")
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-0724e3ec455ef0642111775ae925cf91">Copiar</button>
</div>
<div class="warning"><p>Take into account that <code>reverse_merge!</code> may change the hash in the caller, which may or may not be a good idea.</p></div><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/hash/reverse_merge.rb">active_support/core_ext/hash/reverse_merge.rb</a></code>.</p></div><h5 id="reverse-update"><a class="anchorlink" href="#reverse-update">12.2.2 <code>reverse_update</code></a></h5><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-reverse_update"><code>reverse_update</code></a> is an alias for <code>reverse_merge!</code>, explained above.</p><div class="warning"><p>Note that <code>reverse_update</code> has no bang.</p></div><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/hash/reverse_merge.rb">active_support/core_ext/hash/reverse_merge.rb</a></code>.</p></div><h5 id="deep-merge-and-deep-merge-bang"><a class="anchorlink" href="#deep-merge-and-deep-merge-bang">12.2.3 <code>deep_merge</code> and <code>deep_merge!</code></a></h5><p>As you can see in the previous example if a key is found in both hashes the value in the one in the argument wins.</p><p>Active Support defines <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-deep_merge"><code>Hash#deep_merge</code></a>. In a deep merge, if a key is found in both hashes and their values are hashes in turn, then their <em>merge</em> becomes the value in the resulting hash:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="ss">a: </span><span class="p">{</span><span class="ss">b: </span><span class="mi">1</span><span class="p">}}.</span><span class="nf">deep_merge</span><span class="p">(</span><span class="ss">a: </span><span class="p">{</span><span class="ss">c: </span><span class="mi">2</span><span class="p">})</span>
<span class="c1"># =&gt; {:a=&gt;{:b=&gt;1, :c=&gt;2}}</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-81546ca1f4f4fe21c99eeb147635517b">{a: {b: 1}}.deep_merge(a: {c: 2})
# =&gt; {:a=&gt;{:b=&gt;1, :c=&gt;2}}
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-81546ca1f4f4fe21c99eeb147635517b">Copiar</button>
</div>
<p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-deep_merge-21"><code>deep_merge!</code></a> performs a deep merge in place.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/hash/deep_merge.rb">active_support/core_ext/hash/deep_merge.rb</a></code>.</p></div><h4 id="deep-duplicating"><a class="anchorlink" href="#deep-duplicating">12.3 Deep duplicating</a></h4><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-deep_dup"><code>Hash#deep_dup</code></a> duplicates itself and all keys and values
inside recursively with Active Support method <code>Object#deep_dup</code>. It works like <code>Enumerator#each_with_object</code> with sending <code>deep_dup</code> method to each pair inside.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="p">{</span> <span class="ss">c: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">d: </span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="p">}</span> <span class="p">}</span>

<span class="nb">dup</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">.</span><span class="nf">deep_dup</span>
<span class="nb">dup</span><span class="p">[</span><span class="ss">:b</span><span class="p">][</span><span class="ss">:e</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="nb">dup</span><span class="p">[</span><span class="ss">:b</span><span class="p">][</span><span class="ss">:d</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span>

<span class="nb">hash</span><span class="p">[</span><span class="ss">:b</span><span class="p">][</span><span class="ss">:e</span><span class="p">]</span> <span class="o">==</span> <span class="kp">nil</span>      <span class="c1"># =&gt; true</span>
<span class="nb">hash</span><span class="p">[</span><span class="ss">:b</span><span class="p">][</span><span class="ss">:d</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>   <span class="c1"># =&gt; true</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-7168a348b2d1fb4ffd846d6c5a282f4d">hash = { a: 1, b: { c: 2, d: [3, 4] } }

dup = hash.deep_dup
dup[:b][:e] = 5
dup[:b][:d] &lt;&lt; 5

hash[:b][:e] == nil      # =&gt; true
hash[:b][:d] == [3, 4]   # =&gt; true
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-7168a348b2d1fb4ffd846d6c5a282f4d">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/object/deep_dup.rb">active_support/core_ext/object/deep_dup.rb</a></code>.</p></div><h4 id="working-with-keys"><a class="anchorlink" href="#working-with-keys">12.4 Working with Keys</a></h4><h5 id="except-and-except-bang"><a class="anchorlink" href="#except-and-except-bang">12.4.1 <code>except</code> and <code>except!</code></a></h5><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-except"><code>except</code></a> returns a hash with the keys in the argument list removed, if present:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">}.</span><span class="nf">except</span><span class="p">(</span><span class="ss">:a</span><span class="p">)</span> <span class="c1"># =&gt; {:b=&gt;2}</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-22a1ee4c1f598314c8c4283cc84811e8">{a: 1, b: 2}.except(:a) # =&gt; {:b=&gt;2}
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-22a1ee4c1f598314c8c4283cc84811e8">Copiar</button>
</div>
<p>If the receiver responds to <code>convert_key</code>, the method is called on each of the arguments. This allows <code>except</code> to play nice with hashes with indifferent access for instance:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">}.</span><span class="nf">with_indifferent_access</span><span class="p">.</span><span class="nf">except</span><span class="p">(</span><span class="ss">:a</span><span class="p">)</span>  <span class="c1"># =&gt; {}</span>
<span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">}.</span><span class="nf">with_indifferent_access</span><span class="p">.</span><span class="nf">except</span><span class="p">(</span><span class="s2">"a"</span><span class="p">)</span> <span class="c1"># =&gt; {}</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-c49fb3265a24d57cadeb8cdf38abe2fb">{a: 1}.with_indifferent_access.except(:a)  # =&gt; {}
{a: 1}.with_indifferent_access.except("a") # =&gt; {}
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-c49fb3265a24d57cadeb8cdf38abe2fb">Copiar</button>
</div>
<p>There's also the bang variant <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-except-21"><code>except!</code></a> that removes keys in place.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/hash/except.rb">active_support/core_ext/hash/except.rb</a></code>.</p></div><h5 id="stringify-keys-and-stringify-keys-bang"><a class="anchorlink" href="#stringify-keys-and-stringify-keys-bang">12.4.2 <code>stringify_keys</code> and <code>stringify_keys!</code></a></h5><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-stringify_keys"><code>stringify_keys</code></a> returns a hash that has a stringified version of the keys in the receiver. It does so by sending <code>to_s</code> to them:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="kp">nil</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">,</span> <span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">a: :a</span><span class="p">}.</span><span class="nf">stringify_keys</span>
<span class="c1"># =&gt; {"" =&gt; nil, "1" =&gt; 1, "a" =&gt; :a}</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-cf1b950d357ea8aa0ad0bacc1208fb7a">{nil =&gt; nil, 1 =&gt; 1, a: :a}.stringify_keys
# =&gt; {"" =&gt; nil, "1" =&gt; 1, "a" =&gt; :a}
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-cf1b950d357ea8aa0ad0bacc1208fb7a">Copiar</button>
</div>
<p>In case of key collision, the value will be the one most recently inserted into the hash:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="s2">"a"</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">a: </span><span class="mi">2</span><span class="p">}.</span><span class="nf">stringify_keys</span>
<span class="c1"># The result will be</span>
<span class="c1"># =&gt; {"a"=&gt;2}</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-e670885e8bcae048d3a06a0be279e8d1">{"a" =&gt; 1, a: 2}.stringify_keys
# The result will be
# =&gt; {"a"=&gt;2}
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-e670885e8bcae048d3a06a0be279e8d1">Copiar</button>
</div>
<p>This method may be useful for example to easily accept both symbols and strings as options. For instance <code>ActionView::Helpers::FormHelper</code> defines:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">to_check_box_tag</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">checked_value</span> <span class="o">=</span> <span class="s2">"1"</span><span class="p">,</span> <span class="n">unchecked_value</span> <span class="o">=</span> <span class="s2">"0"</span><span class="p">)</span>
  <span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="nf">stringify_keys</span>
  <span class="n">options</span><span class="p">[</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"checkbox"</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-c20cc8b252e3d5eab296b2f961f667fb">def to_check_box_tag(options = {}, checked_value = "1", unchecked_value = "0")
  options = options.stringify_keys
  options["type"] = "checkbox"
  # ...
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-c20cc8b252e3d5eab296b2f961f667fb">Copiar</button>
</div>
<p>The second line can safely access the "type" key, and let the user to pass either <code>:type</code> or "type".</p><p>There's also the bang variant <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-stringify_keys-21"><code>stringify_keys!</code></a> that stringifies keys in place.</p><p>Besides that, one can use <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-deep_stringify_keys"><code>deep_stringify_keys</code></a> and <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-deep_stringify_keys-21"><code>deep_stringify_keys!</code></a> to stringify all the keys in the given hash and all the hashes nested in it. An example of the result is:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="kp">nil</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">,</span> <span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">nested: </span><span class="p">{</span><span class="ss">a: </span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">}}.</span><span class="nf">deep_stringify_keys</span>
<span class="c1"># =&gt; {""=&gt;nil, "1"=&gt;1, "nested"=&gt;{"a"=&gt;3, "5"=&gt;5}}</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-ea1cf61760ffe7c2c627855fb7bc80bf">{nil =&gt; nil, 1 =&gt; 1, nested: {a: 3, 5 =&gt; 5}}.deep_stringify_keys
# =&gt; {""=&gt;nil, "1"=&gt;1, "nested"=&gt;{"a"=&gt;3, "5"=&gt;5}}
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-ea1cf61760ffe7c2c627855fb7bc80bf">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/hash/keys.rb">active_support/core_ext/hash/keys.rb</a></code>.</p></div><h5 id="symbolize-keys-and-symbolize-keys-bang"><a class="anchorlink" href="#symbolize-keys-and-symbolize-keys-bang">12.4.3 <code>symbolize_keys</code> and <code>symbolize_keys!</code></a></h5><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-symbolize_keys"><code>symbolize_keys</code></a> returns a hash that has a symbolized version of the keys in the receiver, where possible. It does so by sending <code>to_sym</code> to them:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="kp">nil</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">,</span> <span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"a"</span> <span class="o">=&gt;</span> <span class="s2">"a"</span><span class="p">}.</span><span class="nf">symbolize_keys</span>
<span class="c1"># =&gt; {nil=&gt;nil, 1=&gt;1, :a=&gt;"a"}</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-7803f614c574907d024addafe5d42f21">{nil =&gt; nil, 1 =&gt; 1, "a" =&gt; "a"}.symbolize_keys
# =&gt; {nil=&gt;nil, 1=&gt;1, :a=&gt;"a"}
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-7803f614c574907d024addafe5d42f21">Copiar</button>
</div>
<div class="warning"><p>Note in the previous example only one key was symbolized.</p></div><p>In case of key collision, the value will be the one most recently inserted into the hash:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="s2">"a"</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">a: </span><span class="mi">2</span><span class="p">}.</span><span class="nf">symbolize_keys</span>
<span class="c1"># =&gt; {:a=&gt;2}</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-9cd8a8e81a3efde9e5d35bdf60ee4659">{"a" =&gt; 1, a: 2}.symbolize_keys
# =&gt; {:a=&gt;2}
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-9cd8a8e81a3efde9e5d35bdf60ee4659">Copiar</button>
</div>
<p>This method may be useful for example to easily accept both symbols and strings as options. For instance <code>ActionText::TagHelper</code> defines</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">rich_text_area_tag</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="p">{})</span>
  <span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="nf">symbolize_keys</span>

  <span class="n">options</span><span class="p">[</span><span class="ss">:input</span><span class="p">]</span> <span class="o">||=</span> <span class="s2">"trix_input_</span><span class="si">#{</span><span class="no">ActionText</span><span class="o">::</span><span class="no">TagHelper</span><span class="p">.</span><span class="nf">id</span> <span class="o">+=</span> <span class="mi">1</span><span class="si">}</span><span class="s2">"</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-c7e7b0bfbc24012b323b30c8d9e30c81">def rich_text_area_tag(name, value = nil, options = {})
  options = options.symbolize_keys

  options[:input] ||= "trix_input_#{ActionText::TagHelper.id += 1}"
  # ...
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-c7e7b0bfbc24012b323b30c8d9e30c81">Copiar</button>
</div>
<p>The third line can safely access the <code>:input</code> key, and let the user to pass either <code>:input</code> or "input".</p><p>There's also the bang variant <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-symbolize_keys-21"><code>symbolize_keys!</code></a> that symbolizes keys in place.</p><p>Besides that, one can use <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-deep_symbolize_keys"><code>deep_symbolize_keys</code></a> and <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-deep_symbolize_keys-21"><code>deep_symbolize_keys!</code></a> to symbolize all the keys in the given hash and all the hashes nested in it. An example of the result is:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="kp">nil</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">,</span> <span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"nested"</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="s2">"a"</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">}}.</span><span class="nf">deep_symbolize_keys</span>
<span class="c1"># =&gt; {nil=&gt;nil, 1=&gt;1, nested:{a:3, 5=&gt;5}}</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-273187917bffc190439ca7a25f50e62b">{nil =&gt; nil, 1 =&gt; 1, "nested" =&gt; {"a" =&gt; 3, 5 =&gt; 5}}.deep_symbolize_keys
# =&gt; {nil=&gt;nil, 1=&gt;1, nested:{a:3, 5=&gt;5}}
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-273187917bffc190439ca7a25f50e62b">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/hash/keys.rb">active_support/core_ext/hash/keys.rb</a></code>.</p></div><h5 id="to-options-and-to-options-bang"><a class="anchorlink" href="#to-options-and-to-options-bang">12.4.4 <code>to_options</code> and <code>to_options!</code></a></h5><p>The methods <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-to_options"><code>to_options</code></a> and <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-to_options-21"><code>to_options!</code></a> are aliases of <code>symbolize_keys</code> and <code>symbolize_keys!</code>, respectively.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/hash/keys.rb">active_support/core_ext/hash/keys.rb</a></code>.</p></div><h5 id="assert-valid-keys"><a class="anchorlink" href="#assert-valid-keys">12.4.5 <code>assert_valid_keys</code></a></h5><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-assert_valid_keys"><code>assert_valid_keys</code></a> receives an arbitrary number of arguments, and checks whether the receiver has any key outside that list. If it does <code>ArgumentError</code> is raised.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">}.</span><span class="nf">assert_valid_keys</span><span class="p">(</span><span class="ss">:a</span><span class="p">)</span>  <span class="c1"># passes</span>
<span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">}.</span><span class="nf">assert_valid_keys</span><span class="p">(</span><span class="s2">"a"</span><span class="p">)</span> <span class="c1"># ArgumentError</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-5ffa6a0b48b959bc3b52cf61627ec7ee">{a: 1}.assert_valid_keys(:a)  # passes
{a: 1}.assert_valid_keys("a") # ArgumentError
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-5ffa6a0b48b959bc3b52cf61627ec7ee">Copiar</button>
</div>
<p>Active Record does not accept unknown options when building associations, for example. It implements that control via <code>assert_valid_keys</code>.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/hash/keys.rb">active_support/core_ext/hash/keys.rb</a></code>.</p></div><h4 id="working-with-values"><a class="anchorlink" href="#working-with-values">12.5 Working with Values</a></h4><h5 id="deep-transform-values-and-deep-transform-values-bang"><a class="anchorlink" href="#deep-transform-values-and-deep-transform-values-bang">12.5.1 <code>deep_transform_values</code> and <code>deep_transform_values!</code></a></h5><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-deep_transform_values"><code>deep_transform_values</code></a> returns a new hash with all values converted by the block operation. This includes the values from the root hash and from all nested hashes and arrays.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">person: </span><span class="p">{</span> <span class="ss">name: </span><span class="s1">'Rob'</span><span class="p">,</span> <span class="ss">age: </span><span class="s1">'28'</span> <span class="p">}</span> <span class="p">}</span>

<span class="nb">hash</span><span class="p">.</span><span class="nf">deep_transform_values</span><span class="p">{</span> <span class="o">|</span><span class="n">value</span><span class="o">|</span> <span class="n">value</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">upcase</span> <span class="p">}</span>
<span class="c1"># =&gt; {person: {name: "ROB", age: "28"}}</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-2224fcb27af2e45f218e9716d8d3ea51">hash = { person: { name: 'Rob', age: '28' } }

hash.deep_transform_values{ |value| value.to_s.upcase }
# =&gt; {person: {name: "ROB", age: "28"}}
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2224fcb27af2e45f218e9716d8d3ea51">Copiar</button>
</div>
<p>There's also the bang variant <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-deep_transform_values-21"><code>deep_transform_values!</code></a> that destructively converts all values by using the block operation.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/hash/deep_transform_values.rb">active_support/core_ext/hash/deep_transform_values.rb</a></code>.</p></div><h4 id="slicing"><a class="anchorlink" href="#slicing">12.6 Slicing</a></h4><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-slice-21"><code>slice!</code></a> replaces the hash with only the given keys and returns a hash containing the removed key/value pairs.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">}</span>
<span class="n">rest</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">.</span><span class="nf">slice!</span><span class="p">(</span><span class="ss">:a</span><span class="p">)</span> <span class="c1"># =&gt; {:b=&gt;2}</span>
<span class="nb">hash</span>                   <span class="c1"># =&gt; {:a=&gt;1}</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-d6614d11c261f4fb6d23d29c9a603bac">hash = {a: 1, b: 2}
rest = hash.slice!(:a) # =&gt; {:b=&gt;2}
hash                   # =&gt; {:a=&gt;1}
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d6614d11c261f4fb6d23d29c9a603bac">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/hash/slice.rb">active_support/core_ext/hash/slice.rb</a></code>.</p></div><h4 id="extensions-to-hash-extracting"><a class="anchorlink" href="#extensions-to-hash-extracting">12.7 Extracting</a></h4><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-extract-21"><code>extract!</code></a> removes and returns the key/value pairs matching the given keys.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">}</span>
<span class="n">rest</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">.</span><span class="nf">extract!</span><span class="p">(</span><span class="ss">:a</span><span class="p">)</span> <span class="c1"># =&gt; {:a=&gt;1}</span>
<span class="nb">hash</span>                     <span class="c1"># =&gt; {:b=&gt;2}</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-352e562e27af9f5d5171c0879780983f">hash = {a: 1, b: 2}
rest = hash.extract!(:a) # =&gt; {:a=&gt;1}
hash                     # =&gt; {:b=&gt;2}
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-352e562e27af9f5d5171c0879780983f">Copiar</button>
</div>
<p>The method <code>extract!</code> returns the same subclass of Hash that the receiver is.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">}.</span><span class="nf">with_indifferent_access</span>
<span class="n">rest</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">.</span><span class="nf">extract!</span><span class="p">(</span><span class="ss">:a</span><span class="p">).</span><span class="nf">class</span>
<span class="c1"># =&gt; ActiveSupport::HashWithIndifferentAccess</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-50d6fda16cc29d9f1b195fa5efc62bb5">hash = {a: 1, b: 2}.with_indifferent_access
rest = hash.extract!(:a).class
# =&gt; ActiveSupport::HashWithIndifferentAccess
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-50d6fda16cc29d9f1b195fa5efc62bb5">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/hash/slice.rb">active_support/core_ext/hash/slice.rb</a></code>.</p></div><h4 id="indifferent-access"><a class="anchorlink" href="#indifferent-access">12.8 Indifferent Access</a></h4><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Hash.html#method-i-with_indifferent_access"><code>with_indifferent_access</code></a> returns an <a href="https://api.rubyonrails.org/v6.1.4/classes/ActiveSupport/HashWithIndifferentAccess.html"><code>ActiveSupport::HashWithIndifferentAccess</code></a> out of its receiver:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">}.</span><span class="nf">with_indifferent_access</span><span class="p">[</span><span class="s2">"a"</span><span class="p">]</span> <span class="c1"># =&gt; 1</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-572078cd5c4b7dfcfa8a03674cafe6bf">{a: 1}.with_indifferent_access["a"] # =&gt; 1
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-572078cd5c4b7dfcfa8a03674cafe6bf">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/hash/indifferent_access.rb">active_support/core_ext/hash/indifferent_access.rb</a></code>.</p></div><h3 id="extensions-to-regexp"><a class="anchorlink" href="#extensions-to-regexp">13 Extensions to <code>Regexp</code></a></h3><h4 id="multiline-questionmark"><a class="anchorlink" href="#multiline-questionmark">13.1 <code>multiline?</code></a></h4><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Regexp.html#method-i-multiline-3F"><code>multiline?</code></a> says whether a regexp has the <code>/m</code> flag set, that is, whether the dot matches newlines.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="sr">%r{.}</span><span class="p">.</span><span class="nf">multiline?</span>  <span class="c1"># =&gt; false</span>
<span class="sr">%r{.}m</span><span class="p">.</span><span class="nf">multiline?</span> <span class="c1"># =&gt; true</span>

<span class="no">Regexp</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'.'</span><span class="p">).</span><span class="nf">multiline?</span>                    <span class="c1"># =&gt; false</span>
<span class="no">Regexp</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span> <span class="no">Regexp</span><span class="o">::</span><span class="no">MULTILINE</span><span class="p">).</span><span class="nf">multiline?</span> <span class="c1"># =&gt; true</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-1a98027e7af1c0abff98d773d0209ad3">%r{.}.multiline?  # =&gt; false
%r{.}m.multiline? # =&gt; true

Regexp.new('.').multiline?                    # =&gt; false
Regexp.new('.', Regexp::MULTILINE).multiline? # =&gt; true
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-1a98027e7af1c0abff98d773d0209ad3">Copiar</button>
</div>
<p>Rails uses this method in a single place, also in the routing code. Multiline regexps are disallowed for route requirements and this flag eases enforcing that constraint.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">verify_regexp_requirements</span><span class="p">(</span><span class="n">requirements</span><span class="p">)</span>
  <span class="c1"># ...</span>
  <span class="k">if</span> <span class="n">requirement</span><span class="p">.</span><span class="nf">multiline?</span>
    <span class="k">raise</span> <span class="no">ArgumentError</span><span class="p">,</span> <span class="s2">"Regexp multiline option is not allowed in routing requirements: </span><span class="si">#{</span><span class="n">requirement</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-0f97c78be49c4aa9a1ad1f89d284ecc0">def verify_regexp_requirements(requirements)
  # ...
  if requirement.multiline?
    raise ArgumentError, "Regexp multiline option is not allowed in routing requirements: #{requirement.inspect}"
  end
  # ...
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-0f97c78be49c4aa9a1ad1f89d284ecc0">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/regexp.rb">active_support/core_ext/regexp.rb</a></code>.</p></div><h3 id="extensions-to-range"><a class="anchorlink" href="#extensions-to-range">14 Extensions to <code>Range</code></a></h3><h4 id="extensions-to-range-to-s"><a class="anchorlink" href="#extensions-to-range-to-s">14.1 <code>to_s</code></a></h4><p>Active Support extends the method <code>Range#to_s</code> so that it understands an optional format argument. As of this writing the only supported non-default format is <code>:db</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">(</span><span class="no">Date</span><span class="p">.</span><span class="nf">today</span><span class="o">..</span><span class="no">Date</span><span class="p">.</span><span class="nf">tomorrow</span><span class="p">).</span><span class="nf">to_s</span>
<span class="c1"># =&gt; "2009-10-25..2009-10-26"</span>

<span class="p">(</span><span class="no">Date</span><span class="p">.</span><span class="nf">today</span><span class="o">..</span><span class="no">Date</span><span class="p">.</span><span class="nf">tomorrow</span><span class="p">).</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:db</span><span class="p">)</span>
<span class="c1"># =&gt; "BETWEEN '2009-10-25' AND '2009-10-26'"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-43214f20ee8e96d0d43924342fb440df">(Date.today..Date.tomorrow).to_s
# =&gt; "2009-10-25..2009-10-26"

(Date.today..Date.tomorrow).to_s(:db)
# =&gt; "BETWEEN '2009-10-25' AND '2009-10-26'"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-43214f20ee8e96d0d43924342fb440df">Copiar</button>
</div>
<p>As the example depicts, the <code>:db</code> format generates a <code>BETWEEN</code> SQL clause. That is used by Active Record in its support for range values in conditions.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/range/conversions.rb">active_support/core_ext/range/conversions.rb</a></code>.</p></div><h4 id="include-questionmark-and-cover-questionmark"><a class="anchorlink" href="#include-questionmark-and-cover-questionmark">14.2 <code>===</code>, <code>include?</code>, and <code>cover?</code></a></h4><p>The methods <code>Range#===</code>, <code>Range#include?</code>, and <code>Range#cover?</code> say whether some value falls between the ends of a given instance:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">(</span><span class="mi">2</span><span class="o">..</span><span class="mi">3</span><span class="p">).</span><span class="nf">include?</span><span class="p">(</span><span class="no">Math</span><span class="o">::</span><span class="no">E</span><span class="p">)</span> <span class="c1"># =&gt; true</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-f0ade5cd08b622f67c2227cfa221db7a">(2..3).include?(Math::E) # =&gt; true
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-f0ade5cd08b622f67c2227cfa221db7a">Copiar</button>
</div>
<p>Active Support extends these methods so that the argument may be another range in turn. In that case we test whether the ends of the argument range belong to the receiver themselves:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">)</span> <span class="o">===</span> <span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># =&gt; true</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">)</span> <span class="o">===</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># =&gt; false</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">)</span> <span class="o">===</span> <span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">11</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
<span class="p">(</span><span class="mi">1</span><span class="o">...</span><span class="mi">9</span><span class="p">)</span> <span class="o">===</span> <span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">9</span><span class="p">)</span>  <span class="c1"># =&gt; false</span>

<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">include?</span><span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># =&gt; true</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">include?</span><span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># =&gt; false</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">include?</span><span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">11</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
<span class="p">(</span><span class="mi">1</span><span class="o">...</span><span class="mi">9</span><span class="p">).</span><span class="nf">include?</span><span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">9</span><span class="p">)</span>  <span class="c1"># =&gt; false</span>

<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">cover?</span><span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># =&gt; true</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">cover?</span><span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># =&gt; false</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">cover?</span><span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">11</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
<span class="p">(</span><span class="mi">1</span><span class="o">...</span><span class="mi">9</span><span class="p">).</span><span class="nf">cover?</span><span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">9</span><span class="p">)</span>  <span class="c1"># =&gt; false</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-24ae372fad568b27d0b8e641fb769035">(1..10) === (3..7)  # =&gt; true
(1..10) === (0..7)  # =&gt; false
(1..10) === (3..11) # =&gt; false
(1...9) === (3..9)  # =&gt; false

(1..10).include?(3..7)  # =&gt; true
(1..10).include?(0..7)  # =&gt; false
(1..10).include?(3..11) # =&gt; false
(1...9).include?(3..9)  # =&gt; false

(1..10).cover?(3..7)  # =&gt; true
(1..10).cover?(0..7)  # =&gt; false
(1..10).cover?(3..11) # =&gt; false
(1...9).cover?(3..9)  # =&gt; false
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-24ae372fad568b27d0b8e641fb769035">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/range/compare_range.rb">active_support/core_ext/range/compare_range.rb</a></code>.</p></div><h4 id="overlaps-questionmark"><a class="anchorlink" href="#overlaps-questionmark">14.3 <code>overlaps?</code></a></h4><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Range.html#method-i-overlaps-3F"><code>Range#overlaps?</code></a> says whether any two given ranges have non-void intersection:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">overlaps?</span><span class="p">(</span><span class="mi">7</span><span class="o">..</span><span class="mi">11</span><span class="p">)</span>  <span class="c1"># =&gt; true</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">overlaps?</span><span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">7</span><span class="p">)</span>   <span class="c1"># =&gt; true</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">overlaps?</span><span class="p">(</span><span class="mi">11</span><span class="o">..</span><span class="mi">27</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-762bc3fdccdd3be8c1d058a3042cc1db">(1..10).overlaps?(7..11)  # =&gt; true
(1..10).overlaps?(0..7)   # =&gt; true
(1..10).overlaps?(11..27) # =&gt; false
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-762bc3fdccdd3be8c1d058a3042cc1db">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/range/overlaps.rb">active_support/core_ext/range/overlaps.rb</a></code>.</p></div><h3 id="extensions-to-date"><a class="anchorlink" href="#extensions-to-date">15 Extensions to <code>Date</code></a></h3><h4 id="extensions-to-date-calculations"><a class="anchorlink" href="#extensions-to-date-calculations">15.1 Calculations</a></h4><div class="info"><p>The following calculation methods have edge cases in October 1582, since days 5..14 just do not exist. This guide does not document their behavior around those days for brevity, but it is enough to say that they do what you would expect. That is, <code>Date.new(1582, 10, 4).tomorrow</code> returns <code>Date.new(1582, 10, 15)</code> and so on. Please check <code>test/core_ext/date_ext_test.rb</code> in the Active Support test suite for expected behavior.</p></div><h5 id="date-current"><a class="anchorlink" href="#date-current">15.1.1 <code>Date.current</code></a></h5><p>Active Support defines <a href="https://api.rubyonrails.org/v6.1.4/classes/Date.html#method-c-current"><code>Date.current</code></a> to be today in the current time zone. That's like <code>Date.today</code>, except that it honors the user time zone, if defined. It also defines <a href="https://api.rubyonrails.org/v6.1.4/classes/Date.html#method-c-yesterday"><code>Date.yesterday</code></a> and <a href="https://api.rubyonrails.org/v6.1.4/classes/Date.html#method-c-tomorrow"><code>Date.tomorrow</code></a>, and the instance predicates <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-past-3F"><code>past?</code></a>, <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-today-3F"><code>today?</code></a>, <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-tomorrow-3F"><code>tomorrow?</code></a>, <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-next_day-3F"><code>next_day?</code></a>, <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-yesterday-3F"><code>yesterday?</code></a>, <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-prev_day-3F"><code>prev_day?</code></a>, <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-future-3F"><code>future?</code></a>, <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-on_weekday-3F"><code>on_weekday?</code></a> and <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-on_weekend-3F"><code>on_weekend?</code></a>, all of them relative to <code>Date.current</code>.</p><p>When making Date comparisons using methods which honor the user time zone, make sure to use <code>Date.current</code> and not <code>Date.today</code>. There are cases where the user time zone might be in the future compared to the system time zone, which <code>Date.today</code> uses by default. This means <code>Date.today</code> may equal <code>Date.yesterday</code>.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/date/calculations.rb">active_support/core_ext/date/calculations.rb</a></code>.</p></div><h5 id="named-dates"><a class="anchorlink" href="#named-dates">15.1.2 Named dates</a></h5><h6 id="beginning-of-week-end-of-week"><a class="anchorlink" href="#beginning-of-week-end-of-week">15.1.2.1 <code>beginning_of_week</code>, <code>end_of_week</code></a></h6><p>The methods <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-beginning_of_week"><code>beginning_of_week</code></a> and <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-end_of_week"><code>end_of_week</code></a> return the dates for the
beginning and end of the week, respectively. Weeks are assumed to start on
Monday, but that can be changed passing an argument, setting thread local
<code>Date.beginning_of_week</code> or <code>config.beginning_of_week</code>.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>     <span class="c1"># =&gt; Sat, 08 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">beginning_of_week</span>          <span class="c1"># =&gt; Mon, 03 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">beginning_of_week</span><span class="p">(</span><span class="ss">:sunday</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 02 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">end_of_week</span>                <span class="c1"># =&gt; Sun, 09 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">end_of_week</span><span class="p">(</span><span class="ss">:sunday</span><span class="p">)</span>       <span class="c1"># =&gt; Sat, 08 May 2010</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-92d984300b7e9c6f2d44b9efd4f19822">d = Date.new(2010, 5, 8)     # =&gt; Sat, 08 May 2010
d.beginning_of_week          # =&gt; Mon, 03 May 2010
d.beginning_of_week(:sunday) # =&gt; Sun, 02 May 2010
d.end_of_week                # =&gt; Sun, 09 May 2010
d.end_of_week(:sunday)       # =&gt; Sat, 08 May 2010
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-92d984300b7e9c6f2d44b9efd4f19822">Copiar</button>
</div>
<p><code>beginning_of_week</code> is aliased to <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-at_beginning_of_week"><code>at_beginning_of_week</code></a> and <code>end_of_week</code> is aliased to <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-at_end_of_week"><code>at_end_of_week</code></a>.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/date_and_time/calculations.rb">active_support/core_ext/date_and_time/calculations.rb</a></code>.</p></div><h6 id="monday-sunday"><a class="anchorlink" href="#monday-sunday">15.1.2.2 <code>monday</code>, <code>sunday</code></a></h6><p>The methods <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-monday"><code>monday</code></a> and <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-sunday"><code>sunday</code></a> return the dates for the previous Monday and
next Sunday, respectively.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>     <span class="c1"># =&gt; Sat, 08 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">monday</span>                     <span class="c1"># =&gt; Mon, 03 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">sunday</span>                     <span class="c1"># =&gt; Sun, 09 May 2010</span>

<span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>    <span class="c1"># =&gt; Mon, 10 Sep 2012</span>
<span class="n">d</span><span class="p">.</span><span class="nf">monday</span>                     <span class="c1"># =&gt; Mon, 10 Sep 2012</span>

<span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>    <span class="c1"># =&gt; Sun, 16 Sep 2012</span>
<span class="n">d</span><span class="p">.</span><span class="nf">sunday</span>                     <span class="c1"># =&gt; Sun, 16 Sep 2012</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-c48721e04b4f82b65acb733196ef30b4">d = Date.new(2010, 5, 8)     # =&gt; Sat, 08 May 2010
d.monday                     # =&gt; Mon, 03 May 2010
d.sunday                     # =&gt; Sun, 09 May 2010

d = Date.new(2012, 9, 10)    # =&gt; Mon, 10 Sep 2012
d.monday                     # =&gt; Mon, 10 Sep 2012

d = Date.new(2012, 9, 16)    # =&gt; Sun, 16 Sep 2012
d.sunday                     # =&gt; Sun, 16 Sep 2012
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-c48721e04b4f82b65acb733196ef30b4">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/date_and_time/calculations.rb">active_support/core_ext/date_and_time/calculations.rb</a></code>.</p></div><h6 id="prev-week-next-week"><a class="anchorlink" href="#prev-week-next-week">15.1.2.3 <code>prev_week</code>, <code>next_week</code></a></h6><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-next_week"><code>next_week</code></a> receives a symbol with a day name in English (default is the thread local <a href="https://api.rubyonrails.org/v6.1.4/classes/Date.html#method-c-beginning_of_week"><code>Date.beginning_of_week</code></a>, or <code>config.beginning_of_week</code>, or <code>:monday</code>) and it returns the date corresponding to that day.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 09 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">next_week</span>              <span class="c1"># =&gt; Mon, 10 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">next_week</span><span class="p">(</span><span class="ss">:saturday</span><span class="p">)</span>   <span class="c1"># =&gt; Sat, 15 May 2010</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-981b7b002d7e446ef89187d879688045">d = Date.new(2010, 5, 9) # =&gt; Sun, 09 May 2010
d.next_week              # =&gt; Mon, 10 May 2010
d.next_week(:saturday)   # =&gt; Sat, 15 May 2010
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-981b7b002d7e446ef89187d879688045">Copiar</button>
</div>
<p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-prev_week"><code>prev_week</code></a> is analogous:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">d</span><span class="p">.</span><span class="nf">prev_week</span>              <span class="c1"># =&gt; Mon, 26 Apr 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">prev_week</span><span class="p">(</span><span class="ss">:saturday</span><span class="p">)</span>   <span class="c1"># =&gt; Sat, 01 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">prev_week</span><span class="p">(</span><span class="ss">:friday</span><span class="p">)</span>     <span class="c1"># =&gt; Fri, 30 Apr 2010</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-a6d1900d383b24af74b2ab998c85259d">d.prev_week              # =&gt; Mon, 26 Apr 2010
d.prev_week(:saturday)   # =&gt; Sat, 01 May 2010
d.prev_week(:friday)     # =&gt; Fri, 30 Apr 2010
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-a6d1900d383b24af74b2ab998c85259d">Copiar</button>
</div>
<p><code>prev_week</code> is aliased to <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-last_week"><code>last_week</code></a>.</p><p>Both <code>next_week</code> and <code>prev_week</code> work as expected when <code>Date.beginning_of_week</code> or <code>config.beginning_of_week</code> are set.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/date_and_time/calculations.rb">active_support/core_ext/date_and_time/calculations.rb</a></code>.</p></div><h6 id="beginning-of-month-end-of-month"><a class="anchorlink" href="#beginning-of-month-end-of-month">15.1.2.4 <code>beginning_of_month</code>, <code>end_of_month</code></a></h6><p>The methods <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-beginning_of_month"><code>beginning_of_month</code></a> and <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-end_of_month"><code>end_of_month</code></a> return the dates for the beginning and end of the month:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 09 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">beginning_of_month</span>     <span class="c1"># =&gt; Sat, 01 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">end_of_month</span>           <span class="c1"># =&gt; Mon, 31 May 2010</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-dc1f0af1b218971d248605fc40923538">d = Date.new(2010, 5, 9) # =&gt; Sun, 09 May 2010
d.beginning_of_month     # =&gt; Sat, 01 May 2010
d.end_of_month           # =&gt; Mon, 31 May 2010
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-dc1f0af1b218971d248605fc40923538">Copiar</button>
</div>
<p><code>beginning_of_month</code> is aliased to <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-at_beginning_of_month"><code>at_beginning_of_month</code></a>, and <code>end_of_month</code> is aliased to <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-at_end_of_month"><code>at_end_of_month</code></a>.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/date_and_time/calculations.rb">active_support/core_ext/date_and_time/calculations.rb</a></code>.</p></div><h6 id="beginning-of-quarter-end-of-quarter"><a class="anchorlink" href="#beginning-of-quarter-end-of-quarter">15.1.2.5 <code>beginning_of_quarter</code>, <code>end_of_quarter</code></a></h6><p>The methods <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-beginning_of_quarter"><code>beginning_of_quarter</code></a> and <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-end_of_quarter"><code>end_of_quarter</code></a> return the dates for the beginning and end of the quarter of the receiver's calendar year:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 09 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">beginning_of_quarter</span>   <span class="c1"># =&gt; Thu, 01 Apr 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">end_of_quarter</span>         <span class="c1"># =&gt; Wed, 30 Jun 2010</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-eb31ee593988929ffd763783b195984b">d = Date.new(2010, 5, 9) # =&gt; Sun, 09 May 2010
d.beginning_of_quarter   # =&gt; Thu, 01 Apr 2010
d.end_of_quarter         # =&gt; Wed, 30 Jun 2010
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-eb31ee593988929ffd763783b195984b">Copiar</button>
</div>
<p><code>beginning_of_quarter</code> is aliased to <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-at_beginning_of_quarter"><code>at_beginning_of_quarter</code></a>, and <code>end_of_quarter</code> is aliased to <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-at_end_of_quarter"><code>at_end_of_quarter</code></a>.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/date_and_time/calculations.rb">active_support/core_ext/date_and_time/calculations.rb</a></code>.</p></div><h6 id="beginning-of-year-end-of-year"><a class="anchorlink" href="#beginning-of-year-end-of-year">15.1.2.6 <code>beginning_of_year</code>, <code>end_of_year</code></a></h6><p>The methods <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-beginning_of_year"><code>beginning_of_year</code></a> and <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-end_of_year"><code>end_of_year</code></a> return the dates for the beginning and end of the year:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 09 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">beginning_of_year</span>      <span class="c1"># =&gt; Fri, 01 Jan 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">end_of_year</span>            <span class="c1"># =&gt; Fri, 31 Dec 2010</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-1c7fd3bfaa80970707a9285ac036009a">d = Date.new(2010, 5, 9) # =&gt; Sun, 09 May 2010
d.beginning_of_year      # =&gt; Fri, 01 Jan 2010
d.end_of_year            # =&gt; Fri, 31 Dec 2010
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-1c7fd3bfaa80970707a9285ac036009a">Copiar</button>
</div>
<p><code>beginning_of_year</code> is aliased to <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-at_beginning_of_year"><code>at_beginning_of_year</code></a>, and <code>end_of_year</code> is aliased to <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-at_end_of_year"><code>at_end_of_year</code></a>.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/date_and_time/calculations.rb">active_support/core_ext/date_and_time/calculations.rb</a></code>.</p></div><h5 id="other-date-computations"><a class="anchorlink" href="#other-date-computations">15.1.3 Other Date Computations</a></h5><h6 id="years-ago-years-since"><a class="anchorlink" href="#years-ago-years-since">15.1.3.1 <code>years_ago</code>, <code>years_since</code></a></h6><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-years_ago"><code>years_ago</code></a> receives a number of years and returns the same date those many years ago:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">years_ago</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># =&gt; Wed, 07 Jun 2000</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-0342dde49e3e7d6485c782ddc13ae66b">date = Date.new(2010, 6, 7)
date.years_ago(10) # =&gt; Wed, 07 Jun 2000
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-0342dde49e3e7d6485c782ddc13ae66b">Copiar</button>
</div>
<p><a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-years_since"><code>years_since</code></a> moves forward in time:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">years_since</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 07 Jun 2020</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-7a40c7ea21e36d2775a0b8e5b1f5b8c2">date = Date.new(2010, 6, 7)
date.years_since(10) # =&gt; Sun, 07 Jun 2020
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-7a40c7ea21e36d2775a0b8e5b1f5b8c2">Copiar</button>
</div>
<p>If such a day does not exist, the last day of the corresponding month is returned:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">29</span><span class="p">).</span><span class="nf">years_ago</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>     <span class="c1"># =&gt; Sat, 28 Feb 2009</span>
<span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">29</span><span class="p">).</span><span class="nf">years_since</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>   <span class="c1"># =&gt; Sat, 28 Feb 2015</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-e209b44a23b73e791cb7579edf6fcbb3">Date.new(2012, 2, 29).years_ago(3)     # =&gt; Sat, 28 Feb 2009
Date.new(2012, 2, 29).years_since(3)   # =&gt; Sat, 28 Feb 2015
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-e209b44a23b73e791cb7579edf6fcbb3">Copiar</button>
</div>
<p><a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-last_year"><code>last_year</code></a> is short-hand for <code>#years_ago(1)</code>.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/date_and_time/calculations.rb">active_support/core_ext/date_and_time/calculations.rb</a></code>.</p></div><h6 id="months-ago-months-since"><a class="anchorlink" href="#months-ago-months-since">15.1.3.2 <code>months_ago</code>, <code>months_since</code></a></h6><p>The methods <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-months_ago"><code>months_ago</code></a> and <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-months_since"><code>months_since</code></a> work analogously for months:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">30</span><span class="p">).</span><span class="nf">months_ago</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>   <span class="c1"># =&gt; Sun, 28 Feb 2010</span>
<span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">30</span><span class="p">).</span><span class="nf">months_since</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; Wed, 30 Jun 2010</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-115e07fac18b7169c2d19d2a73345221">Date.new(2010, 4, 30).months_ago(2)   # =&gt; Sun, 28 Feb 2010
Date.new(2010, 4, 30).months_since(2) # =&gt; Wed, 30 Jun 2010
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-115e07fac18b7169c2d19d2a73345221">Copiar</button>
</div>
<p>If such a day does not exist, the last day of the corresponding month is returned:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">30</span><span class="p">).</span><span class="nf">months_ago</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="c1"># =&gt; Sun, 28 Feb 2010</span>
<span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">months_since</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 28 Feb 2010</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-39d6d0352cbdfbc26c6c0835064fa4bc">Date.new(2010, 4, 30).months_ago(2)    # =&gt; Sun, 28 Feb 2010
Date.new(2009, 12, 31).months_since(2) # =&gt; Sun, 28 Feb 2010
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-39d6d0352cbdfbc26c6c0835064fa4bc">Copiar</button>
</div>
<p><a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-last_month"><code>last_month</code></a> is short-hand for <code>#months_ago(1)</code>.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/date_and_time/calculations.rb">active_support/core_ext/date_and_time/calculations.rb</a></code>.</p></div><h6 id="weeks-ago"><a class="anchorlink" href="#weeks-ago">15.1.3.3 <code>weeks_ago</code></a></h6><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-weeks_ago"><code>weeks_ago</code></a> works analogously for weeks:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">24</span><span class="p">).</span><span class="nf">weeks_ago</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>    <span class="c1"># =&gt; Mon, 17 May 2010</span>
<span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">24</span><span class="p">).</span><span class="nf">weeks_ago</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="c1"># =&gt; Mon, 10 May 2010</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-a687f325f60740e81286859870767901">Date.new(2010, 5, 24).weeks_ago(1)    # =&gt; Mon, 17 May 2010
Date.new(2010, 5, 24).weeks_ago(2)    # =&gt; Mon, 10 May 2010
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-a687f325f60740e81286859870767901">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/date_and_time/calculations.rb">active_support/core_ext/date_and_time/calculations.rb</a></code>.</p></div><h6 id="other-date-computations-advance"><a class="anchorlink" href="#other-date-computations-advance">15.1.3.4 <code>advance</code></a></h6><p>The most generic way to jump to other days is <a href="https://api.rubyonrails.org/v6.1.4/classes/Date.html#method-i-advance"><code>advance</code></a>. This method receives a hash with keys <code>:years</code>, <code>:months</code>, <code>:weeks</code>, <code>:days</code>, and returns a date advanced as much as the present keys indicate:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">advance</span><span class="p">(</span><span class="ss">years: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">weeks: </span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># =&gt; Mon, 20 Jun 2011</span>
<span class="n">date</span><span class="p">.</span><span class="nf">advance</span><span class="p">(</span><span class="ss">months: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">days: </span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; Wed, 04 Aug 2010</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-71cd28b6287d35b09e24d07d98d4f75f">date = Date.new(2010, 6, 6)
date.advance(years: 1, weeks: 2)  # =&gt; Mon, 20 Jun 2011
date.advance(months: 2, days: -2) # =&gt; Wed, 04 Aug 2010
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-71cd28b6287d35b09e24d07d98d4f75f">Copiar</button>
</div>
<p>Note in the previous example that increments may be negative.</p><p>To perform the computation the method first increments years, then months, then weeks, and finally days. This order is important towards the end of months. Say for example we are at the end of February of 2010, and we want to move one month and one day forward.</p><p>The method <code>advance</code> advances first one month, and then one day, the result is:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">28</span><span class="p">).</span><span class="nf">advance</span><span class="p">(</span><span class="ss">months: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">days: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; Sun, 29 Mar 2010</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-6e2faa331e4eb4669f66d6c26aae1947">Date.new(2010, 2, 28).advance(months: 1, days: 1)
# =&gt; Sun, 29 Mar 2010
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-6e2faa331e4eb4669f66d6c26aae1947">Copiar</button>
</div>
<p>While if it did it the other way around the result would be different:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">28</span><span class="p">).</span><span class="nf">advance</span><span class="p">(</span><span class="ss">days: </span><span class="mi">1</span><span class="p">).</span><span class="nf">advance</span><span class="p">(</span><span class="ss">months: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; Thu, 01 Apr 2010</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-8edc8d1e1fec16b82eba398ee9023f1c">Date.new(2010, 2, 28).advance(days: 1).advance(months: 1)
# =&gt; Thu, 01 Apr 2010
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8edc8d1e1fec16b82eba398ee9023f1c">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/date/calculations.rb">active_support/core_ext/date/calculations.rb</a></code>.</p></div><h5 id="extensions-to-date-calculations-changing-components"><a class="anchorlink" href="#extensions-to-date-calculations-changing-components">15.1.4 Changing Components</a></h5><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Date.html#method-i-change"><code>change</code></a> allows you to get a new date which is the same as the receiver except for the given year, month, or day:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">23</span><span class="p">).</span><span class="nf">change</span><span class="p">(</span><span class="ss">year: </span><span class="mi">2011</span><span class="p">,</span> <span class="ss">month: </span><span class="mi">11</span><span class="p">)</span>
<span class="c1"># =&gt; Wed, 23 Nov 2011</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-fc869af88fa63cccb4c1719952786e1e">Date.new(2010, 12, 23).change(year: 2011, month: 11)
# =&gt; Wed, 23 Nov 2011
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-fc869af88fa63cccb4c1719952786e1e">Copiar</button>
</div>
<p>This method is not tolerant to non-existing dates, if the change is invalid <code>ArgumentError</code> is raised:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">change</span><span class="p">(</span><span class="ss">month: </span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># =&gt; ArgumentError: invalid date</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-4e04641620378283e825b16daa5c4d4f">Date.new(2010, 1, 31).change(month: 2)
# =&gt; ArgumentError: invalid date
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-4e04641620378283e825b16daa5c4d4f">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/date/calculations.rb">active_support/core_ext/date/calculations.rb</a></code>.</p></div><h5 id="extensions-to-date-calculations-durations"><a class="anchorlink" href="#extensions-to-date-calculations-durations">15.1.5 Durations</a></h5><p><a href="https://api.rubyonrails.org/v6.1.4/classes/ActiveSupport/Duration.html"><code>Duration</code></a> objects can be added to and subtracted from dates:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; Mon, 09 Aug 2010</span>
<span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="nf">year</span>
<span class="c1"># =&gt; Tue, 09 Aug 2011</span>
<span class="n">d</span> <span class="o">-</span> <span class="mi">3</span><span class="p">.</span><span class="nf">hours</span>
<span class="c1"># =&gt; Sun, 08 Aug 2010 21:00:00 UTC +00:00</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-e54576c72fe121aacce6525f3a09ad71">d = Date.current
# =&gt; Mon, 09 Aug 2010
d + 1.year
# =&gt; Tue, 09 Aug 2011
d - 3.hours
# =&gt; Sun, 08 Aug 2010 21:00:00 UTC +00:00
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-e54576c72fe121aacce6525f3a09ad71">Copiar</button>
</div>
<p>They translate to calls to <code>since</code> or <code>advance</code>. For example here we get the correct jump in the calendar reform:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">1582</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="nf">day</span>
<span class="c1"># =&gt; Fri, 15 Oct 1582</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-b4257f2321a3895dbbd07e5326307fe2">Date.new(1582, 10, 4) + 1.day
# =&gt; Fri, 15 Oct 1582
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-b4257f2321a3895dbbd07e5326307fe2">Copiar</button>
</div>
<h5 id="timestamps"><a class="anchorlink" href="#timestamps">15.1.6 Timestamps</a></h5><div class="info"><p>The following methods return a <code>Time</code> object if possible, otherwise a <code>DateTime</code>. If set, they honor the user time zone.</p></div><h6 id="beginning-of-day-end-of-day"><a class="anchorlink" href="#beginning-of-day-end-of-day">15.1.6.1 <code>beginning_of_day</code>, <code>end_of_day</code></a></h6><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Date.html#method-i-beginning_of_day"><code>beginning_of_day</code></a> returns a timestamp at the beginning of the day (00:00:00):</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">beginning_of_day</span> <span class="c1"># =&gt; Mon Jun 07 00:00:00 +0200 2010</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-32131c03942e55d42dc661bcfa9408dc">date = Date.new(2010, 6, 7)
date.beginning_of_day # =&gt; Mon Jun 07 00:00:00 +0200 2010
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-32131c03942e55d42dc661bcfa9408dc">Copiar</button>
</div>
<p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Date.html#method-i-end_of_day"><code>end_of_day</code></a> returns a timestamp at the end of the day (23:59:59):</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">end_of_day</span> <span class="c1"># =&gt; Mon Jun 07 23:59:59 +0200 2010</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-60b411f5a601b00b7362e6321770febd">date = Date.new(2010, 6, 7)
date.end_of_day # =&gt; Mon Jun 07 23:59:59 +0200 2010
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-60b411f5a601b00b7362e6321770febd">Copiar</button>
</div>
<p><code>beginning_of_day</code> is aliased to <a href="https://api.rubyonrails.org/v6.1.4/classes/Date.html#method-i-at_beginning_of_day"><code>at_beginning_of_day</code></a>, <a href="https://api.rubyonrails.org/v6.1.4/classes/Date.html#method-i-midnight"><code>midnight</code></a>, <a href="https://api.rubyonrails.org/v6.1.4/classes/Date.html#method-i-at_midnight"><code>at_midnight</code></a>.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/date/calculations.rb">active_support/core_ext/date/calculations.rb</a></code>.</p></div><h6 id="beginning-of-hour-end-of-hour"><a class="anchorlink" href="#beginning-of-hour-end-of-hour">15.1.6.2 <code>beginning_of_hour</code>, <code>end_of_hour</code></a></h6><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-beginning_of_hour"><code>beginning_of_hour</code></a> returns a timestamp at the beginning of the hour (hh:00:00):</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">beginning_of_hour</span> <span class="c1"># =&gt; Mon Jun 07 19:00:00 +0200 2010</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-9583092dc2424b3cf3a5929bcc34d82c">date = DateTime.new(2010, 6, 7, 19, 55, 25)
date.beginning_of_hour # =&gt; Mon Jun 07 19:00:00 +0200 2010
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-9583092dc2424b3cf3a5929bcc34d82c">Copiar</button>
</div>
<p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-end_of_hour"><code>end_of_hour</code></a> returns a timestamp at the end of the hour (hh:59:59):</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">end_of_hour</span> <span class="c1"># =&gt; Mon Jun 07 19:59:59 +0200 2010</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-889e1388d76425deef501993945f79ed">date = DateTime.new(2010, 6, 7, 19, 55, 25)
date.end_of_hour # =&gt; Mon Jun 07 19:59:59 +0200 2010
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-889e1388d76425deef501993945f79ed">Copiar</button>
</div>
<p><code>beginning_of_hour</code> is aliased to <a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-at_beginning_of_hour"><code>at_beginning_of_hour</code></a>.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/date_time/calculations.rb">active_support/core_ext/date_time/calculations.rb</a></code>.</p></div><h6 id="beginning-of-minute-end-of-minute"><a class="anchorlink" href="#beginning-of-minute-end-of-minute">15.1.6.3 <code>beginning_of_minute</code>, <code>end_of_minute</code></a></h6><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-beginning_of_minute"><code>beginning_of_minute</code></a> returns a timestamp at the beginning of the minute (hh:mm:00):</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">beginning_of_minute</span> <span class="c1"># =&gt; Mon Jun 07 19:55:00 +0200 2010</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-78cccc5f9287c8a8285ff29c49852b0d">date = DateTime.new(2010, 6, 7, 19, 55, 25)
date.beginning_of_minute # =&gt; Mon Jun 07 19:55:00 +0200 2010
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-78cccc5f9287c8a8285ff29c49852b0d">Copiar</button>
</div>
<p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-end_of_minute"><code>end_of_minute</code></a> returns a timestamp at the end of the minute (hh:mm:59):</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">end_of_minute</span> <span class="c1"># =&gt; Mon Jun 07 19:55:59 +0200 2010</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-edec1bede606ee0e5dae39abf4bc540c">date = DateTime.new(2010, 6, 7, 19, 55, 25)
date.end_of_minute # =&gt; Mon Jun 07 19:55:59 +0200 2010
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-edec1bede606ee0e5dae39abf4bc540c">Copiar</button>
</div>
<p><code>beginning_of_minute</code> is aliased to <a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-at_beginning_of_minute"><code>at_beginning_of_minute</code></a>.</p><div class="info"><p><code>beginning_of_hour</code>, <code>end_of_hour</code>, <code>beginning_of_minute</code> and <code>end_of_minute</code> are implemented for <code>Time</code> and <code>DateTime</code> but <strong>not</strong> <code>Date</code> as it does not make sense to request the beginning or end of an hour or minute on a <code>Date</code> instance.</p></div><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/date_time/calculations.rb">active_support/core_ext/date_time/calculations.rb</a></code>.</p></div><h6 id="ago-since"><a class="anchorlink" href="#ago-since">15.1.6.4 <code>ago</code>, <code>since</code></a></h6><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/Date.html#method-i-ago"><code>ago</code></a> receives a number of seconds as argument and returns a timestamp those many seconds ago from midnight:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">current</span> <span class="c1"># =&gt; Fri, 11 Jun 2010</span>
<span class="n">date</span><span class="p">.</span><span class="nf">ago</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>         <span class="c1"># =&gt; Thu, 10 Jun 2010 23:59:59 EDT -04:00</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-4df460b5052f40dcd0c796091c772d46">date = Date.current # =&gt; Fri, 11 Jun 2010
date.ago(1)         # =&gt; Thu, 10 Jun 2010 23:59:59 EDT -04:00
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-4df460b5052f40dcd0c796091c772d46">Copiar</button>
</div>
<p>Similarly, <a href="https://api.rubyonrails.org/v6.1.4/classes/Date.html#method-i-since"><code>since</code></a> moves forward:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">current</span> <span class="c1"># =&gt; Fri, 11 Jun 2010</span>
<span class="n">date</span><span class="p">.</span><span class="nf">since</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>       <span class="c1"># =&gt; Fri, 11 Jun 2010 00:00:01 EDT -04:00</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-9a3647a5d43f08e4d59c28d45211f2a5">date = Date.current # =&gt; Fri, 11 Jun 2010
date.since(1)       # =&gt; Fri, 11 Jun 2010 00:00:01 EDT -04:00
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-9a3647a5d43f08e4d59c28d45211f2a5">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/date/calculations.rb">active_support/core_ext/date/calculations.rb</a></code>.</p></div><h5 id="other-time-computations"><a class="anchorlink" href="#other-time-computations">15.1.7 Other Time Computations</a></h5><h4 id="conversions"><a class="anchorlink" href="#conversions">15.2 Conversions</a></h4><h3 id="extensions-to-datetime"><a class="anchorlink" href="#extensions-to-datetime">16 Extensions to <code>DateTime</code></a></h3><div class="warning"><p><code>DateTime</code> is not aware of DST rules and so some of these methods have edge cases when a DST change is going on. For example <a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-seconds_since_midnight"><code>seconds_since_midnight</code></a> might not return the real amount in such a day.</p></div><h4 id="extensions-to-datetime-calculations"><a class="anchorlink" href="#extensions-to-datetime-calculations">16.1 Calculations</a></h4><p>The class <code>DateTime</code> is a subclass of <code>Date</code> so by loading <code>active_support/core_ext/date/calculations.rb</code> you inherit these methods and their aliases, except that they will always return datetimes.</p><p>The following methods are reimplemented so you do <strong>not</strong> need to load <code>active_support/core_ext/date/calculations.rb</code> for these ones:</p>
<ul>
<li>
<a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-beginning_of_day"><code>beginning_of_day</code></a> / <a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-midnight"><code>midnight</code></a> / <a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-at_midnight"><code>at_midnight</code></a> / <a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-at_beginning_of_day"><code>at_beginning_of_day</code></a>
</li>
<li><a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-end_of_day"><code>end_of_day</code></a></li>
<li><a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-ago"><code>ago</code></a></li>
<li>
<a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-since"><code>since</code></a> / <a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-in"><code>in</code></a>
</li>
</ul>
<p>On the other hand, <a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-advance"><code>advance</code></a> and <a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-change"><code>change</code></a> are also defined and support more options, they are documented below.</p><p>The following methods are only implemented in <code>active_support/core_ext/date_time/calculations.rb</code> as they only make sense when used with a <code>DateTime</code> instance:</p>
<ul>
<li>
<a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-beginning_of_hour"><code>beginning_of_hour</code></a> / <a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-at_beginning_of_hour"><code>at_beginning_of_hour</code></a>
</li>
<li><a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-end_of_hour"><code>end_of_hour</code></a></li>
</ul>
<h5 id="named-datetimes"><a class="anchorlink" href="#named-datetimes">16.1.1 Named Datetimes</a></h5><h6 id="datetime-current"><a class="anchorlink" href="#datetime-current">16.1.1.1 <code>DateTime.current</code></a></h6><p>Active Support defines <a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-c-current"><code>DateTime.current</code></a> to be like <code>Time.now.to_datetime</code>, except that it honors the user time zone, if defined. The instance predicates <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-past-3F"><code>past?</code></a> and <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-future-3F"><code>future?</code></a> are defined relative to <code>DateTime.current</code>.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/date_time/calculations.rb">active_support/core_ext/date_time/calculations.rb</a></code>.</p></div><h5 id="other-extensions"><a class="anchorlink" href="#other-extensions">16.1.2 Other Extensions</a></h5><h6 id="seconds-since-midnight"><a class="anchorlink" href="#seconds-since-midnight">16.1.2.1 <code>seconds_since_midnight</code></a></h6><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-seconds_since_midnight"><code>seconds_since_midnight</code></a> returns the number of seconds since midnight:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">now</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">current</span>     <span class="c1"># =&gt; Mon, 07 Jun 2010 20:26:36 +0000</span>
<span class="n">now</span><span class="p">.</span><span class="nf">seconds_since_midnight</span> <span class="c1"># =&gt; 73596</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-ace84a90eb112e7bf1395803021e1227">now = DateTime.current     # =&gt; Mon, 07 Jun 2010 20:26:36 +0000
now.seconds_since_midnight # =&gt; 73596
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-ace84a90eb112e7bf1395803021e1227">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/date_time/calculations.rb">active_support/core_ext/date_time/calculations.rb</a></code>.</p></div><h6 id="utc"><a class="anchorlink" href="#utc">16.1.2.2 <code>utc</code></a></h6><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-utc"><code>utc</code></a> gives you the same datetime in the receiver expressed in UTC.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">now</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">current</span> <span class="c1"># =&gt; Mon, 07 Jun 2010 19:27:52 -0400</span>
<span class="n">now</span><span class="p">.</span><span class="nf">utc</span>                <span class="c1"># =&gt; Mon, 07 Jun 2010 23:27:52 +0000</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-0b626e931be2da51c9d44b29639b4776">now = DateTime.current # =&gt; Mon, 07 Jun 2010 19:27:52 -0400
now.utc                # =&gt; Mon, 07 Jun 2010 23:27:52 +0000
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-0b626e931be2da51c9d44b29639b4776">Copiar</button>
</div>
<p>This method is also aliased as <a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-getutc"><code>getutc</code></a>.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/date_time/calculations.rb">active_support/core_ext/date_time/calculations.rb</a></code>.</p></div><h6 id="utc-questionmark"><a class="anchorlink" href="#utc-questionmark">16.1.2.3 <code>utc?</code></a></h6><p>The predicate <a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-utc-3F"><code>utc?</code></a> says whether the receiver has UTC as its time zone:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">now</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">now</span> <span class="c1"># =&gt; Mon, 07 Jun 2010 19:30:47 -0400</span>
<span class="n">now</span><span class="p">.</span><span class="nf">utc?</span>           <span class="c1"># =&gt; false</span>
<span class="n">now</span><span class="p">.</span><span class="nf">utc</span><span class="p">.</span><span class="nf">utc?</span>       <span class="c1"># =&gt; true</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-ece785ca6f0e0df9259e2d01c2edde40">now = DateTime.now # =&gt; Mon, 07 Jun 2010 19:30:47 -0400
now.utc?           # =&gt; false
now.utc.utc?       # =&gt; true
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-ece785ca6f0e0df9259e2d01c2edde40">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/date_time/calculations.rb">active_support/core_ext/date_time/calculations.rb</a></code>.</p></div><h6 id="other-extensions-advance"><a class="anchorlink" href="#other-extensions-advance">16.1.2.4 <code>advance</code></a></h6><p>The most generic way to jump to another datetime is <a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-advance"><code>advance</code></a>. This method receives a hash with keys <code>:years</code>, <code>:months</code>, <code>:weeks</code>, <code>:days</code>, <code>:hours</code>, <code>:minutes</code>, and <code>:seconds</code>, and returns a datetime advanced as much as the present keys indicate.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; Thu, 05 Aug 2010 11:33:31 +0000</span>
<span class="n">d</span><span class="p">.</span><span class="nf">advance</span><span class="p">(</span><span class="ss">years: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">months: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">days: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">hours: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">minutes: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">seconds: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; Tue, 06 Sep 2011 12:34:32 +0000</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-ea92a37372f529620a0f7ba74c3dcabb">d = DateTime.current
# =&gt; Thu, 05 Aug 2010 11:33:31 +0000
d.advance(years: 1, months: 1, days: 1, hours: 1, minutes: 1, seconds: 1)
# =&gt; Tue, 06 Sep 2011 12:34:32 +0000
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-ea92a37372f529620a0f7ba74c3dcabb">Copiar</button>
</div>
<p>This method first computes the destination date passing <code>:years</code>, <code>:months</code>, <code>:weeks</code>, and <code>:days</code> to <code>Date#advance</code> documented above. After that, it adjusts the time calling <a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-since"><code>since</code></a> with the number of seconds to advance. This order is relevant, a different ordering would give different datetimes in some edge-cases. The example in <code>Date#advance</code> applies, and we can extend it to show order relevance related to the time bits.</p><p>If we first move the date bits (that have also a relative order of processing, as documented before), and then the time bits we get for example the following computation:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">59</span><span class="p">)</span>
<span class="c1"># =&gt; Sun, 28 Feb 2010 23:59:59 +0000</span>
<span class="n">d</span><span class="p">.</span><span class="nf">advance</span><span class="p">(</span><span class="ss">months: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">seconds: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; Mon, 29 Mar 2010 00:00:00 +0000</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-bf5c0b22e1a07d3cbe1986d7fb1e22f4">d = DateTime.new(2010, 2, 28, 23, 59, 59)
# =&gt; Sun, 28 Feb 2010 23:59:59 +0000
d.advance(months: 1, seconds: 1)
# =&gt; Mon, 29 Mar 2010 00:00:00 +0000
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-bf5c0b22e1a07d3cbe1986d7fb1e22f4">Copiar</button>
</div>
<p>but if we computed them the other way around, the result would be different:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">d</span><span class="p">.</span><span class="nf">advance</span><span class="p">(</span><span class="ss">seconds: </span><span class="mi">1</span><span class="p">).</span><span class="nf">advance</span><span class="p">(</span><span class="ss">months: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; Thu, 01 Apr 2010 00:00:00 +0000</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-169d715afd500230e08c6f8fe0234eb6">d.advance(seconds: 1).advance(months: 1)
# =&gt; Thu, 01 Apr 2010 00:00:00 +0000
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-169d715afd500230e08c6f8fe0234eb6">Copiar</button>
</div>
<div class="warning"><p>Since <code>DateTime</code> is not DST-aware you can end up in a non-existing point in time with no warning or error telling you so.</p></div><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/date_time/calculations.rb">active_support/core_ext/date_time/calculations.rb</a></code>.</p></div><h5 id="extensions-to-datetime-calculations-changing-components"><a class="anchorlink" href="#extensions-to-datetime-calculations-changing-components">16.1.3 Changing Components</a></h5><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/DateTime.html#method-i-change"><code>change</code></a> allows you to get a new datetime which is the same as the receiver except for the given options, which may include <code>:year</code>, <code>:month</code>, <code>:day</code>, <code>:hour</code>, <code>:min</code>, <code>:sec</code>, <code>:offset</code>, <code>:start</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">now</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; Tue, 08 Jun 2010 01:56:22 +0000</span>
<span class="n">now</span><span class="p">.</span><span class="nf">change</span><span class="p">(</span><span class="ss">year: </span><span class="mi">2011</span><span class="p">,</span> <span class="ss">offset: </span><span class="no">Rational</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">24</span><span class="p">))</span>
<span class="c1"># =&gt; Wed, 08 Jun 2011 01:56:22 -0600</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-b40a604c20accb65815113dd71b4f1ce">now = DateTime.current
# =&gt; Tue, 08 Jun 2010 01:56:22 +0000
now.change(year: 2011, offset: Rational(-6, 24))
# =&gt; Wed, 08 Jun 2011 01:56:22 -0600
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-b40a604c20accb65815113dd71b4f1ce">Copiar</button>
</div>
<p>If hours are zeroed, then minutes and seconds are too (unless they have given values):</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">now</span><span class="p">.</span><span class="nf">change</span><span class="p">(</span><span class="ss">hour: </span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># =&gt; Tue, 08 Jun 2010 00:00:00 +0000</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-95c61bbce5c02e43e3eeebe1ec7c1166">now.change(hour: 0)
# =&gt; Tue, 08 Jun 2010 00:00:00 +0000
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-95c61bbce5c02e43e3eeebe1ec7c1166">Copiar</button>
</div>
<p>Similarly, if minutes are zeroed, then seconds are too (unless it has given a value):</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">now</span><span class="p">.</span><span class="nf">change</span><span class="p">(</span><span class="ss">min: </span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># =&gt; Tue, 08 Jun 2010 01:00:00 +0000</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-4bc816f86c0013c199d7072a7d3bc389">now.change(min: 0)
# =&gt; Tue, 08 Jun 2010 01:00:00 +0000
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-4bc816f86c0013c199d7072a7d3bc389">Copiar</button>
</div>
<p>This method is not tolerant to non-existing dates, if the change is invalid <code>ArgumentError</code> is raised:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">DateTime</span><span class="p">.</span><span class="nf">current</span><span class="p">.</span><span class="nf">change</span><span class="p">(</span><span class="ss">month: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">day: </span><span class="mi">30</span><span class="p">)</span>
<span class="c1"># =&gt; ArgumentError: invalid date</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-f575c35bbc450a9422b8d53bb641f4ff">DateTime.current.change(month: 2, day: 30)
# =&gt; ArgumentError: invalid date
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-f575c35bbc450a9422b8d53bb641f4ff">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/date_time/calculations.rb">active_support/core_ext/date_time/calculations.rb</a></code>.</p></div><h5 id="extensions-to-datetime-calculations-durations"><a class="anchorlink" href="#extensions-to-datetime-calculations-durations">16.1.4 Durations</a></h5><p><a href="https://api.rubyonrails.org/v6.1.4/classes/ActiveSupport/Duration.html"><code>Duration</code></a> objects can be added to and subtracted from datetimes:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">now</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; Mon, 09 Aug 2010 23:15:17 +0000</span>
<span class="n">now</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="nf">year</span>
<span class="c1"># =&gt; Tue, 09 Aug 2011 23:15:17 +0000</span>
<span class="n">now</span> <span class="o">-</span> <span class="mi">1</span><span class="p">.</span><span class="nf">week</span>
<span class="c1"># =&gt; Mon, 02 Aug 2010 23:15:17 +0000</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-22add7bfd917227fce439e972923a975">now = DateTime.current
# =&gt; Mon, 09 Aug 2010 23:15:17 +0000
now + 1.year
# =&gt; Tue, 09 Aug 2011 23:15:17 +0000
now - 1.week
# =&gt; Mon, 02 Aug 2010 23:15:17 +0000
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-22add7bfd917227fce439e972923a975">Copiar</button>
</div>
<p>They translate to calls to <code>since</code> or <code>advance</code>. For example here we get the correct jump in the calendar reform:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">DateTime</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">1582</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">23</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="nf">hour</span>
<span class="c1"># =&gt; Fri, 15 Oct 1582 00:00:00 +0000</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-b9d43a203757c5f49349e1a98096d032">DateTime.new(1582, 10, 4, 23) + 1.hour
# =&gt; Fri, 15 Oct 1582 00:00:00 +0000
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-b9d43a203757c5f49349e1a98096d032">Copiar</button>
</div>
<h3 id="extensions-to-time"><a class="anchorlink" href="#extensions-to-time">17 Extensions to <code>Time</code></a></h3><h4 id="calculations"><a class="anchorlink" href="#calculations">17.1 Calculations</a></h4><p>They are analogous. Please refer to their documentation above and take into account the following differences:</p>
<ul>
<li>
<a href="https://api.rubyonrails.org/v6.1.4/classes/Time.html#method-i-change"><code>change</code></a> accepts an additional <code>:usec</code> option.</li>
<li>
<code>Time</code> understands DST, so you get correct DST calculations as in</li>
</ul>
<div class="code_container">
<pre><code class="highlight ruby"><span class="no">Time</span><span class="p">.</span><span class="nf">zone_default</span>
<span class="c1"># =&gt; #&lt;ActiveSupport::TimeZone:0x7f73654d4f38 @utc_offset=nil, @name="Madrid", ...&gt;</span>

<span class="c1"># In Barcelona, 2010/03/28 02:00 +0100 becomes 2010/03/28 03:00 +0200 due to DST.</span>
<span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">59</span><span class="p">)</span>
<span class="c1"># =&gt; Sun Mar 28 01:59:59 +0100 2010</span>
<span class="n">t</span><span class="p">.</span><span class="nf">advance</span><span class="p">(</span><span class="ss">seconds: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; Sun Mar 28 03:00:00 +0200 2010</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-bdafe9543c950a0420cc9742e530290c">Time.zone_default
# =&gt; #&lt;ActiveSupport::TimeZone:0x7f73654d4f38 @utc_offset=nil, @name="Madrid", ...&gt;

# In Barcelona, 2010/03/28 02:00 +0100 becomes 2010/03/28 03:00 +0200 due to DST.
t = Time.local(2010, 3, 28, 1, 59, 59)
# =&gt; Sun Mar 28 01:59:59 +0100 2010
t.advance(seconds: 1)
# =&gt; Sun Mar 28 03:00:00 +0200 2010
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-bdafe9543c950a0420cc9742e530290c">Copiar</button>
</div>

<ul>
<li>If <a href="https://api.rubyonrails.org/v6.1.4/classes/Time.html#method-i-since"><code>since</code></a> or <a href="https://api.rubyonrails.org/v6.1.4/classes/Time.html#method-i-ago"><code>ago</code></a> jump to a time that can't be expressed with <code>Time</code> a <code>DateTime</code> object is returned instead.</li>
</ul>
<h5 id="time-current"><a class="anchorlink" href="#time-current">17.1.1 <code>Time.current</code></a></h5><p>Active Support defines <a href="https://api.rubyonrails.org/v6.1.4/classes/Time.html#method-c-current"><code>Time.current</code></a> to be today in the current time zone. That's like <code>Time.now</code>, except that it honors the user time zone, if defined. It also defines the instance predicates <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-past-3F"><code>past?</code></a>, <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-today-3F"><code>today?</code></a>, <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-tomorrow-3F"><code>tomorrow?</code></a>, <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-next_day-3F"><code>next_day?</code></a>, <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-yesterday-3F"><code>yesterday?</code></a>, <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-prev_day-3F"><code>prev_day?</code></a> and <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-future-3F"><code>future?</code></a>, all of them relative to <code>Time.current</code>.</p><p>When making Time comparisons using methods which honor the user time zone, make sure to use <code>Time.current</code> instead of <code>Time.now</code>. There are cases where the user time zone might be in the future compared to the system time zone, which <code>Time.now</code> uses by default. This means <code>Time.now.to_date</code> may equal <code>Date.yesterday</code>.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/time/calculations.rb">active_support/core_ext/time/calculations.rb</a></code>.</p></div><h5 id="all-day-all-week-all-month-all-quarter-and-all-year"><a class="anchorlink" href="#all-day-all-week-all-month-all-quarter-and-all-year">17.1.2 <code>all_day</code>, <code>all_week</code>, <code>all_month</code>, <code>all_quarter</code> and <code>all_year</code></a></h5><p>The method <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-all_day"><code>all_day</code></a> returns a range representing the whole day of the current time.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">now</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; Mon, 09 Aug 2010 23:20:05 UTC +00:00</span>
<span class="n">now</span><span class="p">.</span><span class="nf">all_day</span>
<span class="c1"># =&gt; Mon, 09 Aug 2010 00:00:00 UTC +00:00..Mon, 09 Aug 2010 23:59:59 UTC +00:00</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-1b33e7c297aae1e67d03ddad142647e3">now = Time.current
# =&gt; Mon, 09 Aug 2010 23:20:05 UTC +00:00
now.all_day
# =&gt; Mon, 09 Aug 2010 00:00:00 UTC +00:00..Mon, 09 Aug 2010 23:59:59 UTC +00:00
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-1b33e7c297aae1e67d03ddad142647e3">Copiar</button>
</div>
<p>Analogously, <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-all_week"><code>all_week</code></a>, <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-all_month"><code>all_month</code></a>, <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-all_quarter"><code>all_quarter</code></a> and <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-all_year"><code>all_year</code></a> all serve the purpose of generating time ranges.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">now</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; Mon, 09 Aug 2010 23:20:05 UTC +00:00</span>
<span class="n">now</span><span class="p">.</span><span class="nf">all_week</span>
<span class="c1"># =&gt; Mon, 09 Aug 2010 00:00:00 UTC +00:00..Sun, 15 Aug 2010 23:59:59 UTC +00:00</span>
<span class="n">now</span><span class="p">.</span><span class="nf">all_week</span><span class="p">(</span><span class="ss">:sunday</span><span class="p">)</span>
<span class="c1"># =&gt; Sun, 16 Sep 2012 00:00:00 UTC +00:00..Sat, 22 Sep 2012 23:59:59 UTC +00:00</span>
<span class="n">now</span><span class="p">.</span><span class="nf">all_month</span>
<span class="c1"># =&gt; Sat, 01 Aug 2010 00:00:00 UTC +00:00..Tue, 31 Aug 2010 23:59:59 UTC +00:00</span>
<span class="n">now</span><span class="p">.</span><span class="nf">all_quarter</span>
<span class="c1"># =&gt; Thu, 01 Jul 2010 00:00:00 UTC +00:00..Thu, 30 Sep 2010 23:59:59 UTC +00:00</span>
<span class="n">now</span><span class="p">.</span><span class="nf">all_year</span>
<span class="c1"># =&gt; Fri, 01 Jan 2010 00:00:00 UTC +00:00..Fri, 31 Dec 2010 23:59:59 UTC +00:00</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-6ca26adf35c1f43de6964761322c5003">now = Time.current
# =&gt; Mon, 09 Aug 2010 23:20:05 UTC +00:00
now.all_week
# =&gt; Mon, 09 Aug 2010 00:00:00 UTC +00:00..Sun, 15 Aug 2010 23:59:59 UTC +00:00
now.all_week(:sunday)
# =&gt; Sun, 16 Sep 2012 00:00:00 UTC +00:00..Sat, 22 Sep 2012 23:59:59 UTC +00:00
now.all_month
# =&gt; Sat, 01 Aug 2010 00:00:00 UTC +00:00..Tue, 31 Aug 2010 23:59:59 UTC +00:00
now.all_quarter
# =&gt; Thu, 01 Jul 2010 00:00:00 UTC +00:00..Thu, 30 Sep 2010 23:59:59 UTC +00:00
now.all_year
# =&gt; Fri, 01 Jan 2010 00:00:00 UTC +00:00..Fri, 31 Dec 2010 23:59:59 UTC +00:00
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-6ca26adf35c1f43de6964761322c5003">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/date_and_time/calculations.rb">active_support/core_ext/date_and_time/calculations.rb</a></code>.</p></div><h5 id="prev-day-next-day"><a class="anchorlink" href="#prev-day-next-day">17.1.3 <code>prev_day</code>, <code>next_day</code></a></h5><p><a href="https://api.rubyonrails.org/v6.1.4/classes/Time.html#method-i-prev_day"><code>prev_day</code></a> and <a href="https://api.rubyonrails.org/v6.1.4/classes/Time.html#method-i-next_day"><code>next_day</code></a> return the time in the last or next day:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="c1"># =&gt; 2010-05-08 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">prev_day</span>               <span class="c1"># =&gt; 2010-05-07 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">next_day</span>               <span class="c1"># =&gt; 2010-05-09 00:00:00 +0900</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-0d0c9ffd4448cf93d81dccf49370ca9c">t = Time.new(2010, 5, 8) # =&gt; 2010-05-08 00:00:00 +0900
t.prev_day               # =&gt; 2010-05-07 00:00:00 +0900
t.next_day               # =&gt; 2010-05-09 00:00:00 +0900
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-0d0c9ffd4448cf93d81dccf49370ca9c">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/time/calculations.rb">active_support/core_ext/time/calculations.rb</a></code>.</p></div><h5 id="prev-month-next-month"><a class="anchorlink" href="#prev-month-next-month">17.1.4 <code>prev_month</code>, <code>next_month</code></a></h5><p><a href="https://api.rubyonrails.org/v6.1.4/classes/Time.html#method-i-prev_month"><code>prev_month</code></a> and <a href="https://api.rubyonrails.org/v6.1.4/classes/Time.html#method-i-next_month"><code>next_month</code></a> return the time with the same day in the last or next month:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="c1"># =&gt; 2010-05-08 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">prev_month</span>             <span class="c1"># =&gt; 2010-04-08 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">next_month</span>             <span class="c1"># =&gt; 2010-06-08 00:00:00 +0900</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-ee866f570eada36b84275b8ec336b0e3">t = Time.new(2010, 5, 8) # =&gt; 2010-05-08 00:00:00 +0900
t.prev_month             # =&gt; 2010-04-08 00:00:00 +0900
t.next_month             # =&gt; 2010-06-08 00:00:00 +0900
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-ee866f570eada36b84275b8ec336b0e3">Copiar</button>
</div>
<p>If such a day does not exist, the last day of the corresponding month is returned:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">prev_month</span> <span class="c1"># =&gt; 2000-04-30 00:00:00 +0900</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">prev_month</span> <span class="c1"># =&gt; 2000-02-29 00:00:00 +0900</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">next_month</span> <span class="c1"># =&gt; 2000-06-30 00:00:00 +0900</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">next_month</span> <span class="c1"># =&gt; 2000-02-29 00:00:00 +0900</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-2c03894197b6a02452a0fb60325297cf">Time.new(2000, 5, 31).prev_month # =&gt; 2000-04-30 00:00:00 +0900
Time.new(2000, 3, 31).prev_month # =&gt; 2000-02-29 00:00:00 +0900
Time.new(2000, 5, 31).next_month # =&gt; 2000-06-30 00:00:00 +0900
Time.new(2000, 1, 31).next_month # =&gt; 2000-02-29 00:00:00 +0900
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2c03894197b6a02452a0fb60325297cf">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/time/calculations.rb">active_support/core_ext/time/calculations.rb</a></code>.</p></div><h5 id="prev-year-next-year"><a class="anchorlink" href="#prev-year-next-year">17.1.5 <code>prev_year</code>, <code>next_year</code></a></h5><p><a href="https://api.rubyonrails.org/v6.1.4/classes/Time.html#method-i-prev_year"><code>prev_year</code></a> and <a href="https://api.rubyonrails.org/v6.1.4/classes/Time.html#method-i-next_year"><code>next_year</code></a> return a time with the same day/month in the last or next year:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="c1"># =&gt; 2010-05-08 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">prev_year</span>              <span class="c1"># =&gt; 2009-05-08 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">next_year</span>              <span class="c1"># =&gt; 2011-05-08 00:00:00 +0900</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-edebca8720353c0a3592bca26fd9bab9">t = Time.new(2010, 5, 8) # =&gt; 2010-05-08 00:00:00 +0900
t.prev_year              # =&gt; 2009-05-08 00:00:00 +0900
t.next_year              # =&gt; 2011-05-08 00:00:00 +0900
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-edebca8720353c0a3592bca26fd9bab9">Copiar</button>
</div>
<p>If date is the 29th of February of a leap year, you obtain the 28th:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">29</span><span class="p">)</span> <span class="c1"># =&gt; 2000-02-29 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">prev_year</span>               <span class="c1"># =&gt; 1999-02-28 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">next_year</span>               <span class="c1"># =&gt; 2001-02-28 00:00:00 +0900</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-a1ef1ec86cc68930a96ebe3452cd8e04">t = Time.new(2000, 2, 29) # =&gt; 2000-02-29 00:00:00 +0900
t.prev_year               # =&gt; 1999-02-28 00:00:00 +0900
t.next_year               # =&gt; 2001-02-28 00:00:00 +0900
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-a1ef1ec86cc68930a96ebe3452cd8e04">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/time/calculations.rb">active_support/core_ext/time/calculations.rb</a></code>.</p></div><h5 id="prev-quarter-next-quarter"><a class="anchorlink" href="#prev-quarter-next-quarter">17.1.6 <code>prev_quarter</code>, <code>next_quarter</code></a></h5><p><a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-prev_quarter"><code>prev_quarter</code></a> and <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-next_quarter"><code>next_quarter</code></a> return the date with the same day in the previous or next quarter:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="c1"># =&gt; 2010-05-08 00:00:00 +0300</span>
<span class="n">t</span><span class="p">.</span><span class="nf">prev_quarter</span>             <span class="c1"># =&gt; 2010-02-08 00:00:00 +0200</span>
<span class="n">t</span><span class="p">.</span><span class="nf">next_quarter</span>             <span class="c1"># =&gt; 2010-08-08 00:00:00 +0300</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-4f7d2941005bc87aeed5e7869ca7ec2c">t = Time.local(2010, 5, 8) # =&gt; 2010-05-08 00:00:00 +0300
t.prev_quarter             # =&gt; 2010-02-08 00:00:00 +0200
t.next_quarter             # =&gt; 2010-08-08 00:00:00 +0300
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-4f7d2941005bc87aeed5e7869ca7ec2c">Copiar</button>
</div>
<p>If such a day does not exist, the last day of the corresponding month is returned:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Time</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">prev_quarter</span>  <span class="c1"># =&gt; 2000-04-30 00:00:00 +0300</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">prev_quarter</span>  <span class="c1"># =&gt; 2000-02-29 00:00:00 +0200</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">prev_quarter</span> <span class="c1"># =&gt; 2000-07-31 00:00:00 +0300</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">next_quarter</span> <span class="c1"># =&gt; 2001-03-01 00:00:00 +0200</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-1db36296fa0381f1c185d43bba109934">Time.local(2000, 7, 31).prev_quarter  # =&gt; 2000-04-30 00:00:00 +0300
Time.local(2000, 5, 31).prev_quarter  # =&gt; 2000-02-29 00:00:00 +0200
Time.local(2000, 10, 31).prev_quarter # =&gt; 2000-07-31 00:00:00 +0300
Time.local(2000, 11, 31).next_quarter # =&gt; 2001-03-01 00:00:00 +0200
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-1db36296fa0381f1c185d43bba109934">Copiar</button>
</div>
<p><code>prev_quarter</code> is aliased to <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-last_quarter"><code>last_quarter</code></a>.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/date_and_time/calculations.rb">active_support/core_ext/date_and_time/calculations.rb</a></code>.</p></div><h4 id="time-constructors"><a class="anchorlink" href="#time-constructors">17.2 Time Constructors</a></h4><p>Active Support defines <a href="https://api.rubyonrails.org/v6.1.4/classes/Time.html#method-c-current"><code>Time.current</code></a> to be <code>Time.zone.now</code> if there's a user time zone defined, with fallback to <code>Time.now</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Time</span><span class="p">.</span><span class="nf">zone_default</span>
<span class="c1"># =&gt; #&lt;ActiveSupport::TimeZone:0x7f73654d4f38 @utc_offset=nil, @name="Madrid", ...&gt;</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; Fri, 06 Aug 2010 17:11:58 CEST +02:00</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-8688269b83a2ba23178d659d8d57e302">Time.zone_default
# =&gt; #&lt;ActiveSupport::TimeZone:0x7f73654d4f38 @utc_offset=nil, @name="Madrid", ...&gt;
Time.current
# =&gt; Fri, 06 Aug 2010 17:11:58 CEST +02:00
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8688269b83a2ba23178d659d8d57e302">Copiar</button>
</div>
<p>Analogously to <code>DateTime</code>, the predicates <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-past-3F"><code>past?</code></a>, and <a href="https://api.rubyonrails.org/v6.1.4/classes/DateAndTime/Calculations.html#method-i-future-3F"><code>future?</code></a> are relative to <code>Time.current</code>.</p><p>If the time to be constructed lies beyond the range supported by <code>Time</code> in the runtime platform, usecs are discarded and a <code>DateTime</code> object is returned instead.</p><h5 id="durations"><a class="anchorlink" href="#durations">17.2.1 Durations</a></h5><p><a href="https://api.rubyonrails.org/v6.1.4/classes/ActiveSupport/Duration.html"><code>Duration</code></a> objects can be added to and subtracted from time objects:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">now</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; Mon, 09 Aug 2010 23:20:05 UTC +00:00</span>
<span class="n">now</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="nf">year</span>
<span class="c1"># =&gt; Tue, 09 Aug 2011 23:21:11 UTC +00:00</span>
<span class="n">now</span> <span class="o">-</span> <span class="mi">1</span><span class="p">.</span><span class="nf">week</span>
<span class="c1"># =&gt; Mon, 02 Aug 2010 23:21:11 UTC +00:00</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-9dab31b38d1c7cc86b12326bda01b6fc">now = Time.current
# =&gt; Mon, 09 Aug 2010 23:20:05 UTC +00:00
now + 1.year
# =&gt; Tue, 09 Aug 2011 23:21:11 UTC +00:00
now - 1.week
# =&gt; Mon, 02 Aug 2010 23:21:11 UTC +00:00
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-9dab31b38d1c7cc86b12326bda01b6fc">Copiar</button>
</div>
<p>They translate to calls to <code>since</code> or <code>advance</code>. For example here we get the correct jump in the calendar reform:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Time</span><span class="p">.</span><span class="nf">utc</span><span class="p">(</span><span class="mi">1582</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">.</span><span class="nf">days</span>
<span class="c1"># =&gt; Mon Oct 18 00:00:00 UTC 1582</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-0129488aec87a9393f767a8b8420c3cb">Time.utc(1582, 10, 3) + 5.days
# =&gt; Mon Oct 18 00:00:00 UTC 1582
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-0129488aec87a9393f767a8b8420c3cb">Copiar</button>
</div>
<h3 id="extensions-to-file"><a class="anchorlink" href="#extensions-to-file">18 Extensions to <code>File</code></a></h3><h4 id="atomic-write"><a class="anchorlink" href="#atomic-write">18.1 <code>atomic_write</code></a></h4><p>With the class method <a href="https://api.rubyonrails.org/v6.1.4/classes/File.html#method-c-atomic_write"><code>File.atomic_write</code></a> you can write to a file in a way that will prevent any reader from seeing half-written content.</p><p>The name of the file is passed as an argument, and the method yields a file handle opened for writing. Once the block is done <code>atomic_write</code> closes the file handle and completes its job.</p><p>For example, Action Pack uses this method to write asset cache files like <code>all.css</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">File</span><span class="p">.</span><span class="nf">atomic_write</span><span class="p">(</span><span class="n">joined_asset_path</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">cache</span><span class="o">|</span>
  <span class="n">cache</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">join_asset_file_contents</span><span class="p">(</span><span class="n">asset_paths</span><span class="p">))</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-a4ff7673f23461cd20bada1cf3571ddf">File.atomic_write(joined_asset_path) do |cache|
  cache.write(join_asset_file_contents(asset_paths))
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-a4ff7673f23461cd20bada1cf3571ddf">Copiar</button>
</div>
<p>To accomplish this <code>atomic_write</code> creates a temporary file. That's the file the code in the block actually writes to. On completion, the temporary file is renamed, which is an atomic operation on POSIX systems. If the target file exists <code>atomic_write</code> overwrites it and keeps owners and permissions. However there are a few cases where <code>atomic_write</code> cannot change the file ownership or permissions, this error is caught and skipped over trusting in the user/filesystem to ensure the file is accessible to the processes that need it.</p><div class="note"><p>Due to the chmod operation <code>atomic_write</code> performs, if the target file has an ACL set on it this ACL will be recalculated/modified.</p></div><div class="warning"><p>Note you can't append with <code>atomic_write</code>.</p></div><p>The auxiliary file is written in a standard directory for temporary files, but you can pass a directory of your choice as second argument.</p><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/file/atomic.rb">active_support/core_ext/file/atomic.rb</a></code>.</p></div><h3 id="extensions-to-marshal"><a class="anchorlink" href="#extensions-to-marshal">19 Extensions to <code>Marshal</code></a></h3><h4 id="load"><a class="anchorlink" href="#load">19.1 <code>load</code></a></h4><p>Active Support adds constant autoloading support to <code>load</code>.</p><p>For example, the file cache store deserializes this way:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="no">Marshal</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="p">}</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-57c4d105a1af9ee49b56667d5aa665e2">File.open(file_name) { |f| Marshal.load(f) }
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-57c4d105a1af9ee49b56667d5aa665e2">Copiar</button>
</div>
<p>If the cached data refers to a constant that is unknown at that point, the autoloading mechanism is triggered and if it succeeds the deserialization is retried transparently.</p><div class="warning"><p>If the argument is an <code>IO</code> it needs to respond to <code>rewind</code> to be able to retry. Regular files respond to <code>rewind</code>.</p></div><div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/marshal.rb">active_support/core_ext/marshal.rb</a></code>.</p></div><h3 id="extensions-to-nameerror"><a class="anchorlink" href="#extensions-to-nameerror">20 Extensions to <code>NameError</code></a></h3><p>Active Support adds <a href="https://api.rubyonrails.org/v6.1.4/classes/NameError.html#method-i-missing_name-3F"><code>missing_name?</code></a> to <code>NameError</code>, which tests whether the exception was raised because of the name passed as argument.</p><p>The name may be given as a symbol or string. A symbol is tested against the bare constant name, a string is against the fully qualified constant name.</p><div class="info"><p>A symbol can represent a fully qualified constant name as in <code>:"ActiveRecord::Base"</code>, so the behavior for symbols is defined for convenience, not because it has to be that way technically.</p></div><p>For example, when an action of <code>ArticlesController</code> is called Rails tries optimistically to use <code>ArticlesHelper</code>. It is OK that the helper module does not exist, so if an exception for that constant name is raised it should be silenced. But it could be the case that <code>articles_helper.rb</code> raises a <code>NameError</code> due to an actual unknown constant. That should be reraised. The method <code>missing_name?</code> provides a way to distinguish both cases:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">default_helper_module!</span>
  <span class="n">module_name</span> <span class="o">=</span> <span class="nb">name</span><span class="p">.</span><span class="nf">delete_suffix</span><span class="p">(</span><span class="s2">"Controller"</span><span class="p">)</span>
  <span class="n">module_path</span> <span class="o">=</span> <span class="n">module_name</span><span class="p">.</span><span class="nf">underscore</span>
  <span class="n">helper</span> <span class="n">module_path</span>
<span class="k">rescue</span> <span class="no">LoadError</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="k">raise</span> <span class="n">e</span> <span class="k">unless</span> <span class="n">e</span><span class="p">.</span><span class="nf">is_missing?</span> <span class="s2">"helpers/</span><span class="si">#{</span><span class="n">module_path</span><span class="si">}</span><span class="s2">_helper"</span>
<span class="k">rescue</span> <span class="no">NameError</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="k">raise</span> <span class="n">e</span> <span class="k">unless</span> <span class="n">e</span><span class="p">.</span><span class="nf">missing_name?</span> <span class="s2">"</span><span class="si">#{</span><span class="n">module_name</span><span class="si">}</span><span class="s2">Helper"</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-6f086c75fe4518460b79f708994d3f5d">def default_helper_module!
  module_name = name.delete_suffix("Controller")
  module_path = module_name.underscore
  helper module_path
rescue LoadError =&gt; e
  raise e unless e.is_missing? "helpers/#{module_path}_helper"
rescue NameError =&gt; e
  raise e unless e.missing_name? "#{module_name}Helper"
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-6f086c75fe4518460b79f708994d3f5d">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/name_error.rb">active_support/core_ext/name_error.rb</a></code>.</p></div><h3 id="extensions-to-loaderror"><a class="anchorlink" href="#extensions-to-loaderror">21 Extensions to <code>LoadError</code></a></h3><p>Active Support adds <a href="https://api.rubyonrails.org/v6.1.4/classes/LoadError.html#method-i-is_missing-3F"><code>is_missing?</code></a> to <code>LoadError</code>.</p><p>Given a path name <code>is_missing?</code> tests whether the exception was raised due to that particular file (except perhaps for the ".rb" extension).</p><p>For example, when an action of <code>ArticlesController</code> is called Rails tries to load <code>articles_helper.rb</code>, but that file may not exist. That's fine, the helper module is not mandatory so Rails silences a load error. But it could be the case that the helper module does exist and in turn requires another library that is missing. In that case Rails must reraise the exception. The method <code>is_missing?</code> provides a way to distinguish both cases:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">default_helper_module!</span>
  <span class="n">module_name</span> <span class="o">=</span> <span class="nb">name</span><span class="p">.</span><span class="nf">delete_suffix</span><span class="p">(</span><span class="s2">"Controller"</span><span class="p">)</span>
  <span class="n">module_path</span> <span class="o">=</span> <span class="n">module_name</span><span class="p">.</span><span class="nf">underscore</span>
  <span class="n">helper</span> <span class="n">module_path</span>
<span class="k">rescue</span> <span class="no">LoadError</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="k">raise</span> <span class="n">e</span> <span class="k">unless</span> <span class="n">e</span><span class="p">.</span><span class="nf">is_missing?</span> <span class="s2">"helpers/</span><span class="si">#{</span><span class="n">module_path</span><span class="si">}</span><span class="s2">_helper"</span>
<span class="k">rescue</span> <span class="no">NameError</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="k">raise</span> <span class="n">e</span> <span class="k">unless</span> <span class="n">e</span><span class="p">.</span><span class="nf">missing_name?</span> <span class="s2">"</span><span class="si">#{</span><span class="n">module_name</span><span class="si">}</span><span class="s2">Helper"</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-e5a247cce098bde57ee407168ad8a1b6">def default_helper_module!
  module_name = name.delete_suffix("Controller")
  module_path = module_name.underscore
  helper module_path
rescue LoadError =&gt; e
  raise e unless e.is_missing? "helpers/#{module_path}_helper"
rescue NameError =&gt; e
  raise e unless e.missing_name? "#{module_name}Helper"
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-e5a247cce098bde57ee407168ad8a1b6">Copiar</button>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/v6.1.4/activesupport/lib/active_support/core_ext/load_error.rb">active_support/core_ext/load_error.rb</a></code>.</p></div>

        <h3>Feedback</h3>
        <p>
          Você é incentivado a ajudar a melhorar a qualidade deste guia.
        </p>
        <p>
          Por favor, contribua caso veja quaisquer erros, inclusive erros de digitação.
          Para começar, você pode ler nossa sessão de <a href="https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">contribuindo com a documentação</a>.
        </p>
        <p>
          Você também pode encontrar conteúdo incompleto ou coisas que não estão atualizadas.
          Por favor, adicione qualquer documentação em falta na main do Rails. Certifique-se de checar o
          <a href="http://edgeguides.rubyonrails.org">Edge Guides (en-US)</a> primeiro para verificar
          se o problema já foi resolvido ou não no branch main.
          Verifique as <a href="ruby_on_rails_guides_guidelines.html">Diretrizes do Guia Ruby on Rails</a>
          para estilo e convenções.
        </p>
        <p>
          Se, por qualquer motivo, você encontrar algo para consertar, mas não conseguir consertá-lo, por favor
          <a href="https://github.com/campuscode/rails-guides-pt-BR/issues">abra uma issue no nosso Guia</a>.
        </p>
        <p>
          E por último, mas não menos importante, qualquer tipo de discussão sobre a documentação do Ruby on Rails
          é muito bem vinda na <a href="https://discuss.rubyonrails.org/c/rubyonrails-docs">lista de discussão rubyonrails-docs</a> e nas
          <a href="https://github.com/campuscode/rails-guides-pt-BR/issues">issues do Guia em português</a>.
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p> Este projeto está licenciado sob uma licença <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International</a></p>
<p>"Rails", "Ruby on Rails", e o logotipo Rails são marcas comerciais de David Heinemeier Hansson. Todos os direitos reservados.</p>

    </div>
  </div>
  <div id="toggle">
    <img alt="dark theme icon" class="icon">
  </div>
</body>
</html>

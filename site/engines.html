<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Introdução às Engines — Ruby on Rails Guides</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
  <link rel="stylesheet" type="text/css" href="stylesheets/highlight.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/search.css" data-turbolinks-track="reload">
  <link href="images/favicon.ico" rel="icon" type="image/x-icon" />
  <script src="javascripts/turbolinks.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/clipboard.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/guides.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/search.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/lunr-documents.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/lunr.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/toggle-theme.js" data-turbolinks-track="reload"></script>
  <meta property="og:title" content="Introdução às Engines — Ruby on Rails Guides" />
  <meta name="description" content="Introdução às EnginesNeste guia você irá aprender sobre engines e como elas podem ser utilizadas para prover funcionalidades adicionais para suas aplicações hospedeiras através de uma interface bem limpa e fácil de usar.Após ler este guia, você saberá: O que compõe uma engine. Como gerar uma engine. Como construir as funcionalidades para a engine. Como conectar a engine em uma aplicação. Como substituir a funcionalidade de uma engine na aplicação. Como evitar carregar frameworks Rails com Load e Hooks de Configuração." />
  <meta property="og:description" content="Introdução às EnginesNeste guia você irá aprender sobre engines e como elas podem ser utilizadas para prover funcionalidades adicionais para suas aplicações hospedeiras através de uma interface bem limpa e fácil de usar.Após ler este guia, você saberá: O que compõe uma engine. Como gerar uma engine. Como construir as funcionalidades para a engine. Como conectar a engine em uma aplicação. Como substituir a funcionalidade de uma engine na aplicação. Como evitar carregar frameworks Rails com Load e Hooks de Configuração." />
  <meta property="og:locale" content="pt_BR" />
  <meta property="og:site_name" content="Guia Ruby on Rails" />
  <meta property="og:image" content="https://avatars.githubusercontent.com/u/4223" />
  <meta property="og:type" content="website" />
</head>
<body class="guide">
  <div>
    <div id="version-badge">v7.0.8</div>
  </div>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">Veja mais em <a href="https://rubyonrails.org/">rubyonrails.org:</a> </strong>
      <span class="red-button more-info-button">
        Mais Ruby on Rails
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://rubyonrails.org/blog">Blog</a></li>
        <li class="more-info"><a href="https://guides.rubyonrails.org/">Guia oficial</a></li>
        <li class="more-info"><a href="https://api.rubyonrails.org/">API</a></li>
        <li class="more-info"><a href="https://discuss.rubyonrails.org/">Forum</a></li>
        <li class="more-info"><a href="https://github.com/rails/rails">Contribua no GitHub</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="Voltar para a página principal">Guiarails.com.br</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">Home</a></li>
        <li class="guides-search guides-search-large">
          <input class="search-box search-box-large nav-item" type="text" placeholder="Digite o termo...">
          <div class="search-results"></div>
          <div class="search-spinner">Aguarde...</div>
        </li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">Guias</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
            <dl class="guides-section-container">
                <div class="guides-section">
                  <dt>Comece aqui</dt>
                  <dd><a href="getting_started.html">Começando com Rails</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Models</dt>
                  <dd><a href="active_record_basics.html">Active Record Basics</a></dd>
                  <dd><a href="active_record_migrations.html">Active Record Migrations</a></dd>
                  <dd><a href="active_record_validations.html">Active Record Validations</a></dd>
                  <dd><a href="active_record_callbacks.html">Active Record Callbacks</a></dd>
                  <dd><a href="association_basics.html">Active Record Associations</a></dd>
                  <dd><a href="active_record_querying.html">Active Record Query Interface</a></dd>
                  <dd><a href="active_model_basics.html">Active Model Basics</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Views</dt>
                  <dd><a href="action_view_overview.html">Action View Overview</a></dd>
                  <dd><a href="layouts_and_rendering.html">Layouts and Rendering in Rails</a></dd>
                  <dd><a href="action_view_helpers.html">Action View Helpers</a></dd>
                  <dd><a href="form_helpers.html">Action View Form Helpers</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Controllers</dt>
                  <dd><a href="action_controller_overview.html">Action Controller Overview</a></dd>
                  <dd><a href="routing.html">Rails Routing from the Outside In</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Outros componentes</dt>
                  <dd><a href="active_support_core_extensions.html">Active Support Core Extensions</a></dd>
                  <dd><a href="action_mailer_basics.html">Action Mailer Basics</a></dd>
                  <dd><a href="action_mailbox_basics.html">Action Mailbox Basics</a></dd>
                  <dd><a href="action_text_overview.html">Action Text Overview</a></dd>
                  <dd><a href="active_job_basics.html">Active Job Basics</a></dd>
                  <dd><a href="active_storage_overview.html">Active Storage Overview</a></dd>
                  <dd><a href="action_cable_overview.html">Action Cable Overview</a></dd>
                  <dd><a href="webpacker.html">Webpacker</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Indo mais fundo</dt>
                  <dd><a href="i18n.html">Rails Internationalization (I18n) API</a></dd>
                  <dd><a href="testing.html">Testing Rails Applications</a></dd>
                  <dd><a href="security.html">Securing Rails Applications</a></dd>
                  <dd><a href="debugging_rails_applications.html">Debugging Rails Applications</a></dd>
                  <dd><a href="configuring.html">Configuring Rails Applications</a></dd>
                  <dd><a href="command_line.html">The Rails Command Line</a></dd>
                  <dd><a href="asset_pipeline.html">The Asset Pipeline</a></dd>
                  <dd><a href="working_with_javascript_in_rails.html">Working with JavaScript in Rails</a></dd>
                  <dd><a href="initialization.html">The Rails Initialization Process</a></dd>
                  <dd><a href="autoloading_and_reloading_constants.html">Autoloading and Reloading Constants</a></dd>
                  <dd><a href="classic_to_zeitwerk_howto.html">Classic para Zeitwerk - Como Fazer</a></dd>
                  <dd><a href="caching_with_rails.html">Caching with Rails: An Overview</a></dd>
                  <dd><a href="active_support_instrumentation.html">Active Support Instrumentation</a></dd>
                  <dd><a href="api_app.html">Using Rails for API-only Applications</a></dd>
                  <dd><a href="active_record_postgresql.html">Active Record and PostgreSQL</a></dd>
                  <dd><a href="active_record_multiple_databases.html">Multiple Databases with Active Record</a></dd>
                  <dd><a href="active_record_encryption.html">Active Record Encryption</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Estendendo o Rails</dt>
                  <dd><a href="plugins.html">The Basics of Creating Rails Plugins</a></dd>
                  <dd><a href="rails_on_rack.html">Rails on Rack</a></dd>
                  <dd><a href="generators.html">Creating and Customizing Rails Generators &amp; Templates</a></dd>
                  <dd><a href="engines.html">Getting Started with Engines</a></dd>
                  <dd><a href="threading_and_code_execution.html">Threading and Code Execution in Rails</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Contribuições</dt>
                  <dd><a href="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails</a></dd>
                  <dd><a href="api_documentation_guidelines.html">API Documentation Guidelines</a></dd>
                  <dd><a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Políticas</dt>
                  <dd><a href="maintenance_policy.html">Maintenance Policy for Ruby on Rails</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Release Notes</dt>
                  <dd><a href="upgrading_ruby_on_rails.html">Upgrading Ruby on Rails</a></dd>
                  <dd><a href="7_0_release_notes.html">Version 7.0 - Dezembro 2021</a></dd>
                  <dd><a href="6_1_release_notes.html">Version 6.1 - Dezembro 2020</a></dd>
                  <dd><a href="6_0_release_notes.html">Version 6.0 - Agosto 2019</a></dd>
                  <dd><a href="5_2_release_notes.html">Version 5.2 - April 2018</a></dd>
                  <dd><a href="5_1_release_notes.html">Version 5.1 - April 2017</a></dd>
                  <dd><a href="5_0_release_notes.html">Version 5.0 - June 2016</a></dd>
                  <dd><a href="4_2_release_notes.html">Version 4.2 - December 2014</a></dd>
                  <dd><a href="4_1_release_notes.html">Version 4.1 - April 2014</a></dd>
                  <dd><a href="4_0_release_notes.html">Version 4.0 - June 2013</a></dd>
                  <dd><a href="3_2_release_notes.html">Version 3.2 - January 2012</a></dd>
                  <dd><a href="3_1_release_notes.html">Version 3.1 - August 2011</a></dd>
                  <dd><a href="3_0_release_notes.html">Version 3.0 - August 2010</a></dd>
                  <dd><a href="2_3_release_notes.html">Version 2.3 - March 2009</a></dd>
                  <dd><a href="2_2_release_notes.html">Version 2.2 - November 2008</a></dd>
                </div>
            </div>
          </dl>
        </li>
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">Contribua</a></li>
        <li class="guides-search guides-search-small">
          <input class="search-box search-box-small nav-item" type="text" placeholder="Digite o termo...">
          <div class="search-results"></div>
          <div class="search-spinner">Aguarde...</div>
        </li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">Guias</option>
              <optgroup label="Comece aqui">
                  <option value="getting_started.html">Começando com Rails</option>
              </optgroup>
              <optgroup label="Models">
                  <option value="active_record_basics.html">Active Record Basics</option>
                  <option value="active_record_migrations.html">Active Record Migrations</option>
                  <option value="active_record_validations.html">Active Record Validations</option>
                  <option value="active_record_callbacks.html">Active Record Callbacks</option>
                  <option value="association_basics.html">Active Record Associations</option>
                  <option value="active_record_querying.html">Active Record Query Interface</option>
                  <option value="active_model_basics.html">Active Model Basics</option>
              </optgroup>
              <optgroup label="Views">
                  <option value="action_view_overview.html">Action View Overview</option>
                  <option value="layouts_and_rendering.html">Layouts and Rendering in Rails</option>
                  <option value="action_view_helpers.html">Action View Helpers</option>
                  <option value="form_helpers.html">Action View Form Helpers</option>
              </optgroup>
              <optgroup label="Controllers">
                  <option value="action_controller_overview.html">Action Controller Overview</option>
                  <option value="routing.html">Rails Routing from the Outside In</option>
              </optgroup>
              <optgroup label="Outros componentes">
                  <option value="active_support_core_extensions.html">Active Support Core Extensions</option>
                  <option value="action_mailer_basics.html">Action Mailer Basics</option>
                  <option value="action_mailbox_basics.html">Action Mailbox Basics</option>
                  <option value="action_text_overview.html">Action Text Overview</option>
                  <option value="active_job_basics.html">Active Job Basics</option>
                  <option value="active_storage_overview.html">Active Storage Overview</option>
                  <option value="action_cable_overview.html">Action Cable Overview</option>
                  <option value="webpacker.html">Webpacker</option>
              </optgroup>
              <optgroup label="Indo mais fundo">
                  <option value="i18n.html">Rails Internationalization (I18n) API</option>
                  <option value="testing.html">Testing Rails Applications</option>
                  <option value="security.html">Securing Rails Applications</option>
                  <option value="debugging_rails_applications.html">Debugging Rails Applications</option>
                  <option value="configuring.html">Configuring Rails Applications</option>
                  <option value="command_line.html">The Rails Command Line</option>
                  <option value="asset_pipeline.html">The Asset Pipeline</option>
                  <option value="working_with_javascript_in_rails.html">Working with JavaScript in Rails</option>
                  <option value="initialization.html">The Rails Initialization Process</option>
                  <option value="autoloading_and_reloading_constants.html">Autoloading and Reloading Constants</option>
                  <option value="classic_to_zeitwerk_howto.html">Classic para Zeitwerk - Como Fazer</option>
                  <option value="caching_with_rails.html">Caching with Rails: An Overview</option>
                  <option value="active_support_instrumentation.html">Active Support Instrumentation</option>
                  <option value="api_app.html">Using Rails for API-only Applications</option>
                  <option value="active_record_postgresql.html">Active Record and PostgreSQL</option>
                  <option value="active_record_multiple_databases.html">Multiple Databases with Active Record</option>
                  <option value="active_record_encryption.html">Active Record Encryption</option>
              </optgroup>
              <optgroup label="Estendendo o Rails">
                  <option value="plugins.html">The Basics of Creating Rails Plugins</option>
                  <option value="rails_on_rack.html">Rails on Rack</option>
                  <option value="generators.html">Creating and Customizing Rails Generators &amp; Templates</option>
                  <option value="engines.html">Getting Started with Engines</option>
                  <option value="threading_and_code_execution.html">Threading and Code Execution in Rails</option>
              </optgroup>
              <optgroup label="Contribuições">
                  <option value="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails</option>
                  <option value="api_documentation_guidelines.html">API Documentation Guidelines</option>
                  <option value="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</option>
              </optgroup>
              <optgroup label="Políticas">
                  <option value="maintenance_policy.html">Maintenance Policy for Ruby on Rails</option>
              </optgroup>
              <optgroup label="Release Notes">
                  <option value="upgrading_ruby_on_rails.html">Upgrading Ruby on Rails</option>
                  <option value="7_0_release_notes.html">Version 7.0 - Dezembro 2021</option>
                  <option value="6_1_release_notes.html">Version 6.1 - Dezembro 2020</option>
                  <option value="6_0_release_notes.html">Version 6.0 - Agosto 2019</option>
                  <option value="5_2_release_notes.html">Version 5.2 - April 2018</option>
                  <option value="5_1_release_notes.html">Version 5.1 - April 2017</option>
                  <option value="5_0_release_notes.html">Version 5.0 - June 2016</option>
                  <option value="4_2_release_notes.html">Version 4.2 - December 2014</option>
                  <option value="4_1_release_notes.html">Version 4.1 - April 2014</option>
                  <option value="4_0_release_notes.html">Version 4.0 - June 2013</option>
                  <option value="3_2_release_notes.html">Version 3.2 - January 2012</option>
                  <option value="3_1_release_notes.html">Version 3.1 - August 2011</option>
                  <option value="3_0_release_notes.html">Version 3.0 - August 2010</option>
                  <option value="2_3_release_notes.html">Version 2.3 - March 2009</option>
                  <option value="2_2_release_notes.html">Version 2.2 - November 2008</option>
              </optgroup>
          </select>
        </li>
      </ul>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Introdução às <em>Engines</em></h2><p>Neste guia você irá aprender sobre <em>engines</em> e como elas podem ser utilizadas para prover funcionalidades adicionais para suas aplicações hospedeiras através de uma interface bem limpa e fácil de usar.</p><p>Após ler este guia, você saberá:</p>
<ul>
<li>O que compõe uma <em>engine</em>.</li>
<li>Como gerar uma <em>engine</em>.</li>
<li>Como construir as funcionalidades para a <em>engine</em>.</li>
<li>Como conectar a <em>engine</em> em uma aplicação.</li>
<li>Como substituir a funcionalidade de uma <em>engine</em> na aplicação.</li>
<li>Como evitar carregar frameworks Rails com <em>Load</em> e <em>Hooks</em> de Configuração.</li>
</ul>


                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li><a href="#o-que-s%C3%A3o-engines-questionmark">O que são <em>Engines</em>?</a></li>
<li>
<a href="#gerando-uma-engine">Gerando uma <em>Engine</em></a>

<ul>
<li><a href="#dentro-de-uma-engine">Dentro de uma <em>engine</em></a></li>
</ul>
</li>
<li>
<a href="#fornecendo-funcionalidades-a-engine">Fornecendo Funcionalidades a <em>Engine</em></a>

<ul>
<li><a href="#gerando-um-recurso-de-artigo">Gerando um Recurso de Artigo</a></li>
<li><a href="#gerando-um-recurso-de-coment%C3%A1rios">Gerando um Recurso de Comentários</a></li>
</ul>
</li>
<li>
<a href="#hooking-into-an-application">Hooking Into an Application</a>

<ul>
<li><a href="#mounting-the-engine">Mounting the Engine</a></li>
<li><a href="#engine-setup">Engine Setup</a></li>
<li><a href="#using-a-class-provided-by-the-application">Using a Class Provided by the Application</a></li>
<li><a href="#configuring-an-engine">Configuring an Engine</a></li>
</ul>
</li>
<li>
<a href="#testando-uma-engine">Testando uma <em>Engine</em></a>

<ul>
<li><a href="#testes-funcionais">Testes funcionais</a></li>
</ul>
</li>
<li>
<a href="#improving-engine-functionality">Improving Engine Functionality</a>

<ul>
<li><a href="#overriding-models-and-controllers">Overriding Models and Controllers</a></li>
<li><a href="#autoloading-and-engines">Autoloading and Engines</a></li>
<li><a href="#overriding-views">Overriding Views</a></li>
<li><a href="#routes">Routes</a></li>
<li><a href="#assets">Assets</a></li>
<li><a href="#separate-assets-and-precompiling">Separate Assets and Precompiling</a></li>
<li><a href="#other-gem-dependencies">Other Gem Dependencies</a></li>
</ul>
</li>
<li>
<a href="#load-and-configuration-hooks">Load and Configuration Hooks</a>

<ul>
<li><a href="#avoid-loading-rails-frameworks">Avoid Loading Rails Frameworks</a></li>
<li><a href="#when-are-hooks-called-questionmark">When are Hooks called?</a></li>
<li><a href="#modifying-code-to-use-load-hooks">Modifying Code to Use Load Hooks</a></li>
<li><a href="#available-load-hooks">Available Load Hooks</a></li>
<li><a href="#available-configuration-hooks">Available Configuration Hooks</a></li>
</ul>
</li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h3 id="o-que-são-engines-questionmark"><a class="anchorlink" href="#o-que-s%C3%A3o-engines-questionmark">1 O que são <em>Engines</em>?</a></h3><p><em>Engines</em> podem ser consideradas aplicações em miniatura que fornecem funcionalidades
para a aplicação hospedeira. Uma aplicação Rails é na verdade apenas uma <em>engine</em>
"sobrecarregada", com a classe <code>Rails::Application</code> herdando muitos de seus comportamentos
a partir da classe <code>Rails::Engine</code>.</p><p>Portanto, <em>engines</em> e aplicações podem ser tratadas quase como a mesma coisa,
apenas com algumas diferenças sutis, como você verá ao longo deste guia. <em>Engines</em>
e aplicações também compartilham uma estrutura em comum.</p><p><em>Engines</em> também são intimamente relacionadas a <em>plugins</em>. Os dois compartilham uma
estrutura de diretório <code>lib</code> e ambos são gerados usando o gerador <code>rails plugin new</code>.
A diferença é que uma <em>engine</em> é considerada um "<em>plugin</em> completo" pelo Rails
(como é indicado pela opção <code>--full</code> que é passada ao comando gerador). Entretanto,
nós iremos usar a opção <code>--mountable</code> aqui, que inclui todas as funcionalidades
da <code>--full</code>, e mais algumas. Este guia referenciará estes "<em>plugins</em> completos"
apenas como "<em>engines</em>" em todo o decorrer. Uma <em>engine</em> <strong>pode</strong> ser um <em>plugin</em>,
e um <em>plugin</em> <strong>pode</strong> ser uma <em>engine</em>.</p><p>A <em>engine</em> que será criada neste guia será chamada "blorgh". Essa <em>engine</em> proverá
a funcionalidade de <em>blogging</em> para sua aplicação hospedeira, permitindo a criação
de novos artigos e comentários. No começo deste guia, você irá trabalhar somente
com a <em>engine</em> em si, mas nas seções mais a frente, você verá como conectá-la em
uma aplicação.</p><p><em>Engines</em> também podem ser isoladas de sua aplicação hospedeira. Isso significa que
uma aplicação é capaz de ter um caminho provido por um <em>helper</em> de roteamento,
como o <code>articles_path</code> e usar uma <em>engine</em> que também provê um caminho chamado
<code>articles_path</code>, e os dois não sofreram conflito. Junto com isso, <em>controllers</em>,
<em>models</em> e nomes de tabela também são separados por <em>namespace</em>. Você verá como
fazer isso mais tarde neste guia.</p><p>É importante ter em mente que a aplicação <strong>sempre</strong> terá precedência
sobre suas <em>engines</em>. Uma aplicação é o objeto que terá a palavra final sobre o
que estará presente no ambiente. A <em>engine</em> estará somente a aprimorando, ao invés
de mudá-la drasticamente.</p><p>Para ver demonstrações de outras <em>engines</em>,
veja <a href="https://github.com/plataformatec/devise">Devise</a>, uma <em>engine</em> que provê
autenticação para suas aplicações hospedeiras, ou
<a href="https://github.com/thredded/thredded">Thredded</a>, uma <em>engine</em> que provê
funcionalidades de fórum, também há
<a href="https://github.com/spree/spree">Spree</a>, que provê uma plataforma de <em>e-commerce</em>,
e <a href="https://github.com/refinery/refinerycms">Refinery CMS</a>, uma <em>engine</em> de CMS.</p><p>Por fim, <em>engines</em> não seriam possíveis sem o trabalho de James Adam,
Piotr Sarnacki, a equipe principal do Rails e várias outras pessoas. Se algum dia
você se encontrar com eles, não se esqueça de dizer "obrigado(a)"!</p><h3 id="gerando-uma-engine"><a class="anchorlink" href="#gerando-uma-engine">2 Gerando uma <em>Engine</em></a></h3><p>Para gerar uma <em>engine</em>, você precisará rodar o gerador de <em>plugin</em> e passar a ele
opções conforme for necessário. Para o exemplo do "blorgh", você precisará criar
uma <em>engine</em> "montável" (<em>mountable</em>), executando o seguinte comando em um terminal:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">rails </span>plugin new blorgh <span class="nt">--mountable</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="rails plugin new blorgh --mountable
">Copy</button>
</div>
<p>A lista com todas as opções disponíveis no gerador de <em>plugin</em> pode ser vista digitando:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">rails </span>plugin <span class="nt">--help</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="rails plugin --help
">Copy</button>
</div>
<p>A opção <code>--mountable</code> indica ao gerador que você quer criar uma <em>engine</em>
"montável" e com <em>namespace</em> isolado. Esse gerador fornecerá a mesma estrutura de
esqueleto que a opção <code>--full</code>. A opção <code>--full</code> indica ao
gerador que você quer criar uma <em>engine</em>, incluindo uma estrutura de esqueleto
que fornece o seguinte:</p>
<ul>
<li>Uma árvore de diretório <code>app</code>
</li>
<li>
<p>Um arquivo <code>config/routes.rb</code>:</p>
<div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Rails.application.routes.draw do
end
">Copy</button>
</div>
</li>
<li>
<p>Um arquivo em <code>lib/blorgh/engine.rb</code>, que é idêntico em função quando se compara
ao arquivo <code>config/application.rb</code> presente em aplicações Rails padrões:</p>
<div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">Blorgh</span>
  <span class="k">class</span> <span class="nc">Engine</span> <span class="o">&lt;</span> <span class="o">::</span><span class="no">Rails</span><span class="o">::</span><span class="no">Engine</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="module Blorgh
  class Engine &lt; ::Rails::Engine
  end
end
">Copy</button>
</div>
</li>
</ul>
<p>A opção <code>--mountable</code> adicionará à opção <code>--full</code>:</p>
<ul>
<li>Arquivos de manifesto de recursos (<code>blorgh_manifest.js</code> and <code>application.css</code>)</li>
<li>Um <em>stub</em> <code>ApplicationController</code> com <em>namespace</em>
</li>
<li>Um <em>stup</em> <code>ApplicationHelper</code> com <em>namespace</em>
</li>
<li>Um <em>template</em> de <em>layout</em> para as <em>views</em> da <em>engine</em>
</li>
<li>
<p>Isolação de <em>namespace</em> em <code>config/routes.rb</code>:</p>
<div class="code_container">
<pre><code class="highlight ruby"><span class="no">Blorgh</span><span class="o">::</span><span class="no">Engine</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Blorgh::Engine.routes.draw do
end
">Copy</button>
</div>
</li>
<li>
<p>Isolação de <em>namespace</em> em <code>lib/blorgh/engine.rb</code>:</p>
<div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">Blorgh</span>
  <span class="k">class</span> <span class="nc">Engine</span> <span class="o">&lt;</span> <span class="o">::</span><span class="no">Rails</span><span class="o">::</span><span class="no">Engine</span>
    <span class="n">isolate_namespace</span> <span class="no">Blorgh</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="module Blorgh
  class Engine &lt; ::Rails::Engine
    isolate_namespace Blorgh
  end
end
">Copy</button>
</div>
</li>
</ul>
<p>De forma adicional, a opção <code>--mountable</code> indica ao gerador para montar a
<em>engine</em> dentro da aplicação de teste fictícia localizada em <code>test/dummy</code> ao
adicionar o seguinte as rotas da aplicação fictícia em <code>test/dummy/config/routes.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">mount</span> <span class="no">Blorgh</span><span class="o">::</span><span class="no">Engine</span> <span class="o">=&gt;</span> <span class="s2">"/blorgh"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='mount Blorgh::Engine =&gt; "/blorgh"
'>Copy</button>
</div>
<h4 id="dentro-de-uma-engine"><a class="anchorlink" href="#dentro-de-uma-engine">2.1 Dentro de uma <em>engine</em></a></h4><h5 id="arquivos-críticos"><a class="anchorlink" href="#arquivos-cr%C3%ADticos">2.1.1 Arquivos Críticos</a></h5><p>No diretório raiz dessa nova <em>engine</em> há um arquivo <code>blorgh.gemspec</code>.
Quando você incluir a <em>engine</em> em uma aplicação mais tarde, você fará isso
colocando esta linha no <code>Gemfile</code> de sua aplicação Rails:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">gem</span> <span class="s1">'blorgh'</span><span class="p">,</span> <span class="ss">path: </span><span class="s1">'engines/blorgh'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="gem 'blorgh', path: 'engines/blorgh'
">Copy</button>
</div>
<p>Não esqueça de executar <code>bundle install</code> como de costume. Ao especificá-la como
uma <em>gem</em> dentro do <code>Gemfile</code>, o Bundler irá carregá-la de acordo, analisando esse
arquivo <code>blorgh.gemspec</code> e requerindo um arquivo dentro do diretório <code>lib</code> chamado
<code>lib/blorgh.rb</code>. Esse arquivo requere o arquivo <code>blorgh/engine.rb</code> (localizado em
<code>lib/blorgh/engine.rb</code>) e define um módulo base chamado <code>Blorgh</code>.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">require</span> <span class="s2">"blorgh/engine"</span>

<span class="k">module</span> <span class="nn">Blorgh</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='require "blorgh/engine"

module Blorgh
end
'>Copy</button>
</div>
<div class="info"><p>Some engines choose to use this file to put global configuration options
for their engine. It's a relatively good idea, so if you want to offer
configuration options, the file where your engine's <code>module</code> is defined is
perfect for that. Place the methods inside the module and you'll be good to go.</p></div><p>Dentro de <code>lib/blorgh/engine.rb</code> está a classe base da <em>engine</em></p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">Blorgh</span>
  <span class="k">class</span> <span class="nc">Engine</span> <span class="o">&lt;</span> <span class="o">::</span><span class="no">Rails</span><span class="o">::</span><span class="no">Engine</span>
    <span class="n">isolate_namespace</span> <span class="no">Blorgh</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="module Blorgh
  class Engine &lt; ::Rails::Engine
    isolate_namespace Blorgh
  end
end
">Copy</button>
</div>
<p>Ao herdar da classe <code>Rails::Engine</code>, essa <em>gem</em> notifica ao Rails que existe
uma <em>engine</em> no caminho especificado e montará corretamente a <em>engine</em> dentro
da aplicação, executando tarefas como adicionar o diretório <code>app</code> da <em>engine</em> ao
caminho de carregamento (<em>load path</em>) para <em>models</em>, <em>mailers</em>, <em>controllers</em> e <em>views</em>.</p><p>O método <code>isolate_namespace</code> merece uma nota especial. Essa chamada é responsável
por isolar os <em>controllers</em>, <em>models</em>, rotas e outras coisas em seu próprio <em>namespace</em>,
separado de componentes similares dentro da aplicação.
Sem isso, haveria a possibilidade dos componentes da <em>engine</em> "vazarem" dentro
da aplicação, causando uma disrupção indesejada, ou que componentes importantes
da <em>engine</em> fossem sobrescritos por coisas com nomes similares existentes na aplicação.
Um exemplo de conflitos como esses são os <em>helpers</em>. Sem chamar <code>isolate_namespace</code>,
os <em>helpers</em> da <em>engine</em> seriam incluídos nos <em>controllers</em> da aplicação.</p><div class="note"><p>It is <strong>highly</strong> recommended that the <code>isolate_namespace</code> line be left
within the <code>Engine</code> class definition. Without it, classes generated in an engine
<strong>may</strong> conflict with an application.</p></div><p>O que esse isolamento de <em>namespace</em> significa é que um <em>model</em> gerado por uma chamada
ao <code>bin/rails generate model</code>, como <code>bin/rails generate model article</code>, não será
chamada <code>Article</code>, mas sim dentro de um <em>namespace</em>, chamado de <code>Blorgh::Article</code>.
Além disso, a tabela para o <em>model</em> também usará o <em>namespace</em>, tornando-se <code>blorgh_articles</code>,
ao invés de simplesmente <code>articles</code>.
Similar ao <em>namespacing</em> do <em>model</em>, um <em>controller</em> chamado <code>ArticlesController</code>
se torna <code>Blorgh::ArticlesController</code> e as <em>views</em> desse <em>controller</em> não estarão
em <code>app/views/articles</code>, mas sim em <code>app/views/blorgh/articles</code>. <em>Mailers</em>, <em>jobs</em>
e <em>helpers</em> também são incluídos no <em>namespace</em>.</p><p>Por fim, as rotas também serão isoladas dentro da <em>engine</em>. Essa é uma das
partes mais importantes sobre <em>namespacing</em>, e é discutida mais tarde na seção
<a href="#routes">Rotas</a> deste guia.</p><h5 id="diretório-app"><a class="anchorlink" href="#diret%C3%B3rio-app">2.1.2 Diretório <code>app</code></a></h5><p>Dentro do diretório <code>app</code> estão os diretórios padrões <code>assets</code>, <code>controllers</code>, <code>helpers</code>,
<code>jobs</code>, <code>mailers</code>, <code>models</code>, e <code>views</code> de uma aplicação que você deve estar familiarizado.
Nós veremos mais sobre <em>models</em> em uma seção futura, quando estivermos escrevendo a <em>engine</em>.</p><p>Dentro do diretório <code>app/assets</code>, estão os diretórios <code>images</code> e <code>stylesheets</code> que,
novamente, já deve ser familiar a você devido sua similaridade com uma aplicação.
Uma diferença aqui, entretanto, é que cada diretório contém um sub-diretório com o nome
da <em>engine</em>. Como essa <em>engine</em> utiliza um <em>namespace</em>, seus <em>assets</em> também devem usar.</p><p>Dentro do diretório <code>app/controllers</code> há um diretório <code>blorgh</code> que contém um
arquivo chamado <code>application_controller.rb</code>. Esse arquivo fornecerá funcionalidades
comuns aos <em>controllers</em> da <em>engine</em>. O diretório <code>blorgh</code> é onde os outros <em>controllers</em>
da <em>engine</em> estarão. Ao colocá-los neste diretório com <em>namespace</em>, você estará evitando
que eles possam conflitar com <em>controllers</em> com nomes idênticos  de <em>controllers</em> existentes
em outras <em>engines</em> ou da própria aplicação.</p><div class="note"><p>The <code>ApplicationController</code> class inside an engine is named just like a
Rails application in order to make it easier for you to convert your
applications into engines.</p></div><div class="note"><p>If the parent application runs in <code>classic</code> mode, you may run into a
situation where your engine controller is inheriting from the main application
controller and not your engine's application controller. The best way to prevent
this is to switch to <code>zeitwerk</code> mode in the parent application. Otherwise, use
<code>require_dependency</code> to ensure that the engine's application controller is
loaded. For example:</p></div><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># ONLY NEEDED IN `classic` MODE.</span>
<span class="n">require_dependency</span> <span class="s2">"blorgh/application_controller"</span>

<span class="k">module</span> <span class="nn">Blorgh</span>
  <span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='# ONLY NEEDED IN `classic` MODE.
require_dependency "blorgh/application_controller"

module Blorgh
  class ArticlesController &lt; ApplicationController
    # ...
  end
end
'>Copy</button>
</div>
<div class="warning"><p>Don't use <code>require</code> because it will break the automatic reloading of
classes in the development environment - using <code>require_dependency</code> ensures that
classes are loaded and unloaded in the correct manner.</p></div><p>Assim como para <code>app/controllers</code>, você encontrará um subdiretório <code>blorgh</code> dentro
dos diretórios <code>app/helpers</code>, <code>app/jobs</code>, <code>app/mailers</code> e <code>app/models</code> contendo
o arquivo associado <code>application_*.rb</code> para reunir funcionalidades comuns. Ao
colocar seus arquivos nesse subdiretório e utilizar o <em>namespace</em> nos seus objetos,
você evita que eles possam conflitar com elementos de nome idênticos  ao de outras
<em>engines</em> ou até mesmo da própria aplicação.</p><p>Por último, o diretório <code>app/views</code> contém uma pasta <code>layouts</code>, que contém um
arquivo em <code>blorgh/application.html.erb</code>. Esse arquivo permite que você especifique
um <em>layout</em> para a <em>engine</em>. Se a <em>engine</em> for utilizada sozinha, então você deve
adicionar as personalizações necessárias para seu arquivo de <code>layout</code> ao invés do
arquivo <code>app/views/layouts/application.html.erb</code> da aplicação.</p><p>Se você não quer forçar um <em>layout</em> para os usuários da <em>engine</em>, então você pode
deletar esse arquivo e referenciar um <em>layout</em> diferente nos <em>controllers</em> da sua
<em>engine</em>.</p><h5 id="diretório-bin"><a class="anchorlink" href="#diret%C3%B3rio-bin">2.1.3 Diretório <code>bin</code></a></h5><p>Esse diretório contém um arquivo, <code>bin/rails</code>, que possibilita o uso dos sub-comandos
e geradores do Rails assim como você utilizaria em uma aplicação. Isso significa que
você terá a habilidade de gerar novos <em>controllers</em> e <em>models</em> para essa <em>engine</em> de
forma bem simples ao rodar comandos como este:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate model
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails generate model
">Copy</button>
</div>
<p>Tenha em mente, é claro, que tudo gerado com esses comandos dentro de uma <em>engine</em>
que contém o <code>isolate_namespace</code> na classe <code>Engine</code> conterá um <em>namespace</em>.</p><h5 id="diretório-test"><a class="anchorlink" href="#diret%C3%B3rio-test">2.1.4 Diretório <code>test</code></a></h5><p>O diretório <code>test</code> é onde os testes para a <em>engine</em> estarão. Para testar a <em>engine</em>,
há uma versão reduzida de uma aplicação Rails embutida nela em <code>test/dummy</code>. Essa
aplicação irá montar a <em>engine</em> no arquivo <code>test/dummy/config/routes.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">mount</span> <span class="no">Blorgh</span><span class="o">::</span><span class="no">Engine</span> <span class="o">=&gt;</span> <span class="s2">"/blorgh"</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='Rails.application.routes.draw do
  mount Blorgh::Engine =&gt; "/blorgh"
end
'>Copy</button>
</div>
<p>Essa linha monta a <em>engine</em> no caminho <code>/blorgh</code>, que a tornará acessível através
da aplicação somente neste caminho.</p><p>Dentro do diretório de teste há o diretório <code>test/integration</code>, onde os testes
de integração devem ser colocados. Outros diretórios também podem ser criados
no diretório <code>test</code>. Por exemplo, você pode querer criar um diretório <code>test/models</code>
para os testes de <em>models</em>.</p><h3 id="fornecendo-funcionalidades-a-engine"><a class="anchorlink" href="#fornecendo-funcionalidades-a-engine">3 Fornecendo Funcionalidades a <em>Engine</em></a></h3><p>A <em>engine</em> que este guia cobre fornece funcionalidades de submeter artigos e
comentários e segue na mesma linha do <a href="getting_started.html">Guia Começando com Rails</a>, com algumas
novas alterações.</p><div class="note"><p>For this section, make sure to run the commands in the root of the
<code>blorgh</code> engine's directory.</p></div><h4 id="gerando-um-recurso-de-artigo"><a class="anchorlink" href="#gerando-um-recurso-de-artigo">3.1 Gerando um Recurso de Artigo</a></h4><p>A primeira coisa a se gerar para uma <em>engine</em> de blog é o <em>model</em> <code>Article</code> e o
<em>controller</em> relacionado. Para gerar isso rapidamente, você pode utilizar o
gerador de <em>scaffold</em> do Rails.</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate scaffold article title:string text:text
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails generate scaffold article title:string text:text
">Copy</button>
</div>
<p>Esse comando gerará a seguinte saída:</p><div class="code_container">
<pre><code class="highlight plaintext">invoke  active_record
create    db/migrate/[timestamp]_create_blorgh_articles.rb
create    app/models/blorgh/article.rb
invoke    test_unit
create      test/models/blorgh/article_test.rb
create      test/fixtures/blorgh/articles.yml
invoke  resource_route
 route    resources :articles
invoke  scaffold_controller
create    app/controllers/blorgh/articles_controller.rb
invoke    erb
create      app/views/blorgh/articles
create      app/views/blorgh/articles/index.html.erb
create      app/views/blorgh/articles/edit.html.erb
create      app/views/blorgh/articles/show.html.erb
create      app/views/blorgh/articles/new.html.erb
create      app/views/blorgh/articles/_form.html.erb
invoke    test_unit
create      test/controllers/blorgh/articles_controller_test.rb
create      test/system/blorgh/articles_test.rb
invoke    helper
create      app/helpers/blorgh/articles_helper.rb
invoke      test_unit
</code></pre>
<button class="clipboard-button" data-clipboard-text="invoke  active_record
create    db/migrate/[timestamp]_create_blorgh_articles.rb
create    app/models/blorgh/article.rb
invoke    test_unit
create      test/models/blorgh/article_test.rb
create      test/fixtures/blorgh/articles.yml
invoke  resource_route
 route    resources :articles
invoke  scaffold_controller
create    app/controllers/blorgh/articles_controller.rb
invoke    erb
create      app/views/blorgh/articles
create      app/views/blorgh/articles/index.html.erb
create      app/views/blorgh/articles/edit.html.erb
create      app/views/blorgh/articles/show.html.erb
create      app/views/blorgh/articles/new.html.erb
create      app/views/blorgh/articles/_form.html.erb
invoke    test_unit
create      test/controllers/blorgh/articles_controller_test.rb
create      test/system/blorgh/articles_test.rb
invoke    helper
create      app/helpers/blorgh/articles_helper.rb
invoke      test_unit
">Copy</button>
</div>
<p>A primeira coisa que o gerador de <em>scaffold</em> faz é invocar o gerador <code>active_record</code>,
que gera uma migração e um <code>model</code> para o recurso. Note que, porém, a migração é
chamada <code>create_blorgh_articles</code> ao invés de <code>create_articles</code>. Isso se deve a
chamada do método <code>isolate_namespace</code> na definição da classe <code>Blorgh::Engine</code>. O <em>model</em>
aqui também está sob um <em>namespace</em>, colocado em <code>app/models/blorgh/article.rb</code> ao invés
de <code>app/models/article.rb</code> devido à chamada do método <code>isolate_namespace</code> dentro da
classe <code>Engine</code>.</p><p>A seguir, é invocado o gerador <code>test_unit</code> para este <em>model</em>, gerando um teste de <em>model</em>
em <code>test/models/blorgh/article_test.rb</code> (ao invés de <code>test/models/article_test.rb</code>) e uma
<em>fixture</em> em <code>test/fixtures/blorgh/articles.yml</code> (ao invés de <code>test/fixtures/articles.yml</code>).</p><p>Depois disso, uma linha para o recurso é inserida no arquivo <code>config/routes.rb</code> para
aquela <em>engine</em>. Essa linha é simplesmente <code>resources :articles</code>, transformando o
arquivo <code>config/routes.rb</code> da <em>engine</em> nisto:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Blorgh</span><span class="o">::</span><span class="no">Engine</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:articles</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Blorgh::Engine.routes.draw do
  resources :articles
end
">Copy</button>
</div>
<p>Note que as rotas são escritas sobre o objeto <code>Blorgh::Engine</code> ao invés da classe
<code>YourApp::Application</code>. Isso acontece, pois assim as rotas da <em>engine</em> permanecem
confinadas na própria <em>engine</em> e podem ser montadas em um ponto específico como
mostrado na seção <a href="#test-directory">diretório de teste</a>. Isso também faz com que
as rotas da <em>engine</em> estejam isoladas das rotas da própria aplicação. A seção
<a href="#routes">Rotas</a> deste guia, descreve isso em detalhes.</p><p>A seguir, é invocado o gerador <code>scaffold_controller</code>, gerando um <em>controller</em> chamado
<code>Blorgh::ArticlesController</code> (em <code>app/controllers/blorgh/articles_controller.rb</code>) e
suas <em>views</em> relacionadas em <code>app/views/blorgh/articles</code>. Esse gerador também gera testes
para o <em>controller</em> (<code>test/controllers/blorgh/articles_controller_test.rb</code> e
<code>test/system/blorgh/articles_test.rb</code>) e um <em>helper</em> (<code>app/helpers/blorgh/articles_helper.rb</code>).</p><p>Tudo que esse gerador cria está sob um <em>namespace</em>. A classe do <em>controller</em> é
definida dentro de um módulo <code>Blorgh</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">Blorgh</span>
  <span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="module Blorgh
  class ArticlesController &lt; ApplicationController
    # ...
  end
end
">Copy</button>
</div>
<div class="note"><p>The <code>ArticlesController</code> class inherits from
<code>Blorgh::ApplicationController</code>, not the application's <code>ApplicationController</code>.</p></div><p>O <em>helper</em> dentro de <code>app/helpers/blorgh/articles_helper.rb</code> também está sob um <em>namespace</em>.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">Blorgh</span>
  <span class="k">module</span> <span class="nn">ArticlesHelper</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="module Blorgh
  module ArticlesHelper
    # ...
  end
end
">Copy</button>
</div>
<p>Isso ajuda a prevenir conflitos com qualquer outra <em>engine</em> ou aplicação que também
tenha um recurso de artigo.</p><p>Você pode ver o que a <em>engine</em> tem até agora executando <code>bin/rails db:migrate</code> na raiz
de sua <em>engine</em> para executar as migrações geradas pelo gerador de <em>scaffold</em>, e então
executar <code>bin/rails server</code> em <code>test/dummy</code>. Quando você abrir <code>http://localhost:3000/blorgh/articles</code>,
você verá o <em>scaffold</em> padrão que foi gerado.  Clique em volta! Você acaba de gerar as
primeiras funções de sua primeira <em>engine</em>.</p><p>Se você preferir testar utilizando o <em>console</em>, <code>bin/rails console</code> também funcionará
como uma aplicação Rails. Lembre-se: o model <code>Article</code> utiliza um <em>namespace</em>, então para
referenciá-lo, você deve chamá-lo como <code>Blorgh::Article</code>.</p><div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Blorgh</span><span class="o">::</span><span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">Blorgh</span><span class="o">::</span><span class="no">Article</span> <span class="ss">id: </span><span class="mi">1</span> <span class="o">...</span><span class="kt">&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Blorgh::Article.find(1)
">Copy</button>
</div>
<p>Uma última coisa é que o recurso <code>articles</code> para essa <em>engine</em> deve estar na
raiz da <em>engine</em>. Sempre que alguém for ao caminho raiz onde a <em>engine</em> está montada,
eles devem ver uma lista de artigos. Isso pode ser feito se essa linha for inserida
ao arquivo <code>config/routes.rb</code> dentro da <em>engine</em>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">root</span> <span class="ss">to: </span><span class="s2">"articles#index"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='root to: "articles#index"
'>Copy</button>
</div>
<p>Agora, as pessoas só precisarão ir à raiz da <em>engine</em> para ver os artigos, ao invés
de visitar <code>/articles</code>. Isso significa que ao invés de <code>http://localhost:3000/blorgh/articles</code>,
você agora só precisa ir até <code>http://localhost:3000/blorgh</code>.</p><h4 id="gerando-um-recurso-de-comentários"><a class="anchorlink" href="#gerando-um-recurso-de-coment%C3%A1rios">3.2 Gerando um Recurso de Comentários</a></h4><p>Agora que a <em>engine</em> pode criar novos artigos, faz sentido adicionar a funcionalidade
de comentários também. Para fazer isso, você precisará gerar um <em>model</em> de comentário,
um <em>controller</em> de comentários, e então modificar o <em>scaffold</em> de artigos para
exibir os comentários e permitir que pessoas possam criar novos comentários.</p><p>Da raiz da <em>engine</em>, execute o gerador de <em>model</em>. Indique a geração de um
<em>model</em> <code>Comment</code>, com a sua tabela contendo duas colunas: um inteiro <code>article_id</code>
e uma coluna de texto <code>text</code>.</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate model Comment article_id:integer text:text
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails generate model Comment article_id:integer text:text
">Copy</button>
</div>
<p>Isso produzirá a seguinte saída:</p><div class="code_container">
<pre><code class="highlight plaintext">invoke  active_record
create    db/migrate/[timestamp]_create_blorgh_comments.rb
create    app/models/blorgh/comment.rb
invoke    test_unit
create      test/models/blorgh/comment_test.rb
create      test/fixtures/blorgh/comments.yml
</code></pre>
<button class="clipboard-button" data-clipboard-text="invoke  active_record
create    db/migrate/[timestamp]_create_blorgh_comments.rb
create    app/models/blorgh/comment.rb
invoke    test_unit
create      test/models/blorgh/comment_test.rb
create      test/fixtures/blorgh/comments.yml
">Copy</button>
</div>
<p>Esse gerador gerará somente os arquivos de <em>model</em> que ele precisa, colocando
os arquivo dentro de um diretório <code>blorgh</code> e criando uma classe de <em>model</em>
chamada <code>Blorgh::Comment</code>. Agora execute a migração para criar nossa tabela
<code>blorgh_comments</code>.</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>db:migrate
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails db:migrate
">Copy</button>
</div>
<p>Para exibir os comentários em um artigo, edite <code>app/views/blorgh/articles/show.html.erb</code>
e adicione essas linhas antes do link "Edit".</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h3&gt;</span>Comments<span class="nt">&lt;/h3&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;h3&gt;Comments&lt;/h3&gt;
&lt;%= render @article.comments %&gt;
">Copy</button>
</div>
<p>Essa linha requer que exista uma associação <code>has_many</code> com os comentários definida
no <em>model</em> <code>Blorgh::Article</code>, o que não existe até o momento. Para defini-la, abra
<code>app/models/blorgh/article.rb</code> e adicione essa linha no <em>model</em>.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">has_many</span> <span class="ss">:comments</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="has_many :comments
">Copy</button>
</div>
<p>Transformando o <em>model</em> nisso:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">Blorgh</span>
  <span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
    <span class="n">has_many</span> <span class="ss">:comments</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="module Blorgh
  class Article &lt; ApplicationRecord
    has_many :comments
  end
end
">Copy</button>
</div>
<div class="note"><p>Because the <code>has_many</code> is defined inside a class that is inside the
<code>Blorgh</code> module, Rails will know that you want to use the <code>Blorgh::Comment</code>
model for these objects, so there's no need to specify that using the
<code>:class_name</code> option here.</p></div><p>A seguir, é necessário que tenhamos um formulário para que os comentários sejam
criados dentro de um artigo. Para adicionar isso, coloque essa linha logo após
<code>render @article.comments</code> em <code>app/views/blorgh/articles/show.html.erb</code>.</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s2">"blorgh/comments/form"</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;%= render "blorgh/comments/form" %&gt;
'>Copy</button>
</div>
<p>A seguir, a <em>partial</em> que essa linha renderizará precisa existir. Crie um novo
diretório <code>app/views/blorgh/comments</code> e dentro dele, um novo arquivo chamado
<code>_form.html.erb</code> que contem esse conteúdo para criar a <em>partial</em> requerida:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h3&gt;</span>New comment<span class="nt">&lt;/h3&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="p">[</span><span class="vi">@article</span><span class="p">,</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">build</span><span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:text</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:text</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;h3&gt;New comment&lt;/h3&gt;
&lt;%= form_with model: [@article, @article.comments.build] do |form| %&gt;
  &lt;p&gt;
    &lt;%= form.label :text %&gt;&lt;br&gt;
    &lt;%= form.text_area :text %&gt;
  &lt;/p&gt;
  &lt;%= form.submit %&gt;
&lt;% end %&gt;
">Copy</button>
</div>
<p>Quando esse formulário é submetido, ele tentará performar uma requisição do tipo
<code>POST</code> a uma rota <code>/articles/:article_id/comments</code> da <em>engine</em>. Essa ainda não existe
atualmente, mas pode ser criada mudando a linha <code>resources :articles</code> dentro de
<code>config/routes.rb</code> para estas linhas:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:articles</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:comments</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :articles do
  resources :comments
end
">Copy</button>
</div>
<p>Isso cria uma rota aninhada para os comentários, que o formulário requer.</p><p>Essa rota agora existe, mas o <em>controller</em> para onde está rota leva, não existe.
Para criá-lo, execute este comando na raiz da <em>engine</em>.</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate controller comments
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails generate controller comments
">Copy</button>
</div>
<p>Isso gerará o seguinte:</p><div class="code_container">
<pre><code class="highlight plaintext">create  app/controllers/blorgh/comments_controller.rb
invoke  erb
 exist    app/views/blorgh/comments
invoke  test_unit
create    test/controllers/blorgh/comments_controller_test.rb
invoke  helper
create    app/helpers/blorgh/comments_helper.rb
invoke    test_unit
</code></pre>
<button class="clipboard-button" data-clipboard-text="create  app/controllers/blorgh/comments_controller.rb
invoke  erb
 exist    app/views/blorgh/comments
invoke  test_unit
create    test/controllers/blorgh/comments_controller_test.rb
invoke  helper
create    app/helpers/blorgh/comments_helper.rb
invoke    test_unit
">Copy</button>
</div>
<p>O formulário está executando uma requisição do tipo <code>POST</code> para <code>/articles/:article_id/comments</code>
que corresponderá a ação <code>create</code> em <code>Blorgh::CommentsController</code>. Essa ação precisa ser
criada, o que pode ser feito colocando as seguintes linhas dentro da definição da classe
em <code>app/controllers/blorgh/comments_controller.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">create</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:article_id</span><span class="p">])</span>
  <span class="vi">@comment</span> <span class="o">=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">comment_params</span><span class="p">)</span>
  <span class="n">flash</span><span class="p">[</span><span class="ss">:notice</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Comment has been created!"</span>
  <span class="n">redirect_to</span> <span class="n">articles_path</span>
<span class="k">end</span>

<span class="kp">private</span>
  <span class="k">def</span> <span class="nf">comment_params</span>
    <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:comment</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:text</span><span class="p">)</span>
  <span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='def create
  @article = Article.find(params[:article_id])
  @comment = @article.comments.create(comment_params)
  flash[:notice] = "Comment has been created!"
  redirect_to articles_path
end

private
  def comment_params
    params.require(:comment).permit(:text)
  end
'>Copy</button>
</div>
<p>Isso é o último passo requerido para obter o formulário de novo comentário funcionando.
Exibir os comentários, entretanto, ainda não está funcionando. Se você criar um comentário
agora, você verá o seguinte erro:</p><div class="code_container">
<pre><code class="highlight plaintext">Missing partial blorgh/comments/_comment with {:handlers=&gt;[:erb, :builder],
:formats=&gt;[:html], :locale=&gt;[:en, :en]}. Searched in:   *
"/Users/ryan/Sites/side_projects/blorgh/test/dummy/app/views"   *
"/Users/ryan/Sites/side_projects/blorgh/app/views"
</code></pre>
<button class="clipboard-button" data-clipboard-text='Missing partial blorgh/comments/_comment with {:handlers=&gt;[:erb, :builder],
:formats=&gt;[:html], :locale=&gt;[:en, :en]}. Searched in:   *
"/Users/ryan/Sites/side_projects/blorgh/test/dummy/app/views"   *
"/Users/ryan/Sites/side_projects/blorgh/app/views"
'>Copy</button>
</div>
<p>Essa <em>engine</em> não é capaz de encontrar a <em>partial</em> requerida para renderizar os comentários.
O Rails procura primeiro no diretório <code>app/views</code> da aplicação (<code>test/dummy</code>) e
depois no diretório <code>app/views</code> da <em>engine</em>. Quando ele não consegue encontrar, ele
irá disparar esse erro. A <em>engine</em> sabe procurar por <code>blorgh/comments/_comment</code> porque
o objeto do <em>model</em> a está recebendo da classe <code>Blorgh::Comment</code>.</p><p>Essa <em>partial</em> será responsável apenas por renderizar o texto do comentário, por agora.
Crie um novo arquivo em <code>app/views/blorgh/comments/_comment.html.erb</code> e coloque essa
linha dentro dele:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">comment_counter</span> <span class="o">+</span> <span class="mi">1</span> <span class="cp">%&gt;</span>. <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">text</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= comment_counter + 1 %&gt;. &lt;%= comment.text %&gt;
">Copy</button>
</div>
<p>A variável local <code>comment_counter</code> nos é provida pela chamada <code>&lt;%= render
@article.comments %&gt;</code>, que irá defini-la automaticamente e incrementar o contador
enquanto faz a iteração através de cada comentário. Ela é usada nesse exemplo para
exibir um pequeno número ao lado de cada comentário quando ele é criado.</p><p>Isso finaliza a funcionalidade de comentário da <em>engine</em> de <em>blogging</em>. Agora é
hora de utilizá-la em uma aplicação.</p><h3 id="hooking-into-an-application"><a class="anchorlink" href="#hooking-into-an-application">4 Hooking Into an Application</a></h3><p>Using an engine within an application is very easy. This section covers how to
mount the engine into an application and the initial setup required, as well as
linking the engine to a <code>User</code> class provided by the application to provide
ownership for articles and comments within the engine.</p><h4 id="mounting-the-engine"><a class="anchorlink" href="#mounting-the-engine">4.1 Mounting the Engine</a></h4><p>First, the engine needs to be specified inside the application's <code>Gemfile</code>. If
there isn't an application handy to test this out in, generate one using the
<code>rails new</code> command outside of the engine directory like this:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">rails </span>new unicorn
</code></pre>
<button class="clipboard-button" data-clipboard-text="rails new unicorn
">Copy</button>
</div>
<p>Usually, specifying the engine inside the <code>Gemfile</code> would be done by specifying it
as a normal, everyday gem.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">gem</span> <span class="s1">'devise'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="gem 'devise'
">Copy</button>
</div>
<p>However, because you are developing the <code>blorgh</code> engine on your local machine,
you will need to specify the <code>:path</code> option in your <code>Gemfile</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">gem</span> <span class="s1">'blorgh'</span><span class="p">,</span> <span class="ss">path: </span><span class="s1">'engines/blorgh'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="gem 'blorgh', path: 'engines/blorgh'
">Copy</button>
</div>
<p>Then run <code>bundle</code> to install the gem.</p><p>As described earlier, by placing the gem in the <code>Gemfile</code> it will be loaded when
Rails is loaded. It will first require <code>lib/blorgh.rb</code> from the engine, then
<code>lib/blorgh/engine.rb</code>, which is the file that defines the major pieces of
functionality for the engine.</p><p>To make the engine's functionality accessible from within an application, it
needs to be mounted in that application's <code>config/routes.rb</code> file:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">mount</span> <span class="no">Blorgh</span><span class="o">::</span><span class="no">Engine</span><span class="p">,</span> <span class="ss">at: </span><span class="s2">"/blog"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='mount Blorgh::Engine, at: "/blog"
'>Copy</button>
</div>
<p>This line will mount the engine at <code>/blog</code> in the application. Making it
accessible at <code>http://localhost:3000/blog</code> when the application runs with <code>bin/rails
server</code>.</p><div class="note"><p>Other engines, such as Devise, handle this a little differently by making
you specify custom helpers (such as <code>devise_for</code>) in the routes. These helpers
do exactly the same thing, mounting pieces of the engines's functionality at a
pre-defined path which may be customizable.</p></div><h4 id="engine-setup"><a class="anchorlink" href="#engine-setup">4.2 Engine Setup</a></h4><p>The engine contains migrations for the <code>blorgh_articles</code> and <code>blorgh_comments</code>
table which need to be created in the application's database so that the
engine's models can query them correctly. To copy these migrations into the
application run the following command from the application's root:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>blorgh:install:migrations
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails blorgh:install:migrations
">Copy</button>
</div>
<p>If you have multiple engines that need migrations copied over, use
<code>railties:install:migrations</code> instead:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>railties:install:migrations
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails railties:install:migrations
">Copy</button>
</div>
<p>This command, when run for the first time, will copy over all the migrations
from the engine. When run the next time, it will only copy over migrations that
haven't been copied over already. The first run for this command will output
something such as this:</p><div class="code_container">
<pre><code class="highlight plaintext">Copied migration [timestamp_1]_create_blorgh_articles.blorgh.rb from blorgh
Copied migration [timestamp_2]_create_blorgh_comments.blorgh.rb from blorgh
</code></pre>
<button class="clipboard-button" data-clipboard-text="Copied migration [timestamp_1]_create_blorgh_articles.blorgh.rb from blorgh
Copied migration [timestamp_2]_create_blorgh_comments.blorgh.rb from blorgh
">Copy</button>
</div>
<p>The first timestamp (<code>[timestamp_1]</code>) will be the current time, and the second
timestamp (<code>[timestamp_2]</code>) will be the current time plus a second. The reason
for this is so that the migrations for the engine are run after any existing
migrations in the application.</p><p>To run these migrations within the context of the application, simply run <code>bin/rails
db:migrate</code>. When accessing the engine through <code>http://localhost:3000/blog</code>, the
articles will be empty. This is because the table created inside the application is
different from the one created within the engine. Go ahead, play around with the
newly mounted engine. You'll find that it's the same as when it was only an
engine.</p><p>If you would like to run migrations only from one engine, you can do it by
specifying <code>SCOPE</code>:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>db:migrate <span class="nv">SCOPE</span><span class="o">=</span>blorgh
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails db:migrate SCOPE=blorgh
">Copy</button>
</div>
<p>This may be useful if you want to revert engine's migrations before removing it.
To revert all migrations from blorgh engine you can run code such as:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>db:migrate <span class="nv">SCOPE</span><span class="o">=</span>blorgh <span class="nv">VERSION</span><span class="o">=</span>0
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails db:migrate SCOPE=blorgh VERSION=0
">Copy</button>
</div>
<h4 id="using-a-class-provided-by-the-application"><a class="anchorlink" href="#using-a-class-provided-by-the-application">4.3 Using a Class Provided by the Application</a></h4><h5 id="using-a-model-provided-by-the-application"><a class="anchorlink" href="#using-a-model-provided-by-the-application">4.3.1 Using a Model Provided by the Application</a></h5><p>When an engine is created, it may want to use specific classes from an
application to provide links between the pieces of the engine and the pieces of
the application. In the case of the <code>blorgh</code> engine, making articles and comments
have authors would make a lot of sense.</p><p>A typical application might have a <code>User</code> class that would be used to represent
authors for an article or a comment. But there could be a case where the
application calls this class something different, such as <code>Person</code>. For this
reason, the engine should not hardcode associations specifically for a <code>User</code>
class.</p><p>To keep it simple in this case, the application will have a class called <code>User</code>
that represents the users of the application (we'll get into making this
configurable further on). It can be generated using this command inside the
application:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate model user name:string
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails generate model user name:string
">Copy</button>
</div>
<p>The <code>bin/rails db:migrate</code> command needs to be run here to ensure that our
application has the <code>users</code> table for future use.</p><p>Also, to keep it simple, the articles form will have a new text field called
<code>author_name</code>, where users can elect to put their name. The engine will then
take this name and either create a new <code>User</code> object from it, or find one that
already has that name. The engine will then associate the article with the found or
created <code>User</code> object.</p><p>First, the <code>author_name</code> text field needs to be added to the
<code>app/views/blorgh/articles/_form.html.erb</code> partial inside the engine. This can be
added above the <code>title</code> field with this code:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"field"</span><span class="nt">&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:author_name</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:author_name</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;div class="field"&gt;
  &lt;%= form.label :author_name %&gt;&lt;br&gt;
  &lt;%= form.text_field :author_name %&gt;
&lt;/div&gt;
'>Copy</button>
</div>
<p>Next, we need to update our <code>Blorgh::ArticlesController#article_params</code> method to
permit the new form parameter:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">article_params</span>
  <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:article</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:text</span><span class="p">,</span> <span class="ss">:author_name</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="def article_params
  params.require(:article).permit(:title, :text, :author_name)
end
">Copy</button>
</div>
<p>The <code>Blorgh::Article</code> model should then have some code to convert the <code>author_name</code>
field into an actual <code>User</code> object and associate it as that article's <code>author</code>
before the article is saved. It will also need to have an <code>attr_accessor</code> set up
for this field, so that the setter and getter methods are defined for it.</p><p>To do all this, you'll need to add the <code>attr_accessor</code> for <code>author_name</code>, the
association for the author and the <code>before_validation</code> call into
<code>app/models/blorgh/article.rb</code>. The <code>author</code> association will be hard-coded to the
<code>User</code> class for the time being.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">attr_accessor</span> <span class="ss">:author_name</span>
<span class="n">belongs_to</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">class_name: </span><span class="s2">"User"</span>

<span class="n">before_validation</span> <span class="ss">:set_author</span>

<span class="kp">private</span>
  <span class="k">def</span> <span class="nf">set_author</span>
    <span class="nb">self</span><span class="p">.</span><span class="nf">author</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find_or_create_by</span><span class="p">(</span><span class="ss">name: </span><span class="n">author_name</span><span class="p">)</span>
  <span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='attr_accessor :author_name
belongs_to :author, class_name: "User"

before_validation :set_author

private
  def set_author
    self.author = User.find_or_create_by(name: author_name)
  end
'>Copy</button>
</div>
<p>By representing the <code>author</code> association's object with the <code>User</code> class, a link
is established between the engine and the application. There needs to be a way
of associating the records in the <code>blorgh_articles</code> table with the records in the
<code>users</code> table. Because the association is called <code>author</code>, there should be an
<code>author_id</code> column added to the <code>blorgh_articles</code> table.</p><p>To generate this new column, run this command within the engine:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate migration add_author_id_to_blorgh_articles author_id:integer
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails generate migration add_author_id_to_blorgh_articles author_id:integer
">Copy</button>
</div>
<div class="note"><p>Due to the migration's name and the column specification after it, Rails
will automatically know that you want to add a column to a specific table and
write that into the migration for you. You don't need to tell it any more than
this.</p></div><p>This migration will need to be run on the application. To do that, it must first
be copied using this command:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>blorgh:install:migrations
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails blorgh:install:migrations
">Copy</button>
</div>
<p>Notice that only <em>one</em> migration was copied over here. This is because the first
two migrations were copied over the first time this command was run.</p><div class="code_container">
<pre><code class="highlight plaintext">NOTE Migration [timestamp]_create_blorgh_articles.blorgh.rb from blorgh has been skipped. Migration with the same name already exists.
NOTE Migration [timestamp]_create_blorgh_comments.blorgh.rb from blorgh has been skipped. Migration with the same name already exists.
Copied migration [timestamp]_add_author_id_to_blorgh_articles.blorgh.rb from blorgh
</code></pre>
<button class="clipboard-button" data-clipboard-text="NOTE Migration [timestamp]_create_blorgh_articles.blorgh.rb from blorgh has been skipped. Migration with the same name already exists.
NOTE Migration [timestamp]_create_blorgh_comments.blorgh.rb from blorgh has been skipped. Migration with the same name already exists.
Copied migration [timestamp]_add_author_id_to_blorgh_articles.blorgh.rb from blorgh
">Copy</button>
</div>
<p>Run the migration using:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>db:migrate
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails db:migrate
">Copy</button>
</div>
<p>Now with all the pieces in place, an action will take place that will associate
an author - represented by a record in the <code>users</code> table - with an article,
represented by the <code>blorgh_articles</code> table from the engine.</p><p>Finally, the author's name should be displayed on the article's page. Add this code
above the "Title" output inside <code>app/views/blorgh/articles/show.html.erb</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;b&gt;</span>Author:<span class="nt">&lt;/b&gt;</span>
  <span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">author</span><span class="p">.</span><span class="nf">name</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;p&gt;
  &lt;b&gt;Author:&lt;/b&gt;
  &lt;%= @article.author.name %&gt;
&lt;/p&gt;
">Copy</button>
</div>
<h5 id="using-a-controller-provided-by-the-application"><a class="anchorlink" href="#using-a-controller-provided-by-the-application">4.3.2 Using a Controller Provided by the Application</a></h5><p>Because Rails controllers generally share code for things like authentication
and accessing session variables, they inherit from <code>ApplicationController</code> by
default. Rails engines, however are scoped to run independently from the main
application, so each engine gets a scoped <code>ApplicationController</code>. This
namespace prevents code collisions, but often engine controllers need to access
methods in the main application's <code>ApplicationController</code>. An easy way to
provide this access is to change the engine's scoped <code>ApplicationController</code> to
inherit from the main application's <code>ApplicationController</code>. For our Blorgh
engine this would be done by changing
<code>app/controllers/blorgh/application_controller.rb</code> to look like:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">Blorgh</span>
  <span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="o">::</span><span class="no">ApplicationController</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="module Blorgh
  class ApplicationController &lt; ::ApplicationController
  end
end
">Copy</button>
</div>
<p>By default, the engine's controllers inherit from
<code>Blorgh::ApplicationController</code>. So, after making this change they will have
access to the main application's <code>ApplicationController</code>, as though they were
part of the main application.</p><p>This change does require that the engine is run from a Rails application that
has an <code>ApplicationController</code>.</p><h4 id="configuring-an-engine"><a class="anchorlink" href="#configuring-an-engine">4.4 Configuring an Engine</a></h4><p>This section covers how to make the <code>User</code> class configurable, followed by
general configuration tips for the engine.</p><h5 id="setting-configuration-settings-in-the-application"><a class="anchorlink" href="#setting-configuration-settings-in-the-application">4.4.1 Setting Configuration Settings in the Application</a></h5><p>The next step is to make the class that represents a <code>User</code> in the application
customizable for the engine. This is because that class may not always be
<code>User</code>, as previously explained. To make this setting customizable, the engine
will have a configuration setting called <code>author_class</code> that will be used to
specify which class represents users inside the application.</p><p>To define this configuration setting, you should use a <code>mattr_accessor</code> inside
the <code>Blorgh</code> module for the engine. Add this line to <code>lib/blorgh.rb</code> inside the
engine:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">mattr_accessor</span> <span class="ss">:author_class</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="mattr_accessor :author_class
">Copy</button>
</div>
<p>This method works like its siblings, <code>attr_accessor</code> and <code>cattr_accessor</code>, but
provides a setter and getter method on the module with the specified name. To
use it, it must be referenced using <code>Blorgh.author_class</code>.</p><p>The next step is to switch the <code>Blorgh::Article</code> model over to this new setting.
Change the <code>belongs_to</code> association inside this model
(<code>app/models/blorgh/article.rb</code>) to this:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">belongs_to</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">class_name: </span><span class="no">Blorgh</span><span class="p">.</span><span class="nf">author_class</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="belongs_to :author, class_name: Blorgh.author_class
">Copy</button>
</div>
<p>The <code>set_author</code> method in the <code>Blorgh::Article</code> model should also use this class:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">self</span><span class="p">.</span><span class="nf">author</span> <span class="o">=</span> <span class="no">Blorgh</span><span class="p">.</span><span class="nf">author_class</span><span class="p">.</span><span class="nf">constantize</span><span class="p">.</span><span class="nf">find_or_create_by</span><span class="p">(</span><span class="ss">name: </span><span class="n">author_name</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="self.author = Blorgh.author_class.constantize.find_or_create_by(name: author_name)
">Copy</button>
</div>
<p>To save having to call <code>constantize</code> on the <code>author_class</code> result all the time,
you could instead just override the <code>author_class</code> getter method inside the
<code>Blorgh</code> module in the <code>lib/blorgh.rb</code> file to always call <code>constantize</code> on the
saved value before returning the result:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">author_class</span>
  <span class="vc">@@author_class</span><span class="p">.</span><span class="nf">constantize</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="def self.author_class
  @@author_class.constantize
end
">Copy</button>
</div>
<p>This would then turn the above code for <code>set_author</code> into this:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">self</span><span class="p">.</span><span class="nf">author</span> <span class="o">=</span> <span class="no">Blorgh</span><span class="p">.</span><span class="nf">author_class</span><span class="p">.</span><span class="nf">find_or_create_by</span><span class="p">(</span><span class="ss">name: </span><span class="n">author_name</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="self.author = Blorgh.author_class.find_or_create_by(name: author_name)
">Copy</button>
</div>
<p>Resulting in something a little shorter, and more implicit in its behavior. The
<code>author_class</code> method should always return a <code>Class</code> object.</p><p>Since we changed the <code>author_class</code> method to return a <code>Class</code> instead of a
<code>String</code>, we must also modify our <code>belongs_to</code> definition in the <code>Blorgh::Article</code>
model:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">belongs_to</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">class_name: </span><span class="no">Blorgh</span><span class="p">.</span><span class="nf">author_class</span><span class="p">.</span><span class="nf">to_s</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="belongs_to :author, class_name: Blorgh.author_class.to_s
">Copy</button>
</div>
<p>To set this configuration setting within the application, an initializer should
be used. By using an initializer, the configuration will be set up before the
application starts and calls the engine's models, which may depend on this
configuration setting existing.</p><p>Create a new initializer at <code>config/initializers/blorgh.rb</code> inside the
application where the <code>blorgh</code> engine is installed and put this content in it:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Blorgh</span><span class="p">.</span><span class="nf">author_class</span> <span class="o">=</span> <span class="s2">"User"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='Blorgh.author_class = "User"
'>Copy</button>
</div>
<div class="warning"><p>It's very important here to use the <code>String</code> version of the class,
rather than the class itself. If you were to use the class, Rails would attempt
to load that class and then reference the related table. This could lead to
problems if the table didn't already exist. Therefore, a <code>String</code> should be
used and then converted to a class using <code>constantize</code> in the engine later on.</p></div><p>Go ahead and try to create a new article. You will see that it works exactly in the
same way as before, except this time the engine is using the configuration
setting in <code>config/initializers/blorgh.rb</code> to learn what the class is.</p><p>There are now no strict dependencies on what the class is, only what the API for
the class must be. The engine simply requires this class to define a
<code>find_or_create_by</code> method which returns an object of that class, to be
associated with an article when it's created. This object, of course, should have
some sort of identifier by which it can be referenced.</p><h5 id="general-engine-configuration"><a class="anchorlink" href="#general-engine-configuration">4.4.2 General Engine Configuration</a></h5><p>Within an engine, there may come a time where you wish to use things such as
initializers, internationalization, or other configuration options. The great
news is that these things are entirely possible, because a Rails engine shares
much the same functionality as a Rails application. In fact, a Rails
application's functionality is actually a superset of what is provided by
engines!</p><p>If you wish to use an initializer - code that should run before the engine is
loaded - the place for it is the <code>config/initializers</code> folder. This directory's
functionality is explained in the <a href="configuring.html#initializers">Initializers
section</a> of the Configuring guide, and works
precisely the same way as the <code>config/initializers</code> directory inside an
application. The same thing goes if you want to use a standard initializer.</p><p>For locales, simply place the locale files in the <code>config/locales</code> directory,
just like you would in an application.</p><h3 id="testando-uma-engine"><a class="anchorlink" href="#testando-uma-engine">5 Testando uma <em>Engine</em></a></h3><p>Quando uma <em>engine</em> é gerada, há uma pequena aplicação fictícia (dummy)
criada dentro dela em <code>test/dummy</code>. Essa aplicação é utilizada como ponto de
montagem para a <em>engine</em>, para tornar os testes de uma <em>engine</em> extremamente
simples. Você pode ampliar essa aplicação gerando <em>controllers</em>, <em>models</em> ou
<em>views</em> de dentro do diretório, e então usá-los para testar sua <em>engine</em>.</p><p>O diretório <code>test</code> sempre deverá ser tratado como um ambiente de teste típico
do Rails, permitindo testes unitários, funcionais e de integração.</p><h4 id="testes-funcionais"><a class="anchorlink" href="#testes-funcionais">5.1 Testes funcionais</a></h4><p>É importante levar em consideração ao escrever testes funcionais, que os testes
serão executados em uma aplicação - a aplicação <code>test/dummy</code> - e não a sua <em>engine</em>.
Isso se deve a preparação do ambiente de testes; uma <em>engine</em> precisa de uma
aplicação hospedeira para que seja possível testar suas funcionalidades principais,
especialmente os <em>controllers</em>. Isso significa que se você está a realizar um
típico <code>GET</code> para um <em>controller</em> em um teste funcional de <em>controller</em> como este:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">Blorgh</span>
  <span class="k">class</span> <span class="nc">FooControllerTest</span> <span class="o">&lt;</span> <span class="no">ActionDispatch</span><span class="o">::</span><span class="no">IntegrationTest</span>
    <span class="kp">include</span> <span class="no">Engine</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">url_helpers</span>

    <span class="k">def</span> <span class="nf">test_index</span>
      <span class="n">get</span> <span class="n">foos_url</span>
      <span class="c1"># ...</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="module Blorgh
  class FooControllerTest &lt; ActionDispatch::IntegrationTest
    include Engine.routes.url_helpers

    def test_index
      get foos_url
      # ...
    end
  end
end
">Copy</button>
</div>
<p>Ele pode não funcionar corretamente. Isso acontece porque a aplicação não sabe
como rotear essas requisições para as <em>engines</em> a menos que você diga <em>como</em> fazer
isso, de forma explícita. E para isso, você precisa definir a variável de instância
<code>@routes</code> como sendo o conjunto de rotas da <em>engine</em> no seu código de
preparação (setup):</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">Blorgh</span>
  <span class="k">class</span> <span class="nc">FooControllerTest</span> <span class="o">&lt;</span> <span class="no">ActionDispatch</span><span class="o">::</span><span class="no">IntegrationTest</span>
    <span class="kp">include</span> <span class="no">Engine</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">url_helpers</span>

    <span class="n">setup</span> <span class="k">do</span>
      <span class="vi">@routes</span> <span class="o">=</span> <span class="no">Engine</span><span class="p">.</span><span class="nf">routes</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">test_index</span>
      <span class="n">get</span> <span class="n">foos_url</span>
      <span class="c1"># ...</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="module Blorgh
  class FooControllerTest &lt; ActionDispatch::IntegrationTest
    include Engine.routes.url_helpers

    setup do
      @routes = Engine.routes
    end

    def test_index
      get foos_url
      # ...
    end
  end
end
">Copy</button>
</div>
<p>Isso indica à aplicação que você ainda quer executar uma requisição do tipo <code>GET</code>,
para ação <code>index</code> desse <em>controller</em>, mas você quer usar as rotas da <em>engine</em> para
chegar lá, ao invés das rotas da aplicação.</p><p>Isso também certifica que os <em>helpers</em> de URL da <em>engine</em> irão funcionar como
esperado em seus testes.</p><h3 id="improving-engine-functionality"><a class="anchorlink" href="#improving-engine-functionality">6 Improving Engine Functionality</a></h3><p>This section explains how to add and/or override engine MVC functionality in the
main Rails application.</p><h4 id="overriding-models-and-controllers"><a class="anchorlink" href="#overriding-models-and-controllers">6.1 Overriding Models and Controllers</a></h4><p>Engine models and controllers can be reopened by the parent application to extend or decorate them.</p><p>Overrides may be organized in a dedicated directory <code>app/overrides</code>, ignored by the autoloader, and preloaded in a <code>to_prepare</code> callback:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># config/application.rb</span>
<span class="k">module</span> <span class="nn">MyApp</span>
  <span class="k">class</span> <span class="nc">Application</span> <span class="o">&lt;</span> <span class="no">Rails</span><span class="o">::</span><span class="no">Application</span>
    <span class="c1"># ...</span>

    <span class="n">overrides</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="no">Rails</span><span class="p">.</span><span class="nf">root</span><span class="si">}</span><span class="s2">/app/overrides"</span>
    <span class="no">Rails</span><span class="p">.</span><span class="nf">autoloaders</span><span class="p">.</span><span class="nf">main</span><span class="p">.</span><span class="nf">ignore</span><span class="p">(</span><span class="n">overrides</span><span class="p">)</span>

    <span class="n">config</span><span class="p">.</span><span class="nf">to_prepare</span> <span class="k">do</span>
      <span class="no">Dir</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="s2">"</span><span class="si">#{</span><span class="n">overrides</span><span class="si">}</span><span class="s2">/**/*_override.rb"</span><span class="p">).</span><span class="nf">sort</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">override</span><span class="o">|</span>
        <span class="nb">load</span> <span class="n">override</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='# config/application.rb
module MyApp
  class Application &lt; Rails::Application
    # ...

    overrides = "#{Rails.root}/app/overrides"
    Rails.autoloaders.main.ignore(overrides)

    config.to_prepare do
      Dir.glob("#{overrides}/**/*_override.rb").sort.each do |override|
        load override
      end
    end
  end
end
'>Copy</button>
</div>
<h5 id="reopening-existing-classes-using-class-eval"><a class="anchorlink" href="#reopening-existing-classes-using-class-eval">6.1.1 Reopening Existing Classes Using <code>class_eval</code></a></h5><p>For example, in order to override the engine model</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># Blorgh/app/models/blorgh/article.rb</span>
<span class="k">module</span> <span class="nn">Blorgh</span>
  <span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="# Blorgh/app/models/blorgh/article.rb
module Blorgh
  class Article &lt; ApplicationRecord
    # ...
  end
end
">Copy</button>
</div>
<p>you just create a file that <em>reopens</em> that class:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># MyApp/app/overrides/models/blorgh/article_override.rb</span>
<span class="no">Blorgh</span><span class="o">::</span><span class="no">Article</span><span class="p">.</span><span class="nf">class_eval</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="# MyApp/app/overrides/models/blorgh/article_override.rb
Blorgh::Article.class_eval do
  # ...
end
">Copy</button>
</div>
<p>It is very important that the override <em>reopens</em> the class or module. Using the <code>class</code> or <code>module</code> keywords would define them if they were not already in memory, which would be incorrect because the definition lives in the engine. Using <code>class_eval</code> as shown above ensures you are reopening.</p><h5 id="reopening-existing-classes-using-activesupport-concern"><a class="anchorlink" href="#reopening-existing-classes-using-activesupport-concern">6.1.2 Reopening Existing Classes Using ActiveSupport::Concern</a></h5><p>Using <code>Class#class_eval</code> is great for simple adjustments, but for more complex
class modifications, you might want to consider using <a href="https://api.rubyonrails.org/v7.0.8/classes/ActiveSupport/Concern.html"><code>ActiveSupport::Concern</code></a>.
ActiveSupport::Concern manages load order of interlinked dependent modules and
classes at run time allowing you to significantly modularize your code.</p><p><strong>Adding</strong> <code>Article#time_since_created</code> and <strong>Overriding</strong> <code>Article#summary</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># MyApp/app/models/blorgh/article.rb</span>

<span class="k">class</span> <span class="nc">Blorgh::Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="kp">include</span> <span class="no">Blorgh</span><span class="o">::</span><span class="no">Concerns</span><span class="o">::</span><span class="no">Models</span><span class="o">::</span><span class="no">Article</span>

  <span class="k">def</span> <span class="nf">time_since_created</span>
    <span class="no">Time</span><span class="p">.</span><span class="nf">current</span> <span class="o">-</span> <span class="n">created_at</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">summary</span>
    <span class="s2">"</span><span class="si">#{</span><span class="n">title</span><span class="si">}</span><span class="s2"> - </span><span class="si">#{</span><span class="n">truncate</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='# MyApp/app/models/blorgh/article.rb

class Blorgh::Article &lt; ApplicationRecord
  include Blorgh::Concerns::Models::Article

  def time_since_created
    Time.current - created_at
  end

  def summary
    "#{title} - #{truncate(text)}"
  end
end
'>Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># Blorgh/app/models/blorgh/article.rb</span>
<span class="k">module</span> <span class="nn">Blorgh</span>
  <span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
    <span class="kp">include</span> <span class="no">Blorgh</span><span class="o">::</span><span class="no">Concerns</span><span class="o">::</span><span class="no">Models</span><span class="o">::</span><span class="no">Article</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="# Blorgh/app/models/blorgh/article.rb
module Blorgh
  class Article &lt; ApplicationRecord
    include Blorgh::Concerns::Models::Article
  end
end
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># Blorgh/lib/concerns/models/article.rb</span>

<span class="k">module</span> <span class="nn">Blorgh::Concerns::Models::Article</span>
  <span class="kp">extend</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Concern</span>

  <span class="c1"># `included do` causes the block to be evaluated in the context</span>
  <span class="c1"># in which the module is included (i.e. Blorgh::Article),</span>
  <span class="c1"># rather than in the module itself.</span>
  <span class="n">included</span> <span class="k">do</span>
    <span class="nb">attr_accessor</span> <span class="ss">:author_name</span>
    <span class="n">belongs_to</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">class_name: </span><span class="s2">"User"</span>

    <span class="n">before_validation</span> <span class="ss">:set_author</span>

    <span class="kp">private</span>
      <span class="k">def</span> <span class="nf">set_author</span>
        <span class="nb">self</span><span class="p">.</span><span class="nf">author</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find_or_create_by</span><span class="p">(</span><span class="ss">name: </span><span class="n">author_name</span><span class="p">)</span>
      <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">summary</span>
    <span class="s2">"</span><span class="si">#{</span><span class="n">title</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>

  <span class="k">module</span> <span class="nn">ClassMethods</span>
    <span class="k">def</span> <span class="nf">some_class_method</span>
      <span class="s1">'some class method string'</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="# Blorgh/lib/concerns/models/article.rb

module Blorgh::Concerns::Models::Article
  extend ActiveSupport::Concern

  # `included do` causes the block to be evaluated in the context
  # in which the module is included (i.e. Blorgh::Article),
  # rather than in the module itself.
  included do
    attr_accessor :author_name
    belongs_to :author, class_name: &quot;User&quot;

    before_validation :set_author

    private
      def set_author
        self.author = User.find_or_create_by(name: author_name)
      end
  end

  def summary
    &quot;#{title}&quot;
  end

  module ClassMethods
    def some_class_method
      'some class method string'
    end
  end
end
">Copy</button>
</div>
<h4 id="autoloading-and-engines"><a class="anchorlink" href="#autoloading-and-engines">6.2 Autoloading and Engines</a></h4><p>Please check the <a href="autoloading_and_reloading_constants.html#autoloading-and-engines">Autoloading and Reloading Constants</a>
guide for more information about autoloading and engines.</p><h4 id="overriding-views"><a class="anchorlink" href="#overriding-views">6.3 Overriding Views</a></h4><p>When Rails looks for a view to render, it will first look in the <code>app/views</code>
directory of the application. If it cannot find the view there, it will check in
the <code>app/views</code> directories of all engines that have this directory.</p><p>When the application is asked to render the view for <code>Blorgh::ArticlesController</code>'s
index action, it will first look for the path
<code>app/views/blorgh/articles/index.html.erb</code> within the application. If it cannot
find it, it will look inside the engine.</p><p>You can override this view in the application by simply creating a new file at
<code>app/views/blorgh/articles/index.html.erb</code>. Then you can completely change what
this view would normally output.</p><p>Try this now by creating a new file at <code>app/views/blorgh/articles/index.html.erb</code>
and put this content in it:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"New Article"</span><span class="p">,</span> <span class="n">new_article_path</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;h2&gt;</span><span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h2&gt;</span>
  <span class="nt">&lt;small&gt;</span>By <span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">author</span> <span class="cp">%&gt;</span><span class="nt">&lt;/small&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">simple_format</span><span class="p">(</span><span class="n">article</span><span class="p">.</span><span class="nf">text</span><span class="p">)</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;hr&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;h1&gt;Articles&lt;/h1&gt;
&lt;%= link_to "New Article", new_article_path %&gt;
&lt;% @articles.each do |article| %&gt;
  &lt;h2&gt;&lt;%= article.title %&gt;&lt;/h2&gt;
  &lt;small&gt;By &lt;%= article.author %&gt;&lt;/small&gt;
  &lt;%= simple_format(article.text) %&gt;
  &lt;hr&gt;
&lt;% end %&gt;
'>Copy</button>
</div>
<h4 id="routes"><a class="anchorlink" href="#routes">6.4 Routes</a></h4><p>Routes inside an engine are isolated from the application by default. This is
done by the <code>isolate_namespace</code> call inside the <code>Engine</code> class. This essentially
means that the application and its engines can have identically named routes and
they will not clash.</p><p>Routes inside an engine are drawn on the <code>Engine</code> class within
<code>config/routes.rb</code>, like this:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Blorgh</span><span class="o">::</span><span class="no">Engine</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:articles</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Blorgh::Engine.routes.draw do
  resources :articles
end
">Copy</button>
</div>
<p>By having isolated routes such as this, if you wish to link to an area of an
engine from within an application, you will need to use the engine's routing
proxy method. Calls to normal routing methods such as <code>articles_path</code> may end up
going to undesired locations if both the application and the engine have such a
helper defined.</p><p>For instance, the following example would go to the application's <code>articles_path</code>
if that template was rendered from the application, or the engine's <code>articles_path</code>
if it was rendered from the engine:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Blog articles"</span><span class="p">,</span> <span class="n">articles_path</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;%= link_to "Blog articles", articles_path %&gt;
'>Copy</button>
</div>
<p>To make this route always use the engine's <code>articles_path</code> routing helper method,
we must call the method on the routing proxy method that shares the same name as
the engine.</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Blog articles"</span><span class="p">,</span> <span class="n">blorgh</span><span class="p">.</span><span class="nf">articles_path</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;%= link_to "Blog articles", blorgh.articles_path %&gt;
'>Copy</button>
</div>
<p>If you wish to reference the application inside the engine in a similar way, use
the <code>main_app</code> helper:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Home"</span><span class="p">,</span> <span class="n">main_app</span><span class="p">.</span><span class="nf">root_path</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;%= link_to "Home", main_app.root_path %&gt;
'>Copy</button>
</div>
<p>If you were to use this inside an engine, it would <strong>always</strong> go to the
application's root. If you were to leave off the <code>main_app</code> "routing proxy"
method call, it could potentially go to the engine's or application's root,
depending on where it was called from.</p><p>If a template rendered from within an engine attempts to use one of the
application's routing helper methods, it may result in an undefined method call.
If you encounter such an issue, ensure that you're not attempting to call the
application's routing methods without the <code>main_app</code> prefix from within the
engine.</p><h4 id="assets"><a class="anchorlink" href="#assets">6.5 Assets</a></h4><p>Assets within an engine work in an identical way to a full application. Because
the engine class inherits from <code>Rails::Engine</code>, the application will know to
look up assets in the engine's <code>app/assets</code> and <code>lib/assets</code> directories.</p><p>Like all of the other components of an engine, the assets should be namespaced.
This means that if you have an asset called <code>style.css</code>, it should be placed at
<code>app/assets/stylesheets/[engine name]/style.css</code>, rather than
<code>app/assets/stylesheets/style.css</code>. If this asset isn't namespaced, there is a
possibility that the host application could have an asset named identically, in
which case the application's asset would take precedence and the engine's one
would be ignored.</p><p>Imagine that you did have an asset located at
<code>app/assets/stylesheets/blorgh/style.css</code>. To include this asset inside an
application, just use <code>stylesheet_link_tag</code> and reference the asset as if it
were inside the engine:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s2">"blorgh/style.css"</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;%= stylesheet_link_tag "blorgh/style.css" %&gt;
'>Copy</button>
</div>
<p>You can also specify these assets as dependencies of other assets using Asset
Pipeline require statements in processed files:</p><div class="code_container">
<pre><code class="highlight css"><span class="c">/*
 *= require blorgh/style
 */</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="/*
 *= require blorgh/style
 */
">Copy</button>
</div>
<div class="info"><p>Remember that in order to use languages like Sass or CoffeeScript, you
should add the relevant library to your engine's <code>.gemspec</code>.</p></div><h4 id="separate-assets-and-precompiling"><a class="anchorlink" href="#separate-assets-and-precompiling">6.6 Separate Assets and Precompiling</a></h4><p>There are some situations where your engine's assets are not required by the
host application. For example, say that you've created an admin functionality
that only exists for your engine. In this case, the host application doesn't
need to require <code>admin.css</code> or <code>admin.js</code>. Only the gem's admin layout needs
these assets. It doesn't make sense for the host app to include
<code>"blorgh/admin.css"</code> in its stylesheets. In this situation, you should
explicitly define these assets for precompilation.  This tells Sprockets to add
your engine assets when <code>bin/rails assets:precompile</code> is triggered.</p><p>You can define assets for precompilation in <code>engine.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">initializer</span> <span class="s2">"blorgh.assets.precompile"</span> <span class="k">do</span> <span class="o">|</span><span class="n">app</span><span class="o">|</span>
  <span class="n">app</span><span class="p">.</span><span class="nf">config</span><span class="p">.</span><span class="nf">assets</span><span class="p">.</span><span class="nf">precompile</span> <span class="o">+=</span> <span class="sx">%w( admin.js admin.css )</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='initializer "blorgh.assets.precompile" do |app|
  app.config.assets.precompile += %w( admin.js admin.css )
end
'>Copy</button>
</div>
<p>For more information, read the <a href="asset_pipeline.html">Asset Pipeline guide</a>.</p><h4 id="other-gem-dependencies"><a class="anchorlink" href="#other-gem-dependencies">6.7 Other Gem Dependencies</a></h4><p>Gem dependencies inside an engine should be specified inside the <code>.gemspec</code> file
at the root of the engine. The reason is that the engine may be installed as a
gem. If dependencies were to be specified inside the <code>Gemfile</code>, these would not
be recognized by a traditional gem install and so they would not be installed,
causing the engine to malfunction.</p><p>To specify a dependency that should be installed with the engine during a
traditional <code>gem install</code>, specify it inside the <code>Gem::Specification</code> block
inside the <code>.gemspec</code> file in the engine:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">s</span><span class="p">.</span><span class="nf">add_dependency</span> <span class="s2">"moo"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='s.add_dependency "moo"
'>Copy</button>
</div>
<p>To specify a dependency that should only be installed as a development
dependency of the application, specify it like this:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">s</span><span class="p">.</span><span class="nf">add_development_dependency</span> <span class="s2">"moo"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='s.add_development_dependency "moo"
'>Copy</button>
</div>
<p>Both kinds of dependencies will be installed when <code>bundle install</code> is run inside
of the application. The development dependencies for the gem will only be used
when the development and tests for the engine are running.</p><p>Note that if you want to immediately require dependencies when the engine is
required, you should require them before the engine's initialization. For
example:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">require</span> <span class="s2">"other_engine/engine"</span>
<span class="nb">require</span> <span class="s2">"yet_another_engine/engine"</span>

<span class="k">module</span> <span class="nn">MyEngine</span>
  <span class="k">class</span> <span class="nc">Engine</span> <span class="o">&lt;</span> <span class="o">::</span><span class="no">Rails</span><span class="o">::</span><span class="no">Engine</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='require "other_engine/engine"
require "yet_another_engine/engine"

module MyEngine
  class Engine &lt; ::Rails::Engine
  end
end
'>Copy</button>
</div>
<h3 id="load-and-configuration-hooks"><a class="anchorlink" href="#load-and-configuration-hooks">7 Load and Configuration Hooks</a></h3><p>Rails code can often be referenced on load of an application. Rails is responsible for the load order of these frameworks, so when you load frameworks, such as <code>ActiveRecord::Base</code>, prematurely you are violating an implicit contract your application has with Rails. Moreover, by loading code such as <code>ActiveRecord::Base</code> on boot of your application you are loading entire frameworks which may slow down your boot time and could cause conflicts with load order and boot of your application.</p><p>Load and configuration hooks are the API that allow you to hook into this initialization process without violating the load contract with Rails. This will also mitigate boot performance degradation and avoid conflicts.</p><h4 id="avoid-loading-rails-frameworks"><a class="anchorlink" href="#avoid-loading-rails-frameworks">7.1 Avoid Loading Rails Frameworks</a></h4><p>Since Ruby is a dynamic language, some code will cause different Rails frameworks to load. Take this snippet for instance:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">.</span><span class="nf">include</span><span class="p">(</span><span class="no">MyActiveRecordHelper</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="ActiveRecord::Base.include(MyActiveRecordHelper)
">Copy</button>
</div>
<p>This snippet means that when this file is loaded, it will encounter <code>ActiveRecord::Base</code>. This encounter causes Ruby to look for the definition of that constant and will require it. This causes the entire Active Record framework to be loaded on boot.</p><p><code>ActiveSupport.on_load</code> is a mechanism that can be used to defer the loading of code until it is actually needed. The snippet above can be changed to:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">ActiveSupport</span><span class="p">.</span><span class="nf">on_load</span><span class="p">(</span><span class="ss">:active_record</span><span class="p">)</span> <span class="k">do</span>
  <span class="kp">include</span> <span class="no">MyActiveRecordHelper</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="ActiveSupport.on_load(:active_record) do
  include MyActiveRecordHelper
end
">Copy</button>
</div>
<p>This new snippet will only include <code>MyActiveRecordHelper</code> when <code>ActiveRecord::Base</code> is loaded.</p><h4 id="when-are-hooks-called-questionmark"><a class="anchorlink" href="#when-are-hooks-called-questionmark">7.2 When are Hooks called?</a></h4><p>In the Rails framework these hooks are called when a specific library is loaded. For example, when <code>ActionController::Base</code> is loaded, the <code>:action_controller_base</code> hook is called. This means that all <code>ActiveSupport.on_load</code> calls with <code>:action_controller_base</code> hooks will be called in the context of <code>ActionController::Base</code> (that means <code>self</code> will be an <code>ActionController::Base</code>).</p><h4 id="modifying-code-to-use-load-hooks"><a class="anchorlink" href="#modifying-code-to-use-load-hooks">7.3 Modifying Code to Use Load Hooks</a></h4><p>Modifying code is generally straightforward. If you have a line of code that refers to a Rails framework such as <code>ActiveRecord::Base</code> you can wrap that code in a load hook.</p><p><strong>Modifying calls to <code>include</code></strong></p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">.</span><span class="nf">include</span><span class="p">(</span><span class="no">MyActiveRecordHelper</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="ActiveRecord::Base.include(MyActiveRecordHelper)
">Copy</button>
</div>
<p>becomes</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">ActiveSupport</span><span class="p">.</span><span class="nf">on_load</span><span class="p">(</span><span class="ss">:active_record</span><span class="p">)</span> <span class="k">do</span>
  <span class="c1"># self refers to ActiveRecord::Base here,</span>
  <span class="c1"># so we can call .include</span>
  <span class="kp">include</span> <span class="no">MyActiveRecordHelper</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="ActiveSupport.on_load(:active_record) do
  # self refers to ActiveRecord::Base here,
  # so we can call .include
  include MyActiveRecordHelper
end
">Copy</button>
</div>
<p><strong>Modifying calls to <code>prepend</code></strong></p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span><span class="p">.</span><span class="nf">prepend</span><span class="p">(</span><span class="no">MyActionControllerHelper</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="ActionController::Base.prepend(MyActionControllerHelper)
">Copy</button>
</div>
<p>becomes</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">ActiveSupport</span><span class="p">.</span><span class="nf">on_load</span><span class="p">(</span><span class="ss">:action_controller_base</span><span class="p">)</span> <span class="k">do</span>
  <span class="c1"># self refers to ActionController::Base here,</span>
  <span class="c1"># so we can call .prepend</span>
  <span class="n">prepend</span> <span class="no">MyActionControllerHelper</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="ActiveSupport.on_load(:action_controller_base) do
  # self refers to ActionController::Base here,
  # so we can call .prepend
  prepend MyActionControllerHelper
end
">Copy</button>
</div>
<p><strong>Modifying calls to class methods</strong></p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">.</span><span class="nf">include_root_in_json</span> <span class="o">=</span> <span class="kp">true</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="ActiveRecord::Base.include_root_in_json = true
">Copy</button>
</div>
<p>becomes</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">ActiveSupport</span><span class="p">.</span><span class="nf">on_load</span><span class="p">(</span><span class="ss">:active_record</span><span class="p">)</span> <span class="k">do</span>
  <span class="c1"># self refers to ActiveRecord::Base here</span>
  <span class="nb">self</span><span class="p">.</span><span class="nf">include_root_in_json</span> <span class="o">=</span> <span class="kp">true</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="ActiveSupport.on_load(:active_record) do
  # self refers to ActiveRecord::Base here
  self.include_root_in_json = true
end
">Copy</button>
</div>
<h4 id="available-load-hooks"><a class="anchorlink" href="#available-load-hooks">7.4 Available Load Hooks</a></h4><p>These are the load hooks you can use in your own code. To hook into the initialization process of one of the following classes use the available hook.</p>
<table>
<thead>
<tr>
<th>Class</th>
<th>Hook</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ActionCable</code></td>
<td><code>action_cable</code></td>
</tr>
<tr>
<td><code>ActionCable::Channel::Base</code></td>
<td><code>action_cable_channel</code></td>
</tr>
<tr>
<td><code>ActionCable::Connection::Base</code></td>
<td><code>action_cable_connection</code></td>
</tr>
<tr>
<td><code>ActionCable::Connection::TestCase</code></td>
<td><code>action_cable_connection_test_case</code></td>
</tr>
<tr>
<td><code>ActionController::API</code></td>
<td><code>action_controller_api</code></td>
</tr>
<tr>
<td><code>ActionController::API</code></td>
<td><code>action_controller</code></td>
</tr>
<tr>
<td><code>ActionController::Base</code></td>
<td><code>action_controller_base</code></td>
</tr>
<tr>
<td><code>ActionController::Base</code></td>
<td><code>action_controller</code></td>
</tr>
<tr>
<td><code>ActionController::TestCase</code></td>
<td><code>action_controller_test_case</code></td>
</tr>
<tr>
<td><code>ActionDispatch::IntegrationTest</code></td>
<td><code>action_dispatch_integration_test</code></td>
</tr>
<tr>
<td><code>ActionDispatch::Response</code></td>
<td><code>action_dispatch_response</code></td>
</tr>
<tr>
<td><code>ActionDispatch::Request</code></td>
<td><code>action_dispatch_request</code></td>
</tr>
<tr>
<td><code>ActionDispatch::SystemTestCase</code></td>
<td><code>action_dispatch_system_test_case</code></td>
</tr>
<tr>
<td><code>ActionMailbox::Base</code></td>
<td><code>action_mailbox</code></td>
</tr>
<tr>
<td><code>ActionMailbox::InboundEmail</code></td>
<td><code>action_mailbox_inbound_email</code></td>
</tr>
<tr>
<td><code>ActionMailbox::Record</code></td>
<td><code>action_mailbox_record</code></td>
</tr>
<tr>
<td><code>ActionMailbox::TestCase</code></td>
<td><code>action_mailbox_test_case</code></td>
</tr>
<tr>
<td><code>ActionMailer::Base</code></td>
<td><code>action_mailer</code></td>
</tr>
<tr>
<td><code>ActionMailer::TestCase</code></td>
<td><code>action_mailer_test_case</code></td>
</tr>
<tr>
<td><code>ActionText::Content</code></td>
<td><code>action_text_content</code></td>
</tr>
<tr>
<td><code>ActionText::Record</code></td>
<td><code>action_text_record</code></td>
</tr>
<tr>
<td><code>ActionText::RichText</code></td>
<td><code>action_text_rich_text</code></td>
</tr>
<tr>
<td><code>ActionView::Base</code></td>
<td><code>action_view</code></td>
</tr>
<tr>
<td><code>ActionView::TestCase</code></td>
<td><code>action_view_test_case</code></td>
</tr>
<tr>
<td><code>ActiveJob::Base</code></td>
<td><code>active_job</code></td>
</tr>
<tr>
<td><code>ActiveJob::TestCase</code></td>
<td><code>active_job_test_case</code></td>
</tr>
<tr>
<td><code>ActiveRecord::Base</code></td>
<td><code>active_record</code></td>
</tr>
<tr>
<td><code>ActiveStorage::Attachment</code></td>
<td><code>active_storage_attachment</code></td>
</tr>
<tr>
<td><code>ActiveStorage::VariantRecord</code></td>
<td><code>active_storage_variant_record</code></td>
</tr>
<tr>
<td><code>ActiveStorage::Blob</code></td>
<td><code>active_storage_blob</code></td>
</tr>
<tr>
<td><code>ActiveStorage::Record</code></td>
<td><code>active_storage_record</code></td>
</tr>
<tr>
<td><code>ActiveSupport::TestCase</code></td>
<td><code>active_support_test_case</code></td>
</tr>
<tr>
<td><code>i18n</code></td>
<td><code>i18n</code></td>
</tr>
</tbody>
</table>
<h4 id="available-configuration-hooks"><a class="anchorlink" href="#available-configuration-hooks">7.5 Available Configuration Hooks</a></h4><p>Configuration hooks do not hook into any particular framework, but instead they run in context of the entire application.</p>
<table>
<thead>
<tr>
<th>Hook</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>before_configuration</code></td>
<td>First configurable block to run. Called before any initializers are run.</td>
</tr>
<tr>
<td><code>before_initialize</code></td>
<td>Second configurable block to run. Called before frameworks initialize.</td>
</tr>
<tr>
<td><code>before_eager_load</code></td>
<td>Third configurable block to run. Does not run if <a href="configuring.html#config-eager-load"><code>config.eager_load</code></a> set to false.</td>
</tr>
<tr>
<td><code>after_initialize</code></td>
<td>Last configurable block to run. Called after frameworks initialize.</td>
</tr>
</tbody>
</table>
<p>Configuration hooks can be called in the Engine class.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">Blorgh</span>
  <span class="k">class</span> <span class="nc">Engine</span> <span class="o">&lt;</span> <span class="o">::</span><span class="no">Rails</span><span class="o">::</span><span class="no">Engine</span>
    <span class="n">config</span><span class="p">.</span><span class="nf">before_configuration</span> <span class="k">do</span>
      <span class="nb">puts</span> <span class="s1">'I am called before any initializers'</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="module Blorgh
  class Engine &lt; ::Rails::Engine
    config.before_configuration do
      puts 'I am called before any initializers'
    end
  end
end
">Copy</button>
</div>


        <h3>Feedback</h3>
        <p>
          Você é incentivado a ajudar a melhorar a qualidade deste guia.
        </p>
        <p>
          Por favor, contribua caso veja quaisquer erros, inclusive erros de digitação.
          Para começar, você pode ler nossa sessão de <a href="https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">contribuindo com a documentação</a>.
        </p>
        <p>
          Você também pode encontrar conteúdo incompleto ou coisas que não estão atualizadas.
          Por favor, adicione qualquer documentação em falta na main do Rails. Certifique-se de checar o
          <a href="http://edgeguides.rubyonrails.org">Edge Guides (en-US)</a> primeiro para verificar
          se o problema já foi resolvido ou não no branch main.
          Verifique as <a href="ruby_on_rails_guides_guidelines.html">Diretrizes do Guia Ruby on Rails</a>
          para estilo e convenções.
        </p>
        <p>
          Se, por qualquer motivo, você encontrar algo para consertar, mas não conseguir consertá-lo, por favor
          <a href="https://github.com/campuscode/rails-guides-pt-BR/issues">abra uma issue no nosso Guia</a>.
        </p>
        <p>
          E por último, mas não menos importante, qualquer tipo de discussão sobre a documentação do Ruby on Rails
          é muito bem vinda na <a href="https://discuss.rubyonrails.org/c/rubyonrails-docs">forum oficial do Ruby on Rails</a> e nas
          <a href="https://github.com/campuscode/rails-guides-pt-BR/issues">issues do Guia em português</a>.
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p> Este projeto está licenciado sob uma licença <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International</a></p>
<p>"Rails", "Ruby on Rails", e o logotipo Rails são marcas comerciais de David Heinemeier Hansson. Todos os direitos reservados.</p>

    </div>
  </div>
  <div id="toggle">
    <img alt="dark theme icon" class="icon">
  </div>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Começando com Rails — Ruby on Rails Guides</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
  <link rel="stylesheet" type="text/css" href="stylesheets/highlight.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/search.css" data-turbolinks-track="reload">
  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
  <script src="javascripts/turbolinks.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/clipboard.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/guides.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/search.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/lunr-documents.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/lunr.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/toggle-theme.js" data-turbolinks-track="reload"></script>
  <meta property="og:title" content="Começando com Rails — Ruby on Rails Guides" />
  <meta name="description" content="Começando com RailsEste guia aborda a instalação e a execução do Ruby on Rails.Depois de ler este guia, você vai saber: Como instalar o Rails, criar uma nova aplicação Rails e conectar sua aplicação com um banco de dados. A estrutura geral de uma aplicação Rails. Os princípios básicos do MVC (Model, View, Controller) e design RESTful. Como gerar rapidamente as peças iniciais de uma aplicação Rails." />
  <meta property="og:description" content="Começando com RailsEste guia aborda a instalação e a execução do Ruby on Rails.Depois de ler este guia, você vai saber: Como instalar o Rails, criar uma nova aplicação Rails e conectar sua aplicação com um banco de dados. A estrutura geral de uma aplicação Rails. Os princípios básicos do MVC (Model, View, Controller) e design RESTful. Como gerar rapidamente as peças iniciais de uma aplicação Rails." />
  <meta property="og:locale" content="pt_BR" />
  <meta property="og:site_name" content="Guia Ruby on Rails" />
  <meta property="og:image" content="https://avatars.githubusercontent.com/u/4223" />
  <meta property="og:type" content="website" />
</head>
<body class="guide">
  <div>
    <div id="version-badge">v6.1.4</div>
  </div>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">Veja mais em <a href="https://rubyonrails.org/">rubyonrails.org:</a> </strong>
      <span class="red-button more-info-button">
        Mais Ruby on Rails
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://weblog.rubyonrails.org/">Blog</a></li>
        <li class="more-info"><a href="https://guides.rubyonrails.org/">Guia oficial</a></li>
        <li class="more-info"><a href="https://api.rubyonrails.org/">API</a></li>
        <li class="more-info"><a href="https://discuss.rubyonrails.org/">Forum</a></li>
        <li class="more-info"><a href="https://github.com/rails/rails">Contribua no GitHub</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="Voltar para a página principal">Guiarails.com.br</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">Home</a></li>
        <li class="guides-search guides-search-large">
          <input class="search-box search-box-large nav-item" type="text" placeholder="Digite o termo...">
          <div class="search-results"></div>
          <div class="search-spinner">Aguarde...</div>
        </li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">Guias</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
            <dl class="guides-section-container">
                <div class="guides-section">
                  <dt>Comece aqui</dt>
                  <dd><a href="getting_started.html">Começando com Rails</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Models</dt>
                  <dd><a href="active_record_basics.html">Active Record Basics</a></dd>
                  <dd><a href="active_record_migrations.html">Active Record Migrations</a></dd>
                  <dd><a href="active_record_validations.html">Active Record Validations</a></dd>
                  <dd><a href="active_record_callbacks.html">Active Record Callbacks</a></dd>
                  <dd><a href="association_basics.html">Active Record Associations</a></dd>
                  <dd><a href="active_record_querying.html">Active Record Query Interface</a></dd>
                  <dd><a href="active_model_basics.html">Active Model Basics</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Views</dt>
                  <dd><a href="action_view_overview.html">Action View Overview</a></dd>
                  <dd><a href="layouts_and_rendering.html">Layouts and Rendering in Rails</a></dd>
                  <dd><a href="action_view_helpers.html">Action View Helpers</a></dd>
                  <dd><a href="form_helpers.html">Action View Form Helpers</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Controllers</dt>
                  <dd><a href="action_controller_overview.html">Action Controller Overview</a></dd>
                  <dd><a href="routing.html">Rails Routing from the Outside In</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Outros componentes</dt>
                  <dd><a href="active_support_core_extensions.html">Active Support Core Extensions</a></dd>
                  <dd><a href="action_mailer_basics.html">Action Mailer Basics</a></dd>
                  <dd><a href="action_mailbox_basics.html">Action Mailbox Basics</a></dd>
                  <dd><a href="action_text_overview.html">Action Text Overview</a></dd>
                  <dd><a href="active_job_basics.html">Active Job Basics</a></dd>
                  <dd><a href="active_storage_overview.html">Active Storage Overview</a></dd>
                  <dd><a href="action_cable_overview.html">Action Cable Overview</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Indo mais fundo</dt>
                  <dd><a href="i18n.html">Rails Internationalization (I18n) API</a></dd>
                  <dd><a href="testing.html">Testing Rails Applications</a></dd>
                  <dd><a href="security.html">Securing Rails Applications</a></dd>
                  <dd><a href="debugging_rails_applications.html">Debugging Rails Applications</a></dd>
                  <dd><a href="configuring.html">Configuring Rails Applications</a></dd>
                  <dd><a href="command_line.html">The Rails Command Line</a></dd>
                  <dd><a href="asset_pipeline.html">The Asset Pipeline</a></dd>
                  <dd><a href="working_with_javascript_in_rails.html">Working with JavaScript in Rails</a></dd>
                  <dd><a href="initialization.html">The Rails Initialization Process</a></dd>
                  <dd><a href="autoloading_and_reloading_constants.html">Autoloading and Reloading Constants (Zeitwerk Mode)</a></dd>
                  <dd><a href="autoloading_and_reloading_constants_classic_mode.html">Autoloading and Reloading Constants (Classic Mode)</a></dd>
                  <dd><a href="caching_with_rails.html">Caching with Rails: An Overview</a></dd>
                  <dd><a href="active_support_instrumentation.html">Active Support Instrumentation</a></dd>
                  <dd><a href="api_app.html">Using Rails for API-only Applications</a></dd>
                  <dd><a href="active_record_postgresql.html">Active Record and PostgreSQL</a></dd>
                  <dd><a href="active_record_multiple_databases.html">Multiple Databases with Active Record</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Estendendo o Rails</dt>
                  <dd><a href="plugins.html">The Basics of Creating Rails Plugins</a></dd>
                  <dd><a href="rails_on_rack.html">Rails on Rack</a></dd>
                  <dd><a href="generators.html">Creating and Customizing Rails Generators &amp; Templates</a></dd>
                  <dd><a href="engines.html">Getting Started with Engines</a></dd>
                  <dd><a href="threading_and_code_execution.html">Threading and Code Execution in Rails</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Contribuições</dt>
                  <dd><a href="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails</a></dd>
                  <dd><a href="api_documentation_guidelines.html">API Documentation Guidelines</a></dd>
                  <dd><a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Políticas</dt>
                  <dd><a href="maintenance_policy.html">Maintenance Policy for Ruby on Rails</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Release Notes</dt>
                  <dd><a href="upgrading_ruby_on_rails.html">Upgrading Ruby on Rails</a></dd>
                  <dd><a href="6_1_release_notes.html">Version 6.1 - Dezembro 2020</a></dd>
                  <dd><a href="6_0_release_notes.html">Version 6.0 - Agosto 2019</a></dd>
                  <dd><a href="5_2_release_notes.html">Version 5.2 - April 2018</a></dd>
                  <dd><a href="5_1_release_notes.html">Version 5.1 - April 2017</a></dd>
                  <dd><a href="5_0_release_notes.html">Version 5.0 - June 2016</a></dd>
                  <dd><a href="4_2_release_notes.html">Version 4.2 - December 2014</a></dd>
                  <dd><a href="4_1_release_notes.html">Version 4.1 - April 2014</a></dd>
                  <dd><a href="4_0_release_notes.html">Version 4.0 - June 2013</a></dd>
                  <dd><a href="3_2_release_notes.html">Version 3.2 - January 2012</a></dd>
                  <dd><a href="3_1_release_notes.html">Version 3.1 - August 2011</a></dd>
                  <dd><a href="3_0_release_notes.html">Version 3.0 - August 2010</a></dd>
                  <dd><a href="2_3_release_notes.html">Version 2.3 - March 2009</a></dd>
                  <dd><a href="2_2_release_notes.html">Version 2.2 - November 2008</a></dd>
                </div>
            </div>
          </dl>
        </li>
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">Contribua</a></li>
        <li class="guides-search guides-search-small">
          <input class="search-box search-box-small nav-item" type="text" placeholder="Digite o termo...">
          <div class="search-results"></div>
          <div class="search-spinner">Aguarde...</div>
        </li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">Guias</option>
              <optgroup label="Comece aqui">
                  <option value="getting_started.html">Começando com Rails</option>
              </optgroup>
              <optgroup label="Models">
                  <option value="active_record_basics.html">Active Record Basics</option>
                  <option value="active_record_migrations.html">Active Record Migrations</option>
                  <option value="active_record_validations.html">Active Record Validations</option>
                  <option value="active_record_callbacks.html">Active Record Callbacks</option>
                  <option value="association_basics.html">Active Record Associations</option>
                  <option value="active_record_querying.html">Active Record Query Interface</option>
                  <option value="active_model_basics.html">Active Model Basics</option>
              </optgroup>
              <optgroup label="Views">
                  <option value="action_view_overview.html">Action View Overview</option>
                  <option value="layouts_and_rendering.html">Layouts and Rendering in Rails</option>
                  <option value="action_view_helpers.html">Action View Helpers</option>
                  <option value="form_helpers.html">Action View Form Helpers</option>
              </optgroup>
              <optgroup label="Controllers">
                  <option value="action_controller_overview.html">Action Controller Overview</option>
                  <option value="routing.html">Rails Routing from the Outside In</option>
              </optgroup>
              <optgroup label="Outros componentes">
                  <option value="active_support_core_extensions.html">Active Support Core Extensions</option>
                  <option value="action_mailer_basics.html">Action Mailer Basics</option>
                  <option value="action_mailbox_basics.html">Action Mailbox Basics</option>
                  <option value="action_text_overview.html">Action Text Overview</option>
                  <option value="active_job_basics.html">Active Job Basics</option>
                  <option value="active_storage_overview.html">Active Storage Overview</option>
                  <option value="action_cable_overview.html">Action Cable Overview</option>
              </optgroup>
              <optgroup label="Indo mais fundo">
                  <option value="i18n.html">Rails Internationalization (I18n) API</option>
                  <option value="testing.html">Testing Rails Applications</option>
                  <option value="security.html">Securing Rails Applications</option>
                  <option value="debugging_rails_applications.html">Debugging Rails Applications</option>
                  <option value="configuring.html">Configuring Rails Applications</option>
                  <option value="command_line.html">The Rails Command Line</option>
                  <option value="asset_pipeline.html">The Asset Pipeline</option>
                  <option value="working_with_javascript_in_rails.html">Working with JavaScript in Rails</option>
                  <option value="initialization.html">The Rails Initialization Process</option>
                  <option value="autoloading_and_reloading_constants.html">Autoloading and Reloading Constants (Zeitwerk Mode)</option>
                  <option value="autoloading_and_reloading_constants_classic_mode.html">Autoloading and Reloading Constants (Classic Mode)</option>
                  <option value="caching_with_rails.html">Caching with Rails: An Overview</option>
                  <option value="active_support_instrumentation.html">Active Support Instrumentation</option>
                  <option value="api_app.html">Using Rails for API-only Applications</option>
                  <option value="active_record_postgresql.html">Active Record and PostgreSQL</option>
                  <option value="active_record_multiple_databases.html">Multiple Databases with Active Record</option>
              </optgroup>
              <optgroup label="Estendendo o Rails">
                  <option value="plugins.html">The Basics of Creating Rails Plugins</option>
                  <option value="rails_on_rack.html">Rails on Rack</option>
                  <option value="generators.html">Creating and Customizing Rails Generators &amp; Templates</option>
                  <option value="engines.html">Getting Started with Engines</option>
                  <option value="threading_and_code_execution.html">Threading and Code Execution in Rails</option>
              </optgroup>
              <optgroup label="Contribuições">
                  <option value="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails</option>
                  <option value="api_documentation_guidelines.html">API Documentation Guidelines</option>
                  <option value="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</option>
              </optgroup>
              <optgroup label="Políticas">
                  <option value="maintenance_policy.html">Maintenance Policy for Ruby on Rails</option>
              </optgroup>
              <optgroup label="Release Notes">
                  <option value="upgrading_ruby_on_rails.html">Upgrading Ruby on Rails</option>
                  <option value="6_1_release_notes.html">Version 6.1 - Dezembro 2020</option>
                  <option value="6_0_release_notes.html">Version 6.0 - Agosto 2019</option>
                  <option value="5_2_release_notes.html">Version 5.2 - April 2018</option>
                  <option value="5_1_release_notes.html">Version 5.1 - April 2017</option>
                  <option value="5_0_release_notes.html">Version 5.0 - June 2016</option>
                  <option value="4_2_release_notes.html">Version 4.2 - December 2014</option>
                  <option value="4_1_release_notes.html">Version 4.1 - April 2014</option>
                  <option value="4_0_release_notes.html">Version 4.0 - June 2013</option>
                  <option value="3_2_release_notes.html">Version 3.2 - January 2012</option>
                  <option value="3_1_release_notes.html">Version 3.1 - August 2011</option>
                  <option value="3_0_release_notes.html">Version 3.0 - August 2010</option>
                  <option value="2_3_release_notes.html">Version 2.3 - March 2009</option>
                  <option value="2_2_release_notes.html">Version 2.2 - November 2008</option>
              </optgroup>
          </select>
        </li>
      </ul>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Começando com Rails</h2><p>Este guia aborda a instalação e a execução do Ruby on Rails.</p><p>Depois de ler este guia, você vai saber:</p>
<ul>
<li>Como instalar o Rails, criar uma nova aplicação Rails e conectar sua
aplicação com um banco de dados.</li>
<li>A estrutura geral de uma aplicação Rails.</li>
<li>Os princípios básicos do MVC (<strong>Model</strong>, <strong>View</strong>, <strong>Controller</strong>) e design <strong>RESTful</strong>.</li>
<li>Como gerar rapidamente as peças iniciais de uma aplicação Rails.</li>
</ul>


                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li><a href="#premissas-do-guia">Premissas do Guia</a></li>
<li><a href="#o-que-e-o-rails-questionmark">O que é o Rails?</a></li>
<li>
<a href="#criando-um-novo-projeto-em-rails">Criando um Novo Projeto em Rails</a>

<ul>
<li><a href="#criando-um-novo-projeto-em-rails-instalando-o-rails">Instalando o Rails</a></li>
<li><a href="#criando-a-aplicacao-blog">Criando a Aplicação Blog</a></li>
</ul>
</li>
<li>
<a href="#ola-rails-bang">Olá, Rails!</a>

<ul>
<li><a href="#inicializando-o-servidor-web">Inicializando o Servidor Web</a></li>
<li><a href="#diga-ola-rails">Diga "Olá", Rails</a></li>
<li><a href="#configuracao-da-pagina-inicial-da-aplicacao">Configuração da Página Inicial da Aplicação</a></li>
</ul>
</li>
<li>
<a href="#mvc-e-voce">MVC e Você</a>

<ul>
<li><a href="#mvc-e-voce-gerando-um-model">Gerando um <em>Model</em></a></li>
<li><a href="#migracoes-de-banco-de-dados">Migrações de Banco de Dados</a></li>
<li><a href="#utilizando-um-model-para-interagir-com-o-banco-de-dados">Utilizando um <em>Model</em> para Interagir com o Banco de Dados</a></li>
<li><a href="#exibindo-uma-lista-de-artigos">Exibindo uma Lista de Artigos</a></li>
</ul>
</li>
<li>
<a href="#operacoes-crud">Operações CRUD</a>

<ul>
<li><a href="#exibindo-um-unico-artigo">Exibindo um Único Artigo</a></li>
<li><a href="#roteamento-de-resources-recursos">Roteamento de <em>Resources</em> (recursos)</a></li>
<li><a href="#criando-um-novo-artigo">Criando um Novo Artigo</a></li>
<li><a href="#atualizando-um-artigo">Atualizando um Artigo</a></li>
<li><a href="#deletando-um-artigo">Deletando um Artigo</a></li>
</ul>
</li>
<li>
<a href="#adicionando-um-segundo-model">Adicionando um Segundo Model</a>

<ul>
<li><a href="#adicionando-um-segundo-model-gerando-um-model">Gerando um Model</a></li>
<li><a href="#associando-models">Associando Models</a></li>
<li><a href="#adicionando-a-rota-para-comentarios">Adicionando a Rota para Comentários</a></li>
<li><a href="#gerando-um-controller">Gerando um Controller</a></li>
</ul>
</li>
<li>
<a href="#refatorando">Refatorando</a>

<ul>
<li><a href="#renderizando-colecoes-de-partials">Renderizando Coleções de <em>Partials</em></a></li>
<li><a href="#renderizando-um-formulario-com-partial">Renderizando um Formulário com <em>Partial</em></a></li>
<li><a href="#usando-concerns">Usando <em>Concerns</em></a></li>
</ul>
</li>
<li>
<a href="#deletando-comentarios">Deletando Comentários</a>

<ul>
<li><a href="#excluindo-objetos-associados">Excluindo objetos associados</a></li>
</ul>
</li>
<li>
<a href="#seguranca">Segurança</a>

<ul>
<li><a href="#autenticacao-basica">Autenticação Básica</a></li>
<li><a href="#outras-consideracoes-de-seguranca">Outras Considerações de Segurança</a></li>
</ul>
</li>
<li><a href="#o-que-vem-depois-questionmark">O que vem depois?</a></li>
<li><a href="#dicas-de-configuracao">Dicas de Configuração</a></li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h3 id="premissas-do-guia"><a class="anchorlink" href="#premissas-do-guia">1 Premissas do Guia</a></h3><p>Este guia é projetado para iniciantes que desejam começar uma aplicação Rails do
zero. Ele não assume que você tenha nenhuma experiência anterior com Rails.</p><p>O Rails é um <em>framework</em> para aplicações web que é executado em cima da linguagem
de programação Ruby. Se você não tem nenhuma experiência com Ruby, você vai
achar a curva de aprendizado bastante íngrime começando direto com Rails.
Existem diversas listas organizadas de materiais online para aprender Ruby:</p>
<ul>
<li><a href="https://www.ruby-lang.org/en/documentation/">Site Oficial da Linguagem de Programação Ruby (Em inglês)</a></li>
<li><a href="https://github.com/EbookFoundation/free-programming-books/blob/master/books/free-programming-books.md#ruby">Lista de Livros Grátis de Programação (Em inglês)</a></li>
</ul>
<p>Fique atento que alguns materiais, apesar de excelentes, envolvem versões antigas
do Ruby e podem não incluir parte da sintaxe que você
vai ver no seu dia-a-dia desenvolvendo com Rails.</p><h3 id="o-que-e-o-rails-questionmark"><a class="anchorlink" href="#o-que-e-o-rails-questionmark">2 O que é o Rails?</a></h3><p>Rails é um <em>framework</em> de desenvolvimento de aplicações <em>web</em> escrito na linguagem de programação Ruby.
Foi projetado para facilitar o desenvolvimento de aplicações <em>web</em>, criando premissas sobre tudo que uma pessoa desenvolvedora precisa para começar. Permite que você escreva menos código, enquanto realiza mais do que em muitas outras linguagens ou <em>frameworks.</em> Pessoas desenvolvedoras experientes em Rails, também dizem que desenvolver aplicações web ficou mais divertido.</p><p>Rails é um software opinativo. Assumindo que há uma "melhor" maneira para fazer as coisas, e foi projetado para encorajar essa maneira - e, em alguns casos para desencorajar alternativas. Se você aprender o "Rails Way", provavelmente terá um grande aumento de produtividade. Se você insistir nos velhos hábitos de outras linguagens, tentando usar os padrões que você aprendeu em outro lugar, você pode ter uma experiência menos feliz.</p><p>A filosofia do Rails possui dois princípios fundamentais:</p>
<ul>
<li>
<strong>Não repita a si mesmo:</strong> DRY (don't repeat yourself) é um conceito de desenvolvimento de software que estabelece que "Todo conhecimento deve possuir uma representação única, de autoridade e livre de ambiguidades em todo o sistema". Ao não escrever as mesmas informações repetidamente, o código fica mais fácil de manter, de expandir e com menos <em>bugs</em>.</li>
<li>
<strong>Convenção sobre configuração:</strong> O Rails possui convenções sobre as melhores maneiras de fazer muitas coisas em uma aplicação web, devido a essas convenções você não precisa especificar detalhes através de arquivos de configuração infinitos.</li>
</ul>
<h3 id="criando-um-novo-projeto-em-rails"><a class="anchorlink" href="#criando-um-novo-projeto-em-rails">3 Criando um Novo Projeto em Rails</a></h3><p>A melhor forma de ler esse guia é seguir o passo à passo. Todos os passos são
essenciais para rodar a aplicação de exemplo e nenhum código ou passos adicionais
serão necessários.</p><p>Seguindo este guia, você irá criar um projeto em <em>Rails</em> chamado de
<code>blog</code>, um <em>weblog</em> (muito) simples. Antes de você começar a construir a aplicação,
você precisa ter certeza de ter o <em>Rails</em> instalado.</p><div class="note"><p>Os exemplos à seguir usam <code>$</code> para representar seu <em>prompt</em> de terminal em um
sistema operacional baseado em UNIX, mesmo que ele tenha sido customizado para parecer diferente.
Se você está utilizando Windows, seu <em>prompt</em> será parecido com algo como <code>C:\source_code&gt;</code>.</p></div><h4 id="criando-um-novo-projeto-em-rails-instalando-o-rails"><a class="anchorlink" href="#criando-um-novo-projeto-em-rails-instalando-o-rails">3.1 Instalando o Rails</a></h4><p>Antes de você instalar o Rails, você deve validar para ter certeza que seu sistema
tem os pré requisitos necessários instalados. Esses incluem:</p>
<ul>
<li>Ruby </li>
<li>SQLite3</li>
<li>Node.js</li>
<li>Yarn</li>
</ul>
<h5 id="instalando-o-ruby"><a class="anchorlink" href="#instalando-o-ruby">3.1.1 Instalando o Ruby</a></h5><p>Abra o <em>prompt</em> de linha de comando. No <em>macOS</em> abra o <em>Terminal.app</em>; no <em>Windows</em>
escolha "Executar" no menu inicial e digite <code>cmd.exe</code>. Qualquer comando que antecede
o sinal de dólar <code>$</code> deverá ser rodado em linha de comando. Verifique se você tem a
versão atual do Ruby instalado:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">ruby</span> <span class="nt">--version</span>
<span class="go">ruby 2.5.0
</span></code></pre>
<textarea class="clipboard-content" id="clipboard-28cc647920418a0f70c5b735ede6fe63">ruby --version
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-28cc647920418a0f70c5b735ede6fe63">Copiar</button>
</div>
<p>O Rails necessita da versão Ruby 2.5.0 ou mais atual. Se o número da versão retornada
for menor que este número (como 2.3.7, e 1.8.7), você precisará instalar uma versão do Ruby mais atual.</p><p>Para instalar o Rails no Windows, você primeiro tem que instalar o <a href="https://rubyinstaller.org">Ruby Installer</a>. </p><p>Para mais informações de instalação
de outros Sistemas Operacionais, dê uma olhada em <a href="https://www.ruby-lang.org/en/documentation/installation/">ruby-lang.org</a>.</p><h5 id="instalando-o-sqlite3"><a class="anchorlink" href="#instalando-o-sqlite3">3.1.2 Instalando o SQLite3</a></h5><p>Você também precisará instalar o banco de dados SQLite3.
Muitos sistemas operacionais populares semelhantes ao UNIX são fornecidos com uma versão compatível do SQLite3.
Em outros sistemas você pode achar mais instruções de instalação em <a href="https://www.sqlite.org">SQLite3 website</a>.
Verifique se está corretamente instalado e carregado no seu <code>PATH</code>:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">sqlite3</span> <span class="nt">--version</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-0a4cccf67b4305fbab023d9a67b26200">sqlite3 --version
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-0a4cccf67b4305fbab023d9a67b26200">Copiar</button>
</div>
<p>O programa deverá reportar sua versão.</p><h5 id="instalando-o-node-js-e-yarn"><a class="anchorlink" href="#instalando-o-node-js-e-yarn">3.1.3 Instalando o Node.js e Yarn</a></h5><p>Por fim, você precisará do Node.js e o Yarn instalados para gerenciar o JavaScript da sua aplicação.</p><p>Encontre as instruções de instalação no <a href="https://nodejs.org/en/download/">site do Node.js</a> e
verifique se está instalado corretamente com o seguinte comando:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">node</span> <span class="nt">--version</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-8446499237fd81a462646a1f57baa775">node --version
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8446499237fd81a462646a1f57baa775">Copiar</button>
</div>
<p>A versão do Node.js deve ser impressa. Certifique-se de que é maior
que 8.16.0.</p><p>Para instalar o Yarn, siga as instruções de instalação
instruções no <a href="https://classic.yarnpkg.com/en/docs/install">site do Yarn</a>.</p><p>A execução deste comando deve imprimir a versão do Yarn:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">yarn</span> <span class="nt">--version</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-15d399530bb8187d35474884ba976986">yarn --version
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-15d399530bb8187d35474884ba976986">Copiar</button>
</div>
<p>Se aparecer algo como "1.22.0", o Yarn foi instalado corretamente.</p><h5 id="criando-um-novo-projeto-em-rails-instalando-o-rails-instalando-o-rails"><a class="anchorlink" href="#criando-um-novo-projeto-em-rails-instalando-o-rails-instalando-o-rails">3.1.4 Instalando o Rails</a></h5><p>Para instalar o Rails, use o comando <code>gem install</code> fornecido pelo RubyGems:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">gem install rails</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-2d818613bcbc11b79ff5dec359885e3c">gem install rails
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2d818613bcbc11b79ff5dec359885e3c">Copiar</button>
</div>
<p>Para verificar se você tem tudo instalado corretamente, você deve rodar o comando à seguir:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">rails</span> <span class="nt">--version</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-80c72f35b158a1087fa7cb82e5fc9a6a">rails --version
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-80c72f35b158a1087fa7cb82e5fc9a6a">Copiar</button>
</div>
<p>Se esse comando retornar algo como "Rails 6.0.0", você está pronto para continuar.</p><h4 id="criando-a-aplicacao-blog"><a class="anchorlink" href="#criando-a-aplicacao-blog">3.2 Criando a Aplicação Blog</a></h4><p>O Rails vem com vários scripts chamados <em>generators</em> que são projetados para tornar
sua vida de desenvolvedor fácil, criando tudo que é necessário para começar a
trabalhar em uma tarefa em particular. Um desses é o <em>generator</em> de nova aplicação,
que irá te fornecer a base de uma nova aplicação em Rails para que você não precise
escrever tudo sozinho.</p><p>Para utilizar esse <em>generator</em>, abra um terminal, navegue para um diretório onde
você tenha permissão para criar arquivos, e rode:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">rails </span>new blog
</code></pre>
<textarea class="clipboard-content" id="clipboard-41bc67be5f61465f3cfc0af9956bb98f">rails new blog
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-41bc67be5f61465f3cfc0af9956bb98f">Copiar</button>
</div>
<p>Este comando irá criar uma aplicação em Rails chamada Blog em um diretório <code>blog</code>
e irá instalar as dependências das <em>gems</em> que já foram mencionadas no <code>Gemfile</code>
usando <code>bundle install</code>.</p><div class="note"><p>Se você está utilizando um subsistema Windows para Linux então existem
algumas limitações nas notificações dos arquivos do sistema que significa que você
deve desabilitar as gems <code>spring</code> e <code>listen</code>, o que poderá ser feito rodando o comando
<code>rails new blog --skip-spring --skip-listen</code>.</p></div><div class="info"><p>Você pode ver todas as opções de linha de comando gerador que a aplicação Rails
aceita rodando o comando <code>rails new --help</code>.</p></div><p>Depois de criar a aplicação blog, entre em sua pasta:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>blog
</code></pre>
<textarea class="clipboard-content" id="clipboard-c3383421993279ad3742f9be7ebb7556">cd blog
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-c3383421993279ad3742f9be7ebb7556">Copiar</button>
</div>
<p>A pasta <code>blog</code> vai ter vários arquivos gerados e pastas que compõem a estrutura
de uma aplicação Rails. A maior parte da execução deste tutorial será feito na
pasta <code>app</code>, mas à seguir teremos um resumo básico das funções de cada um dos arquivos e pastas
que o Rails gerou por padrão:</p>
<table>
<thead>
<tr>
<th>Arquivo/Pasta</th>
<th>Objetivo</th>
</tr>
</thead>
<tbody>
<tr>
<td>app/</td>
<td>Contém os <em>controllers</em>, <em>models</em>, <em>views</em>, <em>helpers</em>, <em>mailers</em>, <em>channels</em>, <em>jobs</em>, e <em>assets</em> para sua aplicação. Você irá se concentrar nesse diretório pelo restante desse guia.</td>
</tr>
<tr>
<td>bin/</td>
<td>Contém o script <code>rails</code> que inicializa sua aplicação e contém outros scripts que você utiliza para configurar, atualizar, colocar em produção ou executar sua aplicação.</td>
</tr>
<tr>
<td>config/</td>
<td>Contém configurações de rotas, banco de dados entre outros de sua aplicação. Este conteúdo é abordado com mais detalhes em <a href="configuring.html">Configuring Rails Applications</a>.</td>
</tr>
<tr>
<td>config.ru</td>
<td>Configuração <em>Rack</em> para servidores baseados em <em>Rack</em> usados para iniciar a aplicação. Para mais informações sobre o <em>Rack</em>, consulte <a href="https://rack.github.io/">Rack website</a>.</td>
</tr>
<tr>
<td>db/</td>
<td>Contém o <em>schema</em> do seu banco de dados atual, assim como as <em>migrations</em> do banco de dados.</td>
</tr>
<tr>
<td>Gemfile<br>Gemfile.lock</td>
<td>Esses arquivos permitem que você especifique quais dependências de <em>gem</em> são necessárias na sua aplicação Rails. Esses arquivos são usados pela <em>gem</em> Bundler. Para mais informações sobre o Bundler, acesse <a href="https://bundler.io">o website do Bundler</a>.</td>
</tr>
<tr>
<td>lib/</td>
<td>Módulos extendidos da sua aplicação.</td>
</tr>
<tr>
<td>log/</td>
<td>Arquivos de <em>log</em> da aplicação.</td>
</tr>
<tr>
<td>package.json</td>
<td>Este arquivo permite que você especifique quais dependências <em>npm</em> são necessárias para sua aplicação Rails. Este arquivo é usado pelo Yarn. Para mais informações do Yarn, acesse <a href="https://yarnpkg.com/lang/en/">o website do Yarn</a>.</td>
</tr>
<tr>
<td>public/</td>
<td>Contém arquivos estáticos e <em>assets</em> compilados. Quando sua aplicação está rodando esse diretório é exposto como ele está.</td>
</tr>
<tr>
<td>Rakefile</td>
<td>Este arquivo localiza e carrega tarefas que podem ser rodadas por linhas de comando. As tarefas são definidas nos componentes do Rails. Ao invés de editar o <code>Rakefile</code>, você deve criar suas próprias tarefas adicionando os arquivos no diretório <code>lib/tasks</code> da sua aplicação.</td>
</tr>
<tr>
<td>README.md</td>
<td>Este é um manual de instruções para sua aplicação. Você deve editar este arquivo para informar o que seu aplicativo faz, como configurá-lo e assim por diante.</td>
</tr>
<tr>
<td>storage/</td>
<td>Arquivos de armazenamento ativo do serviço de disco. Mais informações em <a href="active_storage_overview.html">Active Storage Overview</a>.</td>
</tr>
<tr>
<td>test/</td>
<td>Testes unitários, <em>fixtures</em>, e outros tipos de testes. Mais informações em <a href="testing.html">Testing Rails Applications</a>.</td>
</tr>
<tr>
<td>tmp/</td>
<td>Arquivos temporários (como cache e arquivos <em>pid</em>).</td>
</tr>
<tr>
<td>vendor/</td>
<td>Diretório com todos os códigos de terceiros. Em uma típica aplicação Rails inclui <em>vendored gems</em>.</td>
</tr>
<tr>
<td>.gitignore</td>
<td>Este arquivo diz ao Git quais arquivos (ou padrões) devem ser ignorados. Acesse <a href="https://help.github.com/articles/ignoring-files">GitHub - Ignoring files</a> para mais informações sobre arquivos ignorados.</td>
</tr>
<tr>
<td>.ruby-version</td>
<td>Este arquivo contém a versão padrão do Ruby.</td>
</tr>
</tbody>
</table>
<h3 id="ola-rails-bang"><a class="anchorlink" href="#ola-rails-bang">4 Olá, Rails!</a></h3><p>Para começar vamos colocar um texto na tela rapidamente. Para fazer isso, você
precisa que seu servidor de aplicação Rails esteja em execução.</p><h4 id="inicializando-o-servidor-web"><a class="anchorlink" href="#inicializando-o-servidor-web">4.1 Inicializando o Servidor Web</a></h4><p>Você já tem uma aplicação Rails funcional. Para vê-la você deve iniciar um
servidor web em sua máquina de desenvolvimento. Você pode fazer isso executando
o seguinte comando no diretório <code>blog</code>:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>server
</code></pre>
<textarea class="clipboard-content" id="clipboard-28258fca74a55d837ab77d3ef2c8ce8d">bin/rails server
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-28258fca74a55d837ab77d3ef2c8ce8d">Copiar</button>
</div>
<div class="info"><p>Se você está usando Windows, deve executar os scripts do diretório
<code>bin</code> para o interpretador do Ruby: <code>ruby bin\rails server</code>.</p></div><div class="info"><p>A compressão de <em>assets</em> JavaScript requer que você tenha um executor
disponível em seu sistema operacional. Na ausência de um executor você verá um
erro de <code>execjs</code> durante a compressão dos <em>assets</em>. Geralmente o macOS e o Windows possuem um executor JavaScript instalado por
padrão. <code>therubyrhino</code> é o executor recomendado para usuários de JRuby e vem no
<code>Gemfile</code> por padrão em aplicações geradas com JRuby. Você pode avaliar todos
executores em <a href="https://github.com/rails/execjs#readme">ExecJS</a>.</p></div><p>A execução do comando irá iniciar o Puma, um servidor web distribuído com o
Rails por padrão. Para ver sua aplicação em execução, abra um navegador e
navegue para <a href="http://localhost:3000">http://localhost:3000</a>.  Você deve ver a página padrão com informações do Rails:</p><p><img src="images/getting_started/rails_welcome.png" alt="Captura de tela escrito Yay! Você está no Rails(em inglês)"></p><p>Quando você deseja interromper a execução do servidor Web, pressione Ctrl+C na janela do
terminal em que o servidor está sendo executado. No ambiente de desenvolvimento, o Rails geralmente não requer que você reinicie o servidor; mudanças em arquivos são automaticamente interpretadas pelo servidor.</p><p>A página de "Yay! Você está no Rails! (Yay! You're on Rails!)" é o <em>smoke test</em> (teste de sanidade) para uma
nova aplicação Rails: garante que o seu software esteja configurado
corretamente, o suficiente para gerar uma página.</p><h4 id="diga-ola-rails"><a class="anchorlink" href="#diga-ola-rails">4.2 Diga "Olá", Rails</a></h4><p>Para que o Rails diga "Olá", você precisa criar no mínimo uma rota (<em>route</em>), um <em>controller</em> com uma <em>action</em> e uma <em>view</em>. A <em>route</em> mapeia uma requisição para uma <em>action</em> de um <em>controller</em>. A <em>action</em> do <em>controller</em> faz todo o trabalho necessário para lidar com a requisição, e prepara qualquer dado para a <em>view</em>. A <em>view</em>  mostra o dado no formato que você quiser.</p><p>Em termos de implementação: Rotas são regras escritas em um <a href="https://pt.wikipedia.org/wiki/Linguagem_de_dom%C3%ADnio_espec%C3%ADfico">DSL (domain-specific language)</a> em Ruby. <em>Controllers</em> são classes Ruby, e seus métodos públicos são as <em>actions</em>. E as <em>views</em> são <em>templates</em>, geralmente escritos numa mistura de Ruby e HTML.</p><p>Vamos começar adicionando uma rota ao nosso arquivo de rotas, <code>config/routes.rb</code>, no
topo do bloco <code>Rails.application.routes.draw</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#index"</span>

  <span class="c1"># Para mais detalhes da DSL disponível para esse arquivo, veja https://guides.rubyonrails.org/routing.html</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-a9aecc631fbefd4169615c5f5bb14b46">Rails.application.routes.draw do
  get "/articles", to: "articles#index"

  # Para mais detalhes da DSL disponível para esse arquivo, veja https://guides.rubyonrails.org/routing.html
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-a9aecc631fbefd4169615c5f5bb14b46">Copiar</button>
</div>
<p>A rota acima declara que as requisições de <code>GET / articles</code> são mapeadas para o <em>action</em> <code>index</code> do <code>ArticlesController</code>.</p><p>Para criar o <code>ArticlesController</code> e sua <em>action</em> <code>index</code>, vamos executar o controlador
gerador (com a opção <code>--skip-routes</code> porque já temos um
rota apropriada):</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate controller Articles index <span class="nt">--skip-routes</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-7a7a893ba578375832074f4148508225">bin/rails generate controller Articles index --skip-routes
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-7a7a893ba578375832074f4148508225">Copiar</button>
</div>
<p>O Rails vai gerar vários arquivos para você:</p><div class="code_container">
<pre><code class="highlight plaintext">create  app/controllers/articles_controller.rb
invoke  erb
create    app/views/articles
create    app/views/articles/index.html.erb
invoke  test_unit
create    test/controllers/articles_controller_test.rb
invoke  helper
create    app/helpers/articles_helper.rb
invoke    test_unit
invoke  assets
invoke    scss
create      app/assets/stylesheets/articles.scss
</code></pre>
<textarea class="clipboard-content" id="clipboard-59acbe654d15d42cd1482abecb1e727b">create  app/controllers/articles_controller.rb
invoke  erb
create    app/views/articles
create    app/views/articles/index.html.erb
invoke  test_unit
create    test/controllers/articles_controller_test.rb
invoke  helper
create    app/helpers/articles_helper.rb
invoke    test_unit
invoke  assets
invoke    scss
create      app/assets/stylesheets/articles.scss
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-59acbe654d15d42cd1482abecb1e727b">Copiar</button>
</div>
<p>O mais importante desses é o arquivo <em>controller</em>, <code>app/controllers/articles_controller.rb</code>. Vamos dar uma olhada nele:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-3038e1df006235f22f80a4e2f17f4713">class ArticlesController &lt; ApplicationController
  def index
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-3038e1df006235f22f80a4e2f17f4713">Copiar</button>
</div>
<p>A <em>action</em> <code>index</code> está vazia. Quando uma <em>action</em> não renderiza explicitamente uma <em>view</em>
(ou de outra forma acionar uma resposta HTTP), o Rails irá renderizar automaticamente uma <em>view</em>
que corresponde ao nome do <em>controller</em> e <em>action</em>. Convenção sobre
Configuração! As <em>views</em> estão localizadas no diretório <code>app/views</code>. Portanto, a <em>action</em> <code>index</code> renderizará <code>app/views/articles/index.html.erb</code> por padrão.</p><p>Vamos abrir o arquivo <code>app/views/articles/index.html.erb</code>, e substituir todo código existente por:</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;h1&gt;</span>Olá, Rails!<span class="nt">&lt;/h1&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-e708fa369d1d681076748238a8ab3aca">&lt;h1&gt;Olá, Rails!&lt;/h1&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-e708fa369d1d681076748238a8ab3aca">Copiar</button>
</div>
<p>Se você parou anteriormente o servidor web para executar o gerador do <em>controller</em>,
reinicie-o com <code>bin/rails server</code>. Agora visite <a href="http://localhost:3000/articles">http://localhost:3000/articles</a>
e veja nosso texto exibido!</p><h4 id="configuracao-da-pagina-inicial-da-aplicacao"><a class="anchorlink" href="#configuracao-da-pagina-inicial-da-aplicacao">4.3 Configuração da Página Inicial da Aplicação</a></h4><p>No momento, <a href="http://localhost:3000">http://localhost:3000</a> ainda exibe "Yay! Você está no Rails!".
Vamos mostrar nosso "Olá, Rails!" texto em <a href="http://localhost:3000">http://localhost:3000</a> também.
Para fazer isso, vamos adicionar uma rota que mapeia o caminho raiz (<em>root path</em>) da nossa aplicação para o <em>controller</em> e <em>action</em> apropriados.</p><p>Vamos abrir o arquivo <code>config/routes.rb</code>, e adicionar o a rota <code>root</code> no começo do bloco <code>Rails.application.routes.draw</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s2">"articles#index"</span>

  <span class="n">get</span> <span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#index"</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-e03065bdc622c4cc892390d421c3b827">Rails.application.routes.draw do
  root "articles#index"

  get "/articles", to: "articles#index"
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-e03065bdc622c4cc892390d421c3b827">Copiar</button>
</div>
<p>Agora podemos ver a mensagem "Olá, Rails!", quando visitamos <a href="http://localhost:3000">http://localhost:3000</a> confirmando que a <em>route</em> <code>root</code> também mapeia para a <em>action</em> <code>index</code> de <code>ArticlesController</code>.</p><div class="info"><p>Para mais informações sobre roteamento, consulte <a href="routing.html">Roteamento do Rails de Fora para Dentro</a>.</p></div><h3 id="mvc-e-voce"><a class="anchorlink" href="#mvc-e-voce">5 MVC e Você</a></h3><p>Até agora, discutimos rotas, <em>controllers</em>, <em>actions</em> e <em>views</em>. Todas essas
são peças típicas de uma aplicação web que segue o padrão <a href="https://pt.wikipedia.org/wiki/MVC">MVC (Model-View-Controller)</a>.</p><p>MVC é um padrão de projeto que divide as responsabilidades de uma aplicação para
facilitar nosso entendimento. O Rails segue esse padrão de projeto por
convenção.</p><p>Já que temos um <em>controller</em> e uma <em>view</em> para trabalhar, agora vamos gerar a próxima
peça: o <em>model</em>.</p><h4 id="mvc-e-voce-gerando-um-model"><a class="anchorlink" href="#mvc-e-voce-gerando-um-model">5.1 Gerando um <em>Model</em></a></h4><p>Um <em>Model</em> é uma classe Ruby utilizada para representar dados. Além disso, os
<em>models</em> podem interagir com o banco de dados da aplicação através de um recurso
do Rails chamado <em>Active Record</em>.</p><p>Para definir um <em>model</em>, utilizaremos um gerador de <em>models</em>:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate model Article title:string body:text
</code></pre>
<textarea class="clipboard-content" id="clipboard-88d83f849afc7983d6fe3efbebaad7dc">bin/rails generate model Article title:string body:text
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-88d83f849afc7983d6fe3efbebaad7dc">Copiar</button>
</div>
<div class="note"><p>Os nomes dos <em>models</em> são no <strong>singular</strong>, pois um <em>model</em> instanciado
representa um único registro de dados. Para ajudar a lembrar esta convenção,
pense em como você chamaria o construtor do <em>model</em>: queremos escrever
<code>Article.new(...)</code>, <strong>não</strong> <code>Articles.new(...)</code>.</p></div><p>O comando utilizando o gerador criará vários arquivos:</p><div class="code_container">
<pre><code class="highlight plaintext">invoke  active_record
create    db/migrate/&lt;timestamp&gt;_create_articles.rb
create    app/models/article.rb
invoke    test_unit
create      test/models/article_test.rb
create      test/fixtures/articles.yml
</code></pre>
<textarea class="clipboard-content" id="clipboard-80bff034cf0946108aeeb82f199b455c">invoke  active_record
create    db/migrate/&lt;timestamp&gt;_create_articles.rb
create    app/models/article.rb
invoke    test_unit
create      test/models/article_test.rb
create      test/fixtures/articles.yml
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-80bff034cf0946108aeeb82f199b455c">Copiar</button>
</div>
<p>Os dois arquivos em que vamos nos concentrar são o arquivo da <em>migration</em>
(<code>db/migrate/&lt;timestamp&gt;_create_articles.rb</code>) e o arquivo do <em>model</em>
(<code>app/models/article.rb</code>).</p><h4 id="migracoes-de-banco-de-dados"><a class="anchorlink" href="#migracoes-de-banco-de-dados">5.2 Migrações de Banco de Dados</a></h4><p>As <em>Migrations</em> são utilizadas para alterar a estrutura do banco de dados de uma
aplicação. Em aplicações Rails, as <em>migrations</em> são escritas em Ruby para que
possam ser independentes do banco de dados.</p><p>Vamos dar uma olhada no conteúdo do nosso novo arquivo de <em>migration</em>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">CreateArticles</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">6.0</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:articles</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:title</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">text</span> <span class="ss">:body</span>

      <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-13bd7bf16c1f387c8fec97ccd8b16f13">class CreateArticles &lt; ActiveRecord::Migration[6.0]
  def change
    create_table :articles do |t|
      t.string :title
      t.text :body

      t.timestamps
    end
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-13bd7bf16c1f387c8fec97ccd8b16f13">Copiar</button>
</div>
<p>A chamada para <code>create_table</code> especifica como a tabela <code>articles</code> deve ser
construída. Por padrão, o método <code>create_table</code> adiciona uma coluna <code>id</code> como
chave primária de auto incremento. Portanto, o primeiro registro na tabela terá
um <code>id</code> de valor 1, o próximo registro terá um <code>id</code> de valor 2 e assim por
diante.</p><p>Dentro do bloco de <code>create_table</code>, duas colunas são definidas: <code>title</code> e <code>body</code>.
Elas foram adicionadas pelo gerador, pois incluímos a instrução no nosso comando
(<code>bin/rails generate model Article title:string body:text</code>).</p><p>Na última linha do bloco há uma chamada para <code>t.timestamps</code>. Este método define
duas colunas adicionais chamadas <code>created_at</code> e <code>updated_at</code>. Como veremos
mais pra frente, o Rails gerenciará isso para nós, definindo os valores quando
criamos ou atualizamos um objeto <em>model</em>.</p><p>Vamos executar a nossa <em>migration</em> com o seguinte comando:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>db:migrate
</code></pre>
<textarea class="clipboard-content" id="clipboard-4243c2d007ac02da18d6fe4fbdfd5cd5">bin/rails db:migrate
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-4243c2d007ac02da18d6fe4fbdfd5cd5">Copiar</button>
</div>
<p>O comando exibirá o resultado do processamento indicando que a tabela foi criada:</p><div class="code_container">
<pre><code class="highlight plaintext">==  CreateArticles: migrating ===================================
-- create_table(:articles)
   -&gt; 0.0018s
==  CreateArticles: migrated (0.0018s) ==========================
</code></pre>
<textarea class="clipboard-content" id="clipboard-14c11e8c6d0191d23e13f312166e7850">==  CreateArticles: migrating ===================================
-- create_table(:articles)
   -&gt; 0.0018s
==  CreateArticles: migrated (0.0018s) ==========================
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-14c11e8c6d0191d23e13f312166e7850">Copiar</button>
</div>
<div class="info"><p>Para saber mais sobre <em>migrations</em>, consulte <a href="active_record_migrations.html">Active Record Migrations</a>.</p></div><p>Agora podemos interagir com a tabela utilizando o nosso <em>model</em>.</p><h4 id="utilizando-um-model-para-interagir-com-o-banco-de-dados"><a class="anchorlink" href="#utilizando-um-model-para-interagir-com-o-banco-de-dados">5.3 Utilizando um <em>Model</em> para Interagir com o Banco de Dados</a></h4><p>Para brincar um pouco com o nosso <em>model</em>, vamos utilizar um recurso do Rails
chamado <em>console</em>. O <em>console</em> é um ambiente de codificação interativo como o
<code>irb</code>, mas que também carrega automaticamente o Rails e o código da nossa
aplicação.</p><p>Vamos iniciar o console com o comando:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>console
</code></pre>
<textarea class="clipboard-content" id="clipboard-e5ec6056a58305f825aa46b38262e903">bin/rails console
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-e5ec6056a58305f825aa46b38262e903">Copiar</button>
</div>
<p>Você deve visualizar um <em>prompt</em> <code>irb</code>:</p><div class="code_container">
<pre><code class="highlight irb"><span class="go">Loading development environment (Rails 6.0.2.1)
</span><span class="gp">irb(main):001:0&gt;</span><span class="w">
</span></code></pre>
<textarea class="clipboard-content" id="clipboard-0c05993016ec1a900e848249cf75655f"></textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-0c05993016ec1a900e848249cf75655f">Copiar</button>
</div>
<p>Neste <em>prompt</em>, podemos inicializar um novo objeto <code>Article</code>:</p><div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">title: </span><span class="s2">"Hello Rails"</span><span class="p">,</span> <span class="ss">body: </span><span class="s2">"I am on Rails!"</span><span class="p">)</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-4d8d980cde050c6790d100e83a074c28">article = Article.new(title: "Hello Rails", body: "I am on Rails!")
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-4d8d980cde050c6790d100e83a074c28">Copiar</button>
</div>
<p>É importante notar que apenas <em>inicializamos</em> este objeto. O objeto não é salvo
no banco de dados e no momento está disponível apenas no <em>console</em>. Para salvar o
objeto no banco de dados, devemos chamar
<a href="https://api.rubyonrails.org/v6.1.4/classes/ActiveRecord/Persistence.html#method-i-save"><code>save</code></a>:</p><div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">article</span><span class="p">.</span><span class="nf">save</span>
<span class="go">(0.1ms)  begin transaction
Article Create (0.4ms)  INSERT INTO "articles" ("title", "body", "created_at", "updated_at") VALUES (?, ?, ?, ?)  [["title", "Hello Rails"], ["body", "I am on Rails!"], ["created_at", "2020-01-18 23:47:30.734416"], ["updated_at", "2020-01-18 23:47:30.734416"]]
(0.9ms)  commit transaction
</span><span class="p">=&gt;</span> <span class="kp">true</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-1dbad7402895d9ae6331ada91a8a3e93">article.save
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-1dbad7402895d9ae6331ada91a8a3e93">Copiar</button>
</div>
<p>A saída acima mostra uma <em>query</em> <code>INSERT INTO "articles" ...</code> de banco de dados.
Isso indica que o artigo foi inserido em nossa tabela. Se dermos uma olhada no
objeto <code>article</code> novamente, vemos que algo interessante aconteceu:</p><div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">article</span>
<span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">Article</span> <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">title: </span><span class="s2">"Hello Rails"</span><span class="p">,</span> <span class="ss">body: </span><span class="s2">"I am on Rails!"</span><span class="p">,</span> <span class="ss">created_at: </span><span class="s2">"2020-01-18 23:47:30"</span><span class="p">,</span> <span class="ss">updated_at: </span><span class="s2">"2020-01-18 23:47:30"</span><span class="kt">&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-9e688b06f03955d019522a45b01dbb77">article
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-9e688b06f03955d019522a45b01dbb77">Copiar</button>
</div>
<p>Os atributos <code>id</code>, <code>created_at</code> e <code>updated_at</code> agora estão definidos.
O Rails fez isso por nós quando salvamos o objeto.</p><p>Quando quisermos buscar este artigo no banco de dados, podemos chamar
<a href="https://api.rubyonrails.org/v6.1.4/classes/ActiveRecord/FinderMethods.html#method-i-find"><code>find</code></a>
no <em>model</em> e passar o <code>id</code> como argumento:</p><div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">Article</span> <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">title: </span><span class="s2">"Hello Rails"</span><span class="p">,</span> <span class="ss">body: </span><span class="s2">"I am on Rails!"</span><span class="p">,</span> <span class="ss">created_at: </span><span class="s2">"2020-01-18 23:47:30"</span><span class="p">,</span> <span class="ss">updated_at: </span><span class="s2">"2020-01-18 23:47:30"</span><span class="kt">&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-3a6fafa00a1dda03d3d12607f7d74ff3">Article.find(1)
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-3a6fafa00a1dda03d3d12607f7d74ff3">Copiar</button>
</div>
<p>E quando quisermos obter todos os artigos do banco de dados, podemos chamar <a href="https://api.rubyonrails.org/v6.1.4/classes/ActiveRecord/Scoping/Named/ClassMethods.html#method-i-all"><code>all</code></a>
no <em>model</em>:</p><div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
<span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Relation</span> <span class="p">[</span><span class="kt">#&lt;</span><span class="no">Article</span> <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">title: </span><span class="s2">"Hello Rails"</span><span class="p">,</span> <span class="ss">body: </span><span class="s2">"I am on Rails!"</span><span class="p">,</span> <span class="ss">created_at: </span><span class="s2">"2020-01-18 23:47:30"</span><span class="p">,</span> <span class="ss">updated_at: </span><span class="s2">"2020-01-18 23:47:30"</span><span class="kt">&gt;</span><span class="p">]</span><span class="kt">&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-666a2730f846b98e09f5e97141388d7e">Article.all
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-666a2730f846b98e09f5e97141388d7e">Copiar</button>
</div>
<p>Esté método retorna um objeto <a href="https://api.rubyonrails.org/v6.1.4/classes/ActiveRecord/Relation.html"><code>ActiveRecord::Relation</code></a>, que você pode
considerar como um <em>array</em> superpotente.</p><div class="info"><p>Para saber mais sobre <em>models</em>, consulte o <a href="active_record_basics.html">Básico do Active Record</a> e <a href="active_record_querying.html">Interface de Consulta do Active Record</a>.</p></div><p>Os <em>models</em> são a peça final do quebra-cabeça MVC. A seguir, conectaremos todas
as peças.</p><h4 id="exibindo-uma-lista-de-artigos"><a class="anchorlink" href="#exibindo-uma-lista-de-artigos">5.4 Exibindo uma Lista de Artigos</a></h4><p>Vamos voltar ao nosso <em>controller</em> em <code>app/controllers/articles_controller.rb</code> e
alterar a <em>action</em> <code>index</code> para buscar todos os artigos do banco de dados:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-2adbdfab8401d816ea60dfe2dbede393">class ArticlesController &lt; ApplicationController
  def index
    @articles = Article.all
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2adbdfab8401d816ea60dfe2dbede393">Copiar</button>
</div>
<p>As variáveis de instância do <em>controller</em> podem ser acessadas pela <em>view</em>. Isso
significa que podemos referenciar <code>@articles</code> em
<code>app/views/articles/index.html.erb</code>. Vamos abrir esse arquivo e substituir seu
conteúdo por:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-03ab8b75512e0e8cb9504dc7ff0b3849">&lt;h1&gt;Articles&lt;/h1&gt;

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;li&gt;
      &lt;%= article.title %&gt;
    &lt;/li&gt;
  &lt;% end %&gt;
&lt;/ul&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-03ab8b75512e0e8cb9504dc7ff0b3849">Copiar</button>
</div>
<p>O código acima é uma mistura de HTML e <em>ERB</em>. ERB é um sistema de <em>template</em> que
avalia código Ruby embarcado em um documento. Aqui, podemos ver dois tipos de
<em>tags</em> ERB: <code>&lt;% %&gt;</code> e <code>&lt;%= %&gt;</code>. A <em>tag</em> <code>&lt;% %&gt;</code> significa "avaliar o código Ruby
incluso". A <em>tag</em> <code>&lt;%= %&gt;</code> significa "avaliar o código Ruby incluso e retornar o
valor de saída". Qualquer coisa que possa ser escrita em um programa normal em
Ruby pode ir dentro dessas <em>tags</em> ERB, embora geralmente seja melhor manter o
conteúdo das <em>tags</em> ERB de forma curta para facilitar a leitura.</p><p>Já que não queremos gerar o valor retornado por <code>@articles.each</code>, vamos colocar
esse código em <code>&lt;% %&gt;</code>. Porém, uma vez que <strong>queremos</strong> exibir o valor retornado
em <code>article.title</code> (para cada artigo), incluímos esse códido em <code>&lt;%= %&gt;</code>.</p><p>Nós podemos visualizar o resultado final visitando <a href="http://localhost:3000">http://localhost:3000</a>
(lembre-se de que <code>bin/rails server</code> deve estar em execução!). Aqui estão as
etapas do que acontece quando fazemos isso:</p>
<ol>
<li>O navegador faz uma requisição (<em>request</em>): <code>GET http://localhost:3000</code>.</li>
<li>Nossa aplicação Rails recebe essa requisição.</li>
<li>O roteador do Rails mapeia a rota raiz para a <em>action</em> <code>index</code> de
<code>ArticlesController</code>.</li>
<li>A <em>action</em> <code>index</code>utiliza o <em>model</em> <code>Article</code> para buscar todos os artigos no
banco de dados.</li>
<li>O Rails renderiza automaticamente a <em>view</em>
<code>app/views/articles/index.html.erb</code>.</li>
<li>O código ERB na <em>view</em> é avaliado para gerar código HTML.</li>
<li>O servidor envia uma resposta (<em>response</em>) de volta ao navegador contendo o
HTML.</li>
</ol>
<p>Conectamos todas as peças do MVC e temos nossa primeira <em>action</em> no
<em>controller</em>! A seguir, passaremos para a segunda <em>action</em>.</p><h3 id="operacoes-crud"><a class="anchorlink" href="#operacoes-crud">6 Operações CRUD</a></h3><p>Quase todas as aplicações web abrangem operações <a href="https://pt.wikipedia.org/wiki/CRUD">CRUD (Create, Read, Update e
Delete)</a>, traduzidos como criação, consulta,
atualização e destruição de dados. Você pode até descobrir que a maior parte do
trabalho que a sua aplicação faz é o CRUD. O Rails reconhece isso e fornece
muitos recursos para ajudar a simplificar o código na hora de fazer o CRUD.</p><p>Vamos começar a explorar esses recursos adicionando mais funcionalidades à nossa
aplicação.</p><h4 id="exibindo-um-unico-artigo"><a class="anchorlink" href="#exibindo-um-unico-artigo">6.1 Exibindo um Único Artigo</a></h4><p>Atualmente, temos uma <em>view</em> que lista todos os artigos em nosso banco de dados.
Vamos adicionar uma nova <em>view</em> que exibe o título (<em>title</em>) e o corpo (<em>body</em>)
de um único artigo.</p><p>Começamos adicionando uma nova rota que mapeia para uma nova <em>action</em> do
<em>controller</em> (que adicionaremos a seguir). Abra o arquivo <code>config/routes.rb</code> e
insira a última rota exibida aqui:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s2">"articles#index"</span>

  <span class="n">get</span> <span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#index"</span>
  <span class="n">get</span> <span class="s2">"/articles/:id"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#show"</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-7a950e78a0bc954e1c1cf0dcc2409f55">Rails.application.routes.draw do
  root "articles#index"

  get "/articles", to: "articles#index"
  get "/articles/:id", to: "articles#show"
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-7a950e78a0bc954e1c1cf0dcc2409f55">Copiar</button>
</div>
<p>A nova rota é outra rota do tipo <code>get</code>, mas tem algo extra no seu caminho
(<em>path</em>): <code>:id</code>. Isso denomina um <strong>parâmetro</strong> de rota. Um parâmetro de rota
captura um pedaço do caminho da requisição e coloca esse valor no <em>Hash</em>
<code>params</code>, que pode ser acessado pela <em>action</em> do <em>controller</em>. Por exemplo, ao
lidar com uma requisição como <code>GET http://localhost:3000/articles/1</code>, <code>1</code> seria
capturado como o valor para <code>id</code>, que seria então acessível em <code>params[:id]</code> na
<em>action</em> <code>show</code> de <code>ArticlesController</code>.</p><p>Vamos adicionar a <em>action</em> <code>show</code> agora, abaixo da <em>action</em> <code>index</code> em
<code>app/controllers/articles_controller.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-956881fdc32c2d4eb2be8677407d49c3">class ArticlesController &lt; ApplicationController
  def index
    @articles = Article.all
  end

  def show
    @article = Article.find(params[:id])
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-956881fdc32c2d4eb2be8677407d49c3">Copiar</button>
</div>
<p>A <em>action</em> <code>show</code> chama <code>Article.find</code> (<a href="#utilizando-um-model-para-interagir-com-o-banco-de-dados">mencionado
anteriormente</a>) com o
ID capturado pelo parâmetro de rota. O artigo retornado é armazenado na variável
de instância <code>@article</code>, portanto, pode ser acessado pela <em>view</em>. Por padrão, a
<em>action</em> <code>show</code> vai renderizar <code>app/views/articles/show.html.erb</code>.</p><p>Vamos criar <code>app/views/articles/show.html.erb</code>, com o seguinte conteúdo:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-08b12a48a1e5fad05d5121be7e2c8f7f">&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-08b12a48a1e5fad05d5121be7e2c8f7f">Copiar</button>
</div>
<p>Agora podemos ver o artigo quando visitarmos <a href="http://localhost:3000/articles/1">http://localhost:3000/articles/1</a>!</p><p>Para finalizar, vamos adicionar uma maneira mais prática para chegar à página
de um artigo. Iremos vincular o título de cada artigo em
<code>app/views/articles/index.html.erb</code> para sua página:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/articles/</span><span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">id</span> <span class="cp">%&gt;</span><span class="s">"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-5d6996100b3e2b3143f9fab306902a2b">&lt;h1&gt;Articles&lt;/h1&gt;

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;li&gt;
      &lt;a href="/articles/&lt;%= article.id %&gt;"&gt;
        &lt;%= article.title %&gt;
      &lt;/a&gt;
    &lt;/li&gt;
  &lt;% end %&gt;
&lt;/ul&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-5d6996100b3e2b3143f9fab306902a2b">Copiar</button>
</div>
<h4 id="roteamento-de-resources-recursos"><a class="anchorlink" href="#roteamento-de-resources-recursos">6.2 Roteamento de <em>Resources</em> (recursos)</a></h4><p>Até agora, nós vimos o "R" (<em>Read</em>, consulta) do CRUD. Iremos eventualmente
cobrir o "C" (<em>Create</em>, criação), "U" (<em>Update</em>, atualização) e o "D" (<em>Delete</em>,
destruição). Como você deve ter imaginado, faremos isso adicionando novas rotas,
<em>actions</em> no <em>controller</em> e <em>views</em> que funcionam em conjunto para realizar as
operações CRUD em uma entidade. Chamamos essa entidade de <em>resource</em> (recurso).
Por exemplo, em nossa aplicação, diríamos que um artigo é um recurso.</p><p>O Rails fornece um método de rotas chamado <a href="https://api.rubyonrails.org/v6.1.4/classes/ActionDispatch/Routing/Mapper/Resources.html#method-i-resources"><code>resources</code></a>
que mapeia todas as rotas convencionais para uma coleção de recursos, como
artigos. Portanto, antes de prosseguir para as seções "C", "U" e "D", vamos
substituir as duas rotas <code>get</code> em <code>config/routes.rb</code> por <code>resources</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s2">"articles#index"</span>

  <span class="n">resources</span> <span class="ss">:articles</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-219d7d263cfe9d91adcf06795018a047">Rails.application.routes.draw do
  root "articles#index"

  resources :articles
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-219d7d263cfe9d91adcf06795018a047">Copiar</button>
</div>
<p>Nós podemos inspecionar quais rotas estão mapeadas executando o comando
<code>bin/rails routes</code>:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>routes
<span class="gp">      Prefix Verb   URI Pattern                  Controller#</span>Action
<span class="gp">        root GET    /                            articles#</span>index
<span class="gp">    articles GET    /articles(.:format)          articles#</span>index
<span class="gp"> new_article GET    /articles/new(.:format)      articles#</span>new
<span class="gp">     article GET    /articles/:id(.:format)      articles#</span>show
<span class="gp">             POST   /articles(.:format)          articles#</span>create
<span class="gp">edit_article GET    /articles/:id/edit(.:format) articles#</span>edit
<span class="gp">             PATCH  /articles/:id(.:format)      articles#</span>update
<span class="gp">             DELETE /articles/:id(.:format)      articles#</span>destroy
</code></pre>
<textarea class="clipboard-content" id="clipboard-9f75e1a18a067d6ccee739f6f157bdb3">bin/rails routes
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-9f75e1a18a067d6ccee739f6f157bdb3">Copiar</button>
</div>
<p>O método <code>resources</code> também configura URL e métodos auxiliares (<em>helper</em>) de
caminhos que podemos utilizar para evitar que nosso código dependa de uma
configuração de rota específica. Os valores na coluna "Prefix" acima, mais um
sufixo <code>_url</code> ou <code>_path</code> formam os nomes desses <em>helpers</em>. Por exemplo, o
<em>helper</em> <code>article_path</code> retorna <code>"/articles/#{article.id}"</code> quando recebe um
artigo. Podemos utilizá-lo para organizar nossos links em
<code>app/views/articles/index.html.erb</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">&lt;%=</span> <span class="n">article_path</span><span class="p">(</span><span class="n">article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="s">"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-b79c714de2a7459b8d91ac917ee6afbb">&lt;h1&gt;Articles&lt;/h1&gt;

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;li&gt;
      &lt;a href="&lt;%= article_path(article) %&gt;"&gt;
        &lt;%= article.title %&gt;
      &lt;/a&gt;
    &lt;/li&gt;
  &lt;% end %&gt;
&lt;/ul&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-b79c714de2a7459b8d91ac917ee6afbb">Copiar</button>
</div>
<p>No entanto, daremos um passo adiante utilizando o <em>helper</em> <a href="https://api.rubyonrails.org/v6.1.4/classes/ActionView/Helpers/UrlHelper.html#method-i-link_to"><code>link_to</code></a>.
O <em>helper</em> <code>link_to</code> renderiza um link com seu primeiro argumento como o texto
do link e seu segundo argumento como o destino do link. Se passarmos um objeto
<em>model</em> como segundo argumento, o <code>link_to</code> chamará o <em>helper</em> de caminho
apropriado para converter o objeto em um caminho. Por exemplo, se passarmos um
artigo, o <code>link_to</code> chamará o <code>article_path</code>. Portanto,
<code>app/views/articles/index.html.erb</code> se torna:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span><span class="p">,</span> <span class="n">article</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-5fcfeef904910c38f54fb5ae7a4520e8">&lt;h1&gt;Articles&lt;/h1&gt;

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;li&gt;
      &lt;%= link_to article.title, article %&gt;
    &lt;/li&gt;
  &lt;% end %&gt;
&lt;/ul&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-5fcfeef904910c38f54fb5ae7a4520e8">Copiar</button>
</div>
<p>Muito bom!</p><div class="info"><p>Para aprender mais sobre roteamento, consulte <a href="routing.html">Rotas do Rails de Fora pra Dentro</a>.</p></div><h4 id="criando-um-novo-artigo"><a class="anchorlink" href="#criando-um-novo-artigo">6.3 Criando um Novo Artigo</a></h4><p>Agora, seguimos para o "C" (<em>Create</em>, criação) do CRUD. Normalmente, em
aplicações web, a criação de um novo recurso é um processo de várias etapas.
Primeiro, o usuário solicita um formulário para preencher. Em seguida, o usuário
envia o formulário. Se não houver erros, o recurso será criado e algum tipo de
confirmação será exibido. Caso contrário, o formulário é exibido novamente com
mensagens de erros e o processo é repetido.</p><p>Em uma aplicação Rails, esses passos não convencionalmente tratados pelas
<em>actions</em> <code>new</code> e <code>create</code> do <em>controller</em>. Vamos implementar essas <em>actions</em> em
<code>app/controllers/articles_controller.rb</code>, abaixo da <em>action</em> <code>show</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">title: </span><span class="s2">"..."</span><span class="p">,</span> <span class="ss">body: </span><span class="s2">"..."</span><span class="p">)</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:new</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-7059208df886b8ffbf772d491298e9f5">class ArticlesController &lt; ApplicationController
  def index
    @articles = Article.all
  end

  def show
    @article = Article.find(params[:id])
  end

  def new
    @article = Article.new
  end

  def create
    @article = Article.new(title: "...", body: "...")

    if @article.save
      redirect_to @article
    else
      render :new
    end
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-7059208df886b8ffbf772d491298e9f5">Copiar</button>
</div>
<p>A <em>action</em> <code>new</code> instancia um novo artigo, mas não o salva no banco de dados.
Este artigo será utilizado na <em>view</em> ao construirmos o formulário. Por padrão, a
<em>action</em> <code>new</code> renderizará <code>app/views/articles/new.html.erb</code>, que criaremos a
seguir.</p><p>A <em>action</em> <code>create</code> instancia um novo artigo com os valores para o título e
corpo e tenta salvá-lo no banco de dados. Se o artigo for salvo com sucesso, a
<em>action</em> redireciona o navegador para a página do artigo em
<code>"http://localhost:3000/articles/#{@article.id}"</code>. Caso contrário, a <em>action</em>
exibe novamente o formulário renderizando a <em>view</em>
<code>app/views/articles/new.html.erb</code>. O título e o corpo aqui são valores
fictícios. Depois de criarmos o formulário, vamos voltar no <em>controller</em> e
alterá-los.</p><div class="note"><p><a href="https://api.rubyonrails.org/v6.1.4/classes/ActionController/Redirecting.html#method-i-redirect_to"><code>redirect_to</code></a>
fará com que o navegador faça uma nova requisição, enquanto
<a href="https://api.rubyonrails.org/v6.1.4/classes/AbstractController/Rendering.html#method-i-render"><code>render</code></a>
renderiza a <em>view</em> especificada para a requisição atual.  É importante utilizar
o <code>redirect_to</code> após alterar o banco de dados ou o estado da aplicação. Caso
contrário, se o usuário atualizar a página, o navegador fará a mesma requisição
e a mutação será repetida.</p></div><h5 id="utilizando-um-construtor-de-formulario-form-builder"><a class="anchorlink" href="#utilizando-um-construtor-de-formulario-form-builder">6.3.1 Utilizando um Construtor de Formulário (<em>Form Builder</em>)</a></h5><p>Utilizaremos uma funcionalidade do Rails chamada <em>form builder</em> (construtor de
formulário) para criar nosso formulário. Utilizando um construtor de formulário,
podemos escrever uma quantidade mínima de código para gerar um formulário que
está totalmente configurado e segue as convenções do Rails.</p><p>Vamor criar a <em>view</em> <code>app/views/articles/new.html.erb</code> com o seguinte conteúdo:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>New Article<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@article</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-d4fbe5541b275bc3c88cac2b25fac86a">&lt;h1&gt;New Article&lt;/h1&gt;

&lt;%= form_with model: @article do |form| %&gt;
  &lt;div&gt;
    &lt;%= form.label :title %&gt;&lt;br&gt;
    &lt;%= form.text_field :title %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.submit %&gt;
  &lt;/div&gt;
&lt;% end %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d4fbe5541b275bc3c88cac2b25fac86a">Copiar</button>
</div>
<p>O método auxiliar <a href="https://api.rubyonrails.org/v6.1.4/classes/ActionView/Helpers/FormHelper.html#method-i-form_with"><code>form_with</code></a>
instancia um construtor de formulário. No bloco <code>form_with</code> chamamos métodos como
<a href="https://api.rubyonrails.org/v6.1.4/classes/ActionView/Helpers/FormBuilder.html#method-i-label"><code>label</code></a>
e <a href="https://api.rubyonrails.org/v6.1.4/classes/ActionView/Helpers/FormBuilder.html#method-i-text_field"><code>text_field</code></a>
no construtor para gerar os elementos apropriados de um formulário.</p><p>O resultado de saída da nossa chamada <code>form_with</code> será parecido com:</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/articles"</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"authenticity_token"</span> <span class="na">value=</span><span class="s">"..."</span><span class="nt">&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"article_title"</span><span class="nt">&gt;</span>Title<span class="nt">&lt;/label&gt;&lt;br&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"article[title]"</span> <span class="na">id=</span><span class="s">"article_title"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"article_body"</span><span class="nt">&gt;</span>Body<span class="nt">&lt;/label&gt;&lt;br&gt;</span>
    <span class="nt">&lt;textarea</span> <span class="na">name=</span><span class="s">"article[body]"</span> <span class="na">id=</span><span class="s">"article_body"</span><span class="nt">&gt;&lt;/textarea&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">name=</span><span class="s">"commit"</span> <span class="na">value=</span><span class="s">"Create Article"</span> <span class="na">data-disable-with=</span><span class="s">"Create Article"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-052b36f52a96d3c7cb26ef401fad3288">&lt;form action="/articles" accept-charset="UTF-8" method="post"&gt;
  &lt;input type="hidden" name="authenticity_token" value="..."&gt;

  &lt;div&gt;
    &lt;label for="article_title"&gt;Title&lt;/label&gt;&lt;br&gt;
    &lt;input type="text" name="article[title]" id="article_title"&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;label for="article_body"&gt;Body&lt;/label&gt;&lt;br&gt;
    &lt;textarea name="article[body]" id="article_body"&gt;&lt;/textarea&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;input type="submit" name="commit" value="Create Article" data-disable-with="Create Article"&gt;
  &lt;/div&gt;
&lt;/form&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-052b36f52a96d3c7cb26ef401fad3288">Copiar</button>
</div>
<div class="info"><p>Para saber mais sobre os construtores de formulários, consulte <a href="form_helpers.html">Action View Form Helpers</a>.</p></div><h5 id="utilizando-strong-parameters-parametros-fortes"><a class="anchorlink" href="#utilizando-strong-parameters-parametros-fortes">6.3.2 Utilizando <em>Strong Parameters</em> (Parâmetros Fortes)</a></h5><p>Os dados do formulário enviados são colocados no <em>Hash</em> <code>params</code>, junto com os
parâmetros de rota capturados. Assim, a <em>action</em> <code>create</code> pode acessar o título
enviado via <code>params[:article][:title]</code> e o corpo enviado via
<code>params[:article][:body]</code>. Poderíamos passar esses valores individualmente para
<code>Article.new</code>, mas isso seria longo demais e possivelmente sujeito a erros. E
ficaria pior a medida que adicionamos mais campos.</p><p>Em vez disso, passaremos um único <em>Hash</em> que contém os valores. No entanto,
ainda devemos especificar quais valores são permitidos nesse <em>Hash</em>, caso
contrário, um usuário mal intencionado pode enviar campos extras no formulário e
sobrescrever dados privados. Na verdade, se passarmos o <em>Hash</em>
<code>params[:article]</code> não filtrado diretamente para <code>Article.new</code>, o Rails lançará
um <code>ForbiddenAttributesError</code> para nos alertar sobre o problema. Portanto,
utilizaremos um recurso do Rails chamado <em>Strong Parameters</em> (Parâmetros Fortes)
para filtrar <code>params</code>. Pense nisso como <a href="https://pt.wikipedia.org/wiki/Linguagem_tipada">tipagem
forte</a> para <code>params</code>.</p><p>Vamos adicionar um método privado na parte inferior de
<code>app/controllers/articles_controller.rb</code> chamado <code>article_params</code> que filtra o
<code>params</code>. E vamos alterar o método <code>create</code> para utilizá-lo:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:new</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">article_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:article</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:body</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-156f42ee5e549b28ca16d98d702fe726">class ArticlesController &lt; ApplicationController
  def index
    @articles = Article.all
  end

  def show
    @article = Article.find(params[:id])
  end

  def new
    @article = Article.new
  end

  def create
    @article = Article.new(article_params)

    if @article.save
      redirect_to @article
    else
      render :new
    end
  end

  private
    def article_params
      params.require(:article).permit(:title, :body)
    end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-156f42ee5e549b28ca16d98d702fe726">Copiar</button>
</div>
<div class="info"><p>Para saber mais sobre <em>Strong Parameters</em>, consulte <a href="action_controller_overview.html#parametros-fortes">Action Controller
Overview § Parâmetros Fortes</a>.</p></div><h5 id="validacoes-e-exibicao-de-mensagens-de-erros"><a class="anchorlink" href="#validacoes-e-exibicao-de-mensagens-de-erros">6.3.3 Validações e Exibição de Mensagens de Erros</a></h5><p>Como vimos, a criação de um recurso é um processo de várias etapas. Lidar com a
entrada inválida do usuário é outra etapa desse processo. O Rails fornece um
recurso chamado <strong>validações</strong> para nos ajudar a lidar com entradas inválidas do
usuário. As validações são regras que são verificadas antes de um objeto <em>model</em>
ser salvo. Se alguma das validações falhar, o objeto não será salvo e as
mensagens de erros apropriadas serão adicionadas ao atributo <code>errors</code> do objeto
<em>model</em>.</p><p>Vamos adicionar algumas validações ao nosso <em>model</em> em <code>app/models/article.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">10</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-493d919949eacdf77b4a88d76cf302e0">class Article &lt; ApplicationRecord
  validates :title, presence: true
  validates :body, presence: true, length: { minimum: 10 }
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-493d919949eacdf77b4a88d76cf302e0">Copiar</button>
</div>
<p>A primeira validação declara que um valor <code>title</code> deve estar presente. Como
<code>title</code> é uma <em>string</em>, isso significa que o valor <code>title</code> deve conter pelo
menos um caractere diferente de espaço em branco.</p><p>A segunda validação declara que um valor <code>body</code> também deve estar presente. Além
disso, declara que o valor <code>body</code> deve ter pelo menos 10 caracteres.</p><div class="note"><p>Você pode estar se perguntando onde os atributos <code>title</code> e <code>body</code> são
definidos. O <em>Active Record</em> define automaticamente os atributos do <em>model</em> para
cada coluna da tabela, então você não precisa declarar esses atributos em seu
arquivo <em>model</em>.</p></div><p>Com nossas validações no lugar, vamos modificar
<code>app/views/articles/new.html.erb</code> para exibir quaisquer mensagens de erro para
<code>title</code> e <code>body</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>New Article<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@article</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages_for</span><span class="p">(</span><span class="ss">:title</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">message</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;div&gt;</span><span class="cp">&lt;%=</span> <span class="n">message</span> <span class="cp">%&gt;</span><span class="nt">&lt;/div&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages_for</span><span class="p">(</span><span class="ss">:body</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">message</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;div&gt;</span><span class="cp">&lt;%=</span> <span class="n">message</span> <span class="cp">%&gt;</span><span class="nt">&lt;/div&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-227c27b8a7102cc5e932974e3905c05f">&lt;h1&gt;New Article&lt;/h1&gt;

&lt;%= form_with model: @article do |form| %&gt;
  &lt;div&gt;
    &lt;%= form.label :title %&gt;&lt;br&gt;
    &lt;%= form.text_field :title %&gt;
    &lt;% @article.errors.full_messages_for(:title).each do |message| %&gt;
      &lt;div&gt;&lt;%= message %&gt;&lt;/div&gt;
    &lt;% end %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;&lt;br&gt;
    &lt;% @article.errors.full_messages_for(:body).each do |message| %&gt;
      &lt;div&gt;&lt;%= message %&gt;&lt;/div&gt;
    &lt;% end %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.submit %&gt;
  &lt;/div&gt;
&lt;% end %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-227c27b8a7102cc5e932974e3905c05f">Copiar</button>
</div>
<p>O método <a href="https://api.rubyonrails.org/v6.1.4/classes/ActiveModel/Errors.html#method-i-full_messages_for"><code>full_messages_for</code></a>
retorna um <em>array</em> de mensagens de erro amigáveis para um atributo especificado.
Se não houver erros para esse atributo, o <em>array</em> ficará vazio.</p><p>Para entender como tudo isso funciona junto, vamos dar uma olhada nas <em>actions</em>
de <code>new</code> e <code>create</code> do <em>controller</em>:</p><div class="code_container">
<pre><code class="highlight ruby">  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:new</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-83b8622eebd14b8c233a14cc11d13f72">  def new
    @article = Article.new
  end

  def create
    @article = Article.new(article_params)

    if @article.save
      redirect_to @article
    else
      render :new
    end
  end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-83b8622eebd14b8c233a14cc11d13f72">Copiar</button>
</div>
<p>Quando visitamos <a href="http://localhost:3000/articles/new">http://localhost:3000/articles/new</a>, a solicitação <code>GET
/articles/new</code> é mapeada para a <em>action</em> <code>new</code>. A <em>action</em> <code>new</code> não tenta
salvar o <code>@article</code>. Portanto, as validações não são verificadas e não haverá
mensagens de erro.</p><p>Quando enviamos o formulário, a solicitação <code>POST /articles</code> é mapeada para a
<em>action</em> <code>create</code>. A <em>action</em> <code>create</code> <strong>tenta</strong> salvar o <code>@article</code>.
Portanto, as validações <strong>são</strong> verificadas. Se alguma validação falhar,
o <code>@article</code> não será salvo e a <em>view</em> <code>app/views/articles/new.html.erb</code> será
renderizada com as mensagens de erro.</p><div class="info"><p>Para saber mais sobre validações, consulte <a href="active_record_validations.html">Validações do Active Record</a>. Para saber mais sobre as mensagens de erro de
validação, consulte <a href="active_record_validations.html#trabalhando-com-erros-de-validacao">Validações do Active Record § Trabalhando com Erros de
Validação</a>.</p></div><h5 id="criando-um-novo-artigo-finalizando"><a class="anchorlink" href="#criando-um-novo-artigo-finalizando">6.3.4 Finalizando</a></h5><p>Agora podemos criar um artigo visitando <a href="http://localhost:3000/articles/new">http://localhost:3000/articles/new</a>.
Para finalizar, vamos criar um <em>link</em> para essa página na parte inferior da
<em>view</em> <code>app/views/articles/index.html.erb</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span><span class="p">,</span> <span class="n">article</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"New Article"</span><span class="p">,</span> <span class="n">new_article_path</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-64a14ae2ff2a135c219dc987c77465c6">&lt;h1&gt;Articles&lt;/h1&gt;

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;li&gt;
      &lt;%= link_to article.title, article %&gt;
    &lt;/li&gt;
  &lt;% end %&gt;
&lt;/ul&gt;

&lt;%= link_to "New Article", new_article_path %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-64a14ae2ff2a135c219dc987c77465c6">Copiar</button>
</div>
<h4 id="atualizando-um-artigo"><a class="anchorlink" href="#atualizando-um-artigo">6.4 Atualizando um Artigo</a></h4><p>Nós cobrimos o "CR" do CRUD. Agora, vamos passar para o "U" (<em>Update</em>, 
atualização). Atualizar um recurso é muito semelhante a criar um recurso. Ambos
são processos de várias etapas. Primeiro, o usuário solicita um formulário para
editar os dados. Se não houver erros, o recurso será atualizado. Caso contrário,
o formulário é exibido novamente com mensagens de erro e o processo é repetido.</p><p>Essas etapas são convencionalmente tratadas pelas <em>actions</em> <code>edit</code> e <code>update</code> de
um <em>controller</em>. Vamos adicionar uma implementação típica dessas <em>actions</em> em
<code>app/controllers/articles_controller.rb</code>, abaixo da <em>action</em> <code>create</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:new</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:edit</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">article_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:article</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:body</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-4b9fc3435ae67d905c996ead1e7b3b60">class ArticlesController &lt; ApplicationController
  def index
    @articles = Article.all
  end

  def show
    @article = Article.find(params[:id])
  end

  def new
    @article = Article.new
  end

  def create
    @article = Article.new(article_params)

    if @article.save
      redirect_to @article
    else
      render :new
    end
  end

  def edit
    @article = Article.find(params[:id])
  end

  def update
    @article = Article.find(params[:id])

    if @article.update(article_params)
      redirect_to @article
    else
      render :edit
    end
  end

  private
    def article_params
      params.require(:article).permit(:title, :body)
    end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-4b9fc3435ae67d905c996ead1e7b3b60">Copiar</button>
</div>
<p>Observe como as <em>actions</em> <code>edit</code> e <code>update</code> se assemelham às <em>actions</em> <code>new</code> e
<code>create</code>.</p><p>A <em>action</em> <code>edit</code> busca o artigo do banco de dados e o armazena em <code>@article</code>
para que possa ser utilizado ao construir o formulário. Por padrão, a <em>action</em>
<code>edit</code> renderizará <code>app/views/articles/edit.html.erb</code>.</p><p>A <em>action</em> <code>update</code> busca novamente o artigo do banco de dados e tenta
atualizá-lo com os dados filtrados do formulário enviado por <code>article_params</code>.
Se nenhuma validação falhar e a atualização for bem-sucedida, a <em>action</em>
redireciona o navegador para a página do artigo. Caso contrário, a <em>action</em>
exibe novamente o formulário com mensagens de erro, renderizando
<code>app/views/articles/edit.html.erb</code>.</p><h5 id="utilizando-partials-para-compartilhar-codigo-de-view"><a class="anchorlink" href="#utilizando-partials-para-compartilhar-codigo-de-view">6.4.1 Utilizando <em>Partials</em> para Compartilhar Código de <em>View</em></a></h5><p>Nosso formulário <code>edit</code> terá a mesma aparência que o nosso formulário <code>new</code>. Até
o código será o mesmo, graças ao construtor de formulários do Rails e ao
roteamento de recursos. O construtor de formulários configura automaticamente o
formulário para fazer o tipo apropriado de requisição, baseando-se sobre se o
objeto do <em>model</em> foi salvo anteriormente.</p><p>Como o código será o mesmo, vamos separá-lo em uma <em>view</em> compartilhada chamada
<strong>partial</strong>. Vamos criar a <em>view</em> <code>app/views/articles/_form.html.erb</code> com o
seguinte conteúdo:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="n">article</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="n">article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages_for</span><span class="p">(</span><span class="ss">:title</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">message</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;div&gt;</span><span class="cp">&lt;%=</span> <span class="n">message</span> <span class="cp">%&gt;</span><span class="nt">&lt;/div&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%</span> <span class="n">article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages_for</span><span class="p">(</span><span class="ss">:body</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">message</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;div&gt;</span><span class="cp">&lt;%=</span> <span class="n">message</span> <span class="cp">%&gt;</span><span class="nt">&lt;/div&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-576a964edd2528c0b7f363410f232ef3">&lt;%= form_with model: article do |form| %&gt;
  &lt;div&gt;
    &lt;%= form.label :title %&gt;&lt;br&gt;
    &lt;%= form.text_field :title %&gt;
    &lt;% article.errors.full_messages_for(:title).each do |message| %&gt;
      &lt;div&gt;&lt;%= message %&gt;&lt;/div&gt;
    &lt;% end %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;&lt;br&gt;
    &lt;% article.errors.full_messages_for(:body).each do |message| %&gt;
      &lt;div&gt;&lt;%= message %&gt;&lt;/div&gt;
    &lt;% end %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.submit %&gt;
  &lt;/div&gt;
&lt;% end %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-576a964edd2528c0b7f363410f232ef3">Copiar</button>
</div>
<p>O código acima é igual ao nosso formulário em <code>app/views/articles/new.html.erb</code>,
exceto que todas as ocorrências de <code>@article</code> foram substituídas por <code>article</code>.
Como <em>partials</em> são códigos compartilhados, a melhor prática é que elas não
dependam de variáveis de instância específicas definidas por uma <em>action</em> do
<em>controller</em>. Em vez disso, passaremos o artigo para a <em>partial</em> como uma
variável local.</p><p>Vamos atualizar <code>app/views/articles/new.html.erb</code> para utilizar a <em>partial</em> via <a href="https://api.rubyonrails.org/v6.1.4/classes/ActionView/Helpers/RenderingHelper.html#method-i-render"><code>render</code></a>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>New Article<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s2">"form"</span><span class="p">,</span> <span class="ss">article: </span><span class="vi">@article</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-5fdf3e148458eb1e2305de9e9f36587e">&lt;h1&gt;New Article&lt;/h1&gt;

&lt;%= render "form", article: @article %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-5fdf3e148458eb1e2305de9e9f36587e">Copiar</button>
</div>
<div class="note"><p>O nome do arquivo da <em>partial</em> deve ser prefixado <strong>com</strong> um sublinhado,
por exemplo, <code>_form.html.erb</code>. Mas ao renderizar, ela é referenciada <strong>sem</strong> o
sublinhado, por exemplo, <code>render form</code>.</p></div><p>E agora vamos criar uma <em>view</em> <code>app/views/articles/edit.html.erb</code> muito
semelhante:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Edit Article<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s2">"form"</span><span class="p">,</span> <span class="ss">article: </span><span class="vi">@article</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-233684868e13bbbef90e127fd404b6a1">&lt;h1&gt;Edit Article&lt;/h1&gt;

&lt;%= render "form", article: @article %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-233684868e13bbbef90e127fd404b6a1">Copiar</button>
</div>
<div class="info"><p>Para saber mais sobre <em>partials</em>, consulte <a href="layouts_and_rendering.html#usando-partials">Layouts e Renderização no Rails § Usando
Partials</a>.</p></div><h5 id="atualizando-um-artigo-finalizando"><a class="anchorlink" href="#atualizando-um-artigo-finalizando">6.4.2 Finalizando</a></h5><p>Agora podemos atualizar um artigo visitando sua página de edição, por exemplo,
<a href="http://localhost:3000/articles/1/edit">http://localhost:3000/articles/1/edit</a>. Para finalizar, vamos criar um <em>link</em>
para a página de edição na parte inferior de <code>app/views/articles/show.html.erb</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Edit"</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-c0a0072a5ef636442aa1f1aaa7c663da">&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;%= link_to "Edit", edit_article_path(@article) %&gt;&lt;/li&gt;
&lt;/ul&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-c0a0072a5ef636442aa1f1aaa7c663da">Copiar</button>
</div>
<h4 id="deletando-um-artigo"><a class="anchorlink" href="#deletando-um-artigo">6.5 Deletando um Artigo</a></h4><p>Finalmente chegamos do "D" (<em>Delete</em> , destruição) do CRUD. Deletar um recurso é
um processo mais simples do que criar ou atualizar. Requer apenas uma rota e uma
<em>action</em> do <em>controller</em>. E nosso roteamento de recursos (<code>resources :articles</code>)
já fornece a rota que mapeia as requisições <code>DELETE /articles/:id</code> para a
<em>action</em> <code>destroy</code> de <code>ArticlesController</code>.</p><p>Então, vamos adicionar uma típica <em>action</em> <code>destroy</code> em
<code>app/controllers/articles_controller.rb</code>, abaixo da <em>action</em> <code>update</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:new</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:edit</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
    <span class="vi">@article</span><span class="p">.</span><span class="nf">destroy</span>

    <span class="n">redirect_to</span> <span class="n">root_path</span>
  <span class="k">end</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">article_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:article</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:body</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-d9f7a8024554c3c2bcfb423652bdf4e5">class ArticlesController &lt; ApplicationController
  def index
    @articles = Article.all
  end

  def show
    @article = Article.find(params[:id])
  end

  def new
    @article = Article.new
  end

  def create
    @article = Article.new(article_params)

    if @article.save
      redirect_to @article
    else
      render :new
    end
  end

  def edit
    @article = Article.find(params[:id])
  end

  def update
    @article = Article.find(params[:id])

    if @article.update(article_params)
      redirect_to @article
    else
      render :edit
    end
  end

  def destroy
    @article = Article.find(params[:id])
    @article.destroy

    redirect_to root_path
  end

  private
    def article_params
      params.require(:article).permit(:title, :body)
    end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d9f7a8024554c3c2bcfb423652bdf4e5">Copiar</button>
</div>
<p>A <em>action</em> <code>destroy</code> busca o artigo do banco de dados e chama o método <a href="https://api.rubyonrails.org/v6.1.4/classes/ActiveRecord/Persistence.html#method-i-destroy"><code>destroy</code></a>
do artigo. Em seguida, redireciona o navegador para o caminho raiz (<em>root
path</em>).</p><p>Nós optamos por redirecionar para o caminho raiz porque esse é o nosso principal
ponto de acesso para os artigos. Mas, em outras circunstâncias, você pode optar
por redirecionar para, por exemplo, <code>articles_path</code></p><p>Agora vamos adicionar um <em>link</em> na parte inferior de
<code>app/views/articles/show.html.erb</code> para que possamos deletar um artigo de sua
própria página:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Edit"</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Destroy"</span><span class="p">,</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">),</span>
                  <span class="ss">method: :delete</span><span class="p">,</span>
                  <span class="ss">data: </span><span class="p">{</span> <span class="ss">confirm: </span><span class="s2">"Are you sure?"</span> <span class="p">}</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-9853b1c61a110f131d7059600747878d">&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;%= link_to "Edit", edit_article_path(@article) %&gt;&lt;/li&gt;
  &lt;li&gt;&lt;%= link_to "Destroy", article_path(@article),
                  method: :delete,
                  data: { confirm: "Are you sure?" } %&gt;&lt;/li&gt;
&lt;/ul&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-9853b1c61a110f131d7059600747878d">Copiar</button>
</div>
<p>Nó código acima, estamos passando algumas opções adicionais para o <code>link_to</code>. A
opção <code>method: :delete</code> faz com que o <em>link</em> faça uma requisição <code>DELETE</code> em vez
de uma requisição <code>GET</code>. A opção <code>data: { confirm: "Are you sure?" }</code> faz com
que uma caixa de diálogo de confirmação apareça quando o <em>link</em> é clicado. Se o
usuário cancelar a caixa de diálogo, a requisição será abortada. Ambas as opções
são alimentadas por um recurso do Rails chamado <em>JavaScript Discreto</em> (UJS). O
arquivo JavaScript que implementa esses comportamentos é incluído por padrão em
novas aplicações Rails.</p><div class="info"><p>Para saber mais sobre Javascript Discreto (<em>unobtrusive</em>), consulte
<a href="working_with_javascript_in_rails.html">Trabalhando com JavaScript no Rails</a>.</p></div><p>E é isso! Agora podemos listar, exibir, criar, atualizar e deletar artigos!
Incrível!</p><h3 id="adicionando-um-segundo-model"><a class="anchorlink" href="#adicionando-um-segundo-model">7 Adicionando um Segundo Model</a></h3><p>É hora de adicionar um segundo <em>model</em> à aplicação. O segundo <em>model</em> vai lidar com
comentários em artigos.</p><h4 id="adicionando-um-segundo-model-gerando-um-model"><a class="anchorlink" href="#adicionando-um-segundo-model-gerando-um-model">7.1 Gerando um Model</a></h4><p>Nós veremos o mesmo <em>generator</em> que usamos antes quando criamos o <em>model</em>
<code>Article</code> (artigo, inglês). Desta vez vamos criar um <em>model</em> <code>Comment</code> (comentário)
que contém a referência para um artigo. Rode esse comando no seu terminal:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate model Comment commenter:string body:text article:references
</code></pre>
<textarea class="clipboard-content" id="clipboard-4d0c9238fdeb1f7047ec7f7cb7f804b6">bin/rails generate model Comment commenter:string body:text article:references
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-4d0c9238fdeb1f7047ec7f7cb7f804b6">Copiar</button>
</div>
<p>Este comando vai gerar quatro arquivos:</p>
<table>
<thead>
<tr>
<th>Arquivo</th>
<th>Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<td>db/migrate/20140120201010_create_comments.rb</td>
<td>
<em>Migration</em> para criar a tabela de comentários no seu banco de dados (o nome incluirá um <em>timestamp</em> diferente)</td>
</tr>
<tr>
<td>app/models/comment.rb</td>
<td>O <em>model</em> Comment</td>
</tr>
<tr>
<td>test/models/comment_test.rb</td>
<td>Aparelhagem de testes para o <em>model</em> de comentário</td>
</tr>
<tr>
<td>test/fixtures/comments.yml</td>
<td>Exemplo de comentários para uso em testes</td>
</tr>
</tbody>
</table>
<p>Primeiro, veja o arquivo <code>app/models/comment.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Comment</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">belongs_to</span> <span class="ss">:article</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-bc934897fc2f55b15f55ddf76ff84b0f">class Comment &lt; ApplicationRecord
  belongs_to :article
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-bc934897fc2f55b15f55ddf76ff84b0f">Copiar</button>
</div>
<p>Isso é muito semelhante ao <em>model</em> <code>Article</code> que vimos antes. A diferença está na
linha <code>belongs_to : article</code>, o que configura uma associação no <em>Active Record</em>.
Você vai aprender um pouco sobre associações na próxima seção deste guia.</p><p>A palavra-chave (<code>:references</code>) usada no comando <code>bash</code> é um tipo especial de
dado para <em>models</em>. Ela cria uma nova coluna na tabela do banco de dados com o
nome fornecido ao <em>model</em> anexada a um <code>_id</code> que contém um valor do tipo
<em>integer</em>. Para compreender melhor, analise o arquivo <code>db/schema.rb</code> depois de
rodar a <em>migration</em>.</p><p>Além do <em>model</em>, o Rails também gerou a <em>migration</em> para criar a tabela
correspondente no banco de dados:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">CreateComments</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">6.0</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:comments</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:commenter</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">text</span> <span class="ss">:body</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">references</span> <span class="ss">:article</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">foreign_key: </span><span class="kp">true</span>

      <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-3138bda6c16971eed218e659d04716f1">class CreateComments &lt; ActiveRecord::Migration[6.0]
  def change
    create_table :comments do |t|
      t.string :commenter
      t.text :body
      t.references :article, null: false, foreign_key: true

      t.timestamps
    end
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-3138bda6c16971eed218e659d04716f1">Copiar</button>
</div>
<p>A linha <code>t.references</code> cria uma coluna com valores do tipo <em>integer</em> chamada
<code>article_id</code>, um índice para ela e uma restrição de chave estrangeira (<em>foreign key</em>)
que aponta para a coluna <code>id</code> da tabela <code>articles</code>. Vá em frente e rode a
<em>migration</em>:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>db:migrate
</code></pre>
<textarea class="clipboard-content" id="clipboard-27d0f9fbc26343d6c86c6461d0fd5cbb">bin/rails db:migrate
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-27d0f9fbc26343d6c86c6461d0fd5cbb">Copiar</button>
</div>
<p>O Rails é inteligente o suficiente para executar somente as migrações que ainda
não foram rodadas no banco de dados atual, assim neste caso você verá:</p><div class="code_container">
<pre><code class="highlight plaintext">==  CreateComments: migrating =================================================
-- create_table(:comments)
   -&gt; 0.0115s
==  CreateComments: migrated (0.0119s) ========================================
</code></pre>
<textarea class="clipboard-content" id="clipboard-7fa6c1b83c461106aeba234c14e85b53">==  CreateComments: migrating =================================================
-- create_table(:comments)
   -&gt; 0.0115s
==  CreateComments: migrated (0.0119s) ========================================
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-7fa6c1b83c461106aeba234c14e85b53">Copiar</button>
</div>
<h4 id="associando-models"><a class="anchorlink" href="#associando-models">7.2 Associando Models</a></h4><p>Associações do <em>Active Record</em> permitem declarar facilmente a relação entre dois
<em>models</em>. No caso de comentários e artigos, você poderia descrever a relação
da seguinte maneira:</p>
<ul>
<li>Cada comentário pertece a um artigo.</li>
<li>Um artigo pode possuir muitos comentários.</li>
</ul>
<p>De fato, essa sintaxe é muito similar à utilizada pelo Rails para declarar essa
associação. Você já viu a linha de código dentro do <em>model</em> <code>Comment</code>
(<code>app/models/comment.rb</code>) que faz com que cada comentário pertença a um Artigo:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Comment</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">belongs_to</span> <span class="ss">:article</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-bf3449d01654892c91fb7d158b5b15b6">class Comment &lt; ApplicationRecord
  belongs_to :article
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-bf3449d01654892c91fb7d158b5b15b6">Copiar</button>
</div>
<p>Você vai precisar editar o arquivo <code>app/models/article.rb</code> para adicionar o outro lado da
associação:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:comments</span>

  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">10</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-28382eacc8450c4ab92adee490d50b33">class Article &lt; ApplicationRecord
  has_many :comments

  validates :title, presence: true
  validates :body, presence: true, length: { minimum: 10 }
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-28382eacc8450c4ab92adee490d50b33">Copiar</button>
</div>
<p>Estas duas declarações habilitam uma boa parte de comportamento automático. Por
exemplo, se você possui uma instância da variável <code>@article</code> que contém um
artigo, você pode recuperar todos os comentários pertencentes àquele artigo na
forma de um <em>array</em> usando <code>@article.comments</code>.</p><div class="info"><p>Para mais informações sobre associações do <em>Active Record</em>, veja o guia
<a href="association_basics.html">Associações no Active Record</a>.</p></div><h4 id="adicionando-a-rota-para-comentarios"><a class="anchorlink" href="#adicionando-a-rota-para-comentarios">7.3 Adicionando a Rota para Comentários</a></h4><p>Da mesma forma que o <em>controller</em> <code>articles</code>, nós vamos precisar adicionar a
rota para que o Rails saiba para onde queremos navegar para encontrar
<code>comments</code>. Abra o arquivo <code>config/routes.rb</code> novamente e o edite da seguinte
maneira:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s2">"articles#index"</span>

  <span class="n">resources</span> <span class="ss">:articles</span> <span class="k">do</span>
    <span class="n">resources</span> <span class="ss">:comments</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-29983c9938f2818b09ce266a24d21aec">Rails.application.routes.draw do
  root "articles#index"

  resources :articles do
    resources :comments
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-29983c9938f2818b09ce266a24d21aec">Copiar</button>
</div>
<p>Isso cria <code>comments</code> como um recurso aninhado (<em>nested resource</em>) dentro de <code>article</code>. Essa é
outra parte do processo para recuperar as relações hierárquicas que existem  entre
artigos e comentários.</p><div class="info"><p>Para mais informações sobre rotas, veja o guia <a href="routing.html">Roteamento no Rails</a></p></div><h4 id="gerando-um-controller"><a class="anchorlink" href="#gerando-um-controller">7.4 Gerando um Controller</a></h4><p>Com o <em>model</em> em mãos, você pode voltar sua atenção para a criação do
<em>controller</em> correspondente. Mais uma vez, você vai usar o <em>generator</em> usado
anteriormente:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate controller Comments
</code></pre>
<textarea class="clipboard-content" id="clipboard-eb0aa788204fd7e663cc9716fc9ffe56">bin/rails generate controller Comments
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-eb0aa788204fd7e663cc9716fc9ffe56">Copiar</button>
</div>
<p>Isso cria quatro arquivos e um diretório vazio:</p>
<table>
<thead>
<tr>
<th>Arquivo/Diretório</th>
<th>Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<td>app/controllers/comments_controller.rb</td>
<td>O <em>controller</em> de comentários</td>
</tr>
<tr>
<td>app/views/comments/</td>
<td>
<em>Views</em> do <em>controller</em> são armazenadas aqui</td>
</tr>
<tr>
<td>test/controllers/comments_controller_test.rb</td>
<td>O teste para o <em>controller</em>
</td>
</tr>
<tr>
<td>app/helpers/comments_helper.rb</td>
<td>Arquivo de <em>helpers</em> da <em>view</em>
</td>
</tr>
<tr>
<td>app/assets/stylesheets/comments.scss</td>
<td>
<em>Cascading style sheet</em> (CSS) para o <em>controller</em>
</td>
</tr>
</tbody>
</table>
<p>Como em qualquer blog, nossos leitores vão criar seus comentários diretamente
depois de lerem o artigo e, uma vez que adicionarem o comentário, serão enviados
de volta para a página <em>show</em> do artigo para verem o comentário agora listado.
Por essa razão, nosso <code>CommentsController</code> está aqui para fornecer um método que
cria comentários e deleta comentários <em>spam</em> quando chegarem.</p><p>Então, primeiro nós vamos ligar o <em>show template</em> para Artigos (<code>app/views/articles/show.html.erb</code>)
para que possamos criar um novo comentários:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Edit"</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Destroy"</span><span class="p">,</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">),</span>
                  <span class="ss">method: :delete</span><span class="p">,</span>
                  <span class="ss">data: </span><span class="p">{</span> <span class="ss">confirm: </span><span class="s2">"Are you sure?"</span> <span class="p">}</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="nt">&lt;h2&gt;</span>Add a comment:<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="p">[</span> <span class="vi">@article</span><span class="p">,</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">build</span> <span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-4c3bcefe8db710fd47c3895df36d4063">&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;%= link_to "Edit", edit_article_path(@article) %&gt;&lt;/li&gt;
  &lt;li&gt;&lt;%= link_to "Destroy", article_path(@article),
                  method: :delete,
                  data: { confirm: "Are you sure?" } %&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Add a comment:&lt;/h2&gt;
&lt;%= form_with model: [ @article, @article.comments.build ] do |form| %&gt;
  &lt;p&gt;
    &lt;%= form.label :commenter %&gt;&lt;br&gt;
    &lt;%= form.text_field :commenter %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.submit %&gt;
  &lt;/p&gt;
&lt;% end %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-4c3bcefe8db710fd47c3895df36d4063">Copiar</button>
</div>
<p>Isso adiciona na página <em>show</em> do <code>Article</code> um formulário que cria um novo
comentário chamando a <em>action</em> <code>create</code> no <code>CommentsController</code>. O <code>form_with</code>
aqui usa um <em>array</em> que vai construir uma rota aninhada, como <code>/articles/1/comments</code>.</p><p>Vamos ligar a <em>action</em> <code>create</code> em <code>app/controllers/comments_controller.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:article_id</span><span class="p">])</span>
    <span class="vi">@comment</span> <span class="o">=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">comment_params</span><span class="p">)</span>
    <span class="n">redirect_to</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">comment_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:comment</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:commenter</span><span class="p">,</span> <span class="ss">:body</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-5a9af6d99e43fceca401f4838a34a66b">class CommentsController &lt; ApplicationController
  def create
    @article = Article.find(params[:article_id])
    @comment = @article.comments.create(comment_params)
    redirect_to article_path(@article)
  end

  private
    def comment_params
      params.require(:comment).permit(:commenter, :body)
    end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-5a9af6d99e43fceca401f4838a34a66b">Copiar</button>
</div>
<p>Você verá um pouco mais de complexidade aqui do que no <em>controller</em> para
artigos. Esse é o efeito colateral do aninhamento que você configurou. Cada
requisição para um comentário deve lembrar o artigo ao qual o comentário está
anexado, para que a chamada inicial do método <code>find</code> do <em>model</em> <code>Article</code>
encontre o artigo em questão.</p><p>Além disso, o código aproveita-se de alguns métodos disponíveis para uma
associação. Nós usamos o método <code>create</code> em <code>@article.comments</code> para criar e
salvar um comentário. Isso vai automaticamente conectar o comentário para que
ele pertença àquele artigo em particular.</p><p>Uma vez que temos um novo comentário, nós enviamos o usuário de volta ao artigo
original usando o helper <code>article_path(@article)</code>. Como já vimos
anteriormente, isso chama a <em>action</em> <code>show</code> do <code>ArticlesController</code> que por sua
vez renderiza o <em>template</em> <code>show.html.erb</code>. É aqui que queremos que o comentário
apareça, então vamos adicionar isso ao arquivo <code>app/views/articles/show.html.erb</code>.</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Edit"</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Destroy"</span><span class="p">,</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">),</span>
                  <span class="ss">method: :delete</span><span class="p">,</span>
                  <span class="ss">data: </span><span class="p">{</span> <span class="ss">confirm: </span><span class="s2">"Are you sure?"</span> <span class="p">}</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="nt">&lt;h2&gt;</span>Comments<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">comment</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;strong&gt;</span>Commenter:<span class="nt">&lt;/strong&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">commenter</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;strong&gt;</span>Comment:<span class="nt">&lt;/strong&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;h2&gt;</span>Add a comment:<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="p">[</span> <span class="vi">@article</span><span class="p">,</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">build</span> <span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-ed7bba823c9ff8a5500f3f75af2d42e6">&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;%= link_to "Edit", edit_article_path(@article) %&gt;&lt;/li&gt;
  &lt;li&gt;&lt;%= link_to "Destroy", article_path(@article),
                  method: :delete,
                  data: { confirm: "Are you sure?" } %&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Comments&lt;/h2&gt;
&lt;% @article.comments.each do |comment| %&gt;
  &lt;p&gt;
    &lt;strong&gt;Commenter:&lt;/strong&gt;
    &lt;%= comment.commenter %&gt;
  &lt;/p&gt;

  &lt;p&gt;
    &lt;strong&gt;Comment:&lt;/strong&gt;
    &lt;%= comment.body %&gt;
  &lt;/p&gt;
&lt;% end %&gt;

&lt;h2&gt;Add a comment:&lt;/h2&gt;
&lt;%= form_with model: [ @article, @article.comments.build ] do |form| %&gt;
  &lt;p&gt;
    &lt;%= form.label :commenter %&gt;&lt;br&gt;
    &lt;%= form.text_field :commenter %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.submit %&gt;
  &lt;/p&gt;
&lt;% end %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-ed7bba823c9ff8a5500f3f75af2d42e6">Copiar</button>
</div>
<p>Agora podemos adicionar artigos e comentários ao seu blog e mostrá-los nos
lugares certos.</p><p><img src="images/getting_started/article_with_comments.png" alt="Article with Comments"></p><h3 id="refatorando"><a class="anchorlink" href="#refatorando">8 Refatorando</a></h3><p>Agora que nossos artigos e comentários funcionam, dê uma olhada no template
<code>app/views/articles/show.html.erb</code>. Ele está ficando longo e esquisito. Nós
podemos usar <em>partials</em> (<em>views</em> parciais) para melhorá-lo.</p><h4 id="renderizando-colecoes-de-partials"><a class="anchorlink" href="#renderizando-colecoes-de-partials">8.1 Renderizando Coleções de <em>Partials</em></a></h4><p>Primeiramente, nós vamos criar uma <em>partial</em> para extrair a exibição de todos os
comentários para o artigo. Crie o arquivo <code>app/views/comments/_comment.html.erb</code>
e insira o código a seguir:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Commenter:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">commenter</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Comment:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-0eb14392d4d221238eb8c4785b91d042">&lt;p&gt;
  &lt;strong&gt;Commenter:&lt;/strong&gt;
  &lt;%= comment.commenter %&gt;
&lt;/p&gt;

&lt;p&gt;
  &lt;strong&gt;Comment:&lt;/strong&gt;
  &lt;%= comment.body %&gt;
&lt;/p&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-0eb14392d4d221238eb8c4785b91d042">Copiar</button>
</div>
<p>Então você pode mudar <code>app/views/articles/show.html.erb</code> para o seguinte código:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Edit"</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Destroy"</span><span class="p">,</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">),</span>
                  <span class="ss">method: :delete</span><span class="p">,</span>
                  <span class="ss">data: </span><span class="p">{</span> <span class="ss">confirm: </span><span class="s2">"Are you sure?"</span> <span class="p">}</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="nt">&lt;h2&gt;</span>Comments<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;h2&gt;</span>Add a comment:<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="p">[</span> <span class="vi">@article</span><span class="p">,</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">build</span> <span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-6475eb424f72d149500e75ec219240b7">&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;%= link_to "Edit", edit_article_path(@article) %&gt;&lt;/li&gt;
  &lt;li&gt;&lt;%= link_to "Destroy", article_path(@article),
                  method: :delete,
                  data: { confirm: "Are you sure?" } %&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Comments&lt;/h2&gt;
&lt;%= render @article.comments %&gt;

&lt;h2&gt;Add a comment:&lt;/h2&gt;
&lt;%= form_with model: [ @article, @article.comments.build ] do |form| %&gt;
  &lt;p&gt;
    &lt;%= form.label :commenter %&gt;&lt;br&gt;
    &lt;%= form.text_field :commenter %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.submit %&gt;
  &lt;/p&gt;
&lt;% end %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-6475eb424f72d149500e75ec219240b7">Copiar</button>
</div>
<p>Isso fará com que a <em>partial</em> seja renderizada em <code>app/views/comments/_comment.html.erb</code>
uma vez para cada comentário na coleção <code>@article.comments</code>. Como o método
<code>render</code> itera sobre a coleção <code>@article.comments</code>, ele designa cada comentário
para uma variável local nomeada como a <em>partial</em>, nesse caso <code>comment</code>, que então
fica disponível para ser exibida na <em>partial</em>.</p><h4 id="renderizando-um-formulario-com-partial"><a class="anchorlink" href="#renderizando-um-formulario-com-partial">8.2 Renderizando um Formulário com <em>Partial</em></a></h4><p>Agora vamos mover aquela nova seção de comentários para sua própria <em>partial</em>.
Novamente, crie o arquivo <code>app/viewscomments/_form.html.erb</code> contendo:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="p">[</span> <span class="vi">@article</span><span class="p">,</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">build</span> <span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-59a4bb184d4878f4531ee3c0fb349b89">&lt;%= form_with model: [ @article, @article.comments.build ] do |form| %&gt;
  &lt;p&gt;
    &lt;%= form.label :commenter %&gt;&lt;br&gt;
    &lt;%= form.text_field :commenter %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.submit %&gt;
  &lt;/p&gt;
&lt;% end %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-59a4bb184d4878f4531ee3c0fb349b89">Copiar</button>
</div>
<p>Então deixe o arquivo <code>app/views/articles/show.html.erb</code> assim:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Edit"</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Destroy"</span><span class="p">,</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">),</span>
                  <span class="ss">method: :delete</span><span class="p">,</span>
                  <span class="ss">data: </span><span class="p">{</span> <span class="ss">confirm: </span><span class="s2">"Are you sure?"</span> <span class="p">}</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="nt">&lt;h2&gt;</span>Comments<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;h2&gt;</span>Add a comment:<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'comments/form'</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-d6cae0e7218ba9c67c9898846f9245e4">&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;%= link_to "Edit", edit_article_path(@article) %&gt;&lt;/li&gt;
  &lt;li&gt;&lt;%= link_to "Destroy", article_path(@article),
                  method: :delete,
                  data: { confirm: "Are you sure?" } %&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Comments&lt;/h2&gt;
&lt;%= render @article.comments %&gt;

&lt;h2&gt;Add a comment:&lt;/h2&gt;
&lt;%= render 'comments/form' %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d6cae0e7218ba9c67c9898846f9245e4">Copiar</button>
</div>
<p>O segundo <em>render</em> apenas define o template de <em>partial</em> que queremos renderizar,
<code>comments/form</code>. O Rails é inteligente o suficiente para entender a barra nessa
string e perceber que você quer renderizar o arquivo <code>_form.html.erb</code> no
diretório <code>app/views/comments</code>.</p><p>O objeto <code>@article</code> está disponível para todas as <em>partials</em> renderizadas na view
porque o definimos como uma variável de instância.</p><h4 id="usando-concerns"><a class="anchorlink" href="#usando-concerns">8.3 Usando <em>Concerns</em></a></h4><p><em>Concerns</em> são uma forma de tornar grandes <em>controllers</em> ou <em>models</em> mais fáceis de entender e gerenciar. Isso também tem a vantagem de ser reutilizável quando vários <em>models</em> (ou <em>controllers</em>) compartilham as mesmas preocupações. As <em>concerns</em> são implementadas usando módulos (<code>module</code>) que contêm métodos que representam uma fatia bem definida da funcionalidade pela qual um <em>model</em> ou <em>controller</em> é responsável. Em outras linguagens, os módulos costumam ser conhecidos como <em>mixins</em>.</p><p>Você pode usar as <em>concerns</em> em seu <em>controller</em> ou <em>model</em> da mesma forma que usaria qualquer módulo. Quando você criou sua aplicação pela primeira vez com <code>rails new blog</code>, duas pastas foram criadas dentro de <code>app/</code> junto com o resto:</p><div class="code_container">
<pre><code class="highlight plaintext">app/controllers/concerns
app/models/concerns
</code></pre>
<textarea class="clipboard-content" id="clipboard-8a28aec9a432847dcfad68e8e8764971">app/controllers/concerns
app/models/concerns
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8a28aec9a432847dcfad68e8e8764971">Copiar</button>
</div>
<p> Um determinado artigo do blog pode ter vários status - por exemplo, pode ser visível para todos (ou seja, <code>public</code>), ou visível apenas para o autor (ou seja, <code>private</code>). Também pode estar oculto para todos, mas ainda pode ser recuperado (ou seja, <code>archived</code>). Os comentários também podem estar ocultos ou visíveis. Isso pode ser representado usando uma coluna <code>status</code> em cada um dos <em>models</em>.</p><p>Dentro do <em>model</em> <code>article</code>, após executar uma <em>migration</em> para adicionar uma coluna <code>status</code>, você pode adicionar:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:comments</span>

  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">10</span> <span class="p">}</span>

  <span class="no">VALID_STATUSES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'public'</span><span class="p">,</span> <span class="s1">'private'</span><span class="p">,</span> <span class="s1">'archived'</span><span class="p">]</span>

  <span class="n">validates</span> <span class="ss">:status</span><span class="p">,</span> <span class="ss">inclusion: </span><span class="p">{</span> <span class="ss">in: </span><span class="no">VALID_STATUSES</span> <span class="p">}</span>

  <span class="k">def</span> <span class="nf">archived?</span>
    <span class="n">status</span> <span class="o">==</span> <span class="s1">'archived'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-28d47d756373447570f2020f8689cd5c">class Article &lt; ApplicationRecord
  has_many :comments

  validates :title, presence: true
  validates :body, presence: true, length: { minimum: 10 }

  VALID_STATUSES = ['public', 'private', 'archived']

  validates :status, inclusion: { in: VALID_STATUSES }

  def archived?
    status == 'archived'
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-28d47d756373447570f2020f8689cd5c">Copiar</button>
</div>
<p>e no <em>model</em> <code>Comment</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Comment</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">belongs_to</span> <span class="ss">:article</span>

  <span class="no">VALID_STATUSES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'public'</span><span class="p">,</span> <span class="s1">'private'</span><span class="p">,</span> <span class="s1">'archived'</span><span class="p">]</span>

  <span class="n">validates</span> <span class="ss">:status</span><span class="p">,</span> <span class="ss">inclusion: </span><span class="p">{</span> <span class="ss">in: </span><span class="no">VALID_STATUSES</span> <span class="p">}</span>

  <span class="k">def</span> <span class="nf">archived?</span>
    <span class="n">status</span> <span class="o">==</span> <span class="s1">'archived'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-c292eca2959c74a0148b69e0e90d303b">class Comment &lt; ApplicationRecord
  belongs_to :article

  VALID_STATUSES = ['public', 'private', 'archived']

  validates :status, inclusion: { in: VALID_STATUSES }

  def archived?
    status == 'archived'
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-c292eca2959c74a0148b69e0e90d303b">Copiar</button>
</div>
<p>Então, em nossa <em>action</em> <code>index</code> (<code>app/views/articles/index.html.erb</code>), usaríamos o método <code>archived?</code> Para evitar a exibição de qualquer artigo que está arquivado:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">unless</span> <span class="n">article</span><span class="p">.</span><span class="nf">archived?</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span><span class="p">,</span> <span class="n">article</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/li&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"New Article"</span><span class="p">,</span> <span class="n">new_article_path</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-8d7f118e7ef47376b8f9adec22ea5d44">&lt;h1&gt;Articles&lt;/h1&gt;

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;% unless article.archived? %&gt;
      &lt;li&gt;
        &lt;%= link_to article.title, article %&gt;
      &lt;/li&gt;
    &lt;% end %&gt;
  &lt;% end %&gt;
&lt;/ul&gt;

&lt;%= link_to "New Article", new_article_path %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8d7f118e7ef47376b8f9adec22ea5d44">Copiar</button>
</div>
<p>No entanto, se você olhar novamente para nossos <em>models</em> agora, pode ver que a lógica está duplicada. Se, no futuro, aumentarmos a funcionalidade do nosso blog - para incluir mensagens privadas, por exemplo - podemos ver a duplicação de lógica mais uma vez. É aqui que as <em>concerns</em> são úteis.</p><p>Uma <em>concerns</em> é responsável apenas por um subconjunto específico da responsabilidade do <em>model</em>; os métodos na nossa <em>concern</em> estarão todos relacionados à visibilidade de um <em>model</em>. Vamos chamar nossa nova <em>concern</em> (módulo) de <code>Visible</code>. Podemos criar um novo arquivo dentro de <code>app/models/concerns</code> chamado<code>visible.rb</code>, e armazenar todos os métodos de status que foram duplicados nos <em>models</em>.</p><p><code>app/models/concerns/visible.rb</code></p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">Visible</span>
  <span class="k">def</span> <span class="nf">archived?</span>
    <span class="n">status</span> <span class="o">==</span> <span class="s1">'archived'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-b97b8d046420cfd23447284fd7231681">module Visible
  def archived?
    status == 'archived'
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-b97b8d046420cfd23447284fd7231681">Copiar</button>
</div>
<p>Podemos adicionar nossa validação de status à <em>concern</em>, mas isso é um pouco mais complexo, pois as validações são métodos chamados no nível da classe. O <code>ActiveSupport::Concern</code> (<a href="https://api.rubyonrails.org/v6.1.4/classes/ActiveSupport/Concern.html">API Guide</a>) nos dá uma maneira mais simples de incluí-los:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">Visible</span>
  <span class="kp">extend</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Concern</span>

  <span class="no">VALID_STATUSES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'public'</span><span class="p">,</span> <span class="s1">'private'</span><span class="p">,</span> <span class="s1">'archived'</span><span class="p">]</span>

  <span class="n">included</span> <span class="k">do</span>
    <span class="n">validates</span> <span class="ss">:status</span><span class="p">,</span> <span class="ss">inclusion: </span><span class="p">{</span> <span class="ss">in: </span><span class="no">VALID_STATUSES</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">archived?</span>
    <span class="n">status</span> <span class="o">==</span> <span class="s1">'archived'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-d81e7f6743dd7ec24939963f9824b102">module Visible
  extend ActiveSupport::Concern

  VALID_STATUSES = ['public', 'private', 'archived']

  included do
    validates :status, inclusion: { in: VALID_STATUSES }
  end

  def archived?
    status == 'archived'
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d81e7f6743dd7ec24939963f9824b102">Copiar</button>
</div>
<p>Agora, podemos remover a lógica duplicada de cada <em>model</em> e, em vez disso, incluir nosso novo módulo <code>Visible</code>:</p><p>Em <code>app/models/article.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="kp">include</span> <span class="no">Visible</span>
  <span class="n">has_many</span> <span class="ss">:comments</span>

  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">10</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-43a0797b4353c9a37dcfdaafb32d230e">class Article &lt; ApplicationRecord
  include Visible
  has_many :comments

  validates :title, presence: true
  validates :body, presence: true, length: { minimum: 10 }
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-43a0797b4353c9a37dcfdaafb32d230e">Copiar</button>
</div>
<p>e em <code>app/models/comment.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Comment</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="kp">include</span> <span class="no">Visible</span>
  <span class="n">belongs_to</span> <span class="ss">:article</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-b7af7c061fb3b45d226c2f178f4ee090">class Comment &lt; ApplicationRecord
  include Visible
  belongs_to :article
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-b7af7c061fb3b45d226c2f178f4ee090">Copiar</button>
</div>
<p>Os métodos de classe também podem ser adicionados às <em>concerns</em>. Se quisermos que uma contagem de artigos públicos ou comentários sejam exibidos em nossa página principal, podemos adicionar um método de classe a <code>Visible</code> da seguinte maneira:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">Visible</span>
  <span class="kp">extend</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Concern</span>

  <span class="no">VALID_STATUSES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'public'</span><span class="p">,</span> <span class="s1">'private'</span><span class="p">,</span> <span class="s1">'archived'</span><span class="p">]</span>

  <span class="n">included</span> <span class="k">do</span>
    <span class="n">validates</span> <span class="ss">:status</span><span class="p">,</span> <span class="ss">inclusion: </span><span class="p">{</span> <span class="ss">in: </span><span class="no">VALID_STATUSES</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">class_methods</span> <span class="k">do</span>
    <span class="k">def</span> <span class="nf">public_count</span>
      <span class="n">where</span><span class="p">(</span><span class="ss">status: </span><span class="s1">'public'</span><span class="p">).</span><span class="nf">count</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">archived?</span>
    <span class="n">status</span> <span class="o">==</span> <span class="s1">'archived'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-59ca2dc549c5d3a814aa5adfc30677df">module Visible
  extend ActiveSupport::Concern

  VALID_STATUSES = ['public', 'private', 'archived']

  included do
    validates :status, inclusion: { in: VALID_STATUSES }
  end

  class_methods do
    def public_count
      where(status: 'public').count
    end
  end

  def archived?
    status == 'archived'
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-59ca2dc549c5d3a814aa5adfc30677df">Copiar</button>
</div>
<p>Então, na <em>view</em>, você pode chamá-lo como qualquer método de classe:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

Our blog has <span class="cp">&lt;%=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">public_count</span> <span class="cp">%&gt;</span> articles and counting!

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span><span class="p">,</span> <span class="n">article</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"New Article"</span><span class="p">,</span> <span class="n">new_article_path</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-70a3d95cc169a513fde1b8a55ceaefac">&lt;h1&gt;Articles&lt;/h1&gt;

Our blog has &lt;%= Article.public_count %&gt; articles and counting!

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;li&gt;
      &lt;%= link_to article.title, article %&gt;
    &lt;/li&gt;
  &lt;% end %&gt;
&lt;/ul&gt;

&lt;%= link_to "New Article", new_article_path %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-70a3d95cc169a513fde1b8a55ceaefac">Copiar</button>
</div>
<p>Existem mais algumas etapas a serem realizadas antes que nossa aplicaçãi funcione com a adição da coluna <code>status</code>. Primeiro, vamos executar as seguintes <em>migrations</em> para adicionar <code>status</code> aos <code>Articles</code> e <code>Comments</code>:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate migration AddStatusToArticles status:string
<span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate migration AddStatusToComments status:string
</code></pre>
<textarea class="clipboard-content" id="clipboard-d3d944347ff85cd7ef9080f68fdc1d58">bin/rails generate migration AddStatusToArticles status:string
bin/rails generate migration AddStatusToComments status:string
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d3d944347ff85cd7ef9080f68fdc1d58">Copiar</button>
</div>
<div class="info"><p>Para aprender mais sobre <em>migrations</em>, veja em <a href="active_record_migrations.html">Active Record Migrations</a>.</p></div><p>Também temos que permitir a chave <code>:status</code> como parte do parâmetro (usando <em>strong parameters</em>), em <code>app/controllers/articles_controller.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="kp">private</span>
    <span class="k">def</span> <span class="nf">article_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:article</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">:status</span><span class="p">)</span>
    <span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-031f4a269fab08068659ea9f166f2ea9">private
    def article_params
      params.require(:article).permit(:title, :body, :status)
    end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-031f4a269fab08068659ea9f166f2ea9">Copiar</button>
</div>
<p>e em <code>app/controllers/comments_controller.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="kp">private</span>
    <span class="k">def</span> <span class="nf">comment_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:comment</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:commenter</span><span class="p">,</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">:status</span><span class="p">)</span>
    <span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-724c27c161b58f3794d29706e93b6072">private
    def comment_params
      params.require(:comment).permit(:commenter, :body, :status)
    end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-724c27c161b58f3794d29706e93b6072">Copiar</button>
</div>
<p>Para finalizar, adicionaremos uma caixa de seleção aos formulários e permitiremos que o usuário selecione o status ao criar um novo artigo ou postar um novo comentário. Também podemos especificar o status padrão como <code>public</code>. Em <code>app/views/articles/_form.html.erb</code>, podemos adicionar:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;div&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:status</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">select</span> <span class="ss">:status</span><span class="p">,</span> <span class="p">[</span><span class="s1">'public'</span><span class="p">,</span> <span class="s1">'private'</span><span class="p">,</span> <span class="s1">'archived'</span><span class="p">],</span> <span class="ss">selected: </span><span class="s1">'public'</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-bc3748de2834fac3bfc7bb3a6410dc19">&lt;div&gt;
  &lt;%= form.label :status %&gt;&lt;br&gt;
  &lt;%= form.select :status, ['public', 'private', 'archived'], selected: 'public' %&gt;
&lt;/div&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-bc3748de2834fac3bfc7bb3a6410dc19">Copiar</button>
</div>
<p>e em <code>app/views/comments/_form.html.erb</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;p&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:status</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">select</span> <span class="ss">:status</span><span class="p">,</span> <span class="p">[</span><span class="s1">'public'</span><span class="p">,</span> <span class="s1">'private'</span><span class="p">,</span> <span class="s1">'archived'</span><span class="p">],</span> <span class="ss">selected: </span><span class="s1">'public'</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-8251f3e22b815204e3322439f2b733a2">&lt;p&gt;
  &lt;%= form.label :status %&gt;&lt;br&gt;
  &lt;%= form.select :status, ['public', 'private', 'archived'], selected: 'public' %&gt;
&lt;/p&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8251f3e22b815204e3322439f2b733a2">Copiar</button>
</div>
<h3 id="deletando-comentarios"><a class="anchorlink" href="#deletando-comentarios">9 Deletando Comentários</a></h3><p>Outra importante <em>feature</em> de um blog é excluir comentários de spam. Para fazer
isto, nós precisamos implementar um link de alguma <em>view</em> e uma <em>action</em>
<code>destroy</code> no <code>CommentsController</code>.</p><p>Primeiro, vamos adicionar o link <em>delete</em> na <em>partial</em>
<code>app/views/comments/_comment.html.erb</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Autor do comentário:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">commenter</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Comentário:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Destruir comentário'</span><span class="p">,</span> <span class="p">[</span><span class="n">comment</span><span class="p">.</span><span class="nf">article</span><span class="p">,</span> <span class="n">comment</span><span class="p">],</span>
              <span class="ss">method: :delete</span><span class="p">,</span>
              <span class="ss">data: </span><span class="p">{</span> <span class="ss">confirm: </span><span class="s2">"Are you sure?"</span> <span class="p">}</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-6f91622c43ee3c0e6f36065ac2bcf08b">&lt;p&gt;
  &lt;strong&gt;Autor do comentário:&lt;/strong&gt;
  &lt;%= comment.commenter %&gt;
&lt;/p&gt;

&lt;p&gt;
  &lt;strong&gt;Comentário:&lt;/strong&gt;
  &lt;%= comment.body %&gt;
&lt;/p&gt;

&lt;p&gt;
  &lt;%= link_to 'Destruir comentário', [comment.article, comment],
              method: :delete,
              data: { confirm: "Are you sure?" } %&gt;
&lt;/p&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-6f91622c43ee3c0e6f36065ac2bcf08b">Copiar</button>
</div>
<p>Clicar neste novo link "Destruir comentário" será disparado um <code>DELETE
/articles/:article_id/comments/:id</code> ao nosso <code>CommentsController</code>, que
pode ser usar isso para encontrar o comentário que queremos excluir, então vamos adicionar
uma ação <code>destroy</code> ao nosso <em>controller</em> (<code>app/controllers/comments_controller.rb</code>):</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:article_id</span><span class="p">])</span>
    <span class="vi">@comment</span> <span class="o">=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">comment_params</span><span class="p">)</span>
    <span class="n">redirect_to</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:article_id</span><span class="p">])</span>
    <span class="vi">@comment</span> <span class="o">=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
    <span class="vi">@comment</span><span class="p">.</span><span class="nf">destroy</span>
    <span class="n">redirect_to</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">comment_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:comment</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:commenter</span><span class="p">,</span> <span class="ss">:body</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-6cf199f55501a7eb227f56f3de312bc7">class CommentsController &lt; ApplicationController
  def create
    @article = Article.find(params[:article_id])
    @comment = @article.comments.create(comment_params)
    redirect_to article_path(@article)
  end

  def destroy
    @article = Article.find(params[:article_id])
    @comment = @article.comments.find(params[:id])
    @comment.destroy
    redirect_to article_path(@article)
  end

  private
    def comment_params
      params.require(:comment).permit(:commenter, :body)
    end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-6cf199f55501a7eb227f56f3de312bc7">Copiar</button>
</div>
<p>A <em>action</em> <code>destroy</code> vai encontrar o artigo que estamos vendo, localizar o
comentário na <em>collection</em> <code>@article.comments</code>, removê-lo do seu banco de
dados e nos enviar de volta para a <em>action</em> <code>show</code> do artigo.</p><h4 id="excluindo-objetos-associados"><a class="anchorlink" href="#excluindo-objetos-associados">9.1 Excluindo objetos associados</a></h4><p>Se você excluir um artigo, os comentários (comments) associados também precisarão ser
excluídos, caso contrário, eles simplesmente ocupariam espaço no banco de dados.
O Rails permite que você use a opção <code>dependent</code> de uma associação para conseguir isso.
Modifique o Modelo de artigo (article), <code>app/models/article.rb</code>, da seguinte forma:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="kp">include</span> <span class="no">Visible</span>

  <span class="n">has_many</span> <span class="ss">:comments</span><span class="p">,</span> <span class="ss">dependent: :destroy</span>

  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">10</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-d99ef227f2173566921d511ac74e5252">class Article &lt; ApplicationRecord
  include Visible

  has_many :comments, dependent: :destroy

  validates :title, presence: true
  validates :body, presence: true, length: { minimum: 10 }
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d99ef227f2173566921d511ac74e5252">Copiar</button>
</div>
<h3 id="seguranca"><a class="anchorlink" href="#seguranca">10 Segurança</a></h3><h4 id="autenticacao-basica"><a class="anchorlink" href="#autenticacao-basica">10.1 Autenticação Básica</a></h4><p>Se fosse fosse publicar o seu blog online, qualquer um poderia adicionar, editar
e deletar seus artigos ou comentários.</p><p>O Rails disponibiliza um sistema de autenticação HTTP que funcionará
tranquilamente nesta situação.</p><p>No <code>ArticlesController</code> nós precisamos que tenha um meio de bloquear o acesso à
várias ações se uma pessoa não estiver autenticada. Aqui podemos usar o método
<code>http_basic_authenticate_with</code>, que permite o acesso para a ação requisitada se
o método deixar.</p><p>Para usar o sistema de autenticação, nós especificamos no topo do nosso
<code>ArticlesController</code> em <code>app/controllers/articles_controller.rb</code>. No nosso caso,
nós queremos que o usuário esteja autenticado em todas as ações, exceto <code>index</code>
e <code>show</code>, então nós colocamos isso:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="n">http_basic_authenticate_with</span> <span class="ss">name: </span><span class="s2">"dhh"</span><span class="p">,</span> <span class="ss">password: </span><span class="s2">"secret"</span><span class="p">,</span> <span class="ss">except: </span><span class="p">[</span><span class="ss">:index</span><span class="p">,</span> <span class="ss">:show</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="c1"># snippet for brevity</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-05f05b0fced5f52c04811ded66a89a41">class ArticlesController &lt; ApplicationController

  http_basic_authenticate_with name: "dhh", password: "secret", except: [:index, :show]

  def index
    @articles = Article.all
  end

  # snippet for brevity
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-05f05b0fced5f52c04811ded66a89a41">Copiar</button>
</div>
<p>Nós também queremos autorizar somente usuários autenticados a deletar
comentários, então em <code>CommentsController</code>
(<code>app/controllers/comments_controller.rb</code>) nós colocamos:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="n">http_basic_authenticate_with</span> <span class="ss">name: </span><span class="s2">"dhh"</span><span class="p">,</span> <span class="ss">password: </span><span class="s2">"secret"</span><span class="p">,</span> <span class="ss">only: :destroy</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:article_id</span><span class="p">])</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>

  <span class="c1"># snippet for brevity</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-2cadfefe2d81eabc2d3cc92375e3bcb1">class CommentsController &lt; ApplicationController

  http_basic_authenticate_with name: "dhh", password: "secret", only: :destroy

  def create
    @article = Article.find(params[:article_id])
    # ...
  end

  # snippet for brevity
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2cadfefe2d81eabc2d3cc92375e3bcb1">Copiar</button>
</div>
<p>Agora se você tentar criar um novo artigo, você deverá preencher um formulário de autenticação:</p><p><img src="images/getting_started/challenge.png" alt="Formulário de Autenticação"></p><p>Outros métodos de autenticação estão disponíveis para aplicações Rails. Dois
<em>add-ons</em> de autenticação populares para Rails são o
<a href="https://github.com/plataformatec/devise">Devise</a> e o
<a href="https://github.com/binarylogic/authlogic">Authlogic</a> entre outros.</p><h4 id="outras-consideracoes-de-seguranca"><a class="anchorlink" href="#outras-consideracoes-de-seguranca">10.2 Outras Considerações de Segurança</a></h4><p>Segurança, especialmente em aplicações web, é uma area ampla e detalhada. O
tópico de segurança aplicações Rails é coberto com mais detalhes em
<a href="security.html">Guia de Segurança Ruby on Rails</a>.</p><h3 id="o-que-vem-depois-questionmark"><a class="anchorlink" href="#o-que-vem-depois-questionmark">11 O que vem depois?</a></h3><p>Agora que você criou sua primeira aplicação Rails, sinta-se à vontade para
atualizar e experimentar por conta própria.</p><p>Lembre-se, você não precisa fazer tudo sem ajuda. Se você precisa de
assistência para começar a desenvolver com Rails, sinta-se à vontade para
consultar estes recursos:</p>
<ul>
<li>O <a href="index.html">Guia Rails</a>
</li>
<li>O <a href="https://guides.rubyonrails.org">Ruby on Rails Guides</a>
</li>
<li>A <a href="https://discuss.rubyonrails.org/c/rubyonrails-talk">lista de discussão do Ruby on Rails</a>
</li>
<li>O canal <a href="irc://irc.freenode.net/#rubyonrails">#rubyonrails</a> no irc.freenode.net</li>
</ul>
<h3 id="dicas-de-configuracao"><a class="anchorlink" href="#dicas-de-configuracao">12 Dicas de Configuração</a></h3><p>O caminho mais fácil para se trabalhar com o Rails é armazenar todos os dados
externos como UTF-8. Se não fizer assim, as bibliotecas Ruby e o Rails vão, na
maioria das vezes, conseguir converter seus dados nativos em UTF-8, porém não
é sempre que isso funciona corretamente, então é melhor que você assegure que
todos seus dados externos estão em UTF-8.</p><p>Caso tenha cometido um erro nessa parte, o sintoma mais comum é o aparecimento
de um diamante preto com um ponto de interrogação dentro no seu navegador. Outro
sintoma comum é o aparecimento de caracteres como "Ã¼" ao invés de "ü". O Rails
executa um número de passos internos para mitigar causas comuns desses problemas
que possam ser detectadas e corrigidas automaticamente. Porém, caso você possua
dados externos que não estão armazenados como UTF-8, eles poderão ocasionalmente
resultar em problemas que não podem ser detectados e nem resolvidos de forma
automática pelo Rails.</p><p>Duas fontes muito comuns de dados que não estão em UTF-8 são:</p>
<ul>
<li>Seu editor de texto: A maioria dos editores de texto (como o TextMate), salvam
os arquivos em UTF-8 de forma padrão. Caso o seu editor de texto não salve,
isso pode resultar em caracteres especiais inseridos por você nos seus
<em>templates</em> (como por exemplo: é) aparecerem no navegador como um diamante
com um ponto de interrogação dentro. Isso também se aplica aos seus arquivos
de tradução i18n. Muitos editores que não salvam em UTF-8 por padrão (como
algumas versões do Dreamweaver) oferecem uma forma de alterar o padrão para
UTF-8. Faça isso.</li>
<li>Seu banco de dados: o Rails converte seus dados do banco de dados em UTF-8
de forma padrão. Porém, se seu banco de dados não está utilizando UTF-8
internamente, pode ser que não consiga armazenar todos os caracteres que seus
usuários insiram. Por exemplo, se seu banco de dados está utilizando Latin-1
internamente, e seu usuário inserir um caractere russo, hebraico ou japonês,
os dados serão perdidos para sempre assim que entrarem no banco de dados. Se
possível, utilize UTF-8 como padrão de armazenamento para o seu banco de dados.</li>
</ul>


        <h3>Feedback</h3>
        <p>
          Você é incentivado a ajudar a melhorar a qualidade deste guia.
        </p>
        <p>
          Por favor, contribua se vir qualquer erros, inclusive erros de digitação.
          Para começar, você pode ler nossa sessão de <a href="https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">contribuindo com a documentação</a>.
        </p>
        <p>
          Você também pode encontrar conteúdo incompleto ou coisas que não estão atualizadas.
          Por favor, adicione qualquer documentação em falta na main do Rails. Certifique-se de checar o
          <a href="http://edgeguides.rubyonrails.org">Edge Guides (en-US)</a> primeiro para verificar
          se o problema já foi resolvido ou não no branch main.
          Verifique as <a href="ruby_on_rails_guides_guidelines.html">Diretrizes do Guia Ruby on Rails</a>
          para estilo e convenções.
        </p>
        <p>
          Se, por qualquer motivo, você encontrar algo para consertar, mas não conseguir consertá-lo, por favor
          <a href="https://github.com/campuscode/rails-guides-pt-BR/issues">abra uma issue no nosso Guia</a>.
        </p>
        <p>
          E por último, mas não menos importante, qualquer tipo de discussão sobre a documentação do Ruby on Rails
          é muito bem vinda na <a href="https://discuss.rubyonrails.org/c/rubyonrails-docs">lista de discussão rubyonrails-docs</a> e nas
          <a href="https://github.com/campuscode/rails-guides-pt-BR/issues">issues do Guia em português</a>.
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p> Este projeto está licenciado sob uma licença <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International</a></p>
<p>"Rails", "Ruby on Rails", e o logotipo Rails são marcas comerciais de David Heinemeier Hansson. Todos os direitos reservados.</p>

    </div>
  </div>
  <div id="toggle">
    <img alt="dark theme icon" class="icon">
  </div>
</body>
</html>

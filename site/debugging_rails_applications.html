<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Debug de Aplicações Rails — Ruby on Rails Guides</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
  <link rel="stylesheet" type="text/css" href="stylesheets/highlight.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/search.css" data-turbolinks-track="reload">
  <link href="images/favicon.ico" rel="icon" type="image/x-icon" />
  <script src="javascripts/turbolinks.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/clipboard.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/guides.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/search.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/lunr-documents.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/lunr.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/toggle-theme.js" data-turbolinks-track="reload"></script>
  <meta property="og:title" content="Debug de Aplicações Rails — Ruby on Rails Guides" />
  <meta name="description" content="Debug de Aplicações RailsEsse guia introduz técnicas de debug para aplicações de Ruby on RailsApós ler esse guia, você saberá: O propósito de das técnicas de debug Como encontrar problemas nas suas aplicações que testes não estão identificando As diferentes maneiras de depurar o seu código Como analisar a stack trace" />
  <meta property="og:description" content="Debug de Aplicações RailsEsse guia introduz técnicas de debug para aplicações de Ruby on RailsApós ler esse guia, você saberá: O propósito de das técnicas de debug Como encontrar problemas nas suas aplicações que testes não estão identificando As diferentes maneiras de depurar o seu código Como analisar a stack trace" />
  <meta property="og:locale" content="pt_BR" />
  <meta property="og:site_name" content="Guia Ruby on Rails" />
  <meta property="og:image" content="https://avatars.githubusercontent.com/u/4223" />
  <meta property="og:type" content="website" />
</head>
<body class="guide">
  <div>
    <div id="version-badge">v7.0.8</div>
  </div>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">Veja mais em <a href="https://rubyonrails.org/">rubyonrails.org:</a> </strong>
      <span class="red-button more-info-button">
        Mais Ruby on Rails
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://rubyonrails.org/blog">Blog</a></li>
        <li class="more-info"><a href="https://guides.rubyonrails.org/">Guia oficial</a></li>
        <li class="more-info"><a href="https://api.rubyonrails.org/">API</a></li>
        <li class="more-info"><a href="https://discuss.rubyonrails.org/">Forum</a></li>
        <li class="more-info"><a href="https://github.com/rails/rails">Contribua no GitHub</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="Voltar para a página principal">Guiarails.com.br</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">Home</a></li>
        <li class="guides-search guides-search-large">
          <input class="search-box search-box-large nav-item" type="text" placeholder="Digite o termo...">
          <div class="search-results"></div>
          <div class="search-spinner">Aguarde...</div>
        </li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">Guias</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
            <dl class="guides-section-container">
                <div class="guides-section">
                  <dt>Comece aqui</dt>
                  <dd><a href="getting_started.html">Começando com Rails</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Models</dt>
                  <dd><a href="active_record_basics.html">Active Record Basics</a></dd>
                  <dd><a href="active_record_migrations.html">Active Record Migrations</a></dd>
                  <dd><a href="active_record_validations.html">Active Record Validations</a></dd>
                  <dd><a href="active_record_callbacks.html">Active Record Callbacks</a></dd>
                  <dd><a href="association_basics.html">Active Record Associations</a></dd>
                  <dd><a href="active_record_querying.html">Active Record Query Interface</a></dd>
                  <dd><a href="active_model_basics.html">Active Model Basics</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Views</dt>
                  <dd><a href="action_view_overview.html">Action View Overview</a></dd>
                  <dd><a href="layouts_and_rendering.html">Layouts and Rendering in Rails</a></dd>
                  <dd><a href="action_view_helpers.html">Action View Helpers</a></dd>
                  <dd><a href="form_helpers.html">Action View Form Helpers</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Controllers</dt>
                  <dd><a href="action_controller_overview.html">Action Controller Overview</a></dd>
                  <dd><a href="routing.html">Rails Routing from the Outside In</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Outros componentes</dt>
                  <dd><a href="active_support_core_extensions.html">Active Support Core Extensions</a></dd>
                  <dd><a href="action_mailer_basics.html">Action Mailer Basics</a></dd>
                  <dd><a href="action_mailbox_basics.html">Action Mailbox Basics</a></dd>
                  <dd><a href="action_text_overview.html">Action Text Overview</a></dd>
                  <dd><a href="active_job_basics.html">Active Job Basics</a></dd>
                  <dd><a href="active_storage_overview.html">Active Storage Overview</a></dd>
                  <dd><a href="action_cable_overview.html">Action Cable Overview</a></dd>
                  <dd><a href="webpacker.html">Webpacker</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Indo mais fundo</dt>
                  <dd><a href="i18n.html">Rails Internationalization (I18n) API</a></dd>
                  <dd><a href="testing.html">Testing Rails Applications</a></dd>
                  <dd><a href="security.html">Securing Rails Applications</a></dd>
                  <dd><a href="debugging_rails_applications.html">Debugging Rails Applications</a></dd>
                  <dd><a href="configuring.html">Configuring Rails Applications</a></dd>
                  <dd><a href="command_line.html">The Rails Command Line</a></dd>
                  <dd><a href="asset_pipeline.html">The Asset Pipeline</a></dd>
                  <dd><a href="working_with_javascript_in_rails.html">Working with JavaScript in Rails</a></dd>
                  <dd><a href="initialization.html">The Rails Initialization Process</a></dd>
                  <dd><a href="autoloading_and_reloading_constants.html">Autoloading and Reloading Constants</a></dd>
                  <dd><a href="classic_to_zeitwerk_howto.html">Classic para Zeitwerk - Como Fazer</a></dd>
                  <dd><a href="caching_with_rails.html">Caching with Rails: An Overview</a></dd>
                  <dd><a href="active_support_instrumentation.html">Active Support Instrumentation</a></dd>
                  <dd><a href="api_app.html">Using Rails for API-only Applications</a></dd>
                  <dd><a href="active_record_postgresql.html">Active Record and PostgreSQL</a></dd>
                  <dd><a href="active_record_multiple_databases.html">Multiple Databases with Active Record</a></dd>
                  <dd><a href="active_record_encryption.html">Active Record Encryption</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Estendendo o Rails</dt>
                  <dd><a href="plugins.html">The Basics of Creating Rails Plugins</a></dd>
                  <dd><a href="rails_on_rack.html">Rails on Rack</a></dd>
                  <dd><a href="generators.html">Creating and Customizing Rails Generators &amp; Templates</a></dd>
                  <dd><a href="engines.html">Getting Started with Engines</a></dd>
                  <dd><a href="threading_and_code_execution.html">Threading and Code Execution in Rails</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Contribuições</dt>
                  <dd><a href="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails</a></dd>
                  <dd><a href="api_documentation_guidelines.html">API Documentation Guidelines</a></dd>
                  <dd><a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Políticas</dt>
                  <dd><a href="maintenance_policy.html">Maintenance Policy for Ruby on Rails</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Release Notes</dt>
                  <dd><a href="upgrading_ruby_on_rails.html">Upgrading Ruby on Rails</a></dd>
                  <dd><a href="7_0_release_notes.html">Version 7.0 - Dezembro 2021</a></dd>
                  <dd><a href="6_1_release_notes.html">Version 6.1 - Dezembro 2020</a></dd>
                  <dd><a href="6_0_release_notes.html">Version 6.0 - Agosto 2019</a></dd>
                  <dd><a href="5_2_release_notes.html">Version 5.2 - April 2018</a></dd>
                  <dd><a href="5_1_release_notes.html">Version 5.1 - April 2017</a></dd>
                  <dd><a href="5_0_release_notes.html">Version 5.0 - June 2016</a></dd>
                  <dd><a href="4_2_release_notes.html">Version 4.2 - December 2014</a></dd>
                  <dd><a href="4_1_release_notes.html">Version 4.1 - April 2014</a></dd>
                  <dd><a href="4_0_release_notes.html">Version 4.0 - June 2013</a></dd>
                  <dd><a href="3_2_release_notes.html">Version 3.2 - January 2012</a></dd>
                  <dd><a href="3_1_release_notes.html">Version 3.1 - August 2011</a></dd>
                  <dd><a href="3_0_release_notes.html">Version 3.0 - August 2010</a></dd>
                  <dd><a href="2_3_release_notes.html">Version 2.3 - March 2009</a></dd>
                  <dd><a href="2_2_release_notes.html">Version 2.2 - November 2008</a></dd>
                </div>
            </div>
          </dl>
        </li>
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">Contribua</a></li>
        <li class="guides-search guides-search-small">
          <input class="search-box search-box-small nav-item" type="text" placeholder="Digite o termo...">
          <div class="search-results"></div>
          <div class="search-spinner">Aguarde...</div>
        </li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">Guias</option>
              <optgroup label="Comece aqui">
                  <option value="getting_started.html">Começando com Rails</option>
              </optgroup>
              <optgroup label="Models">
                  <option value="active_record_basics.html">Active Record Basics</option>
                  <option value="active_record_migrations.html">Active Record Migrations</option>
                  <option value="active_record_validations.html">Active Record Validations</option>
                  <option value="active_record_callbacks.html">Active Record Callbacks</option>
                  <option value="association_basics.html">Active Record Associations</option>
                  <option value="active_record_querying.html">Active Record Query Interface</option>
                  <option value="active_model_basics.html">Active Model Basics</option>
              </optgroup>
              <optgroup label="Views">
                  <option value="action_view_overview.html">Action View Overview</option>
                  <option value="layouts_and_rendering.html">Layouts and Rendering in Rails</option>
                  <option value="action_view_helpers.html">Action View Helpers</option>
                  <option value="form_helpers.html">Action View Form Helpers</option>
              </optgroup>
              <optgroup label="Controllers">
                  <option value="action_controller_overview.html">Action Controller Overview</option>
                  <option value="routing.html">Rails Routing from the Outside In</option>
              </optgroup>
              <optgroup label="Outros componentes">
                  <option value="active_support_core_extensions.html">Active Support Core Extensions</option>
                  <option value="action_mailer_basics.html">Action Mailer Basics</option>
                  <option value="action_mailbox_basics.html">Action Mailbox Basics</option>
                  <option value="action_text_overview.html">Action Text Overview</option>
                  <option value="active_job_basics.html">Active Job Basics</option>
                  <option value="active_storage_overview.html">Active Storage Overview</option>
                  <option value="action_cable_overview.html">Action Cable Overview</option>
                  <option value="webpacker.html">Webpacker</option>
              </optgroup>
              <optgroup label="Indo mais fundo">
                  <option value="i18n.html">Rails Internationalization (I18n) API</option>
                  <option value="testing.html">Testing Rails Applications</option>
                  <option value="security.html">Securing Rails Applications</option>
                  <option value="debugging_rails_applications.html">Debugging Rails Applications</option>
                  <option value="configuring.html">Configuring Rails Applications</option>
                  <option value="command_line.html">The Rails Command Line</option>
                  <option value="asset_pipeline.html">The Asset Pipeline</option>
                  <option value="working_with_javascript_in_rails.html">Working with JavaScript in Rails</option>
                  <option value="initialization.html">The Rails Initialization Process</option>
                  <option value="autoloading_and_reloading_constants.html">Autoloading and Reloading Constants</option>
                  <option value="classic_to_zeitwerk_howto.html">Classic para Zeitwerk - Como Fazer</option>
                  <option value="caching_with_rails.html">Caching with Rails: An Overview</option>
                  <option value="active_support_instrumentation.html">Active Support Instrumentation</option>
                  <option value="api_app.html">Using Rails for API-only Applications</option>
                  <option value="active_record_postgresql.html">Active Record and PostgreSQL</option>
                  <option value="active_record_multiple_databases.html">Multiple Databases with Active Record</option>
                  <option value="active_record_encryption.html">Active Record Encryption</option>
              </optgroup>
              <optgroup label="Estendendo o Rails">
                  <option value="plugins.html">The Basics of Creating Rails Plugins</option>
                  <option value="rails_on_rack.html">Rails on Rack</option>
                  <option value="generators.html">Creating and Customizing Rails Generators &amp; Templates</option>
                  <option value="engines.html">Getting Started with Engines</option>
                  <option value="threading_and_code_execution.html">Threading and Code Execution in Rails</option>
              </optgroup>
              <optgroup label="Contribuições">
                  <option value="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails</option>
                  <option value="api_documentation_guidelines.html">API Documentation Guidelines</option>
                  <option value="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</option>
              </optgroup>
              <optgroup label="Políticas">
                  <option value="maintenance_policy.html">Maintenance Policy for Ruby on Rails</option>
              </optgroup>
              <optgroup label="Release Notes">
                  <option value="upgrading_ruby_on_rails.html">Upgrading Ruby on Rails</option>
                  <option value="7_0_release_notes.html">Version 7.0 - Dezembro 2021</option>
                  <option value="6_1_release_notes.html">Version 6.1 - Dezembro 2020</option>
                  <option value="6_0_release_notes.html">Version 6.0 - Agosto 2019</option>
                  <option value="5_2_release_notes.html">Version 5.2 - April 2018</option>
                  <option value="5_1_release_notes.html">Version 5.1 - April 2017</option>
                  <option value="5_0_release_notes.html">Version 5.0 - June 2016</option>
                  <option value="4_2_release_notes.html">Version 4.2 - December 2014</option>
                  <option value="4_1_release_notes.html">Version 4.1 - April 2014</option>
                  <option value="4_0_release_notes.html">Version 4.0 - June 2013</option>
                  <option value="3_2_release_notes.html">Version 3.2 - January 2012</option>
                  <option value="3_1_release_notes.html">Version 3.1 - August 2011</option>
                  <option value="3_0_release_notes.html">Version 3.0 - August 2010</option>
                  <option value="2_3_release_notes.html">Version 2.3 - March 2009</option>
                  <option value="2_2_release_notes.html">Version 2.2 - November 2008</option>
              </optgroup>
          </select>
        </li>
      </ul>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2><em>Debug</em> de Aplicações Rails</h2><p>Esse guia introduz técnicas de <em>debug</em> para aplicações de Ruby on Rails</p><p>Após ler esse guia, você saberá:</p>
<ul>
<li>O propósito de das técnicas de <em>debug</em></li>
<li>Como encontrar problemas nas suas aplicações que testes não estão identificando</li>
<li>As diferentes maneiras de depurar o seu código</li>
<li>Como analisar a <em>stack trace</em></li>
</ul>


                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li>
<a href="#view-helpers-para-debugging"><em>View Helpers</em> para <em>Debugging</em></a>

<ul>
<li><a href="#debug"><code>debug</code></a></li>
<li><a href="#to-yaml"><code>to_yaml</code></a></li>
<li><a href="#inspect"><code>inspect</code></a></li>
</ul>
</li>
<li>
<a href="#o-logger">O <em>Logger</em></a>

<ul>
<li><a href="#o-que-%C3%A9-o-logger-questionmark">O que é o <em>Logger</em>?</a></li>
<li><a href="#n%C3%ADveis-de-log">Níveis de Log</a></li>
<li><a href="#enviando-mensagens">Enviando Mensagens</a></li>
<li><a href="#verbose-query-logs">Verbose Query Logs</a></li>
<li><a href="#tagged-log">Tagged Log</a></li>
<li><a href="#impacto-dos-logs-no-desempenho">Impacto dos logs no desempenho</a></li>
</ul>
</li>
<li>
<a href="#debugging-with-the-debug-gem">Debugging with the <code>debug</code> Gem</a>

<ul>
<li><a href="#entering-a-debugging-session">Entering a Debugging Session</a></li>
<li><a href="#the-context">The Context</a></li>
<li><a href="#breakpoints">Breakpoints</a></li>
</ul>
</li>
<li>
<a href="#debug-com-a-gem-web-console">Debug com a Gem <code>web-console</code></a>

<ul>
<li><a href="#console">Console</a></li>
<li><a href="#inspecionando-vari%C3%A1veis">Inspecionando Variáveis</a></li>
<li><a href="#configura%C3%A7%C3%B5es">Configurações</a></li>
</ul>
</li>
<li>
<a href="#debug-de-vazamentos-de-mem%C3%B3rias">Debug de Vazamentos de Memórias</a>

<ul>
<li><a href="#valgrind">Valgrind</a></li>
<li><a href="#encontrando-um-vazamento-de-mem%C3%B3ria">Encontrando um vazamento de memória</a></li>
</ul>
</li>
<li><a href="#plugins-para-debug">Plugins para <em>Debug</em></a></li>
<li><a href="#referencias">Referencias</a></li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h3 id="view-helpers-para-debugging"><a class="anchorlink" href="#view-helpers-para-debugging">1 <em>View Helpers</em> para <em>Debugging</em></a></h3><p>Uma tarefa comum é inspecionar o conteúdo de uma variável. O Rails fornece três diferentes formas para fazer isso:</p>
<ul>
<li><code>debug</code></li>
<li><code>to_yaml</code></li>
<li><code>inspect</code></li>
</ul>
<h4 id="debug"><a class="anchorlink" href="#debug">1.1 <code>debug</code></a></h4><p>O <em>helper</em> <code>debug</code> irá retornar uma tag &lt;pre&gt; que renderiza um objeto usando o formato YAML. Isso vai gerar um dado legível para humanos a partir de qualquer objeto. Por exemplo, se você tem esse código em uma <em>view</em>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">debug</span> <span class="vi">@article</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;b&gt;</span>Title:<span class="nt">&lt;/b&gt;</span>
  <span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= debug @article %&gt;
&lt;p&gt;
  &lt;b&gt;Title:&lt;/b&gt;
  &lt;%= @article.title %&gt;
&lt;/p&gt;
">Copy</button>
</div>
<p>Você verá algo parecido com isso:</p><div class="code_container">
<pre><code class="highlight yaml"><span class="nn">---</span> <span class="kt">!ruby/object</span> <span class="s">Article</span>
<span class="na">attributes</span><span class="pi">:</span>
  <span class="na">updated_at</span><span class="pi">:</span> <span class="s">2008-09-05 22:55:47</span>
  <span class="na">body</span><span class="pi">:</span> <span class="s">Esse é um guia muito útil para fazer o debugging da sua app Rails.</span>
  <span class="na">title</span><span class="pi">:</span> <span class="s">Guia de debugging do Rails</span>
  <span class="na">published</span><span class="pi">:</span> <span class="s">t</span>
  <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1"</span>
  <span class="na">created_at</span><span class="pi">:</span> <span class="s">2008-09-05 22:55:47</span>
<span class="na">attributes_cache</span><span class="pi">:</span> <span class="pi">{}</span>


<span class="na">Title</span><span class="pi">:</span> <span class="s">Guia de *debugging* do Rails</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='--- !ruby/object Article
attributes:
  updated_at: 2008-09-05 22:55:47
  body: Esse é um guia muito útil para fazer o debugging da sua app Rails.
  title: Guia de debugging do Rails
  published: t
  id: "1"
  created_at: 2008-09-05 22:55:47
attributes_cache: {}


Title: Guia de *debugging* do Rails
'>Copy</button>
</div>
<h4 id="to-yaml"><a class="anchorlink" href="#to-yaml">1.2 <code>to_yaml</code></a></h4><p>Como alternativa, chamar <code>to_yaml</code> em qualquer objeto o converte para YAML. Você pode passar esse objeto convertido para o método <em>helper</em> <code>simple_format</code> para formatar o <em>output</em>. É assim que o <code>debug</code> faz sua mágica.</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">simple_format</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">to_yaml</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;b&gt;</span>Title:<span class="nt">&lt;/b&gt;</span>
  <span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= simple_format @article.to_yaml %&gt;
&lt;p&gt;
  &lt;b&gt;Title:&lt;/b&gt;
  &lt;%= @article.title %&gt;
&lt;/p&gt;
">Copy</button>
</div>
<p>O código acima vai renderizar algo como isso:</p><div class="code_container">
<pre><code class="highlight yaml"><span class="nn">---</span> <span class="kt">!ruby/object</span> <span class="s">Article</span>
<span class="na">attributes</span><span class="pi">:</span>
<span class="na">updated_at</span><span class="pi">:</span> <span class="s">2008-09-05 22:55:47</span>
<span class="na">body</span><span class="pi">:</span> <span class="s">Esse é um guia muito útil para fazer o debugging de sua app Rails.</span>
<span class="na">title</span><span class="pi">:</span> <span class="s">Guia de debugging do Rails</span>
<span class="na">published</span><span class="pi">:</span> <span class="s">t</span>
<span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1"</span>
<span class="na">created_at</span><span class="pi">:</span> <span class="s">2008-09-05 22:55:47</span>
<span class="na">attributes_cache</span><span class="pi">:</span> <span class="pi">{}</span>

<span class="na">Title</span><span class="pi">:</span> <span class="s">Guia de *debugging* do Rails</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='--- !ruby/object Article
attributes:
updated_at: 2008-09-05 22:55:47
body: Esse é um guia muito útil para fazer o debugging de sua app Rails.
title: Guia de debugging do Rails
published: t
id: "1"
created_at: 2008-09-05 22:55:47
attributes_cache: {}

Title: Guia de *debugging* do Rails
'>Copy</button>
</div>
<h4 id="inspect"><a class="anchorlink" href="#inspect">1.3 <code>inspect</code></a></h4><p>Outro método útil para mostrar valores de objeto é o <code>inspect</code>, especialmente quando estamos trabalhando com arrays ou hashes. Isso imprimirá o valor do objeto como uma string. Por exemplo:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">].</span><span class="nf">inspect</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;b&gt;</span>Title:<span class="nt">&lt;/b&gt;</span>
  <span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= [1, 2, 3, 4, 5].inspect %&gt;
&lt;p&gt;
  &lt;b&gt;Title:&lt;/b&gt;
  &lt;%= @article.title %&gt;
&lt;/p&gt;
">Copy</button>
</div>
<p>Vai renderizar:</p><div class="code_container">
<pre><code class="highlight plaintext">[1, 2, 3, 4, 5]

Title: Guia de *debugging* do Rails
</code></pre>
<button class="clipboard-button" data-clipboard-text="[1, 2, 3, 4, 5]

Title: Guia de *debugging* do Rails
">Copy</button>
</div>
<h3 id="o-logger"><a class="anchorlink" href="#o-logger">2 O <em>Logger</em></a></h3><p>Pode ser útil salvar informações em um arquivo de log em tempo de execução. O Rails mantém um arquivo de log separado para cada ambiente de execução.</p><h4 id="o-que-é-o-logger-questionmark"><a class="anchorlink" href="#o-que-%C3%A9-o-logger-questionmark">2.1 O que é o <em>Logger</em>?</a></h4><p>O Rails utiliza a classe <code>ActiveSupport::Logger</code> para guardar informações de log. Outros tipos de loggers, como o <code>Log4r</code>, também podem ser utilizados.</p><p>Você pode especificar um <em>logger</em> alternativo em <code>config/application.rb</code> ou em qualquer outro arquivo de ambiente, por exemplo:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">logger</span> <span class="o">=</span> <span class="no">Logger</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="no">STDOUT</span><span class="p">)</span>
<span class="n">config</span><span class="p">.</span><span class="nf">logger</span> <span class="o">=</span> <span class="no">Log4r</span><span class="o">::</span><span class="no">Logger</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"Application Log"</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='config.logger = Logger.new(STDOUT)
config.logger = Log4r::Logger.new("Application Log")
'>Copy</button>
</div>
<p>Ou na seção <code>Initializer</code>, adicione <em>qualquer</em> um dos seguintes:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">logger</span> <span class="o">=</span> <span class="no">Logger</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="no">STDOUT</span><span class="p">)</span>
<span class="no">Rails</span><span class="p">.</span><span class="nf">logger</span> <span class="o">=</span> <span class="no">Log4r</span><span class="o">::</span><span class="no">Logger</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"Application Log"</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='Rails.logger = Logger.new(STDOUT)
Rails.logger = Log4r::Logger.new("Application Log")
'>Copy</button>
</div>
<div class="info"><p>Por padrão, cada <em>log</em> é criado em <code>Rails.root/log/</code> e o arquivo de registro é criado com o nome do ambiente no qual a aplicação está sendo executada.</p></div><h4 id="níveis-de-log"><a class="anchorlink" href="#n%C3%ADveis-de-log">2.2 Níveis de Log</a></h4><p>Quando algo é registrado, a informação é armazenada no local de registro correspondente se o nível de <em>log</em> for igual ou maior que o configurado. Se você quiser saber o nível atual do registro, você pode o método <code>Rails.logger.level</code>.</p><p>Os níveis de log disponiveis são: <code>:debug</code>, <code>:info</code>, <code>:warn</code>, <code>:error</code>, <code>:fatal</code>,
e <code>:unknown</code>, correspondendo aos níveis de log de 0 até 5, respectivamente. Para mudar o nível de log padrão, utilize:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">log_level</span> <span class="o">=</span> <span class="ss">:warn</span> <span class="c1"># Em qualquer inicializador de ambiente, ou</span>
<span class="no">Rails</span><span class="p">.</span><span class="nf">logger</span><span class="p">.</span><span class="nf">level</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># a qualquer momento</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="config.log_level = :warn # Em qualquer inicializador de ambiente, ou
Rails.logger.level = 0 # a qualquer momento
">Copy</button>
</div>
<p>Isso é útil quando você quer criar <em>logs</em> em ambientes diferentes de desenvolvimento ou homologação sem sobrecarregar os registros do seu aplicativo com informação desnecessária.</p><div class="info"><p>O nível de <em>log</em> padrão do Rails é <code>debug</code> em todos os ambientes de desenvolvimento.</p></div><h4 id="enviando-mensagens"><a class="anchorlink" href="#enviando-mensagens">2.3 Enviando Mensagens</a></h4><p>Para enviar uma mensagem para o <em>log</em> ativo, use o método <code>logger.(debug|info|warn|error|fatal|unknown)</code> de dentro de um <em>controller</em>, <em>model</em> ou <em>mailer</em>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">logger</span><span class="p">.</span><span class="nf">debug</span> <span class="s2">"Hash com atributos de 'Person': </span><span class="si">#{</span><span class="vi">@person</span><span class="p">.</span><span class="nf">attributes</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">"</span>
<span class="n">logger</span><span class="p">.</span><span class="nf">info</span> <span class="s2">"Processando informações..."</span>
<span class="n">logger</span><span class="p">.</span><span class="nf">fatal</span> <span class="s2">"Encerrando aplicação, erro irrecuperavel!!!"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="logger.debug &quot;Hash com atributos de 'Person': #{@person.attributes.inspect}&quot;
logger.info &quot;Processando informações...&quot;
logger.fatal &quot;Encerrando aplicação, erro irrecuperavel!!!&quot;
">Copy</button>
</div>
<p>Segue um exemplo de um método instrumentado com um log extra:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="c1"># ...</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">debug</span> <span class="s2">"Novo Artigo: </span><span class="si">#{</span><span class="vi">@article</span><span class="p">.</span><span class="nf">attributes</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">debug</span> <span class="s2">"Artigo deve ser valido: </span><span class="si">#{</span><span class="vi">@article</span><span class="p">.</span><span class="nf">valid?</span><span class="si">}</span><span class="s2">"</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
      <span class="n">logger</span><span class="p">.</span><span class="nf">debug</span> <span class="s2">"O Artigo foi salvo e agora o usuario será redirecionado..."</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span><span class="p">,</span> <span class="ss">notice: </span><span class="s1">'Artigo criado com sucesso'</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:new</span><span class="p">,</span> <span class="ss">status: :unprocessable_entity</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="c1"># ...</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">article_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:article</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">:published</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class ArticlesController &lt; ApplicationController
  # ...

  def create
    @article = Article.new(article_params)
    logger.debug &quot;Novo Artigo: #{@article.attributes.inspect}&quot;
    logger.debug &quot;Artigo deve ser valido: #{@article.valid?}&quot;

    if @article.save
      logger.debug &quot;O Artigo foi salvo e agora o usuario será redirecionado...&quot;
      redirect_to @article, notice: 'Artigo criado com sucesso'
    else
      render :new, status: :unprocessable_entity
    end
  end

  # ...

  private
    def article_params
      params.require(:article).permit(:title, :body, :published)
    end
end
">Copy</button>
</div>
<p>Segue um exemplo de um log gerado quando a ação deste <em>controller</em> é executada:</p><div class="code_container">
<pre><code class="highlight plaintext">Started POST "/articles" for 127.0.0.1 at 2018-10-18 20:09:23 -0400
Processing by ArticlesController#create as HTML
  Parameters: {"utf8"=&gt;"✓", "authenticity_token"=&gt;"XLveDrKzF1SwaiNRPTaMtkrsTzedtebPPkmxEFIU0ordLjICSnXsSNfrdMa4ccyBjuGwnnEiQhEoMN6H1Gtz3A==", "article"=&gt;{"title"=&gt;"Debugging Rails", "body"=&gt;"I'm learning how to print in logs.", "published"=&gt;"0"}, "commit"=&gt;"Create Article"}
New article: {"id"=&gt;nil, "title"=&gt;"Debugging Rails", "body"=&gt;"I'm learning how to print in logs.", "published"=&gt;false, "created_at"=&gt;nil, "updated_at"=&gt;nil}
Article should be valid: true
   (0.0ms)  begin transaction
  ↳ app/controllers/articles_controller.rb:31
  Article Create (0.5ms)  INSERT INTO "articles" ("title", "body", "published", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)  [["title", "Debugging Rails"], ["body", "I'm learning how to print in logs."], ["published", 0], ["created_at", "2018-10-19 00:09:23.216549"], ["updated_at", "2018-10-19 00:09:23.216549"]]
  ↳ app/controllers/articles_controller.rb:31
   (2.3ms)  commit transaction
  ↳ app/controllers/articles_controller.rb:31
The article was saved and now the user is going to be redirected...
Redirected to http://localhost:3000/articles/1
Completed 302 Found in 4ms (ActiveRecord: 0.8ms)
</code></pre>
<button class="clipboard-button" data-clipboard-text="Started POST &quot;/articles&quot; for 127.0.0.1 at 2018-10-18 20:09:23 -0400
Processing by ArticlesController#create as HTML
  Parameters: {&quot;utf8&quot;=&gt;&quot;✓&quot;, &quot;authenticity_token&quot;=&gt;&quot;XLveDrKzF1SwaiNRPTaMtkrsTzedtebPPkmxEFIU0ordLjICSnXsSNfrdMa4ccyBjuGwnnEiQhEoMN6H1Gtz3A==&quot;, &quot;article&quot;=&gt;{&quot;title&quot;=&gt;&quot;Debugging Rails&quot;, &quot;body&quot;=&gt;&quot;I'm learning how to print in logs.&quot;, &quot;published&quot;=&gt;&quot;0&quot;}, &quot;commit&quot;=&gt;&quot;Create Article&quot;}
New article: {&quot;id&quot;=&gt;nil, &quot;title&quot;=&gt;&quot;Debugging Rails&quot;, &quot;body&quot;=&gt;&quot;I'm learning how to print in logs.&quot;, &quot;published&quot;=&gt;false, &quot;created_at&quot;=&gt;nil, &quot;updated_at&quot;=&gt;nil}
Article should be valid: true
   (0.0ms)  begin transaction
  ↳ app/controllers/articles_controller.rb:31
  Article Create (0.5ms)  INSERT INTO &quot;articles&quot; (&quot;title&quot;, &quot;body&quot;, &quot;published&quot;, &quot;created_at&quot;, &quot;updated_at&quot;) VALUES (?, ?, ?, ?, ?)  [[&quot;title&quot;, &quot;Debugging Rails&quot;], [&quot;body&quot;, &quot;I'm learning how to print in logs.&quot;], [&quot;published&quot;, 0], [&quot;created_at&quot;, &quot;2018-10-19 00:09:23.216549&quot;], [&quot;updated_at&quot;, &quot;2018-10-19 00:09:23.216549&quot;]]
  ↳ app/controllers/articles_controller.rb:31
   (2.3ms)  commit transaction
  ↳ app/controllers/articles_controller.rb:31
The article was saved and now the user is going to be redirected...
Redirected to http://localhost:3000/articles/1
Completed 302 Found in 4ms (ActiveRecord: 0.8ms)
">Copy</button>
</div>
<p>A adição deste tipo de log facilita a busca por comportamentos não esperados ou não usuais. Se você adicionar logs extras, tenha certeza de utilizar os níveis de log de maneira adequada, para evitar encher seus logs do ambiente de produção com trivialidades inúteis.</p><h4 id="verbose-query-logs"><a class="anchorlink" href="#verbose-query-logs">2.4 Verbose Query Logs</a></h4><p>Ao observar a saída de consulta de banco de dados em logs, pode não ser imediatamente claro por que várias consultas de banco de dados são acionadas quando um único método é chamado:</p><div class="code_container">
<pre><code class="highlight plaintext">irb(main):001:0&gt; Article.pamplemousse
  Article Load (0.4ms)  SELECT "articles".* FROM "articles"
  Comment Load (0.2ms)  SELECT "comments".* FROM "comments" WHERE "comments"."article_id" = ?  [["article_id", 1]]
  Comment Load (0.1ms)  SELECT "comments".* FROM "comments" WHERE "comments"."article_id" = ?  [["article_id", 2]]
  Comment Load (0.1ms)  SELECT "comments".* FROM "comments" WHERE "comments"."article_id" = ?  [["article_id", 3]]
=&gt; #&lt;Comment id: 2, author: "1", body: "Well, actually...", article_id: 1, created_at: "2018-10-19 00:56:10", updated_at: "2018-10-19 00:56:10"&gt;
</code></pre>
<button class="clipboard-button" data-clipboard-text='irb(main):001:0&gt; Article.pamplemousse
  Article Load (0.4ms)  SELECT "articles".* FROM "articles"
  Comment Load (0.2ms)  SELECT "comments".* FROM "comments" WHERE "comments"."article_id" = ?  [["article_id", 1]]
  Comment Load (0.1ms)  SELECT "comments".* FROM "comments" WHERE "comments"."article_id" = ?  [["article_id", 2]]
  Comment Load (0.1ms)  SELECT "comments".* FROM "comments" WHERE "comments"."article_id" = ?  [["article_id", 3]]
=&gt; #&lt;Comment id: 2, author: "1", body: "Well, actually...", article_id: 1, created_at: "2018-10-19 00:56:10", updated_at: "2018-10-19 00:56:10"&gt;
'>Copy</button>
</div>
<p>Depois de executar <code>ActiveRecord.verbose_query_logs = true</code> na sessão <code>bin/rails console</code> para habilitar logs de consulta detalhados e executar o método novamente, torna-se óbvio qual linha única de código está gerando todas essas chamadas discretas de banco de dados:</p><div class="code_container">
<pre><code class="highlight plaintext">irb(main):003:0&gt; Article.pamplemousse
  Article Load (0.2ms)  SELECT "articles".* FROM "articles"
  ↳ app/models/article.rb:5
  Comment Load (0.1ms)  SELECT "comments".* FROM "comments" WHERE "comments"."article_id" = ?  [["article_id", 1]]
  ↳ app/models/article.rb:6
  Comment Load (0.1ms)  SELECT "comments".* FROM "comments" WHERE "comments"."article_id" = ?  [["article_id", 2]]
  ↳ app/models/article.rb:6
  Comment Load (0.1ms)  SELECT "comments".* FROM "comments" WHERE "comments"."article_id" = ?  [["article_id", 3]]
  ↳ app/models/article.rb:6
=&gt; #&lt;Comment id: 2, author: "1", body: "Well, actually...", article_id: 1, created_at: "2018-10-19 00:56:10", updated_at: "2018-10-19 00:56:10"&gt;
</code></pre>
<button class="clipboard-button" data-clipboard-text='irb(main):003:0&gt; Article.pamplemousse
  Article Load (0.2ms)  SELECT "articles".* FROM "articles"
  ↳ app/models/article.rb:5
  Comment Load (0.1ms)  SELECT "comments".* FROM "comments" WHERE "comments"."article_id" = ?  [["article_id", 1]]
  ↳ app/models/article.rb:6
  Comment Load (0.1ms)  SELECT "comments".* FROM "comments" WHERE "comments"."article_id" = ?  [["article_id", 2]]
  ↳ app/models/article.rb:6
  Comment Load (0.1ms)  SELECT "comments".* FROM "comments" WHERE "comments"."article_id" = ?  [["article_id", 3]]
  ↳ app/models/article.rb:6
=&gt; #&lt;Comment id: 2, author: "1", body: "Well, actually...", article_id: 1, created_at: "2018-10-19 00:56:10", updated_at: "2018-10-19 00:56:10"&gt;
'>Copy</button>
</div>
<p>Abaixo de cada instrução do banco de dados, você pode ver setas apontando para o nome do arquivo de origem específico (e o número da linha) do método que resultou em uma chamada de banco de dados. Isso pode ajudá-lo a identificar e resolver problemas de desempenho causados por consultas N + 1: consultas únicas de banco de dados que geram várias consultas adicionais.</p><p>Logs de consulta detalhada são habilitados por padrão nos logs do ambiente de desenvolvimento após o Rails 5.2.</p><div class="warning"><p>Não recomendamos o uso dessa configuração em ambientes de produção. Ele se baseia no método<code>Kernel#caller</code> que tende a alocar muita memória para gerar o <em>backtrace</em> (rastreamento) de chamadas de método.</p></div><h4 id="tagged-log"><a class="anchorlink" href="#tagged-log">2.5 Tagged Log</a></h4><p>Ao executar aplicativos multiusuário e multi-contas, muitas vezes é útil
ser capaz de filtrar os registros usando algumas regras personalizadas. <code>TaggedLogging</code>
no Active Support ajuda você a fazer exatamente isso, marcando linhas de registro com subdomínios, IDs de requisição e qualquer outra coisa para auxiliar no <em>debug</em> de tais aplicativos.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">logger</span> <span class="o">=</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TaggedLogging</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="no">Logger</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="no">STDOUT</span><span class="p">))</span>
<span class="n">logger</span><span class="p">.</span><span class="nf">tagged</span><span class="p">(</span><span class="s2">"BCX"</span><span class="p">)</span> <span class="p">{</span> <span class="n">logger</span><span class="p">.</span><span class="nf">info</span> <span class="s2">"Stuff"</span> <span class="p">}</span>                            <span class="c1"># Logs "[BCX] Stuff"</span>
<span class="n">logger</span><span class="p">.</span><span class="nf">tagged</span><span class="p">(</span><span class="s2">"BCX"</span><span class="p">,</span> <span class="s2">"Jason"</span><span class="p">)</span> <span class="p">{</span> <span class="n">logger</span><span class="p">.</span><span class="nf">info</span> <span class="s2">"Stuff"</span> <span class="p">}</span>                   <span class="c1"># Logs "[BCX] [Jason] Stuff"</span>
<span class="n">logger</span><span class="p">.</span><span class="nf">tagged</span><span class="p">(</span><span class="s2">"BCX"</span><span class="p">)</span> <span class="p">{</span> <span class="n">logger</span><span class="p">.</span><span class="nf">tagged</span><span class="p">(</span><span class="s2">"Jason"</span><span class="p">)</span> <span class="p">{</span> <span class="n">logger</span><span class="p">.</span><span class="nf">info</span> <span class="s2">"Stuff"</span> <span class="p">}</span> <span class="p">}</span> <span class="c1"># Logs "[BCX] [Jason] Stuff"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='logger = ActiveSupport::TaggedLogging.new(Logger.new(STDOUT))
logger.tagged("BCX") { logger.info "Stuff" }                            # Logs "[BCX] Stuff"
logger.tagged("BCX", "Jason") { logger.info "Stuff" }                   # Logs "[BCX] [Jason] Stuff"
logger.tagged("BCX") { logger.tagged("Jason") { logger.info "Stuff" } } # Logs "[BCX] [Jason] Stuff"
'>Copy</button>
</div>
<h4 id="impacto-dos-logs-no-desempenho"><a class="anchorlink" href="#impacto-dos-logs-no-desempenho">2.6 Impacto dos logs no desempenho</a></h4><p>O log sempre terá um pequeno impacto no desempenho do seu aplicativo Rails,
particularmente ao fazer o registro no disco. Além disso, existem algumas sutilezas:</p><p>Ao utilizar o nível <code>:debug</code> terá uma penalidade de desempenho maior do que <code>:fatal</code>,
já que um número muito maior de <em>strings</em> está sendo avaliado e gravado na saída do log (e.g. disco).</p><p>Outra armadilha potencial são muitas chamadas para <code>Logger</code> em seu código:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">logger</span><span class="p">.</span><span class="nf">debug</span> <span class="s2">"Person attributes hash: </span><span class="si">#{</span><span class="vi">@person</span><span class="p">.</span><span class="nf">attributes</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='logger.debug "Person attributes hash: #{@person.attributes.inspect}"
'>Copy</button>
</div>
<p>No exemplo acima, haverá um impacto no desempenho, mesmo se o nível de saída
permitido não incluir <em>debug</em>. A razão é que o Ruby tem que avaliar
essas <em>strings</em>, que inclui instanciar o objeto <code>String</code> um tanto pesado
e interpolar as variáveis.</p><p>Portanto, é recomendado passar blocos para os métodos logger, pois estes são
apenas avaliado se o nível de saída for o mesmo - ou incluído - o nível permitido
(i.e. carregamento lento). O mesmo código reescrito seria:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">logger</span><span class="p">.</span><span class="nf">debug</span> <span class="p">{</span><span class="s2">"Person attributes hash: </span><span class="si">#{</span><span class="vi">@person</span><span class="p">.</span><span class="nf">attributes</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">"</span><span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='logger.debug {"Person attributes hash: #{@person.attributes.inspect}"}
'>Copy</button>
</div>
<p>O conteúdo do bloco e, portanto, a interpolação de <em>string</em>, são apenas
avaliada se o <em>debug</em> está habilitado. Essa economia de desempenho é apenas realmente
perceptível com grandes quantidades de registro, mas é uma boa prática empregar.</p><div class="info"><p>Esta seção foi escrita por <a href="https://stackoverflow.com/questions/16546730/logging-in-rails-is-there-any-performance-hit/16546935#16546935">Jon Cairns em uma resposta no Stack Overflow</a>
e está licenciada sob <a href="https://creativecommons.org/licenses/by-sa/4.0/">cc by-sa 4.0</a>.</p></div><h3 id="debugging-with-the-debug-gem"><a class="anchorlink" href="#debugging-with-the-debug-gem">3 Debugging with the <code>debug</code> Gem</a></h3><p>When your code is behaving in unexpected ways, you can try printing to logs or
the console to diagnose the problem. Unfortunately, there are times when this
sort of error tracking is not effective in finding the root cause of a problem.
When you actually need to journey into your running source code, the debugger
is your best companion.</p><p>The debugger can also help you if you want to learn about the Rails source code
but don't know where to start. Just debug any request to your application and
use this guide to learn how to move from the code you have written into the
underlying Rails code.</p><p>Rails 7 includes the <code>debug</code> gem in the <code>Gemfile</code> of new applications generated
by CRuby. By default, it is ready in the <code>development</code> and <code>test</code> environments.
Please check its <a href="https://github.com/ruby/debug">documentation</a> for usage.</p><h4 id="entering-a-debugging-session"><a class="anchorlink" href="#entering-a-debugging-session">3.1 Entering a Debugging Session</a></h4><p>By default, a debugging session will start after the <code>debug</code> library is required, which happens when your app boots. But don't worry, the session won't interfere your program.</p><p>To enter the debugging session, you can use <code>binding.break</code> and its aliases: <code>binding.b</code> and <code>debugger</code>. The following examples will use <code>debugger</code>:</p><div class="code_container">
<pre><code class="highlight rb"><span class="k">class</span> <span class="nc">PostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">before_action</span> <span class="ss">:set_post</span><span class="p">,</span> <span class="ss">only: </span><span class="sx">%i[ show edit update destroy ]</span>

  <span class="c1"># GET /posts or /posts.json</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@posts</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">all</span>
    <span class="n">debugger</span>
  <span class="k">end</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class PostsController &lt; ApplicationController
  before_action :set_post, only: %i[ show edit update destroy ]

  # GET /posts or /posts.json
  def index
    @posts = Post.all
    debugger
  end
  # ...
end
">Copy</button>
</div>
<p>Once your app evaluates the debugging statement, it'll enter the debugging session:</p><div class="code_container">
<pre><code class="highlight rb"><span class="no">Processing</span> <span class="n">by</span> <span class="no">PostsController</span><span class="c1">#index as HTML</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="k">in</span> <span class="o">~</span><span class="sr">/projects/</span><span class="n">rails</span><span class="o">-</span><span class="n">guide</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">controllers</span><span class="o">/</span><span class="n">posts_controller</span><span class="p">.</span><span class="nf">rb</span>
     <span class="mi">2</span><span class="o">|</span>   <span class="n">before_action</span> <span class="ss">:set_post</span><span class="p">,</span> <span class="ss">only: </span><span class="sx">%i[ show edit update destroy ]</span>
     <span class="mi">3</span><span class="o">|</span>
     <span class="mi">4</span><span class="o">|</span>   <span class="c1"># GET /posts or /posts.json</span>
     <span class="mi">5</span><span class="o">|</span>   <span class="k">def</span> <span class="nf">index</span>
     <span class="mi">6</span><span class="o">|</span>     <span class="vi">@posts</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">all</span>
<span class="o">=&gt;</span>   <span class="mi">7</span><span class="o">|</span>     <span class="n">debugger</span>
     <span class="mi">8</span><span class="o">|</span>   <span class="k">end</span>
     <span class="mi">9</span><span class="o">|</span>
    <span class="mi">10</span><span class="o">|</span>   <span class="c1"># GET /posts/1 or /posts/1.json</span>
    <span class="mi">11</span><span class="o">|</span>   <span class="k">def</span> <span class="nf">show</span>
<span class="o">=&gt;</span><span class="c1">#0    PostsController#index at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:7</span>
  <span class="c1">#1    ActionController::BasicImplicitRender#send_action(method="index", args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6</span>
  <span class="c1"># and 72 frames (use `bt' command for all frames)</span>
<span class="p">(</span><span class="n">rdbg</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Processing by PostsController#index as HTML
[2, 11] in ~/projects/rails-guide-example/app/controllers/posts_controller.rb
     2|   before_action :set_post, only: %i[ show edit update destroy ]
     3|
     4|   # GET /posts or /posts.json
     5|   def index
     6|     @posts = Post.all
=&gt;   7|     debugger
     8|   end
     9|
    10|   # GET /posts/1 or /posts/1.json
    11|   def show
=&gt;#0    PostsController#index at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:7
  #1    ActionController::BasicImplicitRender#send_action(method=&quot;index&quot;, args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6
  # and 72 frames (use `bt' command for all frames)
(rdbg)
">Copy</button>
</div>
<p>You can exit the debugging session at any time and continue your application execution with the <code>continue</code> (or <code>c</code>) command.  Or, to exit both the debugging session and your application, use the <code>quit</code> (or <code>q</code>) command.</p><h4 id="the-context"><a class="anchorlink" href="#the-context">3.2 The Context</a></h4><p>After entering the debugging session, you can type in Ruby code as you're in a Rails console or IRB.</p><div class="code_container">
<pre><code class="highlight rb"><span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="vi">@posts</span>    <span class="c1"># ruby</span>
<span class="p">[]</span>
<span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="nb">self</span>
<span class="c1">#&lt;PostsController:0x0000000000aeb0&gt;</span>
<span class="p">(</span><span class="n">rdbg</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="(rdbg) @posts    # ruby
[]
(rdbg) self
#&lt;PostsController:0x0000000000aeb0&gt;
(rdbg)
">Copy</button>
</div>
<p>You can also use <code>p</code> or <code>pp</code> command to evaluate Ruby expressions (e.g. when a variable name conflicts with a debugger command).</p><div class="code_container">
<pre><code class="highlight rb"><span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="nb">p</span> <span class="n">headers</span>    <span class="c1"># command</span>
<span class="o">=&gt;</span> <span class="p">{</span><span class="s2">"X-Frame-Options"</span><span class="o">=&gt;</span><span class="s2">"SAMEORIGIN"</span><span class="p">,</span> <span class="s2">"X-XSS-Protection"</span><span class="o">=&gt;</span><span class="s2">"1; mode=block"</span><span class="p">,</span> <span class="s2">"X-Content-Type-Options"</span><span class="o">=&gt;</span><span class="s2">"nosniff"</span><span class="p">,</span> <span class="s2">"X-Download-Options"</span><span class="o">=&gt;</span><span class="s2">"noopen"</span><span class="p">,</span> <span class="s2">"X-Permitted-Cross-Domain-Policies"</span><span class="o">=&gt;</span><span class="s2">"none"</span><span class="p">,</span> <span class="s2">"Referrer-Policy"</span><span class="o">=&gt;</span><span class="s2">"strict-origin-when-cross-origin"</span><span class="p">}</span>
<span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="n">pp</span> <span class="n">headers</span>    <span class="c1"># command</span>
<span class="p">{</span><span class="s2">"X-Frame-Options"</span><span class="o">=&gt;</span><span class="s2">"SAMEORIGIN"</span><span class="p">,</span>
 <span class="s2">"X-XSS-Protection"</span><span class="o">=&gt;</span><span class="s2">"1; mode=block"</span><span class="p">,</span>
 <span class="s2">"X-Content-Type-Options"</span><span class="o">=&gt;</span><span class="s2">"nosniff"</span><span class="p">,</span>
 <span class="s2">"X-Download-Options"</span><span class="o">=&gt;</span><span class="s2">"noopen"</span><span class="p">,</span>
 <span class="s2">"X-Permitted-Cross-Domain-Policies"</span><span class="o">=&gt;</span><span class="s2">"none"</span><span class="p">,</span>
 <span class="s2">"Referrer-Policy"</span><span class="o">=&gt;</span><span class="s2">"strict-origin-when-cross-origin"</span><span class="p">}</span>
<span class="p">(</span><span class="n">rdbg</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='(rdbg) p headers    # command
=&gt; {"X-Frame-Options"=&gt;"SAMEORIGIN", "X-XSS-Protection"=&gt;"1; mode=block", "X-Content-Type-Options"=&gt;"nosniff", "X-Download-Options"=&gt;"noopen", "X-Permitted-Cross-Domain-Policies"=&gt;"none", "Referrer-Policy"=&gt;"strict-origin-when-cross-origin"}
(rdbg) pp headers    # command
{"X-Frame-Options"=&gt;"SAMEORIGIN",
 "X-XSS-Protection"=&gt;"1; mode=block",
 "X-Content-Type-Options"=&gt;"nosniff",
 "X-Download-Options"=&gt;"noopen",
 "X-Permitted-Cross-Domain-Policies"=&gt;"none",
 "Referrer-Policy"=&gt;"strict-origin-when-cross-origin"}
(rdbg)
'>Copy</button>
</div>
<p>Besides direct evaluation, debugger also helps you collect rich amount of information through different commands. Just to name a few here:</p>
<ul>
<li>
<code>info</code> (or <code>i</code>) - Information about current frame.</li>
<li>
<code>backtrace</code> (or <code>bt</code>) - Backtrace (with additional information).</li>
<li>
<code>outline</code> (or <code>o</code>, <code>ls</code>) - Available methods, constants, local variables, and instance variables in the current scope.</li>
</ul>
<h5 id="the-info-command"><a class="anchorlink" href="#the-info-command">3.2.1 The <code>info</code> Command</a></h5><p>It'll give you an overview of the values of local and instance variables that are visible from the current frame.</p><div class="code_container">
<pre><code class="highlight rb"><span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="n">info</span>    <span class="c1"># command</span>
<span class="o">%</span><span class="nb">self</span> <span class="o">=</span> <span class="c1">#&lt;PostsController:0x0000000000af78&gt;</span>
<span class="vi">@_action_has_layout</span> <span class="o">=</span> <span class="kp">true</span>
<span class="vi">@_action_name</span> <span class="o">=</span> <span class="s2">"index"</span>
<span class="vi">@_config</span> <span class="o">=</span> <span class="p">{}</span>
<span class="vi">@_lookup_context</span> <span class="o">=</span> <span class="c1">#&lt;ActionView::LookupContext:0x00007fd91a037e38 @details_key=nil, @digest_cache=...</span>
<span class="vi">@_request</span> <span class="o">=</span> <span class="c1">#&lt;ActionDispatch::Request GET "http://localhost:3000/posts" for 127.0.0.1&gt;</span>
<span class="vi">@_response</span> <span class="o">=</span> <span class="c1">#&lt;ActionDispatch::Response:0x00007fd91a03ea08 @mon_data=#&lt;Monitor:0x00007fd91a03e8c8&gt;...</span>
<span class="vi">@_response_body</span> <span class="o">=</span> <span class="kp">nil</span>
<span class="vi">@_routes</span> <span class="o">=</span> <span class="kp">nil</span>
<span class="vi">@marked_for_same_origin_verification</span> <span class="o">=</span> <span class="kp">true</span>
<span class="vi">@posts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="vi">@rendered_format</span> <span class="o">=</span> <span class="kp">nil</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='(rdbg) info    # command
%self = #&lt;PostsController:0x0000000000af78&gt;
@_action_has_layout = true
@_action_name = "index"
@_config = {}
@_lookup_context = #&lt;ActionView::LookupContext:0x00007fd91a037e38 @details_key=nil, @digest_cache=...
@_request = #&lt;ActionDispatch::Request GET "http://localhost:3000/posts" for 127.0.0.1&gt;
@_response = #&lt;ActionDispatch::Response:0x00007fd91a03ea08 @mon_data=#&lt;Monitor:0x00007fd91a03e8c8&gt;...
@_response_body = nil
@_routes = nil
@marked_for_same_origin_verification = true
@posts = []
@rendered_format = nil
'>Copy</button>
</div>
<h5 id="the-backtrace-command"><a class="anchorlink" href="#the-backtrace-command">3.2.2 The <code>backtrace</code> Command</a></h5><p>When used without any options, it lists all the frames on the stack:</p><div class="code_container">
<pre><code class="highlight rb"><span class="o">=&gt;</span><span class="c1">#0    PostsController#index at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:7</span>
  <span class="c1">#1    ActionController::BasicImplicitRender#send_action(method="index", args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6</span>
  <span class="c1">#2    AbstractController::Base#process_action(method_name="index", args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/abstract_controller/base.rb:214</span>
  <span class="c1">#3    ActionController::Rendering#process_action(#arg_rest=nil) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/rendering.rb:53</span>
  <span class="c1">#4    block in process_action at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/abstract_controller/callbacks.rb:221</span>
  <span class="c1">#5    block in run_callbacks at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activesupport-7.0.0.alpha2/lib/active_support/callbacks.rb:118</span>
  <span class="c1">#6    ActionText::Rendering::ClassMethods#with_renderer(renderer=#&lt;PostsController:0x0000000000af78&gt;) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actiontext-7.0.0.alpha2/lib/action_text/rendering.rb:20</span>
  <span class="c1">#7    block {|controller=#&lt;PostsController:0x0000000000af78&gt;, action=#&lt;Proc:0x00007fd91985f1c0 /Users/st0012/...|} in &lt;class:Engine&gt; (4 levels) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actiontext-7.0.0.alpha2/lib/action_text/engine.rb:69</span>
  <span class="c1">#8    [C] BasicObject#instance_exec at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activesupport-7.0.0.alpha2/lib/active_support/callbacks.rb:127</span>
  <span class="o">.....</span> <span class="ow">and</span> <span class="n">more</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='=&gt;#0    PostsController#index at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:7
  #1    ActionController::BasicImplicitRender#send_action(method="index", args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6
  #2    AbstractController::Base#process_action(method_name="index", args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/abstract_controller/base.rb:214
  #3    ActionController::Rendering#process_action(#arg_rest=nil) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/rendering.rb:53
  #4    block in process_action at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/abstract_controller/callbacks.rb:221
  #5    block in run_callbacks at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activesupport-7.0.0.alpha2/lib/active_support/callbacks.rb:118
  #6    ActionText::Rendering::ClassMethods#with_renderer(renderer=#&lt;PostsController:0x0000000000af78&gt;) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actiontext-7.0.0.alpha2/lib/action_text/rendering.rb:20
  #7    block {|controller=#&lt;PostsController:0x0000000000af78&gt;, action=#&lt;Proc:0x00007fd91985f1c0 /Users/st0012/...|} in &lt;class:Engine&gt; (4 levels) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actiontext-7.0.0.alpha2/lib/action_text/engine.rb:69
  #8    [C] BasicObject#instance_exec at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activesupport-7.0.0.alpha2/lib/active_support/callbacks.rb:127
  ..... and more
'>Copy</button>
</div>
<p>Every frame comes with:</p>
<ul>
<li>Frame identifier</li>
<li>Call location</li>
<li>Additional information (e.g. block or method arguments)</li>
</ul>
<p>This will give you a great sense about what's happening in your app. However, you probably will notice that:</p>
<ul>
<li>There are too many frames (usually 50+ in a Rails app).</li>
<li>Most of the frames are from Rails or other libraries you use.</li>
</ul>
<p>Don't worry, the <code>backtrace</code> command provides 2 options to help you filter frames:</p>
<ul>
<li>
<code>backtrace [num]</code> - only show <code>num</code> numbers of frames, e.g. <code>backtrace 10</code> .</li>
<li>
<code>backtrace /pattern/</code> - only show frames with identifier or location that matches the pattern, e.g. <code>backtrace /MyModel/</code>.</li>
</ul>
<p>It's also possible to use these options together: <code>backtrace [num] /pattern/</code>.</p><h5 id="the-outline-command"><a class="anchorlink" href="#the-outline-command">3.2.3 The <code>outline</code> Command</a></h5><p>This command is similar to <code>pry</code> and <code>irb</code>'s <code>ls</code> command. It will show you what's accessible from the current scope, including:</p>
<ul>
<li>Local variables</li>
<li>Instance variables</li>
<li>Class variables</li>
<li>Methods &amp; their sources</li>
</ul>
<div class="code_container">
<pre><code class="highlight rb"><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Configurable</span><span class="c1">#methods: config</span>
<span class="no">AbstractController</span><span class="o">::</span><span class="no">Base</span><span class="c1">#methods:</span>
  <span class="n">action_methods</span>  <span class="n">action_name</span>  <span class="n">action_name</span><span class="o">=</span>  <span class="n">available_action?</span>  <span class="n">controller_path</span>  <span class="nb">inspect</span>
  <span class="n">response_body</span>
<span class="no">ActionController</span><span class="o">::</span><span class="no">Metal</span><span class="c1">#methods:</span>
  <span class="n">content_type</span>       <span class="n">content_type</span><span class="o">=</span>  <span class="n">controller_name</span>  <span class="n">dispatch</span>          <span class="n">headers</span>
  <span class="n">location</span>           <span class="n">location</span><span class="o">=</span>      <span class="n">media_type</span>       <span class="n">middleware_stack</span>  <span class="n">middleware_stack</span><span class="o">=</span>
  <span class="n">middleware_stack?</span>  <span class="n">performed?</span>     <span class="n">request</span>          <span class="n">request</span><span class="o">=</span>          <span class="n">reset_session</span>
  <span class="n">response</span>           <span class="n">response</span><span class="o">=</span>      <span class="n">response_body</span><span class="o">=</span>   <span class="n">response_code</span>     <span class="n">session</span>
  <span class="n">set_request!</span>       <span class="n">set_response!</span>  <span class="n">status</span>           <span class="n">status</span><span class="o">=</span>           <span class="nb">to_a</span>
<span class="no">ActionView</span><span class="o">::</span><span class="no">ViewPaths</span><span class="c1">#methods:</span>
  <span class="n">_prefixes</span>  <span class="n">any_templates?</span>  <span class="n">append_view_path</span>   <span class="n">details_for_lookup</span>  <span class="n">formats</span>     <span class="n">formats</span><span class="o">=</span>  <span class="n">locale</span>
  <span class="n">locale</span><span class="o">=</span>    <span class="n">lookup_context</span>  <span class="n">prepend_view_path</span>  <span class="n">template_exists?</span>    <span class="n">view_paths</span>
<span class="no">AbstractController</span><span class="o">::</span><span class="no">Rendering</span><span class="c1">#methods: view_assigns</span>

<span class="c1"># .....</span>

<span class="no">PostsController</span><span class="c1">#methods: create  destroy  edit  index  new  show  update</span>
<span class="n">instance</span> <span class="ss">variables:
  </span><span class="vi">@_action_has_layout</span>  <span class="vi">@_action_name</span>    <span class="vi">@_config</span>  <span class="vi">@_lookup_context</span>                      <span class="vi">@_request</span>
  <span class="vi">@_response</span>           <span class="vi">@_response_body</span>  <span class="vi">@_routes</span>  <span class="vi">@marked_for_same_origin_verification</span>  <span class="vi">@posts</span>
  <span class="vi">@rendered_format</span>
<span class="k">class</span> <span class="ss">variables: </span><span class="vc">@@raise_on_missing_translations</span>  <span class="vc">@@raise_on_open_redirects</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="ActiveSupport::Configurable#methods: config
AbstractController::Base#methods:
  action_methods  action_name  action_name=  available_action?  controller_path  inspect
  response_body
ActionController::Metal#methods:
  content_type       content_type=  controller_name  dispatch          headers
  location           location=      media_type       middleware_stack  middleware_stack=
  middleware_stack?  performed?     request          request=          reset_session
  response           response=      response_body=   response_code     session
  set_request!       set_response!  status           status=           to_a
ActionView::ViewPaths#methods:
  _prefixes  any_templates?  append_view_path   details_for_lookup  formats     formats=  locale
  locale=    lookup_context  prepend_view_path  template_exists?    view_paths
AbstractController::Rendering#methods: view_assigns

# .....

PostsController#methods: create  destroy  edit  index  new  show  update
instance variables:
  @_action_has_layout  @_action_name    @_config  @_lookup_context                      @_request
  @_response           @_response_body  @_routes  @marked_for_same_origin_verification  @posts
  @rendered_format
class variables: @@raise_on_missing_translations  @@raise_on_open_redirects
">Copy</button>
</div>
<h4 id="breakpoints"><a class="anchorlink" href="#breakpoints">3.3 Breakpoints</a></h4><p>There are many ways to insert and trigger a breakpoint in the debugger. In addition to adding debugging statements (e.g. <code>debugger</code>) directly in your code, you can also insert breakpoints with commands:</p>
<ul>
<li>
<code>break</code> (or <code>b</code>)

<ul>
<li>
<code>break</code> - list all breakpoints</li>
<li>
<code>break &lt;num&gt;</code> - set a breakpoint on the <code>num</code> line of the current file</li>
<li>
<code>break &lt;file:num&gt;</code> - set a breakpoint on the <code>num</code> line of <code>file</code>
</li>
<li>
<code>break &lt;Class#method&gt;</code> or <code>break &lt;Class.method&gt;</code> - set a breakpoint on <code>Class#method</code> or <code>Class.method</code>
</li>
<li>
<code>break &lt;expr&gt;.&lt;method&gt;</code> - sets a breakpoint on <code>&lt;expr&gt;</code> result's <code>&lt;method&gt;</code> method.</li>
</ul>
</li>
<li>
<code>catch &lt;Exception&gt;</code> - set a breakpoint that'll stop when <code>Exception</code> is raised</li>
<li>
<code>watch &lt;@ivar&gt;</code> - set a breakpoint that'll stop when the result of current object's <code>@ivar</code> is changed (this is slow)</li>
</ul>
<p>And to remove them, you can use:</p>
<ul>
<li>
<code>delete</code> (or <code>del</code>)

<ul>
<li>
<code>delete</code> - delete all breakpoints</li>
<li>
<code>delete &lt;num&gt;</code> - delete the breakpoint with id <code>num</code>
</li>
</ul>
</li>
</ul>
<h5 id="the-break-command"><a class="anchorlink" href="#the-break-command">3.3.1 The <code>break</code> Command</a></h5><p><strong>Set a breakpoint on a specified line number - e.g. <code>b 28</code></strong></p><div class="code_container">
<pre><code class="highlight rb"><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">29</span><span class="p">]</span> <span class="k">in</span> <span class="o">~</span><span class="sr">/projects/</span><span class="n">rails</span><span class="o">-</span><span class="n">guide</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">controllers</span><span class="o">/</span><span class="n">posts_controller</span><span class="p">.</span><span class="nf">rb</span>
    <span class="mi">20</span><span class="o">|</span>   <span class="k">end</span>
    <span class="mi">21</span><span class="o">|</span>
    <span class="mi">22</span><span class="o">|</span>   <span class="c1"># POST /posts or /posts.json</span>
    <span class="mi">23</span><span class="o">|</span>   <span class="k">def</span> <span class="nf">create</span>
    <span class="mi">24</span><span class="o">|</span>     <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">post_params</span><span class="p">)</span>
<span class="o">=&gt;</span>  <span class="mi">25</span><span class="o">|</span>     <span class="n">debugger</span>
    <span class="mi">26</span><span class="o">|</span>
    <span class="mi">27</span><span class="o">|</span>     <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
    <span class="mi">28</span><span class="o">|</span>       <span class="k">if</span> <span class="vi">@post</span><span class="p">.</span><span class="nf">save</span>
    <span class="mi">29</span><span class="o">|</span>         <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">redirect_to</span> <span class="vi">@post</span><span class="p">,</span> <span class="ss">notice: </span><span class="s2">"Post was successfully created."</span> <span class="p">}</span>
<span class="o">=&gt;</span><span class="c1">#0    PostsController#create at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:25</span>
  <span class="c1">#1    ActionController::BasicImplicitRender#send_action(method="create", args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6</span>
  <span class="c1"># and 72 frames (use `bt' command for all frames)</span>
<span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="n">b</span> <span class="mi">28</span>    <span class="c1"># break command</span>
<span class="c1">#0  BP - Line  /Users/st0012/projects/rails-guide-example/app/controllers/posts_controller.rb:28 (line)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="[20, 29] in ~/projects/rails-guide-example/app/controllers/posts_controller.rb
    20|   end
    21|
    22|   # POST /posts or /posts.json
    23|   def create
    24|     @post = Post.new(post_params)
=&gt;  25|     debugger
    26|
    27|     respond_to do |format|
    28|       if @post.save
    29|         format.html { redirect_to @post, notice: &quot;Post was successfully created.&quot; }
=&gt;#0    PostsController#create at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:25
  #1    ActionController::BasicImplicitRender#send_action(method=&quot;create&quot;, args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6
  # and 72 frames (use `bt' command for all frames)
(rdbg) b 28    # break command
#0  BP - Line  /Users/st0012/projects/rails-guide-example/app/controllers/posts_controller.rb:28 (line)
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight rb"><span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="n">c</span>    <span class="c1"># continue command</span>
<span class="p">[</span><span class="mi">23</span><span class="p">,</span> <span class="mi">32</span><span class="p">]</span> <span class="k">in</span> <span class="o">~</span><span class="sr">/projects/</span><span class="n">rails</span><span class="o">-</span><span class="n">guide</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">controllers</span><span class="o">/</span><span class="n">posts_controller</span><span class="p">.</span><span class="nf">rb</span>
    <span class="mi">23</span><span class="o">|</span>   <span class="k">def</span> <span class="nf">create</span>
    <span class="mi">24</span><span class="o">|</span>     <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">post_params</span><span class="p">)</span>
    <span class="mi">25</span><span class="o">|</span>     <span class="n">debugger</span>
    <span class="mi">26</span><span class="o">|</span>
    <span class="mi">27</span><span class="o">|</span>     <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
<span class="o">=&gt;</span>  <span class="mi">28</span><span class="o">|</span>       <span class="k">if</span> <span class="vi">@post</span><span class="p">.</span><span class="nf">save</span>
    <span class="mi">29</span><span class="o">|</span>         <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">redirect_to</span> <span class="vi">@post</span><span class="p">,</span> <span class="ss">notice: </span><span class="s2">"Post was successfully created."</span> <span class="p">}</span>
    <span class="mi">30</span><span class="o">|</span>         <span class="nb">format</span><span class="p">.</span><span class="nf">json</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">:show</span><span class="p">,</span> <span class="ss">status: :created</span><span class="p">,</span> <span class="ss">location: </span><span class="vi">@post</span> <span class="p">}</span>
    <span class="mi">31</span><span class="o">|</span>       <span class="k">else</span>
    <span class="mi">32</span><span class="o">|</span>         <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">:new</span><span class="p">,</span> <span class="ss">status: :unprocessable_entity</span> <span class="p">}</span>
<span class="o">=&gt;</span><span class="c1">#0    block {|format=#&lt;ActionController::MimeResponds::Collec...|} in create at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:28</span>
  <span class="c1">#1    ActionController::MimeResponds#respond_to(mimes=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/mime_responds.rb:205</span>
  <span class="c1"># and 74 frames (use `bt' command for all frames)</span>

<span class="no">Stop</span> <span class="n">by</span> <span class="c1">#0  BP - Line  /Users/st0012/projects/rails-guide-example/app/controllers/posts_controller.rb:28 (line)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="(rdbg) c    # continue command
[23, 32] in ~/projects/rails-guide-example/app/controllers/posts_controller.rb
    23|   def create
    24|     @post = Post.new(post_params)
    25|     debugger
    26|
    27|     respond_to do |format|
=&gt;  28|       if @post.save
    29|         format.html { redirect_to @post, notice: &quot;Post was successfully created.&quot; }
    30|         format.json { render :show, status: :created, location: @post }
    31|       else
    32|         format.html { render :new, status: :unprocessable_entity }
=&gt;#0    block {|format=#&lt;ActionController::MimeResponds::Collec...|} in create at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:28
  #1    ActionController::MimeResponds#respond_to(mimes=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/mime_responds.rb:205
  # and 74 frames (use `bt' command for all frames)

Stop by #0  BP - Line  /Users/st0012/projects/rails-guide-example/app/controllers/posts_controller.rb:28 (line)
">Copy</button>
</div>
<p><strong>Set a breakpoint on a given method call - e.g. <code>b @post.save</code></strong></p><div class="code_container">
<pre><code class="highlight rb"><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">29</span><span class="p">]</span> <span class="k">in</span> <span class="o">~</span><span class="sr">/projects/</span><span class="n">rails</span><span class="o">-</span><span class="n">guide</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">controllers</span><span class="o">/</span><span class="n">posts_controller</span><span class="p">.</span><span class="nf">rb</span>
    <span class="mi">20</span><span class="o">|</span>   <span class="k">end</span>
    <span class="mi">21</span><span class="o">|</span>
    <span class="mi">22</span><span class="o">|</span>   <span class="c1"># POST /posts or /posts.json</span>
    <span class="mi">23</span><span class="o">|</span>   <span class="k">def</span> <span class="nf">create</span>
    <span class="mi">24</span><span class="o">|</span>     <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">post_params</span><span class="p">)</span>
<span class="o">=&gt;</span>  <span class="mi">25</span><span class="o">|</span>     <span class="n">debugger</span>
    <span class="mi">26</span><span class="o">|</span>
    <span class="mi">27</span><span class="o">|</span>     <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
    <span class="mi">28</span><span class="o">|</span>       <span class="k">if</span> <span class="vi">@post</span><span class="p">.</span><span class="nf">save</span>
    <span class="mi">29</span><span class="o">|</span>         <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">redirect_to</span> <span class="vi">@post</span><span class="p">,</span> <span class="ss">notice: </span><span class="s2">"Post was successfully created."</span> <span class="p">}</span>
<span class="o">=&gt;</span><span class="c1">#0    PostsController#create at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:25</span>
  <span class="c1">#1    ActionController::BasicImplicitRender#send_action(method="create", args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6</span>
  <span class="c1"># and 72 frames (use `bt' command for all frames)</span>
<span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="n">b</span> <span class="vi">@post</span><span class="p">.</span><span class="nf">save</span>    <span class="c1"># break command</span>
<span class="c1">#0  BP - Method  @post.save at /Users/st0012/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/suppressor.rb:43</span>

</code></pre>
<button class="clipboard-button" data-clipboard-text="[20, 29] in ~/projects/rails-guide-example/app/controllers/posts_controller.rb
    20|   end
    21|
    22|   # POST /posts or /posts.json
    23|   def create
    24|     @post = Post.new(post_params)
=&gt;  25|     debugger
    26|
    27|     respond_to do |format|
    28|       if @post.save
    29|         format.html { redirect_to @post, notice: &quot;Post was successfully created.&quot; }
=&gt;#0    PostsController#create at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:25
  #1    ActionController::BasicImplicitRender#send_action(method=&quot;create&quot;, args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6
  # and 72 frames (use `bt' command for all frames)
(rdbg) b @post.save    # break command
#0  BP - Method  @post.save at /Users/st0012/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/suppressor.rb:43

">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight rb"><span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="n">c</span>    <span class="c1"># continue command</span>
<span class="p">[</span><span class="mi">39</span><span class="p">,</span> <span class="mi">48</span><span class="p">]</span> <span class="k">in</span> <span class="o">~</span><span class="sr">/.rbenv/</span><span class="n">versions</span><span class="o">/</span><span class="mf">3.0</span><span class="o">.</span><span class="mi">1</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">ruby</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="mf">3.0</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">activerecord</span><span class="o">-</span><span class="mf">7.0</span><span class="o">.</span><span class="mi">0</span><span class="p">.</span><span class="nf">alpha2</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">active_record</span><span class="o">/</span><span class="n">suppressor</span><span class="p">.</span><span class="nf">rb</span>
    <span class="mi">39</span><span class="o">|</span>         <span class="no">SuppressorRegistry</span><span class="p">.</span><span class="nf">suppressed</span><span class="p">[</span><span class="nb">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">previous_state</span>
    <span class="mi">40</span><span class="o">|</span>       <span class="k">end</span>
    <span class="mi">41</span><span class="o">|</span>     <span class="k">end</span>
    <span class="mi">42</span><span class="o">|</span>
    <span class="mi">43</span><span class="o">|</span>     <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="o">**</span><span class="p">)</span> <span class="c1"># :nodoc:</span>
<span class="o">=&gt;</span>  <span class="mi">44</span><span class="o">|</span>       <span class="no">SuppressorRegistry</span><span class="p">.</span><span class="nf">suppressed</span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span><span class="p">]</span> <span class="p">?</span> <span class="kp">true</span> <span class="p">:</span> <span class="k">super</span>
    <span class="mi">45</span><span class="o">|</span>     <span class="k">end</span>
    <span class="mi">46</span><span class="o">|</span>
    <span class="mi">47</span><span class="o">|</span>     <span class="k">def</span> <span class="nf">save!</span><span class="p">(</span><span class="o">**</span><span class="p">)</span> <span class="c1"># :nodoc:</span>
    <span class="mi">48</span><span class="o">|</span>       <span class="no">SuppressorRegistry</span><span class="p">.</span><span class="nf">suppressed</span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span><span class="p">]</span> <span class="p">?</span> <span class="kp">true</span> <span class="p">:</span> <span class="k">super</span>
<span class="o">=&gt;</span><span class="c1">#0    ActiveRecord::Suppressor#save(#arg_rest=nil) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/suppressor.rb:44</span>
  <span class="c1">#1    block {|format=#&lt;ActionController::MimeResponds::Collec...|} in create at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:28</span>
  <span class="c1"># and 75 frames (use `bt' command for all frames)</span>

<span class="no">Stop</span> <span class="n">by</span> <span class="c1">#0  BP - Method  @post.save at /Users/st0012/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/suppressor.rb:43</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="(rdbg) c    # continue command
[39, 48] in ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/suppressor.rb
    39|         SuppressorRegistry.suppressed[name] = previous_state
    40|       end
    41|     end
    42|
    43|     def save(**) # :nodoc:
=&gt;  44|       SuppressorRegistry.suppressed[self.class.name] ? true : super
    45|     end
    46|
    47|     def save!(**) # :nodoc:
    48|       SuppressorRegistry.suppressed[self.class.name] ? true : super
=&gt;#0    ActiveRecord::Suppressor#save(#arg_rest=nil) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/suppressor.rb:44
  #1    block {|format=#&lt;ActionController::MimeResponds::Collec...|} in create at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:28
  # and 75 frames (use `bt' command for all frames)

Stop by #0  BP - Method  @post.save at /Users/st0012/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/suppressor.rb:43
">Copy</button>
</div>
<h5 id="the-catch-command"><a class="anchorlink" href="#the-catch-command">3.3.2 The <code>catch</code> Command</a></h5><p><strong>Stop when an exception is raised - e.g. <code>catch ActiveRecord::RecordInvalid</code></strong></p><div class="code_container">
<pre><code class="highlight rb"><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">29</span><span class="p">]</span> <span class="k">in</span> <span class="o">~</span><span class="sr">/projects/</span><span class="n">rails</span><span class="o">-</span><span class="n">guide</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">controllers</span><span class="o">/</span><span class="n">posts_controller</span><span class="p">.</span><span class="nf">rb</span>
    <span class="mi">20</span><span class="o">|</span>   <span class="k">end</span>
    <span class="mi">21</span><span class="o">|</span>
    <span class="mi">22</span><span class="o">|</span>   <span class="c1"># POST /posts or /posts.json</span>
    <span class="mi">23</span><span class="o">|</span>   <span class="k">def</span> <span class="nf">create</span>
    <span class="mi">24</span><span class="o">|</span>     <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">post_params</span><span class="p">)</span>
<span class="o">=&gt;</span>  <span class="mi">25</span><span class="o">|</span>     <span class="n">debugger</span>
    <span class="mi">26</span><span class="o">|</span>
    <span class="mi">27</span><span class="o">|</span>     <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
    <span class="mi">28</span><span class="o">|</span>       <span class="k">if</span> <span class="vi">@post</span><span class="p">.</span><span class="nf">save!</span>
    <span class="mi">29</span><span class="o">|</span>         <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">redirect_to</span> <span class="vi">@post</span><span class="p">,</span> <span class="ss">notice: </span><span class="s2">"Post was successfully created."</span> <span class="p">}</span>
<span class="o">=&gt;</span><span class="c1">#0    PostsController#create at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:25</span>
  <span class="c1">#1    ActionController::BasicImplicitRender#send_action(method="create", args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6</span>
  <span class="c1"># and 72 frames (use `bt' command for all frames)</span>
<span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="kp">catch</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">RecordInvalid</span>    <span class="c1"># command</span>
<span class="c1">#1  BP - Catch  "ActiveRecord::RecordInvalid"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="[20, 29] in ~/projects/rails-guide-example/app/controllers/posts_controller.rb
    20|   end
    21|
    22|   # POST /posts or /posts.json
    23|   def create
    24|     @post = Post.new(post_params)
=&gt;  25|     debugger
    26|
    27|     respond_to do |format|
    28|       if @post.save!
    29|         format.html { redirect_to @post, notice: &quot;Post was successfully created.&quot; }
=&gt;#0    PostsController#create at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:25
  #1    ActionController::BasicImplicitRender#send_action(method=&quot;create&quot;, args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6
  # and 72 frames (use `bt' command for all frames)
(rdbg) catch ActiveRecord::RecordInvalid    # command
#1  BP - Catch  &quot;ActiveRecord::RecordInvalid&quot;
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight rb"><span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="n">c</span>    <span class="c1"># continue command</span>
<span class="p">[</span><span class="mi">75</span><span class="p">,</span> <span class="mi">84</span><span class="p">]</span> <span class="k">in</span> <span class="o">~</span><span class="sr">/.rbenv/</span><span class="n">versions</span><span class="o">/</span><span class="mf">3.0</span><span class="o">.</span><span class="mi">1</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">ruby</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="mf">3.0</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">activerecord</span><span class="o">-</span><span class="mf">7.0</span><span class="o">.</span><span class="mi">0</span><span class="p">.</span><span class="nf">alpha2</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">active_record</span><span class="o">/</span><span class="n">validations</span><span class="p">.</span><span class="nf">rb</span>
    <span class="mi">75</span><span class="o">|</span>     <span class="k">def</span> <span class="nf">default_validation_context</span>
    <span class="mi">76</span><span class="o">|</span>       <span class="n">new_record?</span> <span class="p">?</span> <span class="ss">:create</span> <span class="p">:</span> <span class="ss">:update</span>
    <span class="mi">77</span><span class="o">|</span>     <span class="k">end</span>
    <span class="mi">78</span><span class="o">|</span>
    <span class="mi">79</span><span class="o">|</span>     <span class="k">def</span> <span class="nf">raise_validation_error</span>
<span class="o">=&gt;</span>  <span class="mi">80</span><span class="o">|</span>       <span class="k">raise</span><span class="p">(</span><span class="no">RecordInvalid</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nb">self</span><span class="p">))</span>
    <span class="mi">81</span><span class="o">|</span>     <span class="k">end</span>
    <span class="mi">82</span><span class="o">|</span>
    <span class="mi">83</span><span class="o">|</span>     <span class="k">def</span> <span class="nf">perform_validations</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="p">{})</span>
    <span class="mi">84</span><span class="o">|</span>       <span class="n">options</span><span class="p">[</span><span class="ss">:validate</span><span class="p">]</span> <span class="o">==</span> <span class="kp">false</span> <span class="o">||</span> <span class="n">valid?</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="ss">:context</span><span class="p">])</span>
<span class="o">=&gt;</span><span class="c1">#0    ActiveRecord::Validations#raise_validation_error at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb:80</span>
  <span class="c1">#1    ActiveRecord::Validations#save!(options={}) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb:53</span>
  <span class="c1"># and 88 frames (use `bt' command for all frames)</span>

<span class="no">Stop</span> <span class="n">by</span> <span class="c1">#1  BP - Catch  "ActiveRecord::RecordInvalid"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="(rdbg) c    # continue command
[75, 84] in ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb
    75|     def default_validation_context
    76|       new_record? ? :create : :update
    77|     end
    78|
    79|     def raise_validation_error
=&gt;  80|       raise(RecordInvalid.new(self))
    81|     end
    82|
    83|     def perform_validations(options = {})
    84|       options[:validate] == false || valid?(options[:context])
=&gt;#0    ActiveRecord::Validations#raise_validation_error at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb:80
  #1    ActiveRecord::Validations#save!(options={}) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb:53
  # and 88 frames (use `bt' command for all frames)

Stop by #1  BP - Catch  &quot;ActiveRecord::RecordInvalid&quot;
">Copy</button>
</div>
<h5 id="the-watch-command"><a class="anchorlink" href="#the-watch-command">3.3.3 The <code>watch</code> Command</a></h5><p><strong>Stop when the instance variable is changed - e.g. <code>watch @_response_body</code></strong></p><div class="code_container">
<pre><code class="highlight rb"><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">29</span><span class="p">]</span> <span class="k">in</span> <span class="o">~</span><span class="sr">/projects/</span><span class="n">rails</span><span class="o">-</span><span class="n">guide</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">controllers</span><span class="o">/</span><span class="n">posts_controller</span><span class="p">.</span><span class="nf">rb</span>
    <span class="mi">20</span><span class="o">|</span>   <span class="k">end</span>
    <span class="mi">21</span><span class="o">|</span>
    <span class="mi">22</span><span class="o">|</span>   <span class="c1"># POST /posts or /posts.json</span>
    <span class="mi">23</span><span class="o">|</span>   <span class="k">def</span> <span class="nf">create</span>
    <span class="mi">24</span><span class="o">|</span>     <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">post_params</span><span class="p">)</span>
<span class="o">=&gt;</span>  <span class="mi">25</span><span class="o">|</span>     <span class="n">debugger</span>
    <span class="mi">26</span><span class="o">|</span>
    <span class="mi">27</span><span class="o">|</span>     <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
    <span class="mi">28</span><span class="o">|</span>       <span class="k">if</span> <span class="vi">@post</span><span class="p">.</span><span class="nf">save!</span>
    <span class="mi">29</span><span class="o">|</span>         <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">redirect_to</span> <span class="vi">@post</span><span class="p">,</span> <span class="ss">notice: </span><span class="s2">"Post was successfully created."</span> <span class="p">}</span>
<span class="o">=&gt;</span><span class="c1">#0    PostsController#create at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:25</span>
  <span class="c1">#1    ActionController::BasicImplicitRender#send_action(method="create", args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6</span>
  <span class="c1"># and 72 frames (use `bt' command for all frames)</span>
<span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="n">watch</span> <span class="vi">@_response_body</span>    <span class="c1"># command</span>
<span class="c1">#0  BP - Watch  #&lt;PostsController:0x00007fce69ca5320&gt; @_response_body =</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="[20, 29] in ~/projects/rails-guide-example/app/controllers/posts_controller.rb
    20|   end
    21|
    22|   # POST /posts or /posts.json
    23|   def create
    24|     @post = Post.new(post_params)
=&gt;  25|     debugger
    26|
    27|     respond_to do |format|
    28|       if @post.save!
    29|         format.html { redirect_to @post, notice: &quot;Post was successfully created.&quot; }
=&gt;#0    PostsController#create at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:25
  #1    ActionController::BasicImplicitRender#send_action(method=&quot;create&quot;, args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6
  # and 72 frames (use `bt' command for all frames)
(rdbg) watch @_response_body    # command
#0  BP - Watch  #&lt;PostsController:0x00007fce69ca5320&gt; @_response_body =
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight rb"><span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="n">c</span>    <span class="c1"># continue command</span>
<span class="p">[</span><span class="mi">173</span><span class="p">,</span> <span class="mi">182</span><span class="p">]</span> <span class="k">in</span> <span class="o">~</span><span class="sr">/.rbenv/</span><span class="n">versions</span><span class="o">/</span><span class="mf">3.0</span><span class="o">.</span><span class="mi">1</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">ruby</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="mf">3.0</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">actionpack</span><span class="o">-</span><span class="mf">7.0</span><span class="o">.</span><span class="mi">0</span><span class="p">.</span><span class="nf">alpha2</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">action_controller</span><span class="o">/</span><span class="n">metal</span><span class="p">.</span><span class="nf">rb</span>
   <span class="mi">173</span><span class="o">|</span>       <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="n">body</span><span class="p">]</span> <span class="k">unless</span> <span class="n">body</span><span class="p">.</span><span class="nf">nil?</span> <span class="o">||</span> <span class="n">body</span><span class="p">.</span><span class="nf">respond_to?</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span>
   <span class="mi">174</span><span class="o">|</span>       <span class="n">response</span><span class="p">.</span><span class="nf">reset_body!</span>
   <span class="mi">175</span><span class="o">|</span>       <span class="k">return</span> <span class="k">unless</span> <span class="n">body</span>
   <span class="mi">176</span><span class="o">|</span>       <span class="n">response</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="n">body</span>
   <span class="mi">177</span><span class="o">|</span>       <span class="k">super</span>
<span class="o">=&gt;</span> <span class="mi">178</span><span class="o">|</span>     <span class="k">end</span>
   <span class="mi">179</span><span class="o">|</span>
   <span class="mi">180</span><span class="o">|</span>     <span class="c1"># Tests if render or redirect has already happened.</span>
   <span class="mi">181</span><span class="o">|</span>     <span class="k">def</span> <span class="nf">performed?</span>
   <span class="mi">182</span><span class="o">|</span>       <span class="n">response_body</span> <span class="o">||</span> <span class="n">response</span><span class="p">.</span><span class="nf">committed?</span>
<span class="o">=&gt;</span><span class="c1">#0    ActionController::Metal#response_body=(body=["&lt;html&gt;&lt;body&gt;You are being &lt;a href=\"ht...) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal.rb:178 #=&gt; ["&lt;html&gt;&lt;body&gt;You are being &lt;a href=\"ht...</span>
  <span class="c1">#1    ActionController::Redirecting#redirect_to(options=#&lt;Post id: 13, title: "qweqwe", content:..., response_options={:allow_other_host=&gt;false}) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/redirecting.rb:74</span>
  <span class="c1"># and 82 frames (use `bt' command for all frames)</span>

<span class="no">Stop</span> <span class="n">by</span> <span class="c1">#0  BP - Watch  #&lt;PostsController:0x00007fce69ca5320&gt; @_response_body =  -&gt; ["&lt;html&gt;&lt;body&gt;You are being &lt;a href=\"http://localhost:3000/posts/13\"&gt;redirected&lt;/a&gt;.&lt;/body&gt;&lt;/html&gt;"]</span>
<span class="p">(</span><span class="n">rdbg</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="(rdbg) c    # continue command
[173, 182] in ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal.rb
   173|       body = [body] unless body.nil? || body.respond_to?(:each)
   174|       response.reset_body!
   175|       return unless body
   176|       response.body = body
   177|       super
=&gt; 178|     end
   179|
   180|     # Tests if render or redirect has already happened.
   181|     def performed?
   182|       response_body || response.committed?
=&gt;#0    ActionController::Metal#response_body=(body=[&quot;&lt;html&gt;&lt;body&gt;You are being &lt;a href=\&quot;ht...) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal.rb:178 #=&gt; [&quot;&lt;html&gt;&lt;body&gt;You are being &lt;a href=\&quot;ht...
  #1    ActionController::Redirecting#redirect_to(options=#&lt;Post id: 13, title: &quot;qweqwe&quot;, content:..., response_options={:allow_other_host=&gt;false}) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/redirecting.rb:74
  # and 82 frames (use `bt' command for all frames)

Stop by #0  BP - Watch  #&lt;PostsController:0x00007fce69ca5320&gt; @_response_body =  -&gt; [&quot;&lt;html&gt;&lt;body&gt;You are being &lt;a href=\&quot;http://localhost:3000/posts/13\&quot;&gt;redirected&lt;/a&gt;.&lt;/body&gt;&lt;/html&gt;&quot;]
(rdbg)
">Copy</button>
</div>
<h5 id="breakpoint-options"><a class="anchorlink" href="#breakpoint-options">3.3.4 Breakpoint Options</a></h5><p>In addition to different types of breakpoints, you can also specify options to achieve more advanced debugging workflow. Currently, the debugger supports 4 options:</p>
<ul>
<li>
<code>do: &lt;cmd or expr&gt;</code> - when the breakpoint is triggered, execute the given command/expression and continue the program:

<ul>
<li>
<code>break Foo#bar do: bt</code> - when <code>Foo#bar</code> is called, print the stack frames</li>
</ul>
</li>
<li>
<code>pre: &lt;cmd or expr&gt;</code> - when the breakpoint is triggered, execute the given command/expression before stopping:

<ul>
<li>
<code>break Foo#bar pre: info</code> - when <code>Foo#bar</code> is called, print its surrounding variables before stopping.</li>
</ul>
</li>
<li>
<code>if: &lt;expr&gt;</code> - the breakpoint only stops if the result of <code>&lt;expr</code>&gt; is true:

<ul>
<li>
<code>break Post#save if: params[:debug]</code> - stops at <code>Post#save</code> if <code>params[:debug]</code> is also true</li>
</ul>
</li>
<li>
<code>path: &lt;path_regexp&gt;</code> - the breakpoint only stops if the event that triggers it (e.g. a method call) happens from the given path:

<ul>
<li>
<code>break Post#save if: app/services/a_service</code> - stops at <code>Post#save</code> if the method call happens at a method matches Ruby regexp <code>/app\/services\/a_service/</code>.</li>
</ul>
</li>
</ul>
<p>Please also note that the first 3 options: <code>do:</code>, <code>pre:</code> and <code>if:</code> are also available for the debug statements we mentioned earlier. For example:</p><div class="code_container">
<pre><code class="highlight rb"><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="k">in</span> <span class="o">~</span><span class="sr">/projects/</span><span class="n">rails</span><span class="o">-</span><span class="n">guide</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">controllers</span><span class="o">/</span><span class="n">posts_controller</span><span class="p">.</span><span class="nf">rb</span>
     <span class="mi">2</span><span class="o">|</span>   <span class="n">before_action</span> <span class="ss">:set_post</span><span class="p">,</span> <span class="ss">only: </span><span class="sx">%i[ show edit update destroy ]</span>
     <span class="mi">3</span><span class="o">|</span>
     <span class="mi">4</span><span class="o">|</span>   <span class="c1"># GET /posts or /posts.json</span>
     <span class="mi">5</span><span class="o">|</span>   <span class="k">def</span> <span class="nf">index</span>
     <span class="mi">6</span><span class="o">|</span>     <span class="vi">@posts</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">all</span>
<span class="o">=&gt;</span>   <span class="mi">7</span><span class="o">|</span>     <span class="n">debugger</span><span class="p">(</span><span class="ss">do: </span><span class="s2">"info"</span><span class="p">)</span>
     <span class="mi">8</span><span class="o">|</span>   <span class="k">end</span>
     <span class="mi">9</span><span class="o">|</span>
    <span class="mi">10</span><span class="o">|</span>   <span class="c1"># GET /posts/1 or /posts/1.json</span>
    <span class="mi">11</span><span class="o">|</span>   <span class="k">def</span> <span class="nf">show</span>
<span class="o">=&gt;</span><span class="c1">#0    PostsController#index at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:7</span>
  <span class="c1">#1    ActionController::BasicImplicitRender#send_action(method="index", args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6</span>
  <span class="c1"># and 72 frames (use `bt' command for all frames)</span>
<span class="p">(</span><span class="n">rdbg</span><span class="ss">:binding</span><span class="p">.</span><span class="nf">break</span><span class="p">)</span> <span class="n">info</span>
<span class="o">%</span><span class="nb">self</span> <span class="o">=</span> <span class="c1">#&lt;PostsController:0x00000000017480&gt;</span>
<span class="vi">@_action_has_layout</span> <span class="o">=</span> <span class="kp">true</span>
<span class="vi">@_action_name</span> <span class="o">=</span> <span class="s2">"index"</span>
<span class="vi">@_config</span> <span class="o">=</span> <span class="p">{}</span>
<span class="vi">@_lookup_context</span> <span class="o">=</span> <span class="c1">#&lt;ActionView::LookupContext:0x00007fce3ad336b8 @details_key=nil, @digest_cache=...</span>
<span class="vi">@_request</span> <span class="o">=</span> <span class="c1">#&lt;ActionDispatch::Request GET "http://localhost:3000/posts" for 127.0.0.1&gt;</span>
<span class="vi">@_response</span> <span class="o">=</span> <span class="c1">#&lt;ActionDispatch::Response:0x00007fce3ad397e8 @mon_data=#&lt;Monitor:0x00007fce3ad396a8&gt;...</span>
<span class="vi">@_response_body</span> <span class="o">=</span> <span class="kp">nil</span>
<span class="vi">@_routes</span> <span class="o">=</span> <span class="kp">nil</span>
<span class="vi">@marked_for_same_origin_verification</span> <span class="o">=</span> <span class="kp">true</span>
<span class="vi">@posts</span> <span class="o">=</span> <span class="c1">#&lt;ActiveRecord::Relation [#&lt;Post id: 2, title: "qweqwe", content: "qweqwe", created_at: "...</span>
<span class="vi">@rendered_format</span> <span class="o">=</span> <span class="kp">nil</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="[2, 11] in ~/projects/rails-guide-example/app/controllers/posts_controller.rb
     2|   before_action :set_post, only: %i[ show edit update destroy ]
     3|
     4|   # GET /posts or /posts.json
     5|   def index
     6|     @posts = Post.all
=&gt;   7|     debugger(do: &quot;info&quot;)
     8|   end
     9|
    10|   # GET /posts/1 or /posts/1.json
    11|   def show
=&gt;#0    PostsController#index at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:7
  #1    ActionController::BasicImplicitRender#send_action(method=&quot;index&quot;, args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6
  # and 72 frames (use `bt' command for all frames)
(rdbg:binding.break) info
%self = #&lt;PostsController:0x00000000017480&gt;
@_action_has_layout = true
@_action_name = &quot;index&quot;
@_config = {}
@_lookup_context = #&lt;ActionView::LookupContext:0x00007fce3ad336b8 @details_key=nil, @digest_cache=...
@_request = #&lt;ActionDispatch::Request GET &quot;http://localhost:3000/posts&quot; for 127.0.0.1&gt;
@_response = #&lt;ActionDispatch::Response:0x00007fce3ad397e8 @mon_data=#&lt;Monitor:0x00007fce3ad396a8&gt;...
@_response_body = nil
@_routes = nil
@marked_for_same_origin_verification = true
@posts = #&lt;ActiveRecord::Relation [#&lt;Post id: 2, title: &quot;qweqwe&quot;, content: &quot;qweqwe&quot;, created_at: &quot;...
@rendered_format = nil
">Copy</button>
</div>
<h5 id="program-your-debugging-workflow"><a class="anchorlink" href="#program-your-debugging-workflow">3.3.5 Program Your Debugging Workflow</a></h5><p>With those options, you can script your debugging workflow in one line like:</p><div class="code_container">
<pre><code class="highlight rb"><span class="k">def</span> <span class="nf">create</span>
  <span class="n">debugger</span><span class="p">(</span><span class="ss">do: </span><span class="s2">"catch ActiveRecord::RecordInvalid do: bt 10"</span><span class="p">)</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='def create
  debugger(do: "catch ActiveRecord::RecordInvalid do: bt 10")
  # ...
end
'>Copy</button>
</div>
<p>And then the debugger will run the scripted command and insert the catch breakpoint</p><div class="code_container">
<pre><code class="highlight rb"><span class="p">(</span><span class="n">rdbg</span><span class="ss">:binding</span><span class="p">.</span><span class="nf">break</span><span class="p">)</span> <span class="kp">catch</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">RecordInvalid</span> <span class="ss">do: </span><span class="n">bt</span> <span class="mi">10</span>
<span class="c1">#0  BP - Catch  "ActiveRecord::RecordInvalid"</span>
<span class="p">[</span><span class="mi">75</span><span class="p">,</span> <span class="mi">84</span><span class="p">]</span> <span class="k">in</span> <span class="o">~</span><span class="sr">/.rbenv/</span><span class="n">versions</span><span class="o">/</span><span class="mf">3.0</span><span class="o">.</span><span class="mi">1</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">ruby</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="mf">3.0</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">activerecord</span><span class="o">-</span><span class="mf">7.0</span><span class="o">.</span><span class="mi">0</span><span class="p">.</span><span class="nf">alpha2</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">active_record</span><span class="o">/</span><span class="n">validations</span><span class="p">.</span><span class="nf">rb</span>
    <span class="mi">75</span><span class="o">|</span>     <span class="k">def</span> <span class="nf">default_validation_context</span>
    <span class="mi">76</span><span class="o">|</span>       <span class="n">new_record?</span> <span class="p">?</span> <span class="ss">:create</span> <span class="p">:</span> <span class="ss">:update</span>
    <span class="mi">77</span><span class="o">|</span>     <span class="k">end</span>
    <span class="mi">78</span><span class="o">|</span>
    <span class="mi">79</span><span class="o">|</span>     <span class="k">def</span> <span class="nf">raise_validation_error</span>
<span class="o">=&gt;</span>  <span class="mi">80</span><span class="o">|</span>       <span class="k">raise</span><span class="p">(</span><span class="no">RecordInvalid</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nb">self</span><span class="p">))</span>
    <span class="mi">81</span><span class="o">|</span>     <span class="k">end</span>
    <span class="mi">82</span><span class="o">|</span>
    <span class="mi">83</span><span class="o">|</span>     <span class="k">def</span> <span class="nf">perform_validations</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="p">{})</span>
    <span class="mi">84</span><span class="o">|</span>       <span class="n">options</span><span class="p">[</span><span class="ss">:validate</span><span class="p">]</span> <span class="o">==</span> <span class="kp">false</span> <span class="o">||</span> <span class="n">valid?</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="ss">:context</span><span class="p">])</span>
<span class="o">=&gt;</span><span class="c1">#0    ActiveRecord::Validations#raise_validation_error at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb:80</span>
  <span class="c1">#1    ActiveRecord::Validations#save!(options={}) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb:53</span>
  <span class="c1"># and 88 frames (use `bt' command for all frames)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="(rdbg:binding.break) catch ActiveRecord::RecordInvalid do: bt 10
#0  BP - Catch  &quot;ActiveRecord::RecordInvalid&quot;
[75, 84] in ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb
    75|     def default_validation_context
    76|       new_record? ? :create : :update
    77|     end
    78|
    79|     def raise_validation_error
=&gt;  80|       raise(RecordInvalid.new(self))
    81|     end
    82|
    83|     def perform_validations(options = {})
    84|       options[:validate] == false || valid?(options[:context])
=&gt;#0    ActiveRecord::Validations#raise_validation_error at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb:80
  #1    ActiveRecord::Validations#save!(options={}) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb:53
  # and 88 frames (use `bt' command for all frames)
">Copy</button>
</div>
<p>Once the catch breakpoint is triggered, it'll print the stack frames</p><div class="code_container">
<pre><code class="highlight rb"><span class="no">Stop</span> <span class="n">by</span> <span class="c1">#0  BP - Catch  "ActiveRecord::RecordInvalid"</span>

<span class="p">(</span><span class="n">rdbg</span><span class="ss">:catch</span><span class="p">)</span> <span class="n">bt</span> <span class="mi">10</span>
<span class="o">=&gt;</span><span class="c1">#0    ActiveRecord::Validations#raise_validation_error at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb:80</span>
  <span class="c1">#1    ActiveRecord::Validations#save!(options={}) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb:53</span>
  <span class="c1">#2    block in save! at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/transactions.rb:302</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='Stop by #0  BP - Catch  "ActiveRecord::RecordInvalid"

(rdbg:catch) bt 10
=&gt;#0    ActiveRecord::Validations#raise_validation_error at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb:80
  #1    ActiveRecord::Validations#save!(options={}) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb:53
  #2    block in save! at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/transactions.rb:302
'>Copy</button>
</div>
<p>This technique can save you from repeated manual input and make the debugging experience smoother.</p><p>You can find more commands and configuration options from its <a href="https://github.com/ruby/debug">documentation</a>.</p><h5 id="autoloading-caveat"><a class="anchorlink" href="#autoloading-caveat">3.3.6 Autoloading Caveat</a></h5><p>Debugging with <code>debug</code> works fine most of the time, but there's an edge case: If you evaluate an expression in the console that autoloads a namespace defined in a file, constants in that namespace won't be found.</p><p>For example, if the application has these two files:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># hotel.rb</span>
<span class="k">class</span> <span class="nc">Hotel</span>
<span class="k">end</span>

<span class="c1"># hotel/pricing.rb</span>
<span class="k">module</span> <span class="nn">Hotel::Pricing</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="# hotel.rb
class Hotel
end

# hotel/pricing.rb
module Hotel::Pricing
end
">Copy</button>
</div>
<p>and <code>Hotel</code> is not yet loaded, then</p><div class="code_container">
<pre><code class="highlight plaintext">(rdbg) p Hotel::Pricing
</code></pre>
<button class="clipboard-button" data-clipboard-text="(rdbg) p Hotel::Pricing
">Copy</button>
</div>
<p>will raise a <code>NameError</code>. In some cases, Ruby will be able to resolve an unintended constant in a different scope.</p><p>If you hit this, please restart your debugging session with eager loading enabled (<code>config.eager_load = true</code>).</p><p>Stepping commands line <code>next</code>, <code>continue</code>, etc., do not present this issue. Namespaces defined implicitly only by
subdirectories are not subject to this issue either.</p><p>See <a href="https://github.com/ruby/debug/issues/408">ruby/debug#408</a> for details.</p><h3 id="debug-com-a-gem-web-console"><a class="anchorlink" href="#debug-com-a-gem-web-console">4 Debug com a Gem <code>web-console</code></a></h3><p>A <em>gem</em> Web Console é um pouco semelhante à <em>gem</em> <code>debug</code>, porém é executada no navegador. Em qualquer página você pode solicitar um <code>console</code> no contexto da <em>view</em> ou do <em>controller</em>. O <em>console</em> deve ser renderizado próximo ao conteúdo HTML.</p><h4 id="console"><a class="anchorlink" href="#console">4.1 Console</a></h4><p>Dentro de qualquer <em>controller action</em> ou <em>view</em>, você pode utilizar o console através da chamada do método <code>console</code>.</p><p>Por exemplo, em um <em>controller</em>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">PostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">new</span>
    <span class="n">console</span>
    <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class PostsController &lt; ApplicationController
  def new
    console
    @post = Post.new
  end
end
">Copy</button>
</div>
<p>Ou em uma <em>view</em>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%</span> <span class="n">console</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;h2&gt;</span>New Post<span class="nt">&lt;/h2&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;% console %&gt;

&lt;h2&gt;New Post&lt;/h2&gt;
">Copy</button>
</div>
<p>Isso vai renderizar um <em>console</em> dentro da view. Você não precisa se preocupar com a localização da chamada do método <code>console</code>; não será renderizado próximo ao elemento em que foi invocado, mas sim próximo ao seu conteúdo HTML.</p><p>O <em>console</em> executa código Ruby nativo: Você pode definir e instanciar classes personalizadas, criar novos <em>models</em>, e inspecionar variáveis.</p><div class="note"><p>Somente um <em>console</em> pode ser renderizado por <em>request</em>. De outra maneira <code>web-console</code> lança um erro na segunda invocação do método <code>console</code>.</p></div><h4 id="inspecionando-variáveis"><a class="anchorlink" href="#inspecionando-vari%C3%A1veis">4.2 Inspecionando Variáveis</a></h4><p>Você pode chamar <code>instance_variables</code> para listar todas as variáveis de instância disponíveis em seu contexto. Se você deseja listar todas as variáveis locais, você pode fazer isso usando <code>local_variables</code>.</p><h4 id="configurações"><a class="anchorlink" href="#configura%C3%A7%C3%B5es">4.3 Configurações</a></h4>
<ul>
<li>
<code>config.web_console.allowed_ips</code>: Lista autorizada de endereços e redes IPv4 ou IPv6 (padrões: <code>127.0.0.1/8, ::1</code>).</li>
<li>
<code>config.web_console.whiny_requests</code>: Registra uma mensagem quando a renderização do <em>console</em> é impedida (padrões: <code>true</code>).</li>
</ul>
<p>Uma vez que <code>web-console</code> avalia código Ruby simples remotamente no servidor, não tente usar em produção.</p><h3 id="debug-de-vazamentos-de-memórias"><a class="anchorlink" href="#debug-de-vazamentos-de-mem%C3%B3rias">5 Debug de Vazamentos de Memórias</a></h3><p>Um aplicativo Ruby (on Rails ou não) pode vazar memória (<em>memory leak</em>) - tanto no código Ruby
quanto no nível de código C.</p><p>Nesta seção, você aprenderá como encontrar e corrigir esses vazamentos usando ferramentas
tais como o Valgrind.</p><h4 id="valgrind"><a class="anchorlink" href="#valgrind">5.1 Valgrind</a></h4><p><a href="http://valgrind.org/">Valgrind</a> é um aplicativo para detectar vazamentos de memória baseados em C
e condições de corrida.</p><p>Existem ferramentas Valgrind que podem detectar automaticamente muitos bugs de threading 
e gerenciamento de memória, e criar perfis de seus programas em detalhes. Por exemplo, se uma extensão 
C no intérprete chama <code>malloc()</code> mas não chama corretamente 
<code>free()</code>, essa memória não estará disponível até que o aplicativo seja encerrado.</p><p>Para obter mais informações sobre como instalar o Valgrind e usar com Ruby, consulte
<a href="https://blog.evanweaver.com/2008/02/05/valgrind-and-ruby/">Valgrind and Ruby</a>
por Evan Weaver.</p><h4 id="encontrando-um-vazamento-de-memória"><a class="anchorlink" href="#encontrando-um-vazamento-de-mem%C3%B3ria">5.2 Encontrando um vazamento de memória</a></h4><p>Há um excelente artigo (em inglês) sobre detecção e correção de vazamentos de memória no Derailed, <a href="https://github.com/schneems/derailed_benchmarks#is-my-app-leaking-memory">que você pode ler aqui</a>.</p><h3 id="plugins-para-debug"><a class="anchorlink" href="#plugins-para-debug">6 Plugins para <em>Debug</em></a></h3><p>Existem alguns plugins Rails para te ajudar a procurar erros e <em>debugar</em> a aplicação. Aqui está uma lista de plugins úteis para <em>debug</em>:</p>
<ul>
<li>
<a href="https://github.com/ruckus/active-record-query-trace/tree/master">Query Trace</a> Adiciona rastreamento de origem de consulta aos seus logs.</li>
<li>
<a href="https://github.com/smartinez87/exception_notification/tree/master">Exception Notifier</a>
Fornece um objeto <em>mailer</em> e um conjunto padrão de <em>templates</em> para enviar notificações por email quando ocorrerem erros em um aplicativo Rails.</li>
<li>
<a href="https://github.com/charliesome/better_errors">Better Errors</a> Substitui a página de erro padrão do Rails por uma nova contendo mais informações contextuais, como código-fonte e inspeção de variáveis.</li>
<li>
<a href="https://github.com/dejan/rails_panel">RailsPanel</a> extensão do Chrome para desenvolvimento Rails que encerrerá seu acompanhamento de development.log. Tenha todas as informações sobre as solicitações do seu aplicativo Rails no navegador - no painel Ferramentas do desenvolvedor. Fornece informações sobre db / renderização / tempos totais, lista de parâmetros, visualizações renderizadas e muito mais.</li>
<li>
<a href="https://github.com/pry/pry">Pry</a> Uma alternativa IRB e console de desenvolvedor em tempo de execução.</li>
</ul>
<h3 id="referencias"><a class="anchorlink" href="#referencias">7 Referencias</a></h3>
<ul>
<li><a href="https://github.com/rails/web-console">web-console Homepage</a></li>
<li><a href="https://github.com/ruby/debug">debug homepage</a></li>
</ul>


        <h3>Feedback</h3>
        <p>
          Você é incentivado a ajudar a melhorar a qualidade deste guia.
        </p>
        <p>
          Por favor, contribua caso veja quaisquer erros, inclusive erros de digitação.
          Para começar, você pode ler nossa sessão de <a href="https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">contribuindo com a documentação</a>.
        </p>
        <p>
          Você também pode encontrar conteúdo incompleto ou coisas que não estão atualizadas.
          Por favor, adicione qualquer documentação em falta na main do Rails. Certifique-se de checar o
          <a href="http://edgeguides.rubyonrails.org">Edge Guides (en-US)</a> primeiro para verificar
          se o problema já foi resolvido ou não no branch main.
          Verifique as <a href="ruby_on_rails_guides_guidelines.html">Diretrizes do Guia Ruby on Rails</a>
          para estilo e convenções.
        </p>
        <p>
          Se, por qualquer motivo, você encontrar algo para consertar, mas não conseguir consertá-lo, por favor
          <a href="https://github.com/campuscode/rails-guides-pt-BR/issues">abra uma issue no nosso Guia</a>.
        </p>
        <p>
          E por último, mas não menos importante, qualquer tipo de discussão sobre a documentação do Ruby on Rails
          é muito bem vinda na <a href="https://discuss.rubyonrails.org/c/rubyonrails-docs">forum oficial do Ruby on Rails</a> e nas
          <a href="https://github.com/campuscode/rails-guides-pt-BR/issues">issues do Guia em português</a>.
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p> Este projeto está licenciado sob uma licença <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International</a></p>
<p>"Rails", "Ruby on Rails", e o logotipo Rails são marcas comerciais de David Heinemeier Hansson. Todos os direitos reservados.</p>

    </div>
  </div>
  <div id="toggle">
    <img alt="dark theme icon" class="icon">
  </div>
</body>
</html>

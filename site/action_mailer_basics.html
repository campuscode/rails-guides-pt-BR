<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Começando a usar Action Mailer — Ruby on Rails Guides</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
  <link rel="stylesheet" type="text/css" href="stylesheets/highlight.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/search.css" data-turbolinks-track="reload">
  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
  <script src="javascripts/turbolinks.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/clipboard.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/guides.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/search.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/lunr-documents.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/lunr.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/toggle-theme.js" data-turbolinks-track="reload"></script>
  <meta property="og:title" content="Começando a usar Action Mailer — Ruby on Rails Guides" />
  <meta name="description" content="Começando a usar Action MailerEste guia provê todos os conhecimentos que você precisa para iniciar a enviar e-mails da sua aplicação e outros conhecimentos de como as coisas funcionam internamente. do Action Mailer. Ele também ensina como testar seus mailers.Após a leitura deste guia, você saberá: Como enviar um e-mail usando sua aplicação Rails; Como gerar e editar uma classe Action Mailer e uma mailer view; Como configurar o Action Mailer para o seu ambiente; Como Testar suas classes do Action Mailer." />
  <meta property="og:description" content="Começando a usar Action MailerEste guia provê todos os conhecimentos que você precisa para iniciar a enviar e-mails da sua aplicação e outros conhecimentos de como as coisas funcionam internamente. do Action Mailer. Ele também ensina como testar seus mailers.Após a leitura deste guia, você saberá: Como enviar um e-mail usando sua aplicação Rails; Como gerar e editar uma classe Action Mailer e uma mailer view; Como configurar o Action Mailer para o seu ambiente; Como Testar suas classes do Action Mailer." />
  <meta property="og:locale" content="pt_BR" />
  <meta property="og:site_name" content="Guia Ruby on Rails" />
  <meta property="og:image" content="https://avatars.githubusercontent.com/u/4223" />
  <meta property="og:type" content="website" />
</head>
<body class="guide">
  <div>
    <div id="version-badge">v6.1.4</div>
  </div>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">Veja mais em <a href="https://rubyonrails.org/">rubyonrails.org:</a> </strong>
      <span class="red-button more-info-button">
        Mais Ruby on Rails
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://weblog.rubyonrails.org/">Blog</a></li>
        <li class="more-info"><a href="https://guides.rubyonrails.org/">Guia oficial</a></li>
        <li class="more-info"><a href="https://api.rubyonrails.org/">API</a></li>
        <li class="more-info"><a href="https://discuss.rubyonrails.org/">Forum</a></li>
        <li class="more-info"><a href="https://github.com/rails/rails">Contribua no GitHub</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="Voltar para a página principal">Guiarails.com.br</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">Home</a></li>
        <li class="guides-search guides-search-large">
          <input class="search-box search-box-large nav-item" type="text" placeholder="Digite o termo...">
          <div class="search-results"></div>
          <div class="search-spinner">Aguarde...</div>
        </li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">Guias</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
            <dl class="guides-section-container">
                <div class="guides-section">
                  <dt>Comece aqui</dt>
                  <dd><a href="getting_started.html">Começando com Rails</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Models</dt>
                  <dd><a href="active_record_basics.html">Active Record Basics</a></dd>
                  <dd><a href="active_record_migrations.html">Active Record Migrations</a></dd>
                  <dd><a href="active_record_validations.html">Active Record Validations</a></dd>
                  <dd><a href="active_record_callbacks.html">Active Record Callbacks</a></dd>
                  <dd><a href="association_basics.html">Active Record Associations</a></dd>
                  <dd><a href="active_record_querying.html">Active Record Query Interface</a></dd>
                  <dd><a href="active_model_basics.html">Active Model Basics</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Views</dt>
                  <dd><a href="action_view_overview.html">Action View Overview</a></dd>
                  <dd><a href="layouts_and_rendering.html">Layouts and Rendering in Rails</a></dd>
                  <dd><a href="action_view_helpers.html">Action View Helpers</a></dd>
                  <dd><a href="form_helpers.html">Action View Form Helpers</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Controllers</dt>
                  <dd><a href="action_controller_overview.html">Action Controller Overview</a></dd>
                  <dd><a href="routing.html">Rails Routing from the Outside In</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Outros componentes</dt>
                  <dd><a href="active_support_core_extensions.html">Active Support Core Extensions</a></dd>
                  <dd><a href="action_mailer_basics.html">Action Mailer Basics</a></dd>
                  <dd><a href="action_mailbox_basics.html">Action Mailbox Basics</a></dd>
                  <dd><a href="action_text_overview.html">Action Text Overview</a></dd>
                  <dd><a href="active_job_basics.html">Active Job Basics</a></dd>
                  <dd><a href="active_storage_overview.html">Active Storage Overview</a></dd>
                  <dd><a href="action_cable_overview.html">Action Cable Overview</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Indo mais fundo</dt>
                  <dd><a href="i18n.html">Rails Internationalization (I18n) API</a></dd>
                  <dd><a href="testing.html">Testing Rails Applications</a></dd>
                  <dd><a href="security.html">Securing Rails Applications</a></dd>
                  <dd><a href="debugging_rails_applications.html">Debugging Rails Applications</a></dd>
                  <dd><a href="configuring.html">Configuring Rails Applications</a></dd>
                  <dd><a href="command_line.html">The Rails Command Line</a></dd>
                  <dd><a href="asset_pipeline.html">The Asset Pipeline</a></dd>
                  <dd><a href="working_with_javascript_in_rails.html">Working with JavaScript in Rails</a></dd>
                  <dd><a href="initialization.html">The Rails Initialization Process</a></dd>
                  <dd><a href="autoloading_and_reloading_constants.html">Autoloading and Reloading Constants (Zeitwerk Mode)</a></dd>
                  <dd><a href="autoloading_and_reloading_constants_classic_mode.html">Autoloading and Reloading Constants (Classic Mode)</a></dd>
                  <dd><a href="caching_with_rails.html">Caching with Rails: An Overview</a></dd>
                  <dd><a href="active_support_instrumentation.html">Active Support Instrumentation</a></dd>
                  <dd><a href="api_app.html">Using Rails for API-only Applications</a></dd>
                  <dd><a href="active_record_postgresql.html">Active Record and PostgreSQL</a></dd>
                  <dd><a href="active_record_multiple_databases.html">Multiple Databases with Active Record</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Estendendo o Rails</dt>
                  <dd><a href="plugins.html">The Basics of Creating Rails Plugins</a></dd>
                  <dd><a href="rails_on_rack.html">Rails on Rack</a></dd>
                  <dd><a href="generators.html">Creating and Customizing Rails Generators &amp; Templates</a></dd>
                  <dd><a href="engines.html">Getting Started with Engines</a></dd>
                  <dd><a href="threading_and_code_execution.html">Threading and Code Execution in Rails</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Contribuições</dt>
                  <dd><a href="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails</a></dd>
                  <dd><a href="api_documentation_guidelines.html">API Documentation Guidelines</a></dd>
                  <dd><a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Políticas</dt>
                  <dd><a href="maintenance_policy.html">Maintenance Policy for Ruby on Rails</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Release Notes</dt>
                  <dd><a href="upgrading_ruby_on_rails.html">Upgrading Ruby on Rails</a></dd>
                  <dd><a href="6_1_release_notes.html">Version 6.1 - Dezembro 2020</a></dd>
                  <dd><a href="6_0_release_notes.html">Version 6.0 - Agosto 2019</a></dd>
                  <dd><a href="5_2_release_notes.html">Version 5.2 - April 2018</a></dd>
                  <dd><a href="5_1_release_notes.html">Version 5.1 - April 2017</a></dd>
                  <dd><a href="5_0_release_notes.html">Version 5.0 - June 2016</a></dd>
                  <dd><a href="4_2_release_notes.html">Version 4.2 - December 2014</a></dd>
                  <dd><a href="4_1_release_notes.html">Version 4.1 - April 2014</a></dd>
                  <dd><a href="4_0_release_notes.html">Version 4.0 - June 2013</a></dd>
                  <dd><a href="3_2_release_notes.html">Version 3.2 - January 2012</a></dd>
                  <dd><a href="3_1_release_notes.html">Version 3.1 - August 2011</a></dd>
                  <dd><a href="3_0_release_notes.html">Version 3.0 - August 2010</a></dd>
                  <dd><a href="2_3_release_notes.html">Version 2.3 - March 2009</a></dd>
                  <dd><a href="2_2_release_notes.html">Version 2.2 - November 2008</a></dd>
                </div>
            </div>
          </dl>
        </li>
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">Contribua</a></li>
        <li class="guides-search guides-search-small">
          <input class="search-box search-box-small nav-item" type="text" placeholder="Digite o termo...">
          <div class="search-results"></div>
          <div class="search-spinner">Aguarde...</div>
        </li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">Guias</option>
              <optgroup label="Comece aqui">
                  <option value="getting_started.html">Começando com Rails</option>
              </optgroup>
              <optgroup label="Models">
                  <option value="active_record_basics.html">Active Record Basics</option>
                  <option value="active_record_migrations.html">Active Record Migrations</option>
                  <option value="active_record_validations.html">Active Record Validations</option>
                  <option value="active_record_callbacks.html">Active Record Callbacks</option>
                  <option value="association_basics.html">Active Record Associations</option>
                  <option value="active_record_querying.html">Active Record Query Interface</option>
                  <option value="active_model_basics.html">Active Model Basics</option>
              </optgroup>
              <optgroup label="Views">
                  <option value="action_view_overview.html">Action View Overview</option>
                  <option value="layouts_and_rendering.html">Layouts and Rendering in Rails</option>
                  <option value="action_view_helpers.html">Action View Helpers</option>
                  <option value="form_helpers.html">Action View Form Helpers</option>
              </optgroup>
              <optgroup label="Controllers">
                  <option value="action_controller_overview.html">Action Controller Overview</option>
                  <option value="routing.html">Rails Routing from the Outside In</option>
              </optgroup>
              <optgroup label="Outros componentes">
                  <option value="active_support_core_extensions.html">Active Support Core Extensions</option>
                  <option value="action_mailer_basics.html">Action Mailer Basics</option>
                  <option value="action_mailbox_basics.html">Action Mailbox Basics</option>
                  <option value="action_text_overview.html">Action Text Overview</option>
                  <option value="active_job_basics.html">Active Job Basics</option>
                  <option value="active_storage_overview.html">Active Storage Overview</option>
                  <option value="action_cable_overview.html">Action Cable Overview</option>
              </optgroup>
              <optgroup label="Indo mais fundo">
                  <option value="i18n.html">Rails Internationalization (I18n) API</option>
                  <option value="testing.html">Testing Rails Applications</option>
                  <option value="security.html">Securing Rails Applications</option>
                  <option value="debugging_rails_applications.html">Debugging Rails Applications</option>
                  <option value="configuring.html">Configuring Rails Applications</option>
                  <option value="command_line.html">The Rails Command Line</option>
                  <option value="asset_pipeline.html">The Asset Pipeline</option>
                  <option value="working_with_javascript_in_rails.html">Working with JavaScript in Rails</option>
                  <option value="initialization.html">The Rails Initialization Process</option>
                  <option value="autoloading_and_reloading_constants.html">Autoloading and Reloading Constants (Zeitwerk Mode)</option>
                  <option value="autoloading_and_reloading_constants_classic_mode.html">Autoloading and Reloading Constants (Classic Mode)</option>
                  <option value="caching_with_rails.html">Caching with Rails: An Overview</option>
                  <option value="active_support_instrumentation.html">Active Support Instrumentation</option>
                  <option value="api_app.html">Using Rails for API-only Applications</option>
                  <option value="active_record_postgresql.html">Active Record and PostgreSQL</option>
                  <option value="active_record_multiple_databases.html">Multiple Databases with Active Record</option>
              </optgroup>
              <optgroup label="Estendendo o Rails">
                  <option value="plugins.html">The Basics of Creating Rails Plugins</option>
                  <option value="rails_on_rack.html">Rails on Rack</option>
                  <option value="generators.html">Creating and Customizing Rails Generators &amp; Templates</option>
                  <option value="engines.html">Getting Started with Engines</option>
                  <option value="threading_and_code_execution.html">Threading and Code Execution in Rails</option>
              </optgroup>
              <optgroup label="Contribuições">
                  <option value="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails</option>
                  <option value="api_documentation_guidelines.html">API Documentation Guidelines</option>
                  <option value="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</option>
              </optgroup>
              <optgroup label="Políticas">
                  <option value="maintenance_policy.html">Maintenance Policy for Ruby on Rails</option>
              </optgroup>
              <optgroup label="Release Notes">
                  <option value="upgrading_ruby_on_rails.html">Upgrading Ruby on Rails</option>
                  <option value="6_1_release_notes.html">Version 6.1 - Dezembro 2020</option>
                  <option value="6_0_release_notes.html">Version 6.0 - Agosto 2019</option>
                  <option value="5_2_release_notes.html">Version 5.2 - April 2018</option>
                  <option value="5_1_release_notes.html">Version 5.1 - April 2017</option>
                  <option value="5_0_release_notes.html">Version 5.0 - June 2016</option>
                  <option value="4_2_release_notes.html">Version 4.2 - December 2014</option>
                  <option value="4_1_release_notes.html">Version 4.1 - April 2014</option>
                  <option value="4_0_release_notes.html">Version 4.0 - June 2013</option>
                  <option value="3_2_release_notes.html">Version 3.2 - January 2012</option>
                  <option value="3_1_release_notes.html">Version 3.1 - August 2011</option>
                  <option value="3_0_release_notes.html">Version 3.0 - August 2010</option>
                  <option value="2_3_release_notes.html">Version 2.3 - March 2009</option>
                  <option value="2_2_release_notes.html">Version 2.2 - November 2008</option>
              </optgroup>
          </select>
        </li>
      </ul>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Começando a usar <em>Action Mailer</em></h2><p>Este guia provê todos os conhecimentos que você precisa para iniciar
a enviar e-mails da sua aplicação e outros conhecimentos de como as coisas
funcionam internamente.
do <em>Action Mailer</em>. Ele também ensina como testar seus <em>mailers</em>.</p><p>Após a leitura deste guia, você saberá:</p>
<ul>
<li>Como enviar um e-mail usando sua aplicação Rails;</li>
<li>Como gerar e editar uma classe <em>Action Mailer</em> e uma <em>mailer view</em>;</li>
<li>Como configurar o <em>Action Mailer</em> para o seu ambiente;</li>
<li>Como Testar suas classes do <em>Action Mailer</em>.</li>
</ul>


                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li><a href="#o-que-e-o-action-mailer-questionmark">O que é o <em>Action Mailer</em>?</a></li>
<li>
<a href="#enviando-e-mails">Enviando E-mails</a>

<ul>
<li><a href="#passo-a-passo-para-gerar-um-mailer">Passo a Passo para Gerar um <em>Mailer</em></a></li>
<li><a href="#codificacao-automatica">Codificação automática</a></li>
<li><a href="#lista-completa-de-metodos-do-action-mailer">Lista Completa de Métodos do <em>Action Mailer</em></a></li>
<li><a href="#views-de-mailer"><em>Views</em> de <em>Mailer</em></a></li>
<li><a href="#layouts-de-action-mailer"><em>Layouts de Action Mailer</em></a></li>
<li><a href="#pre-visualizando-emails">Pré-visualizando Emails</a></li>
<li><a href="#gerando-urls-no-action-mailer-views">Gerando URLs no Action Mailer Views</a></li>
<li><a href="#adicionando-imagens-no-action-mailer-views">Adicionando imagens no Action Mailer Views</a></li>
<li><a href="#enviando-emails-multipart">Enviando Emails <em>Multipart</em></a></li>
<li><a href="#enviando-emails-com-opcoes-de-entrega-dinamicas">Enviando Emails com Opções de Entrega Dinâmicas</a></li>
<li><a href="#enviando-emails-sem-renderizar-um-template">Enviando Emails sem Renderizar um <em>Template</em></a></li>
</ul>
</li>
<li><a href="#callbacks-do-action-mailer">Callbacks do <em>Action Mailer</em></a></li>
<li><a href="#usando-os-helpers-do-action-mailer">Usando os <em>helpers</em> do <em>Action Mailer</em></a></li>
<li>
<a href="#configuracao-do-action-mailer">Configuração do <em>Action Mailer</em></a>

<ul>
<li><a href="#exemplo-de-configuracao-do-action-mailer">Exemplo de configuração do <em>Action Mailer</em></a></li>
<li><a href="#configuracao-do-action-mailer-para-gmail">Configuração do <em>Action Mailer</em> para Gmail</a></li>
</ul>
</li>
<li><a href="#testes-de-mailer">Testes de <em>Mailer</em></a></li>
<li>
<a href="#interceptando-e-observando-emails">Interceptando e Observando Emails</a>

<ul>
<li><a href="#interceptando-emails">Interceptando Emails</a></li>
<li><a href="#observando-emails">Observando Emails</a></li>
</ul>
</li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h3 id="o-que-e-o-action-mailer-questionmark"><a class="anchorlink" href="#o-que-e-o-action-mailer-questionmark">1 O que é o <em>Action Mailer</em>?</a></h3><p><em>Action Mailer</em> permite que você envie emails direto da sua aplicação usando as
classes e <em>Mailer views</em></p><h5 id="mailers-sao-semelhantes-a-controllers"><a class="anchorlink" href="#mailers-sao-semelhantes-a-controllers">1.1 <em>Mailers</em> são semelhantes a controllers</a></h5><p>Eles herdam do <code>ActionMailer::Base</code> e se encontram na <code>app/mailers</code>. Os Mailers também funcionam de maneira muito semelhante aos controllers. Alguns exemplos de semelhanças são mostrados abaixo.
Mailers tem:</p>
<ul>
<li>
<em>Actions</em>, e também, <em>views</em> associadas que aparecem em <code>app/views</code>.</li>
<li>Variáveis de instância acessíveis nas <em>views</em>.</li>
<li>A capacidade de utilizar <em>layouts</em> e <em>partials</em>.</li>
<li>A capacidade de acessar um hash de parâmetros.</li>
</ul>
<h3 id="enviando-e-mails"><a class="anchorlink" href="#enviando-e-mails">2 Enviando E-mails</a></h3><p>Esta seção irá te guiar no processo de criação de um <em>Mailer</em> e sua <em>view</em>.</p><h4 id="passo-a-passo-para-gerar-um-mailer"><a class="anchorlink" href="#passo-a-passo-para-gerar-um-mailer">2.1 Passo a Passo para Gerar um <em>Mailer</em></a></h4><h5 id="criando-um-mailer"><a class="anchorlink" href="#criando-um-mailer">2.1.1 Criando um <em>Mailer</em></a></h5><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate mailer User
<span class="go">create  app/mailers/user_mailer.rb
create  app/mailers/application_mailer.rb
invoke  erb
create    app/views/user_mailer
create    app/views/layouts/mailer.text.erb
create    app/views/layouts/mailer.html.erb
invoke  test_unit
create    test/mailers/user_mailer_test.rb
create    test/mailers/previews/user_mailer_preview.rb
</span></code></pre>
<textarea class="clipboard-content" id="clipboard-b6cb07b208280c5fcc830c56d18a68d9">bin/rails generate mailer User
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-b6cb07b208280c5fcc830c56d18a68d9">Copiar</button>
</div>
<div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># app/mailers/application_mailer.rb</span>
<span class="k">class</span> <span class="nc">ApplicationMailer</span> <span class="o">&lt;</span> <span class="no">ActionMailer</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">default</span> <span class="ss">from: </span><span class="s2">"para@exemplo.com"</span>
  <span class="n">layout</span> <span class="s1">'mailer'</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-b6a4cbe7495aefa3c02d45f2084af39c"># app/mailers/application_mailer.rb
class ApplicationMailer &lt; ActionMailer::Base
  default from: "para@exemplo.com"
  layout 'mailer'
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-b6a4cbe7495aefa3c02d45f2084af39c">Copiar</button>
</div>
<div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># app/mailers/user_mailer.rb</span>
<span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-9c59a85efef54ed629dda94293b08ef0"># app/mailers/user_mailer.rb
class UserMailer &lt; ApplicationMailer
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-9c59a85efef54ed629dda94293b08ef0">Copiar</button>
</div>
<p>Como pôde ver no exemplo acima, você pode gerar <em>mailers</em> como faz com outros tipos de arquivos no Rails.</p><p>Se você prefere não usar um <em>generator</em>, você pode criar esses arquivos por si só dentro de <code>app/mailers/</code>, só não se esqueça de adicionar a herança com <code>ActionMailer::Base</code> aos <em>mailers</em>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">MyMailer</span> <span class="o">&lt;</span> <span class="no">ActionMailer</span><span class="o">::</span><span class="no">Base</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-adac5bc232af6958baf6b6191430bce0">class MyMailer &lt; ActionMailer::Base
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-adac5bc232af6958baf6b6191430bce0">Copiar</button>
</div>
<h5 id="editando-o-mailer"><a class="anchorlink" href="#editando-o-mailer">2.1.2 Editando o <em>Mailer</em></a></h5><p><em>Mailers</em> têm métodos chamados <em>actions</em> e usam <em>views</em> para estruturar seu conteúdo.
Onde um <em>controller</em> gera conteúdo como HTML para enviar de volta à um cliente, o <em>Mailer</em> cria uma mensagem para ser entregue por e-mail.</p><p><code>app/mailers/user_mailer.rb</code> contém um <em>mailer</em> vazio:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-4400f67acd4f1d898faa899b45eea442">class UserMailer &lt; ApplicationMailer
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-4400f67acd4f1d898faa899b45eea442">Copiar</button>
</div>
<p>Vamos adicionar um método chamado <code>welcome_email</code>, que enviará um e-mail para o endereço de e-mail registrado pelo usuário.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="n">default</span> <span class="ss">from: </span><span class="s1">'notificacoes@exemplo.com'</span>

  <span class="k">def</span> <span class="nf">welcome_email</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">]</span>
    <span class="vi">@url</span>  <span class="o">=</span> <span class="s1">'http://exemplo.com/login'</span>
    <span class="n">mail</span><span class="p">(</span><span class="ss">to: </span><span class="vi">@user</span><span class="p">.</span><span class="nf">email</span><span class="p">,</span> <span class="ss">subject: </span><span class="s1">'Boas vindas ao nosso incrível site!'</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-4b93b1941a02d5003319fff85788c604">class UserMailer &lt; ApplicationMailer
  default from: 'notificacoes@exemplo.com'

  def welcome_email
    @user = params[:user]
    @url  = 'http://exemplo.com/login'
    mail(to: @user.email, subject: 'Boas vindas ao nosso incrível site!')
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-4b93b1941a02d5003319fff85788c604">Copiar</button>
</div>
<p>Uma breve explicação sobre os itens apresentados no método acima. Para uma lista completa de todas as opções disponíveis, por favor, dê uma olhada mais abaixo na seção: Lista completa de atributos de configuração do <em>Action Mailer</em>.</p>
<ul>
<li>
<code>default Hash</code> — Está é a <em>Hash</em> padrão com valores que serão usados em todos os e-mail enviados por este <em>mailer</em>. Neste exemplo nós configuramos o <code>:from</code> (Remetente, quem envia) para um valor padrão que será usado em todas as mensagens enviadas por está classe. Está configuração pode ser sobrescrita.</li>
<li>
<code>mail</code> — O próprio e-mail, aqui nós estamos passando os parâmetros <code>:to</code> (Destinatário, quem recebe) e <code>:subject</code> (Assunto do e-mail) ao cabeçalho.</li>
</ul>
<h5 id="criando-uma-view-para-nosso-mailer"><a class="anchorlink" href="#criando-uma-view-para-nosso-mailer">2.1.3 Criando uma <em>View</em> para nosso <em>Mailer</em></a></h5><p>Crie um arquivo com o nome <code>welcome_email.html.erb</code> em <code>app/views/user_mailer/</code>. Este será o modelo que usaremos para nosso e-mail, formatado usando HTML:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">content=</span><span class="s">'text/html; charset=UTF-8'</span> <span class="na">http-equiv=</span><span class="s">'Content-Type'</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Boas vindas ao site exemplo.com, <span class="cp">&lt;%=</span> <span class="vi">@user</span><span class="p">.</span><span class="nf">name</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      Você concluiu seu cadastro com sucesso,
      seu nome de usuário é: <span class="cp">&lt;%=</span> <span class="vi">@user</span><span class="p">.</span><span class="nf">login</span> <span class="cp">%&gt;</span>.<span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      Para iniciar sua seção no site clique no link a seguir: <span class="cp">&lt;%=</span> <span class="vi">@url</span> <span class="cp">%&gt;</span>.
    <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>Agradecemos por se juntar à nós! Tenha um ótimo dia!<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-df554a084d97bbe2ccdb9dbcbba0cc99">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta content='text/html; charset=UTF-8' http-equiv='Content-Type' /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Boas vindas ao site exemplo.com, &lt;%= @user.name %&gt;&lt;/h1&gt;
    &lt;p&gt;
      Você concluiu seu cadastro com sucesso,
      seu nome de usuário é: &lt;%= @user.login %&gt;.&lt;br&gt;
    &lt;/p&gt;
    &lt;p&gt;
      Para iniciar sua seção no site clique no link a seguir: &lt;%= @url %&gt;.
    &lt;/p&gt;
    &lt;p&gt;Agradecemos por se juntar à nós! Tenha um ótimo dia!&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-df554a084d97bbe2ccdb9dbcbba0cc99">Copiar</button>
</div>
<p>Vamos criar também um modelo usando somente texto para este e-mail. Nem todos os programas de e-mail leem HTML, então enviar os dois formatos é uma boa prática. Para isto criaremos um arquivo com o nome <code>welcome_email.text.erb</code> em <code>app/views/user_mailer/</code>:</p><div class="code_container">
<pre><code class="highlight erb">Boas vindas ao site exemplo.com, <span class="cp">&lt;%=</span> <span class="vi">@user</span><span class="p">.</span><span class="nf">name</span> <span class="cp">%&gt;</span>
===============================================

Você concluiu seu cadastro com sucesso,
seu nome de usuário é: <span class="cp">&lt;%=</span> <span class="vi">@user</span><span class="p">.</span><span class="nf">login</span> <span class="cp">%&gt;</span>.

Para iniciar sua seção no site clique no link a seguir: <span class="cp">&lt;%=</span> <span class="vi">@url</span> <span class="cp">%&gt;</span>.

Agradecemos por se juntar à nós! Tenha um ótimo dia!
</code></pre>
<textarea class="clipboard-content" id="clipboard-41a75c7813e79a662c0acbcba7c5cb00">Boas vindas ao site exemplo.com, &lt;%= @user.name %&gt;
===============================================

Você concluiu seu cadastro com sucesso,
seu nome de usuário é: &lt;%= @user.login %&gt;.

Para iniciar sua seção no site clique no link a seguir: &lt;%= @url %&gt;.

Agradecemos por se juntar à nós! Tenha um ótimo dia!
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-41a75c7813e79a662c0acbcba7c5cb00">Copiar</button>
</div>
<p>Quando você chamar o método <code>mail</code>, <code>ActionMailer</code> detectará que existem dois modelos para esse e-mail (Um em HTML e outro somente texto) e automaticamente irá gerar um <code>multipart/alternative</code> (Opção que indica ao programa de e-mail que essa mensagem tem uma versão em HTML e outra em somente texto) e-mail.</p><h5 id="chamando-o-mailer"><a class="anchorlink" href="#chamando-o-mailer">2.1.4 Chamando o <em>Mailer</em></a></h5><p><em>Mailers</em> são somente outra maneira de renderizar uma <em>view</em>. Ao invés de renderizar uma
<em>view</em> e envia-la usando o protocolo HTTP, um <em>Mailer</em> envia através
dos protocolos de e-mail. Por esse motivo, faz sentido, para o exemplo anterior, que o
<em>controller</em> informe ao <em>mailer</em> para enviar uma mensagem assim que um usuário complete seu cadastro com sucesso.</p><p>Configurar isto é muito simples.</p><p>Primeiro, criaremos um <em>scaffold</em> (esqueleto) para nosso <em>model</em> <code>User</code>:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate scaffold user name e-mail login
<span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>db:migrate
</code></pre>
<textarea class="clipboard-content" id="clipboard-7265a19c9e915f5252bbde35e04901e8">bin/rails generate scaffold user name e-mail login
bin/rails db:migrate
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-7265a19c9e915f5252bbde35e04901e8">Copiar</button>
</div>
<p>Agora que já temos o <em>model</em> para nossos usuários, podemos começar a criar a funcionalidade. Para isso vamos editar o arquivo <code>app/controllers/users_controller.rb</code> para chamar o <code>UserMailer</code> para enviar um e-mail ao novo usuário registrado. Vamos editar a <em>action</em> <code>create</code> inserindo a seguinte chamada: <code>UserMailer.with(user: @user).welcome_email</code> logo após o usuário ter sido salvo com sucesso.</p><p><em>Action Mailer</em> já é nativamente integrado com o <em>Active Job</em>, logo você pode enviar os e-mails fora do ciclo requisição-resposta, então o usuário não precisa aguardar esse processo terminar para continuar usando a aplicação.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="c1"># POST /users</span>
  <span class="c1"># POST /users.json</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">])</span>

    <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
      <span class="k">if</span> <span class="vi">@user</span><span class="p">.</span><span class="nf">save</span>
        <span class="c1"># Diz ao UserMailer para enviar o _welcome e-mail_ caso o usuário seja salvo</span>
        <span class="no">UserMailer</span><span class="p">.</span><span class="nf">with</span><span class="p">(</span><span class="ss">user: </span><span class="vi">@user</span><span class="p">).</span><span class="nf">welcome_email</span><span class="p">.</span><span class="nf">deliver_later</span>

        <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">redirect_to</span><span class="p">(</span><span class="vi">@user</span><span class="p">,</span> <span class="ss">notice: </span><span class="s1">'Usuário foi criado com sucesso.'</span><span class="p">)</span> <span class="p">}</span>
        <span class="nb">format</span><span class="p">.</span><span class="nf">json</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">json: </span><span class="vi">@user</span><span class="p">,</span> <span class="ss">status: :created</span><span class="p">,</span> <span class="ss">location: </span><span class="vi">@user</span> <span class="p">}</span>
      <span class="k">else</span>
        <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">action: </span><span class="s1">'new'</span> <span class="p">}</span>
        <span class="nb">format</span><span class="p">.</span><span class="nf">json</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">json: </span><span class="vi">@user</span><span class="p">.</span><span class="nf">errors</span><span class="p">,</span> <span class="ss">status: :unprocessable_entity</span> <span class="p">}</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-84aed8e11d2a2e0fed1b02ab35093731">class UsersController &lt; ApplicationController
  # POST /users
  # POST /users.json
  def create
    @user = User.new(params[:user])

    respond_to do |format|
      if @user.save
        # Diz ao UserMailer para enviar o _welcome e-mail_ caso o usuário seja salvo
        UserMailer.with(user: @user).welcome_email.deliver_later

        format.html { redirect_to(@user, notice: 'Usuário foi criado com sucesso.') }
        format.json { render json: @user, status: :created, location: @user }
      else
        format.html { render action: 'new' }
        format.json { render json: @user.errors, status: :unprocessable_entity }
      end
    end
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-84aed8e11d2a2e0fed1b02ab35093731">Copiar</button>
</div>
<div class="note"><p>O comportamento padrão do <em>Active Job</em> é executar os serviços de maneira assíncrona, usando o adaptador <code>:async</code>. Então você pode usar o método <code>deliver_later</code> para enviar os e-mail de maneira assíncrona.
O adaptador padrão do <em>Active Job</em> executa os serviços em um processo <em>Thread Pool</em>. Está abordagem é boa para os ambientes de desenvolvimento e teste, pois não requerem nenhuma infraestrutura externa/complexa, porém é uma abordagem ruim para o ambiente de produção, pois caso o sistema seja reiniciado você pode perder os registros desses serviços.
Se você precisar de uma solução para que esses serviços sejam persistidos, de modo a evitar possíveis perdas, você precisará de um serviço a parte que tenha essa funcionalidade, exemplos: Sidekiq, Resque etc.</p></div><p>Se você deseja que os e-mail sejam enviados no mesmo tempo que chamar o <em>Mailer</em>, simplesmente chame <code>deliver_now</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">SendWeeklySummary</span>
  <span class="k">def</span> <span class="nf">run</span>
    <span class="no">User</span><span class="p">.</span><span class="nf">find_each</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span>
      <span class="no">UserMailer</span><span class="p">.</span><span class="nf">with</span><span class="p">(</span><span class="ss">user: </span><span class="n">user</span><span class="p">).</span><span class="nf">weekly_summary</span><span class="p">.</span><span class="nf">deliver_now</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-0c6315b06488390f7fe69f1f164fe41a">class SendWeeklySummary
  def run
    User.find_each do |user|
      UserMailer.with(user: user).weekly_summary.deliver_now
    end
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-0c6315b06488390f7fe69f1f164fe41a">Copiar</button>
</div>
<p>Qualquer chave-valor passado para o <code>with</code> se torna parte da <em>Hash</em> <code>params</code> que será usado na <em>action</em> do <em>Mailer</em>. Então <code>with(user: @user, account: @user.account)</code> cria <code>params[:user]</code> e <code>params[:account]</code> disponíveis na <em>action</em> do <em>Mailer</em>. Como acontece nos <em>controllers</em> que também tem <code>params</code>.</p><p>O método <code>welcome_email</code> tem como retorno um objeto do tipo <code>ActionMailer::MessageDelivery</code> que você pode encadear os métodos <code>deliver_now</code> ou <code>deliver_later</code> para assim ele se enviar como um e-mail.
O objeto <code>ActionMailer::MessageDelivery</code> é um <em>wrapper</em> (Embrulho) para a classe <code>Mail::Message</code>. Se você quiser inspecionar, alterar, ou fazer qualquer coisa com o objeto <code>Mail::Message</code> você pode acessa-lo através do método <code>message</code> do objeto <code>ActionMailer::MessageDelivery</code>.</p><h4 id="codificacao-automatica"><a class="anchorlink" href="#codificacao-automatica">2.2 Codificação automática</a></h4><p><em>Action Mailer</em> gerencia automaticamente a codificação de caracteres <em>multibytes</em> (Caracteres asiáticos, emojis etc) dentro do cabeçalho e corpo.</p><p>Para exemplos mais complexos como definir uma lista alternativa de caracteres ou codificar o texto de maneira diferente, use essa biblioteca como referência: <a href="https://github.com/mikel/mail">Mail</a>.</p><h4 id="lista-completa-de-metodos-do-action-mailer"><a class="anchorlink" href="#lista-completa-de-metodos-do-action-mailer">2.3 Lista Completa de Métodos do <em>Action Mailer</em></a></h4><p>Existem apenas três métodos que você precisa para enviar qualquer mensagem de e-mail:</p>
<ul>
<li>
<code>headers</code> — Especifica qualquer cabeçalho no e-mail como você desejar. Você pode passar uma <em>hash</em> contendo os campos do cabeçalho seguindo o padrão <code>chave: valor</code>, ou você pode chamar a variável <code>headers[:field_name] = value</code>.</li>
<li>
<code>attachments</code> — Permite adicionar anexos ao e-mail. Exemplo: <code>attachments['file-name.jpg'] = File.read('file-name.jpg')</code> que irá adicionar o arquivo <code>file-name.jpg</code> como anexo no e-mail.</li>
<li>
<code>mail</code> — Cria o e-mail de fato. Você pode usar a <em>hash</em> <code>headers</code> como um dos parâmetros.
<code>mail</code> vai criar o e-mail, tanto em texto puro ou <em>multipart</em>, dependendo dos modelos disponíveis que você definiu.</li>
</ul>
<h5 id="adicionando-anexos"><a class="anchorlink" href="#adicionando-anexos">2.3.1 Adicionando Anexos</a></h5><p>Com o <em>Action Mailer</em> é muito fácil trabalhar com anexos.</p>
<ul>
<li>
<p>Passe o nome do arquivo e o conteúdo para o <em>Action Mailer</em> e a <a href="https://github.com/mikel/mail">Mail gem</a> irá descobrir o <code>mime_type</code> do arquivo, define a codificação (<code>encoding</code>) e criar o anexo.</p>
<div class="code_container">
<pre><code class="highlight ruby"><span class="n">attachments</span><span class="p">[</span><span class="s1">'filename.jpg'</span><span class="p">]</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s1">'/caminho/para/o/arquivo.jpg'</span><span class="p">)</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-d8645376659a3f207e13183876e69113">attachments['filename.jpg'] = File.read('/caminho/para/o/arquivo.jpg')
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d8645376659a3f207e13183876e69113">Copiar</button>
</div>
</li>
</ul>
<p>  Quando o método <code>mail</code> for invocado, enviará um e-mail no modo <em>multipart</em>
  com o anexo, corretamente configurado, sendo o anexo a primeira parte
  como <code>multipart/mixed</code> e a mensagem sendo a segunda com <code>multipart/alternative</code>
  com o texto e o HTML do e-mail.</p><div class="note"><p>O anexo será codificado usando <em>Base64</em> pelo <code>Mail</code>. Se você precisar de algo diferente, codifique previamente o conteúdo e adicione o anexo e qual a codificação na <em>hash</em> <code>attachments</code>.</p></div>
<ul>
<li>
<p>Passe o nome do arquivo, cabeçalhos específicos e o conteúdo e o <em>Action Mailer</em> e <code>Mail</code> irão usar as configurações:</p>
<div class="code_container">
<pre><code class="highlight ruby"><span class="n">encoded_content</span> <span class="o">=</span> <span class="no">SpecialEncode</span><span class="p">(</span><span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s1">'/caminho/para/o/arquivo.jpg'</span><span class="p">))</span>
<span class="n">attachments</span><span class="p">[</span><span class="s1">'arquivo.jpg'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">mime_type: </span><span class="s1">'application/gzip'</span><span class="p">,</span>
  <span class="ss">encoding: </span><span class="s1">'SpecialEncoding'</span><span class="p">,</span>
  <span class="ss">content: </span><span class="n">encoded_content</span>
<span class="p">}</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-0f50b93ac3ffa9b9c219bddcfca3e746">encoded_content = SpecialEncode(File.read('/caminho/para/o/arquivo.jpg'))
attachments['arquivo.jpg'] = {
  mime_type: 'application/gzip',
  encoding: 'SpecialEncoding',
  content: encoded_content
}
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-0f50b93ac3ffa9b9c219bddcfca3e746">Copiar</button>
</div>
</li>
</ul>
<div class="note"><p>Se você especificar a codificação, <code>Mail</code> assumirá que o conteúdo já está codificado e não irá codificar usando o padrão <em>Base64</em>.</p></div><h5 id="criando-anexos-dentro-da-mensagem-de-e-mail-inline"><a class="anchorlink" href="#criando-anexos-dentro-da-mensagem-de-e-mail-inline">2.3.2 Criando Anexos dentro da Mensagem de E-mail (<em>Inline</em>)</a></h5><p><em>Action Mailer</em> 3.0 cria anexos dentro da mensagem de e-mail, algo que antes da versão 3.0 envolvia algumas gambiarras, de maneira muito simples e trivia como sempre deveria ter sido.</p>
<ul>
<li>
<p>Primeiro, para informar ao <code>Mail</code> que o anexo deve ser enviado dentro da própria mensagem você pode encadear o método <code>#inline</code> no <code>attachments</code> dentro da <em>action</em> do seu <em>Mailer</em>:</p>
<div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">welcome</span>
  <span class="n">attachments</span><span class="p">.</span><span class="nf">inline</span><span class="p">[</span><span class="s1">'image.jpg'</span><span class="p">]</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s1">'/caminho/para/a/imagem.jpg'</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-e5284052d017a07ce0ea5ebc5e60334c">def welcome
  attachments.inline['image.jpg'] = File.read('/caminho/para/a/imagem.jpg')
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-e5284052d017a07ce0ea5ebc5e60334c">Copiar</button>
</div>
</li>
<li>
<p>Na <em>view</em>, você só precisa especificar qual o anexo dentro de <code>attachments</code>, que é uma <em>hash</em>, você quer mostrar, encadeando o método <code>url</code> no anexo irá retornar o endereço do anexo e você pode passar o resultado para o método <code>image_tag</code> que renderiza uma imagem, veja o exemplo abaixo:</p>
<div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;p&gt;</span>Olá! Aqui está nossa imagem<span class="nt">&lt;/p&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">image_tag</span> <span class="n">attachments</span><span class="p">[</span><span class="s1">'imagem.jpg'</span><span class="p">].</span><span class="nf">url</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-fd90ba903be4028a14f7fc36ae6f189f">&lt;p&gt;Olá! Aqui está nossa imagem&lt;/p&gt;

&lt;%= image_tag attachments['imagem.jpg'].url %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-fd90ba903be4028a14f7fc36ae6f189f">Copiar</button>
</div>
</li>
<li>
<p>Como isso é uma chamada normal ao método <code>image_tag</code> você pode passar uma <em>hash</em> de opções após a <em>URL</em> do anexo como você faria para qualquer outra imagem:</p>
<div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;p&gt;</span>Olá! Aqui está nossa imagem<span class="nt">&lt;/p&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">image_tag</span> <span class="n">attachments</span><span class="p">[</span><span class="s1">'imagem.jpg'</span><span class="p">].</span><span class="nf">url</span><span class="p">,</span> <span class="ss">alt: </span><span class="s1">'Minha Foto'</span><span class="p">,</span> <span class="ss">class: </span><span class="s1">'fotos'</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-5cc9077931ad669bc3e45cc0d96f3b3c">&lt;p&gt;Olá! Aqui está nossa imagem&lt;/p&gt;

&lt;%= image_tag attachments['imagem.jpg'].url, alt: 'Minha Foto', class: 'fotos' %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-5cc9077931ad669bc3e45cc0d96f3b3c">Copiar</button>
</div>
</li>
</ul>
<h5 id="enviando-e-mail-para-varios-destinatarios"><a class="anchorlink" href="#enviando-e-mail-para-varios-destinatarios">2.3.3 Enviando E-mail para Vários Destinatários</a></h5><p>É possível enviar e-mail para um ou mais destinatários usando uma mensagem de e-mail (Por exemplo: notificando os administradores que houve um novo cadastro) bastando configurar uma lista de e-mails no parâmetro <code>:to</code>. Essa lista de e-mails pode ser um <em>Array</em> de endereços de e-mails ou uma <em>String</em> contendo todos os e-mails separados por vírgulas.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">AdminMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="n">default</span> <span class="ss">to: </span><span class="o">-&gt;</span> <span class="p">{</span> <span class="no">Admin</span><span class="p">.</span><span class="nf">pluck</span><span class="p">(</span><span class="ss">:email</span><span class="p">)</span> <span class="p">},</span>
          <span class="ss">from: </span><span class="s1">'notificacao@exemplo.com'</span>

  <span class="k">def</span> <span class="nf">new_registration</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="n">mail</span><span class="p">(</span><span class="ss">subject: </span><span class="s2">"Novo usuário cadastrado: </span><span class="si">#{</span><span class="vi">@user</span><span class="p">.</span><span class="nf">email</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-651ed5b0877f1594be7fae85fe390247">class AdminMailer &lt; ApplicationMailer
  default to: -&gt; { Admin.pluck(:email) },
          from: 'notificacao@exemplo.com'

  def new_registration(user)
    @user = user
    mail(subject: "Novo usuário cadastrado: #{@user.email}")
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-651ed5b0877f1594be7fae85fe390247">Copiar</button>
</div>
<div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">AdminMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="n">default</span> <span class="ss">to: </span><span class="s1">'email_um@exemplo.com,email_dois@exemplo.com,email_tres@exemplo.com'</span><span class="p">,</span>
          <span class="ss">from: </span><span class="s1">'notificacao@exemplo.com'</span>

  <span class="k">def</span> <span class="nf">new_registration</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="n">mail</span><span class="p">(</span><span class="ss">subject: </span><span class="s2">"Novo usuário cadastrado: </span><span class="si">#{</span><span class="vi">@user</span><span class="p">.</span><span class="nf">email</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-34fbf28007fad18bdfb10783b7787aaf">class AdminMailer &lt; ApplicationMailer
  default to: 'email_um@exemplo.com,email_dois@exemplo.com,email_tres@exemplo.com',
          from: 'notificacao@exemplo.com'

  def new_registration(user)
    @user = user
    mail(subject: "Novo usuário cadastrado: #{@user.email}")
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-34fbf28007fad18bdfb10783b7787aaf">Copiar</button>
</div>
<p>O mesmo formato pode ser usado para enviar e-mails com cópia (Cc:) ou com cópia oculta (Cco: ou Bcc: em inglês), adicione <code>:cc</code> ou <code>:bcc</code> para enviar seguindo os padrões descritos acima.</p><h5 id="enviando-e-mail-com-nome"><a class="anchorlink" href="#enviando-e-mail-com-nome">2.3.4 Enviando E-mail com Nome</a></h5><p>Em alguns momentos você deseja exibir o nome da pessoa que enviou a mensagem ao invés de mostrar somente o e-mail.
Você pode usar <code>email_address_with_name</code> para isso:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">welcome_email</span>
  <span class="vi">@user</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">]</span>
  <span class="n">mail</span><span class="p">(</span>
    <span class="ss">to: </span><span class="n">email_address_with_name</span><span class="p">(((((</span><span class="n">nc</span><span class="p">(</span><span class="vi">@user</span><span class="p">.</span><span class="nf">email</span><span class="p">,</span> <span class="vi">@user</span><span class="p">.</span><span class="nf">name</span><span class="p">),</span>
    <span class="ss">subject: </span><span class="s1">'Welcome to My Awesome Site'</span>
  <span class="p">)</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-cca81304c96470dc1dfa8b3e08092367">def welcome_email
  @user = params[:user]
  mail(
    to: email_address_with_name(((((nc(@user.email, @user.name),
    subject: 'Welcome to My Awesome Site'
  )
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-cca81304c96470dc1dfa8b3e08092367">Copiar</button>
</div>
<h4 id="views-de-mailer"><a class="anchorlink" href="#views-de-mailer">2.4 <em>Views</em> de <em>Mailer</em></a></h4><p>As <em>views</em> de um <em>Mailer</em> ficam no diretório <code>app/views/nome_da_classe_do_mailer</code>. A <em>view</em> específica do <em>mailer</em> é reconhecida pela classe pois seu nome é o mesmo do método. No exemplo anterior, nossa <em>view</em> para o método <code>welcome_email</code> estará em <code>app/views/user_mailer/welcome_email.html.erb</code>, para a versão em HTML e em <code>welcome_email.text.erb</code> para a versão em texto simples.</p><p>Para mudar a <em>mailer view</em> padrão da sua <em>action</em>, é preciso fazer algo como por exemplo:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="n">default</span> <span class="ss">from: </span><span class="s1">'notifications@example.com'</span>

  <span class="k">def</span> <span class="nf">welcome_email</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">]</span>
    <span class="vi">@url</span>  <span class="o">=</span> <span class="s1">'http://example.com/login'</span>
    <span class="n">mail</span><span class="p">(</span><span class="ss">to: </span><span class="vi">@user</span><span class="p">.</span><span class="nf">email</span><span class="p">,</span>
         <span class="ss">subject: </span><span class="s1">'Bem vindo ao meu site!'</span><span class="p">,</span>
         <span class="ss">template_path: </span><span class="s1">'notifications'</span><span class="p">,</span>
         <span class="ss">template_name: </span><span class="s1">'another'</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-4e2555f20b6d4f216c5beafbfe17d773">class UserMailer &lt; ApplicationMailer
  default from: 'notifications@example.com'

  def welcome_email
    @user = params[:user]
    @url  = 'http://example.com/login'
    mail(to: @user.email,
         subject: 'Bem vindo ao meu site!',
         template_path: 'notifications',
         template_name: 'another')
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-4e2555f20b6d4f216c5beafbfe17d773">Copiar</button>
</div>
<p>Nesse caso, os <em>templates</em> serão buscados em <code>app/views/notifications</code>, com o nome <code>another</code>. Também é possível especificar um <em>array</em> de caminhos, que serão verificados em ordem.</p><p>Se quiser mais flexibilidade, você pode fornecer um bloco e renderizar <em>templates</em> específicos, ou até mesmo renderizar texto ou conteúdo <em>inline</em> sem usar um arquivo de <em>template</em>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="n">default</span> <span class="ss">from: </span><span class="s1">'notifications@example.com'</span>

  <span class="k">def</span> <span class="nf">welcome_email</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">]</span>
    <span class="vi">@url</span>  <span class="o">=</span> <span class="s1">'http://example.com/login'</span>
    <span class="n">mail</span><span class="p">(</span><span class="ss">to: </span><span class="vi">@user</span><span class="p">.</span><span class="nf">email</span><span class="p">,</span>
         <span class="ss">subject: </span><span class="s1">'Bem vindo ao meu site!'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
      <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">render</span> <span class="s1">'another_template'</span> <span class="p">}</span>
      <span class="nb">format</span><span class="p">.</span><span class="nf">text</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">plain: </span><span class="s1">'Renderizar texto simples'</span> <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-86bce2619bf2769d89bd5983e51d24f2">class UserMailer &lt; ApplicationMailer
  default from: 'notifications@example.com'

  def welcome_email
    @user = params[:user]
    @url  = 'http://example.com/login'
    mail(to: @user.email,
         subject: 'Bem vindo ao meu site!') do |format|
      format.html { render 'another_template' }
      format.text { render plain: 'Renderizar texto simples' }
    end
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-86bce2619bf2769d89bd5983e51d24f2">Copiar</button>
</div>
<p>Isso fará com que o <em>template</em> 'another_template.html.erb' seja renderizado para a parte HTML, e usará o texto especificado para a parte textual. O comando <em>render</em> é o mesmo usado em <em>Action Controller</em>, então é possível usar as mesmas opções, como por exemplo, <code>:text</code>, <code>:inline</code>, etc.</p><p>Se deseja renderizar um <em>template</em> que está fora do diretório padrão <code>app/views/mailer_name/</code>, você pode usar a opção <code>prepend_view_path</code>, da seguinte forma:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="n">prepend_view_path</span> <span class="s2">"custom/path/to/mailer/view"</span>

  <span class="c1"># Isso tentará carregar o template "custom/path/to/mailer/view/welcome_email"</span>
  <span class="k">def</span> <span class="nf">welcome_email</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-86555732af08dcf6257552361f5acd0e">class UserMailer &lt; ApplicationMailer
  prepend_view_path "custom/path/to/mailer/view"

  # Isso tentará carregar o template "custom/path/to/mailer/view/welcome_email"
  def welcome_email
    # ...
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-86555732af08dcf6257552361f5acd0e">Copiar</button>
</div>
<p>Considere também usar o método <a href="https://guides.rubyonrails.org/action_view_overview.html#view-paths">append_view_path</a>.</p><h5 id="criando-cache-de-uma-view-de-mailer"><a class="anchorlink" href="#criando-cache-de-uma-view-de-mailer">2.4.1 Criando <em>cache</em> de uma <em>view</em> de <em>mailer</em></a></h5><p>É possível criar cache de um fragmento das <em>views</em> de um <em>mailer</em> da mesma forma como fazemos para as <em>views</em> da aplicação, usando o método <code>cache</code>.</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%</span> <span class="n">cache</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="vi">@company</span><span class="p">.</span><span class="nf">name</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-b27459b7c67c8e598c3f64660125a7e1">&lt;% cache do %&gt;
  &lt;%= @company.name %&gt;
&lt;% end %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-b27459b7c67c8e598c3f64660125a7e1">Copiar</button>
</div>
<p>Para usar essa funcionalidade, é necessário configurar sua aplicação da seguinte forma:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">action_mailer</span><span class="p">.</span><span class="nf">perform_caching</span> <span class="o">=</span> <span class="kp">true</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-8b927fc67473d1381cb5c96da6f07052">config.action_mailer.perform_caching = true
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8b927fc67473d1381cb5c96da6f07052">Copiar</button>
</div>
<p>Também é possível criar <em>cache</em> de fragmentos para os emails <em>multipart</em>. Leia mais sobre cache em <a href="caching_with_rails.html">Guia de cache do Rails</a>.</p><h4 id="layouts-de-action-mailer"><a class="anchorlink" href="#layouts-de-action-mailer">2.5 <em>Layouts de Action Mailer</em></a></h4><p>Similarmente como nas <em>views</em> dos <em>controllers</em>, é possível também ter <em>layouts</em> para os <em>mailers</em>. O nome do <em>layout</em> deve ser o mesmo do <em>mailer</em>, como <code>user_mailer.html.erb</code> e <code>user_mailer.text.erb</code> para ser reconhecido automaticamente pelo seu <em>mailer</em> como um <em>layout</em>.</p><p>Se quiser usar um arquivo diferente, chame <code>layout</code> em seu <em>mailer</em>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="n">layout</span> <span class="s1">'awesome'</span> <span class="c1"># use awesome.(html|text).erb as the layout</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-2763784d02c4d052e389af9fbf4d7c54">class UserMailer &lt; ApplicationMailer
  layout 'awesome' # use awesome.(html|text).erb as the layout
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2763784d02c4d052e389af9fbf4d7c54">Copiar</button>
</div>
<p>Assim como nas <em>views</em> de <em>controller</em>, use <code>yield</code> para renderizar a <em>view</em> dentro do layout.</p><p>Você também pode passar <code>layout: 'layout_name'</code> dentro do bloco de formatação como opção na chamada do <em>render</em> para especificar quais formatos usar em <em>layouts</em> diferentes:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="k">def</span> <span class="nf">welcome_email</span>
    <span class="n">mail</span><span class="p">(</span><span class="ss">to: </span><span class="n">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">].</span><span class="nf">email</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
      <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">layout: </span><span class="s1">'my_layout'</span> <span class="p">}</span>
      <span class="nb">format</span><span class="p">.</span><span class="nf">text</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-6e9acb726ca21551936dc381f221fcc2">class UserMailer &lt; ApplicationMailer
  def welcome_email
    mail(to: params[:user].email) do |format|
      format.html { render layout: 'my_layout' }
      format.text
    end
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-6e9acb726ca21551936dc381f221fcc2">Copiar</button>
</div>
<p>Vai renderizar a parte <em>HTML</em> usando o arquivo <code>my_layout.html.erb</code> e a parte de texto com o arquivo usual <code>user_mailer.text.erb</code> se ele existir.</p><h4 id="pre-visualizando-emails"><a class="anchorlink" href="#pre-visualizando-emails">2.6 Pré-visualizando Emails</a></h4><p>O <em>Action Mailer Preview</em> possibilita uma maneira de pré-visualizar como o email vai ficar, acessando uma <em>URL</em> especial que o renderiza. No exemplo acima, a classe para pré-visualizar <code>UserMailer</code> deve se chamar <code>UserMailerPreview</code>
e deve estar localizada em <code>test/mailers/previews/user_mailer_preview.rb</code>. Para ver o modelo de <code>welcome_email</code>, implemente um método que tem o mesmo nome e chame por <code>UserMailer.welcome_email</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UserMailerPreview</span> <span class="o">&lt;</span> <span class="no">ActionMailer</span><span class="o">::</span><span class="no">Preview</span>
  <span class="k">def</span> <span class="nf">welcome_email</span>
    <span class="no">UserMailer</span><span class="p">.</span><span class="nf">with</span><span class="p">(</span><span class="ss">user: </span><span class="no">User</span><span class="p">.</span><span class="nf">first</span><span class="p">).</span><span class="nf">welcome_email</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-ade970e88483a8cdc0fac34cde5b9bc2">class UserMailerPreview &lt; ActionMailer::Preview
  def welcome_email
    UserMailer.with(user: User.first).welcome_email
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-ade970e88483a8cdc0fac34cde5b9bc2">Copiar</button>
</div>
<p>Dessa maneira, o modelo vai ficar disponível em <a href="http://localhost:3000/rails/mailers/user_mailer/welcome_email">http://localhost:3000/rails/mailers/user_mailer/welcome_email</a>.</p><p>Se você mudar algo em <code>app/views/user_mailer/welcome_email.html.erb</code> ou no próprio <em>mailer</em>,
ele será automaticamente recarregado e renderizado, para que você veja as mudanças instantaneamente.
Uma lista das pré-visualizações também ficam disponíveis em <a href="http://localhost:3000/rails/mailers">http://localhost:3000/rails/mailers</a>.</p><p>Por padrão, essas classes de pré-visualizações ficam em <code>test/mailers/previews</code>. Isso pode ser configurado usando a opção <code>preview_path</code>. Por exemplo, se você quiser alterar para <code>lib/mailer_previews</code>, você pode configurar isso em <code>config/application.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">action_mailer</span><span class="p">.</span><span class="nf">preview_path</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="no">Rails</span><span class="p">.</span><span class="nf">root</span><span class="si">}</span><span class="s2">/lib/mailer_previews"</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-88b471520aa641805e3811770770b1ff">config.action_mailer.preview_path = "#{Rails.root}/lib/mailer_previews"
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-88b471520aa641805e3811770770b1ff">Copiar</button>
</div>
<h4 id="gerando-urls-no-action-mailer-views"><a class="anchorlink" href="#gerando-urls-no-action-mailer-views">2.7 Gerando URLs no Action Mailer Views</a></h4><p>Ao contrário dos <em>controllers</em>, a instância do <code>mailer</code> não tem nenhum contexto sobre a
requisição recebida, então você precisará informar o parâmetro <code>:host</code>.</p><p>Como o <code>:host</code> normalmente é o mesmo em toda a aplicação, você pode configurá-lo
globalmente no arquivo <code>config/application.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">action_mailer</span><span class="p">.</span><span class="nf">default_url_options</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">host: </span><span class="s1">'exemplo.com'</span> <span class="p">}</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-80d428a29c82107253ca252e0584f7b3">config.action_mailer.default_url_options = { host: 'exemplo.com' }
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-80d428a29c82107253ca252e0584f7b3">Copiar</button>
</div>
<p>Por causa dessa característica, você não pode usar nenhum dos <em>helpers</em> <code>*_path</code> dentro de
um email. Ao invés, você precisará usar o <code>*_url</code> helper respectivo. Por exemplo,
ao invés de usar:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'welcome'</span><span class="p">,</span> <span class="n">welcome_path</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-8f2d29b089507c37fb53e6e0cd93cae0">&lt;%= link_to 'welcome', welcome_path %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8f2d29b089507c37fb53e6e0cd93cae0">Copiar</button>
</div>
<p>Você precisará usar:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'welcome'</span><span class="p">,</span> <span class="n">welcome_url</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-042859ebb1ae0b431109fa2e05645c03">&lt;%= link_to 'welcome', welcome_url %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-042859ebb1ae0b431109fa2e05645c03">Copiar</button>
</div>
<p>Usando a URL completa, seus links irão funcionar dentro dos seus emails.</p><h5 id="gerando-urls-com-url-for"><a class="anchorlink" href="#gerando-urls-com-url-for">2.7.1 Gerando URLs com <code>url_for</code></a></h5><p>Por padrão, o <code>url_for</code> gera uma URL completa nos <em>templates</em>.</p><p>Se você não configurar a opção <code>:host</code> globalmente, não esqueça de passá-lo para o
<code>url_for</code>.</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">url_for</span><span class="p">(</span><span class="ss">host: </span><span class="s1">'example.com'</span><span class="p">,</span>
            <span class="ss">controller: </span><span class="s1">'welcome'</span><span class="p">,</span>
            <span class="ss">action: </span><span class="s1">'greeting'</span><span class="p">)</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-fa6ac907e1c2c48355a89a4497a4ef0e">&lt;%= url_for(host: 'example.com',
            controller: 'welcome',
            action: 'greeting') %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-fa6ac907e1c2c48355a89a4497a4ef0e">Copiar</button>
</div>
<h5 id="gerando-urls-com-rotas-nomeadas"><a class="anchorlink" href="#gerando-urls-com-rotas-nomeadas">2.7.2 Gerando URLs com Rotas Nomeadas</a></h5><p>Os clientes de email não têm o contexto da web e, portanto, os caminhos não têm a URL
base para completar os endereços da web. Assim, você deve sempre usar a variant  <code>*_url</code>
do <em>helper</em> da rota nomeada.</p><p>Se você não configurar a opção <code>:host</code> globalmente, não esqueça de passá-lo para o
helper da URL.</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">user_url</span><span class="p">(</span><span class="vi">@user</span><span class="p">,</span> <span class="ss">host: </span><span class="s1">'example.com'</span><span class="p">)</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-9137a806575adc0764fdabc0487fba6a">&lt;%= user_url(@user, host: 'example.com') %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-9137a806575adc0764fdabc0487fba6a">Copiar</button>
</div>
<div class="note"><p>Links que não são <code>GET</code> vão exigir o uso de <a href="https://github.com/rails/rails/blob/main/actionview/app/assets/javascripts">rails-ujs</a> ou
<a href="https://github.com/rails/jquery-ujs">jQuery UJS</a>, e, portanto, não irão funcionar em templates de email.
Eles irão resultar em requisições <code>GET</code> normais.</p></div><h4 id="adicionando-imagens-no-action-mailer-views"><a class="anchorlink" href="#adicionando-imagens-no-action-mailer-views">2.8 Adicionando imagens no Action Mailer Views</a></h4><p>Ao contrário dos controllers, a instância do <code>mailer</code> não tem nenhum contexto sobre a
requisição recebida, então você precisará informar o parâmetro <code>:asset_host</code>.</p><p>Como o <code>:asset_host</code> normalmente é o mesmo em toda a aplicação, você pode configurá-lo
globalmente no arquivo <code>config/application.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">asset_host</span> <span class="o">=</span> <span class="s1">'http://example.com'</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-cb43f63b12779362fc202ee93fea811f">config.asset_host = 'http://example.com'
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-cb43f63b12779362fc202ee93fea811f">Copiar</button>
</div>
<p>Agora você pode exibir uma imagem dentro do seu email.</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">image_tag</span> <span class="s1">'image.jpg'</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-16f582d7643974f51c59b9c707c2db54">&lt;%= image_tag 'image.jpg' %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-16f582d7643974f51c59b9c707c2db54">Copiar</button>
</div>
<h4 id="enviando-emails-multipart"><a class="anchorlink" href="#enviando-emails-multipart">2.9 Enviando Emails <em>Multipart</em></a></h4><p>O Action Mailer enviará automaticamente emails <em>multipart</em> se você tiver templates
diferentes para a mesma action. Então, para o nosso exemplo do <code>UserMailer</code>, se você tiver
os templates <code>welcome_email.text.erb</code> e <code>welcome_email.html.erb</code> na pasta
<code>app/views/user_mailer</code>, o Action Mailer irá automaticamente enviar um email multipart
com as versões de HTML e texto configuradas como partes diferentes.</p><p>A ordem das partes sendo inseridas é determinado pelo argumento <code>:parts_order</code>
dentro do método the <code>ActionMailer::Base.default</code>.</p><h4 id="enviando-emails-com-opcoes-de-entrega-dinamicas"><a class="anchorlink" href="#enviando-emails-com-opcoes-de-entrega-dinamicas">2.10 Enviando Emails com Opções de Entrega Dinâmicas</a></h4><p>Se você deseja sobrescrever as opções de entrega padrões (ex: as credenciais SMTP)
enquanto o email está sendo enviado, você pode fazer isso usando o <code>delivery_method_options</code>
na <em>action</em> do mailer.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="k">def</span> <span class="nf">welcome_email</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">]</span>
    <span class="vi">@url</span>  <span class="o">=</span> <span class="n">user_url</span><span class="p">(</span><span class="vi">@user</span><span class="p">)</span>
    <span class="n">delivery_options</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">user_name: </span><span class="n">params</span><span class="p">[</span><span class="ss">:company</span><span class="p">].</span><span class="nf">smtp_user</span><span class="p">,</span>
                         <span class="ss">password: </span><span class="n">params</span><span class="p">[</span><span class="ss">:company</span><span class="p">].</span><span class="nf">smtp_password</span><span class="p">,</span>
                         <span class="ss">address: </span><span class="n">params</span><span class="p">[</span><span class="ss">:company</span><span class="p">].</span><span class="nf">smtp_host</span> <span class="p">}</span>
    <span class="n">mail</span><span class="p">(</span><span class="ss">to: </span><span class="vi">@user</span><span class="p">.</span><span class="nf">email</span><span class="p">,</span>
         <span class="ss">subject: </span><span class="s2">"Please see the Terms and Conditions attached"</span><span class="p">,</span>
         <span class="ss">delivery_method_options: </span><span class="n">delivery_options</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-5bd1d93c037485f80c6bbe34185f1041">class UserMailer &lt; ApplicationMailer
  def welcome_email
    @user = params[:user]
    @url  = user_url(@user)
    delivery_options = { user_name: params[:company].smtp_user,
                         password: params[:company].smtp_password,
                         address: params[:company].smtp_host }
    mail(to: @user.email,
         subject: "Please see the Terms and Conditions attached",
         delivery_method_options: delivery_options)
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-5bd1d93c037485f80c6bbe34185f1041">Copiar</button>
</div>
<h4 id="enviando-emails-sem-renderizar-um-template"><a class="anchorlink" href="#enviando-emails-sem-renderizar-um-template">2.11 Enviando Emails sem Renderizar um <em>Template</em></a></h4><p>Podem haver casos onde você quer pular a etapa de renderização de um template e enviar
o corpo do email como <code>string</code>. Você pode fazer isso usando a opção <code>:body</code>.
Nesses casos, não esqueça de adicionar também a opção <code>:content_type</code>. Caso contrário,
o Rails vai usar o <code>text/plain</code> como padrão.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="k">def</span> <span class="nf">welcome_email</span>
    <span class="n">mail</span><span class="p">(</span><span class="ss">to: </span><span class="n">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">].</span><span class="nf">email</span><span class="p">,</span>
         <span class="ss">body: </span><span class="n">params</span><span class="p">[</span><span class="ss">:email_body</span><span class="p">],</span>
         <span class="ss">content_type: </span><span class="s2">"text/html"</span><span class="p">,</span>
         <span class="ss">subject: </span><span class="s2">"Already rendered!"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-eea3f1067b5517d9a96c4cb4a8335b3a">class UserMailer &lt; ApplicationMailer
  def welcome_email
    mail(to: params[:user].email,
         body: params[:email_body],
         content_type: "text/html",
         subject: "Already rendered!")
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-eea3f1067b5517d9a96c4cb4a8335b3a">Copiar</button>
</div>
<h3 id="callbacks-do-action-mailer"><a class="anchorlink" href="#callbacks-do-action-mailer">3 Callbacks do <em>Action Mailer</em></a></h3><p><em>Action Mailer</em> permite que você especifique o <code>before_action</code>, <code>after_action</code> e
<code>around_action</code>.</p>
<ul>
<li><p>Filtros podem ser especificados com um bloco ou um <em>symbol</em> para um  método no <em>Mailer</em>, similar a um <em>controller</em></p></li>
<li><p>Você pode usar um <code>before_action</code> para definir variáveis de instância,
popule o objeto de email com valores padrões, ou insira <em>headers</em> e anexos padrões.</p></li>
</ul>
<div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">InvitationsMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="n">before_action</span> <span class="ss">:set_inviter_and_invitee</span>
  <span class="n">before_action</span> <span class="p">{</span> <span class="vi">@account</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:inviter</span><span class="p">].</span><span class="nf">account</span> <span class="p">}</span>

  <span class="n">default</span> <span class="ss">to:       </span><span class="o">-&gt;</span> <span class="p">{</span> <span class="vi">@invitee</span><span class="p">.</span><span class="nf">email_address</span> <span class="p">},</span>
          <span class="ss">from:     </span><span class="o">-&gt;</span> <span class="p">{</span> <span class="n">common_address</span><span class="p">(</span><span class="vi">@inviter</span><span class="p">)</span> <span class="p">},</span>
          <span class="ss">reply_to: </span><span class="o">-&gt;</span> <span class="p">{</span> <span class="vi">@inviter</span><span class="p">.</span><span class="nf">email_address_with_name</span> <span class="p">}</span>

  <span class="k">def</span> <span class="nf">account_invitation</span>
    <span class="n">mail</span> <span class="ss">subject: </span><span class="s2">"</span><span class="si">#{</span><span class="vi">@inviter</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2"> invited you to their Basecamp (</span><span class="si">#{</span><span class="vi">@account</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">)"</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">project_invitation</span>
    <span class="vi">@project</span>    <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:project</span><span class="p">]</span>
    <span class="vi">@summarizer</span> <span class="o">=</span> <span class="no">ProjectInvitationSummarizer</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="vi">@project</span><span class="p">.</span><span class="nf">bucket</span><span class="p">)</span>

    <span class="n">mail</span> <span class="ss">subject: </span><span class="s2">"</span><span class="si">#{</span><span class="vi">@inviter</span><span class="p">.</span><span class="nf">name</span><span class="p">.</span><span class="nf">familiar</span><span class="si">}</span><span class="s2"> added you to a project in Basecamp (</span><span class="si">#{</span><span class="vi">@account</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">)"</span>
  <span class="k">end</span>

  <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">set_inviter_and_invitee</span>
      <span class="vi">@inviter</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:inviter</span><span class="p">]</span>
      <span class="vi">@invitee</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:invitee</span><span class="p">]</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-702a9a63dd111a88dad8cc04f5569db3">class InvitationsMailer &lt; ApplicationMailer
  before_action :set_inviter_and_invitee
  before_action { @account = params[:inviter].account }

  default to:       -&gt; { @invitee.email_address },
          from:     -&gt; { common_address(@inviter) },
          reply_to: -&gt; { @inviter.email_address_with_name }

  def account_invitation
    mail subject: "#{@inviter.name} invited you to their Basecamp (#{@account.name})"
  end

  def project_invitation
    @project    = params[:project]
    @summarizer = ProjectInvitationSummarizer.new(@project.bucket)

    mail subject: "#{@inviter.name.familiar} added you to a project in Basecamp (#{@account.name})"
  end

  private

    def set_inviter_and_invitee
      @inviter = params[:inviter]
      @invitee = params[:invitee]
    end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-702a9a63dd111a88dad8cc04f5569db3">Copiar</button>
</div>

<ul>
<li><p>Você pode usar um <code>after_action</code> para fazer uma configuração semelhante ao <code>before_action</code>, mas usando variáveis de instância definidas em sua <em>action</em> do <em>mailer</em>.</p></li>
<li><p>Usando um <code>after_action</code> também vai te permitir sobreescrever o método de
entrega definido por atualizar <code>mail.delivery_method.settings</code>.</p></li>
</ul>
<div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="n">before_action</span> <span class="p">{</span> <span class="vi">@business</span><span class="p">,</span> <span class="vi">@user</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:business</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">]</span> <span class="p">}</span>

  <span class="n">after_action</span> <span class="ss">:set_delivery_options</span><span class="p">,</span>
               <span class="ss">:prevent_delivery_to_guests</span><span class="p">,</span>
               <span class="ss">:set_business_headers</span>

  <span class="k">def</span> <span class="nf">feedback_message</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">campaign_message</span>
  <span class="k">end</span>

  <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">set_delivery_options</span>
      <span class="c1"># You have access to the mail instance,</span>
      <span class="c1"># @business and @user instance variables here</span>
      <span class="k">if</span> <span class="vi">@business</span> <span class="o">&amp;&amp;</span> <span class="vi">@business</span><span class="p">.</span><span class="nf">has_smtp_settings?</span>
        <span class="n">mail</span><span class="p">.</span><span class="nf">delivery_method</span><span class="p">.</span><span class="nf">settings</span><span class="p">.</span><span class="nf">merge!</span><span class="p">(</span><span class="vi">@business</span><span class="p">.</span><span class="nf">smtp_settings</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">prevent_delivery_to_guests</span>
      <span class="k">if</span> <span class="vi">@user</span> <span class="o">&amp;&amp;</span> <span class="vi">@user</span><span class="p">.</span><span class="nf">guest?</span>
        <span class="n">mail</span><span class="p">.</span><span class="nf">perform_deliveries</span> <span class="o">=</span> <span class="kp">false</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">set_business_headers</span>
      <span class="k">if</span> <span class="vi">@business</span>
        <span class="n">headers</span><span class="p">[</span><span class="s2">"X-SMTPAPI-CATEGORY"</span><span class="p">]</span> <span class="o">=</span> <span class="vi">@business</span><span class="p">.</span><span class="nf">code</span>
      <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-a84104b956c1b014c7386228c4df99f7">class UserMailer &lt; ApplicationMailer
  before_action { @business, @user = params[:business], params[:user] }

  after_action :set_delivery_options,
               :prevent_delivery_to_guests,
               :set_business_headers

  def feedback_message
  end

  def campaign_message
  end

  private

    def set_delivery_options
      # You have access to the mail instance,
      # @business and @user instance variables here
      if @business &amp;&amp; @business.has_smtp_settings?
        mail.delivery_method.settings.merge!(@business.smtp_settings)
      end
    end

    def prevent_delivery_to_guests
      if @user &amp;&amp; @user.guest?
        mail.perform_deliveries = false
      end
    end

    def set_business_headers
      if @business
        headers["X-SMTPAPI-CATEGORY"] = @business.code
      end
    end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-a84104b956c1b014c7386228c4df99f7">Copiar</button>
</div>

<ul>
<li>Os filtros do <em>mailer</em> interrompem o processamento adicional se o <em>body</em> estiver definido com um valor não nulo.</li>
</ul>
<h3 id="usando-os-helpers-do-action-mailer"><a class="anchorlink" href="#usando-os-helpers-do-action-mailer">4 Usando os <em>helpers</em> do <em>Action Mailer</em></a></h3><p>O <em>Action Mailer</em> agora herda de <code>AbstractController</code>, para que você tenha acesso aos mesmos
<em>helpers</em> genéricos que um <em>Action Controller</em>.</p><p>Existem também alguns métodos auxiliares específicos do Action Mailer disponíveis em
<code>ActionMailer::MailHelper</code>. Por exemplo, estes permitem acessar a instância de mailer
a partir da <em>view</em> com <code>mailer</code>, e acessando a mensagem usando <code>message</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="n">mailer</span><span class="p">.</span><span class="nf">name</span><span class="p">.</span><span class="nf">underscore</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="n">message</span><span class="p">.</span><span class="nf">subject</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-523a9fea1135bf47f310b5d476551283">&lt;%= stylesheet_link_tag mailer.name.underscore %&gt;
&lt;h1&gt;&lt;%= message.subject %&gt;&lt;/h1&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-523a9fea1135bf47f310b5d476551283">Copiar</button>
</div>
<h3 id="configuracao-do-action-mailer"><a class="anchorlink" href="#configuracao-do-action-mailer">5 Configuração do <em>Action Mailer</em></a></h3><p>As seguintes opções de configuração são feitas melhor em um dos ambientes
arquivos (environment.rb, production.rb, etc...)</p>
<table>
<thead>
<tr>
<th>Configuração</th>
<th>Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>logger</code></td>
<td>Gera informações sobre a execução de correspondência, se disponível. Pode ser definido como <code>nil</code> para nenhum registro. Compatível com os <em>loggers</em> <code>Logger</code> e <code>Log4r</code> do Ruby.</td>
</tr>
<tr>
<td><code>smtp_settings</code></td>
<td>Permite configuração detalhada para o método de entrega <code>:smtp</code>:<ul>
<li>
<code>:address</code> - Permite que você use um servidor de e-mail remoto. Basta alterar a configuração do padrão <code>"localhost"</code>.</li>
<li>
<code>:port</code> - Na chance de seu servidor de e-mail não funcionar na porta 25, você pode alterá-lo.</li>
<li>
<code>:domain</code> - Se você precisar especificar um domínio HELO, pode fazê-lo aqui.</li>
<li>
<code>:user_name</code> - Se o seu servidor de e-mail requer autenticação, defina o nome de usuário neste configuração.</li>
<li>
<code>:password</code> - Se o seu servidor de e-mail requer autenticação, defina a senha neste configuração.</li>
<li>
<code>:authentication</code> - Se o seu servidor de e-mail requer autenticação, você precisa especificar o tipo de autenticação aqui. Este é um símbolo e um dos <code>:plain</code> (irá enviar a senha em claro), <code>:login</code> (irá enviar senha codificada em Base64) or <code>:cram_md5</code> (combina um mecanismo de desafio / resposta para trocar informações e um algoritmo criptográfico Message Digest 5 para <em>hash</em> informações importantes)</li>
<li>
<code>:enable_starttls_auto</code> - Detecta se STARTTLS está habilitado em seu servidor SMTP e começa a usá-lo. O padrão é <code>true</code>.</li>
<li>
<code>:openssl_verify_mode</code> - Ao usar TLS, você pode definir como o OpenSSL verifica o certificado. Isso é realmente útil se você precisar validar um certificado auto assinado e / ou curinga. Você pode usar o nome de uma constante de verificação OpenSSL ('none' ou 'peer') ou diretamente a constante (<code>OpenSSL::SSL::VERIFY_NONE</code> ou <code>OpenSSL::SSL::VERIFY_PEER</code>).</li>
<li>
<code>:ssl/:tls</code> - Permite que a conexão SMTP use SMTP / TLS (SMTPS: SMTP sobre conexão TLS direta)</li>
</ul>
</td>
</tr>
<tr>
<td><code>sendmail_settings</code></td>
<td>Permite que você substitua as opções do método de entrega <code>: sendmail</code>.<ul>
<li>
<code>:location</code> - A localização do executável sendmail. Padrões para <code>/usr/sbin/sendmail</code>.</li>
<li>
<code>:arguments</code> - Os argumentos da linha de comando a serem passados ​​ao sendmail. Padrões para <code>-i</code>.</li>
</ul>
</td>
</tr>
<tr>
<td><code>raise_delivery_errors</code></td>
<td>Se erros devem ou não ser levantados se o e-mail não for entregue. This only works if the external email server is configured for immediate delivery.</td>
</tr>
<tr>
<td><code>delivery_method</code></td>
<td>Define um método de entrega. Os valores possíveis são:<ul>
<li>
<code>:smtp</code> (default), pode ser configurado usando <code>config.action_mailer.smtp_settings</code>.</li>
<li>
<code>:sendmail</code>, pode ser configurado usando <code>config.action_mailer.sendmail_settings</code>.</li>
<li>
<code>:file</code>: salva e-mails em arquivos; pode ser configurado usando <code>config.action_mailer.file_settings</code>.</li>
<li>
<code>:test</code>: salvar e-mails para <code>ActionMailer::Base.deliveries</code> array.</li>
</ul>Veja<a href="https://api.rubyonrails.org/v6.1.4/classes/ActionMailer/Base.html">API docs</a> para mais informações.</td>
</tr>
<tr>
<td><code>perform_deliveries</code></td>
<td>Determina se as entregas são realmente realizadas quando o método <code>entrega</code> é invocado na mensagem do <em>Mail</em>. Por padrão, eles são, mas isso pode ser desligado para ajudar nos testes funcionais. Se este valor for <code>false</code>, o <em>array</em> <code>deliveries</code> não será preenchido, mesmo se <code>delivery_method</code> for <code>:test</code>.</td>
</tr>
<tr>
<td><code>deliveries</code></td>
<td>Mantém um <em>array</em> de todos os emails enviados através do <em>Action Mailer</em> com delivery_method: test. Muito útil para testes de unidade e funcional.</td>
</tr>
<tr>
<td><code>default_options</code></td>
<td>Permite definir valores padrão para as opções do método <code>mail</code> (<code>:from</code>, <code>:reply_to</code>, etc.).</td>
</tr>
</tbody>
</table>
<p>Para uma descrição completa das configurações possíveis, consulte o
<a href="configuring.html#configuring-action-mailer">Configuring Action Mailer</a> dentro do
nosso guia de configuração de aplicativos Rails.</p><h4 id="exemplo-de-configuracao-do-action-mailer"><a class="anchorlink" href="#exemplo-de-configuracao-do-action-mailer">5.1 Exemplo de configuração do <em>Action Mailer</em></a></h4><p>Um exemplo seria adicionar o seguinte ao seu
arquivo <code>config/environments/$RAILS_ENV.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">action_mailer</span><span class="p">.</span><span class="nf">delivery_method</span> <span class="o">=</span> <span class="ss">:sendmail</span>
<span class="c1"># Defaults to:</span>
<span class="c1"># config.action_mailer.sendmail_settings = {</span>
<span class="c1">#   location: '/usr/sbin/sendmail',</span>
<span class="c1">#   arguments: '-i'</span>
<span class="c1"># }</span>
<span class="n">config</span><span class="p">.</span><span class="nf">action_mailer</span><span class="p">.</span><span class="nf">perform_deliveries</span> <span class="o">=</span> <span class="kp">true</span>
<span class="n">config</span><span class="p">.</span><span class="nf">action_mailer</span><span class="p">.</span><span class="nf">raise_delivery_errors</span> <span class="o">=</span> <span class="kp">true</span>
<span class="n">config</span><span class="p">.</span><span class="nf">action_mailer</span><span class="p">.</span><span class="nf">default_options</span> <span class="o">=</span> <span class="p">{</span><span class="ss">from: </span><span class="s1">'no-reply@example.com'</span><span class="p">}</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-ea83c074e4ad2c4deb451d5b7341244d">config.action_mailer.delivery_method = :sendmail
# Defaults to:
# config.action_mailer.sendmail_settings = {
#   location: '/usr/sbin/sendmail',
#   arguments: '-i'
# }
config.action_mailer.perform_deliveries = true
config.action_mailer.raise_delivery_errors = true
config.action_mailer.default_options = {from: 'no-reply@example.com'}
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-ea83c074e4ad2c4deb451d5b7341244d">Copiar</button>
</div>
<h4 id="configuracao-do-action-mailer-para-gmail"><a class="anchorlink" href="#configuracao-do-action-mailer-para-gmail">5.2 Configuração do <em>Action Mailer</em> para Gmail</a></h4><p>Como o Action Mailer agora usa a <a href="https://github.com/mikel/mail">gem Mail</a>,
torna-se tão simples quanto adicionar ao arquivo <code>config/environment/$ RAILS_ENV.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">action_mailer</span><span class="p">.</span><span class="nf">delivery_method</span> <span class="o">=</span> <span class="ss">:smtp</span>
<span class="n">config</span><span class="p">.</span><span class="nf">action_mailer</span><span class="p">.</span><span class="nf">smtp_settings</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">address:              </span><span class="s1">'smtp.gmail.com'</span><span class="p">,</span>
  <span class="ss">port:                 </span><span class="mi">587</span><span class="p">,</span>
  <span class="ss">domain:               </span><span class="s1">'example.com'</span><span class="p">,</span>
  <span class="ss">user_name:            </span><span class="s1">'&lt;username&gt;'</span><span class="p">,</span>
  <span class="ss">password:             </span><span class="s1">'&lt;password&gt;'</span><span class="p">,</span>
  <span class="ss">authentication:       </span><span class="s1">'plain'</span><span class="p">,</span>
  <span class="ss">enable_starttls_auto: </span><span class="kp">true</span> <span class="p">}</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-acf1dadba9bccf922804a2583cf08491">config.action_mailer.delivery_method = :smtp
config.action_mailer.smtp_settings = {
  address:              'smtp.gmail.com',
  port:                 587,
  domain:               'example.com',
  user_name:            '&lt;username&gt;',
  password:             '&lt;password&gt;',
  authentication:       'plain',
  enable_starttls_auto: true }
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-acf1dadba9bccf922804a2583cf08491">Copiar</button>
</div>
<div class="note"><p>Em 15 de julho de 2014, o Google aumentou <a href="https://support.google.com/accounts/answer/6010255">suas medidas de segurança</a> e agora bloqueia as tentativas de aplicativos que considera menos seguros.
Você pode alterar suas configurações do Gmail <a href="https://www.google.com/settings/security/lesssecureapps">aqui</a> para permitir as tentativas. Se sua conta do Gmail tiver a autenticação de dois fatores ativada
em seguida, você precisará definir uma <a href="https://myaccount.google.com/apppasswords">senha de aplicativo</a> e usá-la em vez de sua senha normal. Alternativamente, você pode
use outro ESP para enviar e-mail substituindo 'smtp.gmail.com' acima pelo endereço do seu provedor.</p></div><h3 id="testes-de-mailer"><a class="anchorlink" href="#testes-de-mailer">6 Testes de <em>Mailer</em></a></h3><p>Você encontrará instruções detalhadas de como testar seus <em>mailers</em> no
<a href="testing.html#testing-your-mailers">guia de teste</a>.</p><h3 id="interceptando-e-observando-emails"><a class="anchorlink" href="#interceptando-e-observando-emails">7 Interceptando e Observando Emails</a></h3><p><em>Action Mailer</em> fornece ganchos para os métodos observador e interceptor do Mail. Eles permitem que você registre classes que são chamadas durante o ciclo de vida de entrega de cada e-mail enviado.</p><h4 id="interceptando-emails"><a class="anchorlink" href="#interceptando-emails">7.1 Interceptando Emails</a></h4><p>Os interceptores permitem que você faça modificações em emails antes que eles sejam entregues aos agentes de entrega. Uma classe de interceptor deve implementar o método <code>::delivering_email(message)</code> que será chamado antes do e-mail ser enviado.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">SandboxEmailInterceptor</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">delivering_email</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="n">message</span><span class="p">.</span><span class="nf">to</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'sandbox@example.com'</span><span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-8552093fb1b7bef5e532ac2ee158f368">class SandboxEmailInterceptor
  def self.delivering_email(message)
    message.to = ['sandbox@example.com']
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8552093fb1b7bef5e532ac2ee158f368">Copiar</button>
</div>
<p>Antes que o interceptor possa fazer seu trabalho, você precisa registrá-lo
usando <code>register_interceptor</code>. Você pode fazer isso em um arquivo inicializador
como <code>config/initializers/sandbox_email_interceptor.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">if</span> <span class="no">Rails</span><span class="p">.</span><span class="nf">env</span><span class="p">.</span><span class="nf">staging?</span>
  <span class="no">ActionMailer</span><span class="o">::</span><span class="no">Base</span><span class="p">.</span><span class="nf">register_interceptor</span><span class="p">(</span><span class="no">SandboxEmailInterceptor</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-a28aaf80fc788679310f7bb50c7e46e8">if Rails.env.staging?
  ActionMailer::Base.register_interceptor(SandboxEmailInterceptor)
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-a28aaf80fc788679310f7bb50c7e46e8">Copiar</button>
</div>
<div class="note"><p>O exemplo acima usa um ambiente personalizado chamado "staging" para um
servidor como em produção, mas para fins de teste. Você pode ler
<a href="configuring.html#creating-rails-environments">Criação de Ambientes Rails</a>
para mais informações sobre ambientes Rails personalizados.</p></div><h4 id="observando-emails"><a class="anchorlink" href="#observando-emails">7.2 Observando Emails</a></h4><p>Os observadores fornecem acesso à mensagem de e-mail após ela ter sido enviada. Uma classe de observador deve implementar o método <code>:delivered_email(message)</code>, que será chamado após o e-mail ser enviado.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">EmailDeliveryObserver</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">delivered_email</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="no">EmailDelivery</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-26f4d443f37d7d1f4a1762afe0112314">class EmailDeliveryObserver
  def self.delivered_email(message)
    EmailDelivery.log(message)
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-26f4d443f37d7d1f4a1762afe0112314">Copiar</button>
</div>
<p>Como os interceptores, você precisa registrar observadores usando <code>register_observer</code>. Você pode fazer isso em um arquivo inicializador
como <code>config/initializers/email_delivery_observer.rb</code></p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">ActionMailer</span><span class="o">::</span><span class="no">Base</span><span class="p">.</span><span class="nf">register_observer</span><span class="p">(</span><span class="no">EmailDeliveryObserver</span><span class="p">)</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-dcc8417e085bcb96d282f34945f1a246">ActionMailer::Base.register_observer(EmailDeliveryObserver)
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-dcc8417e085bcb96d282f34945f1a246">Copiar</button>
</div>


        <h3>Feedback</h3>
        <p>
          Você é incentivado a ajudar a melhorar a qualidade deste guia.
        </p>
        <p>
          Por favor, contribua caso veja quaisquer erros, inclusive erros de digitação.
          Para começar, você pode ler nossa sessão de <a href="https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">contribuindo com a documentação</a>.
        </p>
        <p>
          Você também pode encontrar conteúdo incompleto ou coisas que não estão atualizadas.
          Por favor, adicione qualquer documentação em falta na main do Rails. Certifique-se de checar o
          <a href="http://edgeguides.rubyonrails.org">Edge Guides (en-US)</a> primeiro para verificar
          se o problema já foi resolvido ou não no branch main.
          Verifique as <a href="ruby_on_rails_guides_guidelines.html">Diretrizes do Guia Ruby on Rails</a>
          para estilo e convenções.
        </p>
        <p>
          Se, por qualquer motivo, você encontrar algo para consertar, mas não conseguir consertá-lo, por favor
          <a href="https://github.com/campuscode/rails-guides-pt-BR/issues">abra uma issue no nosso Guia</a>.
        </p>
        <p>
          E por último, mas não menos importante, qualquer tipo de discussão sobre a documentação do Ruby on Rails
          é muito bem vinda na <a href="https://discuss.rubyonrails.org/c/rubyonrails-docs">lista de discussão rubyonrails-docs</a> e nas
          <a href="https://github.com/campuscode/rails-guides-pt-BR/issues">issues do Guia em português</a>.
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p> Este projeto está licenciado sob uma licença <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International</a></p>
<p>"Rails", "Ruby on Rails", e o logotipo Rails são marcas comerciais de David Heinemeier Hansson. Todos os direitos reservados.</p>

    </div>
  </div>
  <div id="toggle">
    <img alt="dark theme icon" class="icon">
  </div>
</body>
</html>
